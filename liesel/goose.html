<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.0"/>
    <title>liesel.goose API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */.docstring h2, .docstring h3, .docstring h4, .docstring h5{font-size:1.25rem;font-weight:500;margin:0 0 0.5rem 0;padding:0;}li p + p{margin-top:-0.5rem;}</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../liesel.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;liesel</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

        <h2>Contents</h2>
        <ul>
  <li><a href="#goose-mcmc-framework">Goose MCMC framework</a></li>
</ul>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#DictModel">DictModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DictModel.__init__">DictModel</a>
                        </li>
                        <li>
                                <a class="function" href="#DictModel.extract_position">extract_position</a>
                        </li>
                        <li>
                                <a class="function" href="#DictModel.update_state">update_state</a>
                        </li>
                        <li>
                                <a class="function" href="#DictModel.log_prob">log_prob</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Engine">Engine</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Engine.__init__">Engine</a>
                        </li>
                        <li>
                                <a class="variable" href="#Engine.current_epoch">current_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#Engine.sample_all_epochs">sample_all_epochs</a>
                        </li>
                        <li>
                                <a class="function" href="#Engine.sample_next_epoch">sample_next_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#Engine.append_epoch">append_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#Engine.is_sampling_done">is_sampling_done</a>
                        </li>
                        <li>
                                <a class="function" href="#Engine.get_results">get_results</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EngineBuilder">EngineBuilder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EngineBuilder.__init__">EngineBuilder</a>
                        </li>
                        <li>
                                <a class="variable" href="#EngineBuilder.positions_included">positions_included</a>
                        </li>
                        <li>
                                <a class="variable" href="#EngineBuilder.positions_excluded">positions_excluded</a>
                        </li>
                        <li>
                                <a class="function" href="#EngineBuilder.set_engine_seed">set_engine_seed</a>
                        </li>
                        <li>
                                <a class="variable" href="#EngineBuilder.engine_seed">engine_seed</a>
                        </li>
                        <li>
                                <a class="function" href="#EngineBuilder.add_kernel">add_kernel</a>
                        </li>
                        <li>
                                <a class="variable" href="#EngineBuilder.kernels">kernels</a>
                        </li>
                        <li>
                                <a class="function" href="#EngineBuilder.add_quantity_generator">add_quantity_generator</a>
                        </li>
                        <li>
                                <a class="variable" href="#EngineBuilder.quantity_generators">quantity_generators</a>
                        </li>
                        <li>
                                <a class="function" href="#EngineBuilder.set_initial_values">set_initial_values</a>
                        </li>
                        <li>
                                <a class="variable" href="#EngineBuilder.model_state">model_state</a>
                        </li>
                        <li>
                                <a class="function" href="#EngineBuilder.set_epochs">set_epochs</a>
                        </li>
                        <li>
                                <a class="function" href="#EngineBuilder.set_duration">set_duration</a>
                        </li>
                        <li>
                                <a class="variable" href="#EngineBuilder.epochs">epochs</a>
                        </li>
                        <li>
                                <a class="function" href="#EngineBuilder.set_model">set_model</a>
                        </li>
                        <li>
                                <a class="function" href="#EngineBuilder.build">build</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EpochConfig">EpochConfig</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EpochConfig.__init__">EpochConfig</a>
                        </li>
                        <li>
                                <a class="function" href="#EpochConfig.to_state">to_state</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EpochType">EpochType</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#EpochType.INITIAL_VALUES">INITIAL_VALUES</a>
                        </li>
                        <li>
                                <a class="variable" href="#EpochType.FAST_ADAPTATION">FAST_ADAPTATION</a>
                        </li>
                        <li>
                                <a class="variable" href="#EpochType.SLOW_ADAPTATION">SLOW_ADAPTATION</a>
                        </li>
                        <li>
                                <a class="variable" href="#EpochType.BURNIN">BURNIN</a>
                        </li>
                        <li>
                                <a class="variable" href="#EpochType.POSTERIOR">POSTERIOR</a>
                        </li>
                        <li>
                                <a class="function" href="#EpochType.is_adaptation">is_adaptation</a>
                        </li>
                        <li>
                                <a class="function" href="#EpochType.is_warmup">is_warmup</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GibbsKernel">GibbsKernel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GibbsKernel.__init__">GibbsKernel</a>
                        </li>
                        <li>
                                <a class="variable" href="#GibbsKernel.error_book">error_book</a>
                        </li>
                        <li>
                                <a class="variable" href="#GibbsKernel.needs_history">needs_history</a>
                        </li>
                        <li>
                                <a class="variable" href="#GibbsKernel.identifier">identifier</a>
                        </li>
                        <li>
                                <a class="function" href="#GibbsKernel.init_state">init_state</a>
                        </li>
                        <li>
                                <a class="function" href="#GibbsKernel.transition">transition</a>
                        </li>
                        <li>
                                <a class="function" href="#GibbsKernel.tune">tune</a>
                        </li>
                        <li>
                                <a class="function" href="#GibbsKernel.start_epoch">start_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#GibbsKernel.end_epoch">end_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#GibbsKernel.end_warmup">end_warmup</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HMCKernel">HMCKernel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HMCKernel.__init__">HMCKernel</a>
                        </li>
                        <li>
                                <a class="variable" href="#HMCKernel.error_book">error_book</a>
                        </li>
                        <li>
                                <a class="variable" href="#HMCKernel.needs_history">needs_history</a>
                        </li>
                        <li>
                                <a class="variable" href="#HMCKernel.identifier">identifier</a>
                        </li>
                        <li>
                                <a class="function" href="#HMCKernel.init_state">init_state</a>
                        </li>
                        <li>
                                <a class="function" href="#HMCKernel.start_epoch">start_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#HMCKernel.end_epoch">end_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#HMCKernel.end_warmup">end_warmup</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#IWLSKernel">IWLSKernel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#IWLSKernel.__init__">IWLSKernel</a>
                        </li>
                        <li>
                                <a class="variable" href="#IWLSKernel.error_book">error_book</a>
                        </li>
                        <li>
                                <a class="variable" href="#IWLSKernel.needs_history">needs_history</a>
                        </li>
                        <li>
                                <a class="variable" href="#IWLSKernel.identifier">identifier</a>
                        </li>
                        <li>
                                <a class="function" href="#IWLSKernel.init_state">init_state</a>
                        </li>
                        <li>
                                <a class="function" href="#IWLSKernel.tune">tune</a>
                        </li>
                        <li>
                                <a class="function" href="#IWLSKernel.start_epoch">start_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#IWLSKernel.end_epoch">end_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#IWLSKernel.end_warmup">end_warmup</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ModelInterface">ModelInterface</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ModelInterface.extract_position">extract_position</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelInterface.update_state">update_state</a>
                        </li>
                        <li>
                                <a class="function" href="#ModelInterface.log_prob">log_prob</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#NUTSKernel">NUTSKernel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#NUTSKernel.__init__">NUTSKernel</a>
                        </li>
                        <li>
                                <a class="variable" href="#NUTSKernel.error_book">error_book</a>
                        </li>
                        <li>
                                <a class="variable" href="#NUTSKernel.needs_history">needs_history</a>
                        </li>
                        <li>
                                <a class="variable" href="#NUTSKernel.identifier">identifier</a>
                        </li>
                        <li>
                                <a class="function" href="#NUTSKernel.init_state">init_state</a>
                        </li>
                        <li>
                                <a class="function" href="#NUTSKernel.start_epoch">start_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#NUTSKernel.end_epoch">end_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#NUTSKernel.end_warmup">end_warmup</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#Position">Position</a>
            </li>
            <li>
                    <a class="class" href="#RWKernel">RWKernel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RWKernel.__init__">RWKernel</a>
                        </li>
                        <li>
                                <a class="variable" href="#RWKernel.error_book">error_book</a>
                        </li>
                        <li>
                                <a class="variable" href="#RWKernel.needs_history">needs_history</a>
                        </li>
                        <li>
                                <a class="variable" href="#RWKernel.identifier">identifier</a>
                        </li>
                        <li>
                                <a class="function" href="#RWKernel.init_state">init_state</a>
                        </li>
                        <li>
                                <a class="function" href="#RWKernel.tune">tune</a>
                        </li>
                        <li>
                                <a class="function" href="#RWKernel.start_epoch">start_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#RWKernel.end_epoch">end_epoch</a>
                        </li>
                        <li>
                                <a class="function" href="#RWKernel.end_warmup">end_warmup</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Summary">Summary</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Summary.__init__">Summary</a>
                        </li>
                        <li>
                                <a class="function" href="#Summary.to_dataframe">to_dataframe</a>
                        </li>
                        <li>
                                <a class="function" href="#Summary.from_result">from_result</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#plot_cor">plot_cor</a>
            </li>
            <li>
                    <a class="function" href="#plot_density">plot_density</a>
            </li>
            <li>
                    <a class="function" href="#plot_param">plot_param</a>
            </li>
            <li>
                    <a class="function" href="#plot_trace">plot_trace</a>
            </li>
            <li>
                    <a class="function" href="#stan_epochs">stan_epochs</a>
            </li>
            <li>
                    <a class="function" href="#summary">summary</a>
            </li>
    </ul>


    <footer>My Package v1.0</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../liesel.html">liesel</a><wbr>.goose    </h1>

                        <div class="docstring"><h1 id="goose-mcmc-framework">Goose MCMC framework</h1>

<p>This module defines the public API of Goose. Expect breakages if using anything
beyond this module (and maybe also if using this module, as this is early-stage
research software).</p>
</div>

                        <input id="goose-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="goose-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd"># Goose MCMC framework</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">This module defines the public API of Goose. Expect breakages if using anything</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="sd">beyond this module (and maybe also if using this module, as this is early-stage</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="sd">research software).</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span> <span class="nn">.builder</span> <span class="kn">import</span> <span class="n">EngineBuilder</span> <span class="k">as</span> <span class="n">EngineBuilder</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span> <span class="nn">.engine</span> <span class="kn">import</span> <span class="n">Engine</span> <span class="k">as</span> <span class="n">Engine</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span> <span class="nn">.epoch</span> <span class="kn">import</span> <span class="n">EpochConfig</span><span class="p">,</span> <span class="n">EpochType</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span> <span class="nn">.gibbs</span> <span class="kn">import</span> <span class="n">GibbsKernel</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="kn">from</span> <span class="nn">.hmc</span> <span class="kn">import</span> <span class="n">HMCKernel</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="kn">from</span> <span class="nn">.iwls</span> <span class="kn">import</span> <span class="n">IWLSKernel</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">DictModel</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="kn">from</span> <span class="nn">.nuts</span> <span class="kn">import</span> <span class="n">NUTSKernel</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a><span class="kn">from</span> <span class="nn">.rw</span> <span class="kn">import</span> <span class="n">RWKernel</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="kn">from</span> <span class="nn">.summary_m</span> <span class="kn">import</span> <span class="n">Summary</span><span class="p">,</span> <span class="n">summary</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a><span class="kn">from</span> <span class="nn">.summary_viz</span> <span class="kn">import</span> <span class="n">plot_cor</span><span class="p">,</span> <span class="n">plot_density</span><span class="p">,</span> <span class="n">plot_param</span><span class="p">,</span> <span class="n">plot_trace</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="kn">from</span> <span class="nn">.types</span> <span class="kn">import</span> <span class="n">ModelInterface</span><span class="p">,</span> <span class="n">Position</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a><span class="kn">from</span> <span class="nn">.warmup</span> <span class="kn">import</span> <span class="n">stan_epochs</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="s2">&quot;DictModel&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s2">&quot;Engine&quot;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;EngineBuilder&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="s2">&quot;EpochConfig&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;EpochType&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;GibbsKernel&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="s2">&quot;HMCKernel&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="s2">&quot;IWLSKernel&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="s2">&quot;ModelInterface&quot;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="s2">&quot;NUTSKernel&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="s2">&quot;Position&quot;</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>    <span class="s2">&quot;RWKernel&quot;</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="s2">&quot;Summary&quot;</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>    <span class="s2">&quot;plot_cor&quot;</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a>    <span class="s2">&quot;plot_density&quot;</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a>    <span class="s2">&quot;plot_param&quot;</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a>    <span class="s2">&quot;plot_trace&quot;</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a>    <span class="s2">&quot;stan_epochs&quot;</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a>    <span class="s2">&quot;summary&quot;</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="DictModel">
                            <input id="DictModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DictModel</span>:

                <label class="view-source-button" for="DictModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictModel-14"><a href="#DictModel-14"><span class="linenos">14</span></a><span class="k">class</span> <span class="nc">DictModel</span><span class="p">:</span>
</span><span id="DictModel-15"><a href="#DictModel-15"><span class="linenos">15</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DictModel-16"><a href="#DictModel-16"><span class="linenos">16</span></a><span class="sd">    A model interface for a model state represented by a `dict[str, Array]`</span>
</span><span id="DictModel-17"><a href="#DictModel-17"><span class="linenos">17</span></a><span class="sd">    and a corresponding log-probability function.</span>
</span><span id="DictModel-18"><a href="#DictModel-18"><span class="linenos">18</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DictModel-19"><a href="#DictModel-19"><span class="linenos">19</span></a>
</span><span id="DictModel-20"><a href="#DictModel-20"><span class="linenos">20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_prob_fn</span><span class="p">:</span> <span class="n">LogProbFunction</span><span class="p">):</span>
</span><span id="DictModel-21"><a href="#DictModel-21"><span class="linenos">21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_prob_fn</span> <span class="o">=</span> <span class="n">log_prob_fn</span>
</span><span id="DictModel-22"><a href="#DictModel-22"><span class="linenos">22</span></a>
</span><span id="DictModel-23"><a href="#DictModel-23"><span class="linenos">23</span></a>    <span class="k">def</span> <span class="nf">extract_position</span><span class="p">(</span>
</span><span id="DictModel-24"><a href="#DictModel-24"><span class="linenos">24</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span>
</span><span id="DictModel-25"><a href="#DictModel-25"><span class="linenos">25</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Position</span><span class="p">:</span>
</span><span id="DictModel-26"><a href="#DictModel-26"><span class="linenos">26</span></a>        <span class="k">return</span> <span class="n">Position</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">model_state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">position_keys</span><span class="p">})</span>
</span><span id="DictModel-27"><a href="#DictModel-27"><span class="linenos">27</span></a>
</span><span id="DictModel-28"><a href="#DictModel-28"><span class="linenos">28</span></a>    <span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">Position</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelState</span><span class="p">:</span>
</span><span id="DictModel-29"><a href="#DictModel-29"><span class="linenos">29</span></a>        <span class="k">return</span> <span class="n">model_state</span> <span class="o">|</span> <span class="n">position</span>
</span><span id="DictModel-30"><a href="#DictModel-30"><span class="linenos">30</span></a>
</span><span id="DictModel-31"><a href="#DictModel-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">log_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="DictModel-32"><a href="#DictModel-32"><span class="linenos">32</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A model interface for a model state represented by a <code>dict[str, Array]</code>
and a corresponding log-probability function.</p>
</div>


                            <div id="DictModel.__init__" class="classattr">
                                        <input id="DictModel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DictModel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">log_prob_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="DictModel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictModel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictModel.__init__-20"><a href="#DictModel.__init__-20"><span class="linenos">20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_prob_fn</span><span class="p">:</span> <span class="n">LogProbFunction</span><span class="p">):</span>
</span><span id="DictModel.__init__-21"><a href="#DictModel.__init__-21"><span class="linenos">21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_log_prob_fn</span> <span class="o">=</span> <span class="n">log_prob_fn</span>
</span></pre></div>


    

                            </div>
                            <div id="DictModel.extract_position" class="classattr">
                                        <input id="DictModel.extract_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_position</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Position</span>:</span></span>

                <label class="view-source-button" for="DictModel.extract_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictModel.extract_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictModel.extract_position-23"><a href="#DictModel.extract_position-23"><span class="linenos">23</span></a>    <span class="k">def</span> <span class="nf">extract_position</span><span class="p">(</span>
</span><span id="DictModel.extract_position-24"><a href="#DictModel.extract_position-24"><span class="linenos">24</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span>
</span><span id="DictModel.extract_position-25"><a href="#DictModel.extract_position-25"><span class="linenos">25</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Position</span><span class="p">:</span>
</span><span id="DictModel.extract_position-26"><a href="#DictModel.extract_position-26"><span class="linenos">26</span></a>        <span class="k">return</span> <span class="n">Position</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">model_state</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">position_keys</span><span class="p">})</span>
</span></pre></div>


    

                            </div>
                            <div id="DictModel.update_state" class="classattr">
                                        <input id="DictModel.update_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">position</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Position</span>, </span><span class="param"><span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="DictModel.update_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictModel.update_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictModel.update_state-28"><a href="#DictModel.update_state-28"><span class="linenos">28</span></a>    <span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">Position</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelState</span><span class="p">:</span>
</span><span id="DictModel.update_state-29"><a href="#DictModel.update_state-29"><span class="linenos">29</span></a>        <span class="k">return</span> <span class="n">model_state</span> <span class="o">|</span> <span class="n">position</span>
</span></pre></div>


    

                            </div>
                            <div id="DictModel.log_prob" class="classattr">
                                        <input id="DictModel.log_prob-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log_prob</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="DictModel.log_prob-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DictModel.log_prob"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DictModel.log_prob-31"><a href="#DictModel.log_prob-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">log_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="DictModel.log_prob-32"><a href="#DictModel.log_prob-32"><span class="linenos">32</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Engine">
                            <input id="Engine-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Engine</span>:

                <label class="view-source-button" for="Engine-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Engine"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Engine-162"><a href="#Engine-162"><span class="linenos">162</span></a><span class="k">class</span> <span class="nc">Engine</span><span class="p">:</span>
</span><span id="Engine-163"><a href="#Engine-163"><span class="linenos">163</span></a>    <span class="sd">&quot;&quot;&quot;MCMC engine capable of combining multiple transition kernels.&quot;&quot;&quot;</span>
</span><span id="Engine-164"><a href="#Engine-164"><span class="linenos">164</span></a>
</span><span id="Engine-165"><a href="#Engine-165"><span class="linenos">165</span></a>    <span class="c1"># __slots__ = (</span>
</span><span id="Engine-166"><a href="#Engine-166"><span class="linenos">166</span></a>    <span class="c1">#     &quot;_prng_keys&quot;,</span>
</span><span id="Engine-167"><a href="#Engine-167"><span class="linenos">167</span></a>    <span class="c1">#     &quot;_model_states&quot;,</span>
</span><span id="Engine-168"><a href="#Engine-168"><span class="linenos">168</span></a>    <span class="c1">#     &quot;_kernel_states&quot;,</span>
</span><span id="Engine-169"><a href="#Engine-169"><span class="linenos">169</span></a>    <span class="c1">#     &quot;_calculator&quot;,</span>
</span><span id="Engine-170"><a href="#Engine-170"><span class="linenos">170</span></a>    <span class="c1">#     &quot;_random_calculator&quot;,</span>
</span><span id="Engine-171"><a href="#Engine-171"><span class="linenos">171</span></a>    <span class="c1">#     &quot;_position_chain&quot;,</span>
</span><span id="Engine-172"><a href="#Engine-172"><span class="linenos">172</span></a>    <span class="c1">#     &quot;_transition_info_chain&quot;,</span>
</span><span id="Engine-173"><a href="#Engine-173"><span class="linenos">173</span></a>    <span class="c1">#     &quot;_tuning_info_chain&quot;,</span>
</span><span id="Engine-174"><a href="#Engine-174"><span class="linenos">174</span></a>    <span class="c1">#     &quot;_calc_result_chain&quot;,</span>
</span><span id="Engine-175"><a href="#Engine-175"><span class="linenos">175</span></a>    <span class="c1">#     &quot;_calc_result_random_chain&quot;,</span>
</span><span id="Engine-176"><a href="#Engine-176"><span class="linenos">176</span></a>    <span class="c1">#     &quot;_epoch_configs&quot;,</span>
</span><span id="Engine-177"><a href="#Engine-177"><span class="linenos">177</span></a>    <span class="c1">#     &quot;_position_keys&quot;,</span>
</span><span id="Engine-178"><a href="#Engine-178"><span class="linenos">178</span></a>    <span class="c1"># )</span>
</span><span id="Engine-179"><a href="#Engine-179"><span class="linenos">179</span></a>
</span><span id="Engine-180"><a href="#Engine-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Engine-181"><a href="#Engine-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Engine-182"><a href="#Engine-182"><span class="linenos">182</span></a>        <span class="n">seeds</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="Engine-183"><a href="#Engine-183"><span class="linenos">183</span></a>        <span class="n">model_states</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="Engine-184"><a href="#Engine-184"><span class="linenos">184</span></a>        <span class="n">kernel_sequence</span><span class="p">:</span> <span class="n">KernelSequence</span><span class="p">,</span>
</span><span id="Engine-185"><a href="#Engine-185"><span class="linenos">185</span></a>        <span class="n">epoch_configs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">EpochConfig</span><span class="p">],</span>
</span><span id="Engine-186"><a href="#Engine-186"><span class="linenos">186</span></a>        <span class="n">jitted_sample_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Engine-187"><a href="#Engine-187"><span class="linenos">187</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">ModelInterface</span><span class="p">,</span>
</span><span id="Engine-188"><a href="#Engine-188"><span class="linenos">188</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Engine-189"><a href="#Engine-189"><span class="linenos">189</span></a>        <span class="n">minimize_transition_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Engine-190"><a href="#Engine-190"><span class="linenos">190</span></a>        <span class="n">store_kernel_states</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Engine-191"><a href="#Engine-191"><span class="linenos">191</span></a>        <span class="n">quantity_generators</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">QuantityGenerator</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="Engine-192"><a href="#Engine-192"><span class="linenos">192</span></a>        <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Engine-193"><a href="#Engine-193"><span class="linenos">193</span></a>    <span class="p">):</span>
</span><span id="Engine-194"><a href="#Engine-194"><span class="linenos">194</span></a>        <span class="c1"># fill slots that can be filled directly</span>
</span><span id="Engine-195"><a href="#Engine-195"><span class="linenos">195</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_inital_states</span> <span class="o">=</span> <span class="n">model_states</span>
</span><span id="Engine-196"><a href="#Engine-196"><span class="linenos">196</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_seeds</span> <span class="o">=</span> <span class="n">seeds</span>
</span><span id="Engine-197"><a href="#Engine-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_jitted_sample_duration</span> <span class="o">=</span> <span class="n">jitted_sample_duration</span>
</span><span id="Engine-198"><a href="#Engine-198"><span class="linenos">198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_minimize_transition_infos</span> <span class="o">=</span> <span class="n">minimize_transition_infos</span>
</span><span id="Engine-199"><a href="#Engine-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_store_kernel_states</span> <span class="o">=</span> <span class="n">store_kernel_states</span>
</span><span id="Engine-200"><a href="#Engine-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span> <span class="o">=</span> <span class="n">model_states</span>
</span><span id="Engine-201"><a href="#Engine-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span> <span class="o">=</span> <span class="n">quantity_generators</span>
</span><span id="Engine-202"><a href="#Engine-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span> <span class="o">=</span> <span class="n">show_progress</span>
</span><span id="Engine-203"><a href="#Engine-203"><span class="linenos">203</span></a>
</span><span id="Engine-204"><a href="#Engine-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span> <span class="o">=</span> <span class="n">kernel_sequence</span>
</span><span id="Engine-205"><a href="#Engine-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_manager</span> <span class="o">=</span> <span class="n">EpochManager</span><span class="p">(</span><span class="n">epoch_configs</span><span class="p">)</span>
</span><span id="Engine-206"><a href="#Engine-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_has_ended</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Engine-207"><a href="#Engine-207"><span class="linenos">207</span></a>
</span><span id="Engine-208"><a href="#Engine-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">position_keys</span><span class="p">:</span>
</span><span id="Engine-209"><a href="#Engine-209"><span class="linenos">209</span></a>            <span class="n">position_keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Engine-210"><a href="#Engine-210"><span class="linenos">210</span></a>                <span class="n">key</span>
</span><span id="Engine-211"><a href="#Engine-211"><span class="linenos">211</span></a>                <span class="k">for</span> <span class="n">ker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">_kernels</span>  <span class="c1"># FIXME: use of private field</span>
</span><span id="Engine-212"><a href="#Engine-212"><span class="linenos">212</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ker</span><span class="o">.</span><span class="n">position_keys</span>
</span><span id="Engine-213"><a href="#Engine-213"><span class="linenos">213</span></a>            <span class="p">]</span>
</span><span id="Engine-214"><a href="#Engine-214"><span class="linenos">214</span></a>
</span><span id="Engine-215"><a href="#Engine-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_position_keys</span> <span class="o">=</span> <span class="n">position_keys</span>
</span><span id="Engine-216"><a href="#Engine-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="Engine-217"><a href="#Engine-217"><span class="linenos">217</span></a>
</span><span id="Engine-218"><a href="#Engine-218"><span class="linenos">218</span></a>        <span class="c1"># feed in history if at least one kernel requires history for tuning</span>
</span><span id="Engine-219"><a href="#Engine-219"><span class="linenos">219</span></a>        <span class="c1">#</span>
</span><span id="Engine-220"><a href="#Engine-220"><span class="linenos">220</span></a>        <span class="c1"># FIXME: automatically fetch position keys</span>
</span><span id="Engine-221"><a href="#Engine-221"><span class="linenos">221</span></a>        <span class="c1">#</span>
</span><span id="Engine-222"><a href="#Engine-222"><span class="linenos">222</span></a>        <span class="c1"># fetch kernels&#39; position keys and add them automatically to track them</span>
</span><span id="Engine-223"><a href="#Engine-223"><span class="linenos">223</span></a>        <span class="c1"># in the position chain</span>
</span><span id="Engine-224"><a href="#Engine-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_history_required_for_tuning</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="Engine-225"><a href="#Engine-225"><span class="linenos">225</span></a>            <span class="p">[</span><span class="n">ker</span><span class="o">.</span><span class="n">needs_history</span> <span class="k">for</span> <span class="n">ker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">_kernels</span><span class="p">]</span>
</span><span id="Engine-226"><a href="#Engine-226"><span class="linenos">226</span></a>        <span class="p">)</span>  <span class="c1"># FIXME: use of private field</span>
</span><span id="Engine-227"><a href="#Engine-227"><span class="linenos">227</span></a>
</span><span id="Engine-228"><a href="#Engine-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prng_key</span> <span class="o">=</span> <span class="n">seeds</span>
</span><span id="Engine-229"><a href="#Engine-229"><span class="linenos">229</span></a>
</span><span id="Engine-230"><a href="#Engine-230"><span class="linenos">230</span></a>        <span class="c1"># setup storage</span>
</span><span id="Engine-231"><a href="#Engine-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_position_chain</span><span class="p">:</span> <span class="n">EpochChainManager</span> <span class="o">=</span> <span class="n">EpochChainManager</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Engine-232"><a href="#Engine-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_transition_info_chain</span><span class="p">:</span> <span class="n">EpochChainManager</span> <span class="o">=</span> <span class="n">EpochChainManager</span><span class="p">(</span>
</span><span id="Engine-233"><a href="#Engine-233"><span class="linenos">233</span></a>            <span class="n">multichain</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Engine-234"><a href="#Engine-234"><span class="linenos">234</span></a>        <span class="p">)</span>
</span><span id="Engine-235"><a href="#Engine-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tuning_info_chain</span><span class="p">:</span> <span class="n">ListChain</span> <span class="o">=</span> <span class="n">ListChain</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Engine-236"><a href="#Engine-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_state_chain</span><span class="p">:</span> <span class="n">EpochChainManager</span> <span class="o">=</span> <span class="n">EpochChainManager</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Engine-237"><a href="#Engine-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_chain</span><span class="p">:</span> <span class="n">EpochChainManager</span> <span class="o">=</span> <span class="n">EpochChainManager</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Engine-238"><a href="#Engine-238"><span class="linenos">238</span></a>
</span><span id="Engine-239"><a href="#Engine-239"><span class="linenos">239</span></a>        <span class="c1"># initialize kernel state</span>
</span><span id="Engine-240"><a href="#Engine-240"><span class="linenos">240</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_prng_key_one</span><span class="p">()</span>
</span><span id="Engine-241"><a href="#Engine-241"><span class="linenos">241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">init_states</span><span class="p">)(</span>
</span><span id="Engine-242"><a href="#Engine-242"><span class="linenos">242</span></a>            <span class="n">keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span>
</span><span id="Engine-243"><a href="#Engine-243"><span class="linenos">243</span></a>        <span class="p">)</span>
</span><span id="Engine-244"><a href="#Engine-244"><span class="linenos">244</span></a>
</span><span id="Engine-245"><a href="#Engine-245"><span class="linenos">245</span></a>        <span class="c1"># current epoch</span>
</span><span id="Engine-246"><a href="#Engine-246"><span class="linenos">246</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span><span class="p">:</span> <span class="n">EpochState</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine-247"><a href="#Engine-247"><span class="linenos">247</span></a>
</span><span id="Engine-248"><a href="#Engine-248"><span class="linenos">248</span></a>        <span class="c1"># jit sample function</span>
</span><span id="Engine-249"><a href="#Engine-249"><span class="linenos">249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_many_jitted</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span>
</span><span id="Engine-250"><a href="#Engine-250"><span class="linenos">250</span></a>            <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span>
</span><span id="Engine-251"><a href="#Engine-251"><span class="linenos">251</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_sample_many</span><span class="p">,</span>
</span><span id="Engine-252"><a href="#Engine-252"><span class="linenos">252</span></a>                <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="Engine-253"><a href="#Engine-253"><span class="linenos">253</span></a>                <span class="n">out_axes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="Engine-254"><a href="#Engine-254"><span class="linenos">254</span></a>            <span class="p">)</span>
</span><span id="Engine-255"><a href="#Engine-255"><span class="linenos">255</span></a>        <span class="p">)</span>
</span><span id="Engine-256"><a href="#Engine-256"><span class="linenos">256</span></a>
</span><span id="Engine-257"><a href="#Engine-257"><span class="linenos">257</span></a>    <span class="nd">@property</span>
</span><span id="Engine-258"><a href="#Engine-258"><span class="linenos">258</span></a>    <span class="k">def</span> <span class="nf">current_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EpochState</span><span class="p">:</span>
</span><span id="Engine-259"><a href="#Engine-259"><span class="linenos">259</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Engine-260"><a href="#Engine-260"><span class="linenos">260</span></a><span class="sd">        Returns the current epoch.</span>
</span><span id="Engine-261"><a href="#Engine-261"><span class="linenos">261</span></a>
</span><span id="Engine-262"><a href="#Engine-262"><span class="linenos">262</span></a><span class="sd">        Raises a `RuntimeError` if no epoch is active.</span>
</span><span id="Engine-263"><a href="#Engine-263"><span class="linenos">263</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Engine-264"><a href="#Engine-264"><span class="linenos">264</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Engine-265"><a href="#Engine-265"><span class="linenos">265</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No active epoch&quot;</span><span class="p">)</span>
</span><span id="Engine-266"><a href="#Engine-266"><span class="linenos">266</span></a>
</span><span id="Engine-267"><a href="#Engine-267"><span class="linenos">267</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span>
</span><span id="Engine-268"><a href="#Engine-268"><span class="linenos">268</span></a>
</span><span id="Engine-269"><a href="#Engine-269"><span class="linenos">269</span></a>    <span class="k">def</span> <span class="nf">sample_all_epochs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine-270"><a href="#Engine-270"><span class="linenos">270</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Engine-271"><a href="#Engine-271"><span class="linenos">271</span></a><span class="sd">        Runs sampling for all remaining epochs.</span>
</span><span id="Engine-272"><a href="#Engine-272"><span class="linenos">272</span></a>
</span><span id="Engine-273"><a href="#Engine-273"><span class="linenos">273</span></a><span class="sd">        Auto-tuning methods are called automatically.</span>
</span><span id="Engine-274"><a href="#Engine-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Engine-275"><a href="#Engine-275"><span class="linenos">275</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_manager</span><span class="o">.</span><span class="n">has_more</span><span class="p">():</span>
</span><span id="Engine-276"><a href="#Engine-276"><span class="linenos">276</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_next_epoch</span><span class="p">()</span>
</span><span id="Engine-277"><a href="#Engine-277"><span class="linenos">277</span></a>
</span><span id="Engine-278"><a href="#Engine-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">sample_next_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine-279"><a href="#Engine-279"><span class="linenos">279</span></a>        <span class="sd">&quot;&quot;&quot;Runs sampling for the next epoch assuming no epoch is active.&quot;&quot;&quot;</span>
</span><span id="Engine-280"><a href="#Engine-280"><span class="linenos">280</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_start_epoch</span><span class="p">()</span>
</span><span id="Engine-281"><a href="#Engine-281"><span class="linenos">281</span></a>
</span><span id="Engine-282"><a href="#Engine-282"><span class="linenos">282</span></a>        <span class="c1"># special treatment for the initial values</span>
</span><span id="Engine-283"><a href="#Engine-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">INITIAL_VALUES</span><span class="p">:</span>
</span><span id="Engine-284"><a href="#Engine-284"><span class="linenos">284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_inital_values_epoch</span><span class="p">()</span>
</span><span id="Engine-285"><a href="#Engine-285"><span class="linenos">285</span></a>            <span class="k">return</span>
</span><span id="Engine-286"><a href="#Engine-286"><span class="linenos">286</span></a>
</span><span id="Engine-287"><a href="#Engine-287"><span class="linenos">287</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_start_epoch</span><span class="p">()</span>
</span><span id="Engine-288"><a href="#Engine-288"><span class="linenos">288</span></a>
</span><span id="Engine-289"><a href="#Engine-289"><span class="linenos">289</span></a>        <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">duration</span>
</span><span id="Engine-290"><a href="#Engine-290"><span class="linenos">290</span></a>        <span class="n">epoch_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">name</span>
</span><span id="Engine-291"><a href="#Engine-291"><span class="linenos">291</span></a>        <span class="n">jitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jitted_sample_duration</span>
</span><span id="Engine-292"><a href="#Engine-292"><span class="linenos">292</span></a>
</span><span id="Engine-293"><a href="#Engine-293"><span class="linenos">293</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">:</span>
</span><span id="Engine-294"><a href="#Engine-294"><span class="linenos">294</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="Engine-295"><a href="#Engine-295"><span class="linenos">295</span></a>                <span class="sa">f</span><span class="s2">&quot;Starting epoch: </span><span class="si">{</span><span class="n">epoch_type</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> transitions, &quot;</span>
</span><span id="Engine-296"><a href="#Engine-296"><span class="linenos">296</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">jitted</span><span class="si">}</span><span class="s2"> jitted together&quot;</span>
</span><span id="Engine-297"><a href="#Engine-297"><span class="linenos">297</span></a>            <span class="p">)</span>
</span><span id="Engine-298"><a href="#Engine-298"><span class="linenos">298</span></a>
</span><span id="Engine-299"><a href="#Engine-299"><span class="linenos">299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_for_duration</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
</span><span id="Engine-300"><a href="#Engine-300"><span class="linenos">300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_end_epoch</span><span class="p">()</span>
</span><span id="Engine-301"><a href="#Engine-301"><span class="linenos">301</span></a>
</span><span id="Engine-302"><a href="#Engine-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">append_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochConfig</span><span class="p">):</span>
</span><span id="Engine-303"><a href="#Engine-303"><span class="linenos">303</span></a>        <span class="sd">&quot;&quot;&quot;Appends an epoch to the epochs that should be sampled.&quot;&quot;&quot;</span>
</span><span id="Engine-304"><a href="#Engine-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_manager</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
</span><span id="Engine-305"><a href="#Engine-305"><span class="linenos">305</span></a>
</span><span id="Engine-306"><a href="#Engine-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">is_sampling_done</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Engine-307"><a href="#Engine-307"><span class="linenos">307</span></a>        <span class="sd">&quot;&quot;&quot;Returns true if all configured epochs have been sampled.&quot;&quot;&quot;</span>
</span><span id="Engine-308"><a href="#Engine-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_manager</span><span class="o">.</span><span class="n">has_more</span><span class="p">()</span>
</span><span id="Engine-309"><a href="#Engine-309"><span class="linenos">309</span></a>
</span><span id="Engine-310"><a href="#Engine-310"><span class="linenos">310</span></a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SamplingResult</span><span class="p">:</span>
</span><span id="Engine-311"><a href="#Engine-311"><span class="linenos">311</span></a>        <span class="sd">&quot;&quot;&quot;Returns the results of the sampling process.&quot;&quot;&quot;</span>
</span><span id="Engine-312"><a href="#Engine-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store_kernel_states</span><span class="p">:</span>
</span><span id="Engine-313"><a href="#Engine-313"><span class="linenos">313</span></a>            <span class="n">ksc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_state_chain</span>
</span><span id="Engine-314"><a href="#Engine-314"><span class="linenos">314</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Engine-315"><a href="#Engine-315"><span class="linenos">315</span></a>            <span class="n">ksc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine-316"><a href="#Engine-316"><span class="linenos">316</span></a>
</span><span id="Engine-317"><a href="#Engine-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span>
</span><span id="Engine-318"><a href="#Engine-318"><span class="linenos">318</span></a>            <span class="n">gqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_chain</span>
</span><span id="Engine-319"><a href="#Engine-319"><span class="linenos">319</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Engine-320"><a href="#Engine-320"><span class="linenos">320</span></a>            <span class="n">gqs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine-321"><a href="#Engine-321"><span class="linenos">321</span></a>
</span><span id="Engine-322"><a href="#Engine-322"><span class="linenos">322</span></a>        <span class="k">return</span> <span class="n">SamplingResult</span><span class="p">(</span>
</span><span id="Engine-323"><a href="#Engine-323"><span class="linenos">323</span></a>            <span class="n">positions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_position_chain</span><span class="p">,</span>
</span><span id="Engine-324"><a href="#Engine-324"><span class="linenos">324</span></a>            <span class="n">transition_infos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_transition_info_chain</span><span class="p">,</span>
</span><span id="Engine-325"><a href="#Engine-325"><span class="linenos">325</span></a>            <span class="n">generated_quantities</span><span class="o">=</span><span class="n">Option</span><span class="p">(</span><span class="n">gqs</span><span class="p">),</span>
</span><span id="Engine-326"><a href="#Engine-326"><span class="linenos">326</span></a>            <span class="n">tuning_infos</span><span class="o">=</span><span class="n">Option</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuning_info_chain</span><span class="p">),</span>
</span><span id="Engine-327"><a href="#Engine-327"><span class="linenos">327</span></a>            <span class="n">kernel_states</span><span class="o">=</span><span class="n">Option</span><span class="p">(</span><span class="n">ksc</span><span class="p">),</span>
</span><span id="Engine-328"><a href="#Engine-328"><span class="linenos">328</span></a>            <span class="n">full_model_states</span><span class="o">=</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
</span><span id="Engine-329"><a href="#Engine-329"><span class="linenos">329</span></a>        <span class="p">)</span>
</span><span id="Engine-330"><a href="#Engine-330"><span class="linenos">330</span></a>
</span><span id="Engine-331"><a href="#Engine-331"><span class="linenos">331</span></a>    <span class="k">def</span> <span class="nf">_split_prng_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeyArray</span><span class="p">:</span>
</span><span id="Engine-332"><a href="#Engine-332"><span class="linenos">332</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="n">_split_keys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prng_key</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Engine-333"><a href="#Engine-333"><span class="linenos">333</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prng_key</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Engine-334"><a href="#Engine-334"><span class="linenos">334</span></a>        <span class="k">return</span> <span class="n">keys</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>
</span><span id="Engine-335"><a href="#Engine-335"><span class="linenos">335</span></a>
</span><span id="Engine-336"><a href="#Engine-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">_split_prng_key_one</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeyArray</span><span class="p">:</span>
</span><span id="Engine-337"><a href="#Engine-337"><span class="linenos">337</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_prng_key</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Engine-338"><a href="#Engine-338"><span class="linenos">338</span></a>        <span class="k">return</span> <span class="n">key</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="Engine-339"><a href="#Engine-339"><span class="linenos">339</span></a>
</span><span id="Engine-340"><a href="#Engine-340"><span class="linenos">340</span></a>    <span class="k">def</span> <span class="nf">_generate_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine-341"><a href="#Engine-341"><span class="linenos">341</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span>
</span><span id="Engine-342"><a href="#Engine-342"><span class="linenos">342</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Engine-343"><a href="#Engine-343"><span class="linenos">343</span></a>
</span><span id="Engine-344"><a href="#Engine-344"><span class="linenos">344</span></a>        <span class="n">quants</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Engine-345"><a href="#Engine-345"><span class="linenos">345</span></a>
</span><span id="Engine-346"><a href="#Engine-346"><span class="linenos">346</span></a>        <span class="k">for</span> <span class="n">qg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span>
</span><span id="Engine-347"><a href="#Engine-347"><span class="linenos">347</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_prng_key_one</span><span class="p">()</span>
</span><span id="Engine-348"><a href="#Engine-348"><span class="linenos">348</span></a>            <span class="n">gen_f</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">generate</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</span><span id="Engine-349"><a href="#Engine-349"><span class="linenos">349</span></a>            <span class="n">quant</span> <span class="o">=</span> <span class="n">gen_f</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="p">)</span>
</span><span id="Engine-350"><a href="#Engine-350"><span class="linenos">350</span></a>            <span class="n">quants</span><span class="p">[</span><span class="n">qg</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant</span>
</span><span id="Engine-351"><a href="#Engine-351"><span class="linenos">351</span></a>
</span><span id="Engine-352"><a href="#Engine-352"><span class="linenos">352</span></a>        <span class="k">return</span> <span class="n">quants</span>
</span><span id="Engine-353"><a href="#Engine-353"><span class="linenos">353</span></a>
</span><span id="Engine-354"><a href="#Engine-354"><span class="linenos">354</span></a>    <span class="k">def</span> <span class="nf">_handle_inital_values_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine-355"><a href="#Engine-355"><span class="linenos">355</span></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">INITIAL_VALUES</span>
</span><span id="Engine-356"><a href="#Engine-356"><span class="linenos">356</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">advance_time</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Engine-357"><a href="#Engine-357"><span class="linenos">357</span></a>
</span><span id="Engine-358"><a href="#Engine-358"><span class="linenos">358</span></a>        <span class="n">initial_position</span> <span class="o">=</span> <span class="n">_add_time_dimension</span><span class="p">(</span>
</span><span id="Engine-359"><a href="#Engine-359"><span class="linenos">359</span></a>            <span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Engine-360"><a href="#Engine-360"><span class="linenos">360</span></a>            <span class="n">x</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">extract_position</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span>
</span><span id="Engine-361"><a href="#Engine-361"><span class="linenos">361</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_position_keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span>
</span><span id="Engine-362"><a href="#Engine-362"><span class="linenos">362</span></a>            <span class="p">),</span>
</span><span id="Engine-363"><a href="#Engine-363"><span class="linenos">363</span></a>        <span class="p">)</span>
</span><span id="Engine-364"><a href="#Engine-364"><span class="linenos">364</span></a>
</span><span id="Engine-365"><a href="#Engine-365"><span class="linenos">365</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_position_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initial_position</span><span class="p">)</span>
</span><span id="Engine-366"><a href="#Engine-366"><span class="linenos">366</span></a>
</span><span id="Engine-367"><a href="#Engine-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store_kernel_states</span><span class="p">:</span>
</span><span id="Engine-368"><a href="#Engine-368"><span class="linenos">368</span></a>            <span class="n">ks</span> <span class="o">=</span> <span class="n">_add_time_dimension</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span><span class="p">)</span>
</span><span id="Engine-369"><a href="#Engine-369"><span class="linenos">369</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_state_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>
</span><span id="Engine-370"><a href="#Engine-370"><span class="linenos">370</span></a>
</span><span id="Engine-371"><a href="#Engine-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span>
</span><span id="Engine-372"><a href="#Engine-372"><span class="linenos">372</span></a>            <span class="n">quants</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_quantity</span><span class="p">()</span>
</span><span id="Engine-373"><a href="#Engine-373"><span class="linenos">373</span></a>            <span class="n">quants</span> <span class="o">=</span> <span class="n">_add_time_dimension</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">quants</span><span class="p">)</span>
</span><span id="Engine-374"><a href="#Engine-374"><span class="linenos">374</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quants</span><span class="p">)</span>
</span><span id="Engine-375"><a href="#Engine-375"><span class="linenos">375</span></a>
</span><span id="Engine-376"><a href="#Engine-376"><span class="linenos">376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine-377"><a href="#Engine-377"><span class="linenos">377</span></a>
</span><span id="Engine-378"><a href="#Engine-378"><span class="linenos">378</span></a>    <span class="k">def</span> <span class="nf">_start_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine-379"><a href="#Engine-379"><span class="linenos">379</span></a>        <span class="sd">&quot;&quot;&quot;Advances to the next epoch.&quot;&quot;&quot;</span>
</span><span id="Engine-380"><a href="#Engine-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Engine-381"><a href="#Engine-381"><span class="linenos">381</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Epoch is active and not completed&quot;</span><span class="p">)</span>
</span><span id="Engine-382"><a href="#Engine-382"><span class="linenos">382</span></a>
</span><span id="Engine-383"><a href="#Engine-383"><span class="linenos">383</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_manager</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span><span id="Engine-384"><a href="#Engine-384"><span class="linenos">384</span></a>
</span><span id="Engine-385"><a href="#Engine-385"><span class="linenos">385</span></a>        <span class="c1"># invoke end_warmup() for the first non-warmup epoch</span>
</span><span id="Engine-386"><a href="#Engine-386"><span class="linenos">386</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="Engine-387"><a href="#Engine-387"><span class="linenos">387</span></a>            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_has_ended</span>
</span><span id="Engine-388"><a href="#Engine-388"><span class="linenos">388</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">POSTERIOR</span>
</span><span id="Engine-389"><a href="#Engine-389"><span class="linenos">389</span></a>        <span class="p">):</span>
</span><span id="Engine-390"><a href="#Engine-390"><span class="linenos">390</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_end_warmup</span><span class="p">()</span>
</span><span id="Engine-391"><a href="#Engine-391"><span class="linenos">391</span></a>
</span><span id="Engine-392"><a href="#Engine-392"><span class="linenos">392</span></a>        <span class="c1"># advance chains to next epoch</span>
</span><span id="Engine-393"><a href="#Engine-393"><span class="linenos">393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_position_chain</span><span class="o">.</span><span class="n">advance_epoch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
</span><span id="Engine-394"><a href="#Engine-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_transition_info_chain</span><span class="o">.</span><span class="n">advance_epoch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
</span><span id="Engine-395"><a href="#Engine-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_state_chain</span><span class="o">.</span><span class="n">advance_epoch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
</span><span id="Engine-396"><a href="#Engine-396"><span class="linenos">396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_chain</span><span class="o">.</span><span class="n">advance_epoch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
</span><span id="Engine-397"><a href="#Engine-397"><span class="linenos">397</span></a>
</span><span id="Engine-398"><a href="#Engine-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">_kernel_start_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine-399"><a href="#Engine-399"><span class="linenos">399</span></a>        <span class="sd">&quot;&quot;&quot;Inform kernels about new epoch.&quot;&quot;&quot;</span>
</span><span id="Engine-400"><a href="#Engine-400"><span class="linenos">400</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_prng_key_one</span><span class="p">()</span>
</span><span id="Engine-401"><a href="#Engine-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span>
</span><span id="Engine-402"><a href="#Engine-402"><span class="linenos">402</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">start_epoch</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Engine-403"><a href="#Engine-403"><span class="linenos">403</span></a>        <span class="p">)(</span><span class="n">keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="p">)</span>
</span><span id="Engine-404"><a href="#Engine-404"><span class="linenos">404</span></a>
</span><span id="Engine-405"><a href="#Engine-405"><span class="linenos">405</span></a>    <span class="k">def</span> <span class="nf">_end_warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine-406"><a href="#Engine-406"><span class="linenos">406</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Engine-407"><a href="#Engine-407"><span class="linenos">407</span></a><span class="sd">        Ends the warmup sequence.</span>
</span><span id="Engine-408"><a href="#Engine-408"><span class="linenos">408</span></a>
</span><span id="Engine-409"><a href="#Engine-409"><span class="linenos">409</span></a><span class="sd">        Calls `end_warmup` for each kernel. From now on, only epochs of type</span>
</span><span id="Engine-410"><a href="#Engine-410"><span class="linenos">410</span></a><span class="sd">        posterior can follow.</span>
</span><span id="Engine-411"><a href="#Engine-411"><span class="linenos">411</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Engine-412"><a href="#Engine-412"><span class="linenos">412</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_prng_key_one</span><span class="p">()</span>
</span><span id="Engine-413"><a href="#Engine-413"><span class="linenos">413</span></a>        <span class="n">tuning_infos</span><span class="p">:</span> <span class="n">TuningInfos</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tuning_info_chain</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">value</span>
</span><span id="Engine-414"><a href="#Engine-414"><span class="linenos">414</span></a>
</span><span id="Engine-415"><a href="#Engine-415"><span class="linenos">415</span></a>        <span class="n">end_warmup_output</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">end_warmup</span><span class="p">)(</span>
</span><span id="Engine-416"><a href="#Engine-416"><span class="linenos">416</span></a>            <span class="n">keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span><span class="p">,</span> <span class="n">tuning_infos</span>
</span><span id="Engine-417"><a href="#Engine-417"><span class="linenos">417</span></a>        <span class="p">)</span>
</span><span id="Engine-418"><a href="#Engine-418"><span class="linenos">418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span> <span class="o">=</span> <span class="n">end_warmup_output</span><span class="o">.</span><span class="n">kernel_states</span>
</span><span id="Engine-419"><a href="#Engine-419"><span class="linenos">419</span></a>
</span><span id="Engine-420"><a href="#Engine-420"><span class="linenos">420</span></a>        <span class="c1"># add warnings for the user if there are any non-zero error-code</span>
</span><span id="Engine-421"><a href="#Engine-421"><span class="linenos">421</span></a>        <span class="k">for</span> <span class="n">kid</span><span class="p">,</span> <span class="n">ec</span> <span class="ow">in</span> <span class="n">end_warmup_output</span><span class="o">.</span><span class="n">error_codes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Engine-422"><a href="#Engine-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ec</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Engine-423"><a href="#Engine-423"><span class="linenos">423</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warmup error code for </span><span class="si">{</span><span class="n">kid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Engine-424"><a href="#Engine-424"><span class="linenos">424</span></a>
</span><span id="Engine-425"><a href="#Engine-425"><span class="linenos">425</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished warmup&quot;</span><span class="p">)</span>
</span><span id="Engine-426"><a href="#Engine-426"><span class="linenos">426</span></a>
</span><span id="Engine-427"><a href="#Engine-427"><span class="linenos">427</span></a>    <span class="k">def</span> <span class="nf">_end_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine-428"><a href="#Engine-428"><span class="linenos">428</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Engine-429"><a href="#Engine-429"><span class="linenos">429</span></a><span class="sd">        End epoch.</span>
</span><span id="Engine-430"><a href="#Engine-430"><span class="linenos">430</span></a>
</span><span id="Engine-431"><a href="#Engine-431"><span class="linenos">431</span></a><span class="sd">        Informs kernels about the end of the epoch and initializes the tuning</span>
</span><span id="Engine-432"><a href="#Engine-432"><span class="linenos">432</span></a><span class="sd">        if required.</span>
</span><span id="Engine-433"><a href="#Engine-433"><span class="linenos">433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Engine-434"><a href="#Engine-434"><span class="linenos">434</span></a>        <span class="c1"># ensure that an epoch is active</span>
</span><span id="Engine-435"><a href="#Engine-435"><span class="linenos">435</span></a>        <span class="n">epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span>
</span><span id="Engine-436"><a href="#Engine-436"><span class="linenos">436</span></a>
</span><span id="Engine-437"><a href="#Engine-437"><span class="linenos">437</span></a>        <span class="c1"># inform kernels about end of epoch</span>
</span><span id="Engine-438"><a href="#Engine-438"><span class="linenos">438</span></a>        <span class="n">end_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_prng_key_one</span><span class="p">()</span>
</span><span id="Engine-439"><a href="#Engine-439"><span class="linenos">439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span>
</span><span id="Engine-440"><a href="#Engine-440"><span class="linenos">440</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">end_epoch</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Engine-441"><a href="#Engine-441"><span class="linenos">441</span></a>        <span class="p">)(</span><span class="n">end_keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="Engine-442"><a href="#Engine-442"><span class="linenos">442</span></a>
</span><span id="Engine-443"><a href="#Engine-443"><span class="linenos">443</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tune_kernels</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
</span><span id="Engine-444"><a href="#Engine-444"><span class="linenos">444</span></a>
</span><span id="Engine-445"><a href="#Engine-445"><span class="linenos">445</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">:</span>
</span><span id="Engine-446"><a href="#Engine-446"><span class="linenos">446</span></a>            <span class="n">ti_option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transition_info_chain</span><span class="o">.</span><span class="n">get_current_chain</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="Engine-447"><a href="#Engine-447"><span class="linenos">447</span></a>
</span><span id="Engine-448"><a href="#Engine-448"><span class="linenos">448</span></a>            <span class="k">def</span> <span class="nf">count_non_zero_error_codes</span><span class="p">(</span><span class="n">tis</span><span class="p">:</span> <span class="n">TransitionInfos</span><span class="p">):</span>
</span><span id="Engine-449"><a href="#Engine-449"><span class="linenos">449</span></a>                <span class="n">cts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Engine-450"><a href="#Engine-450"><span class="linenos">450</span></a>                <span class="k">for</span> <span class="n">kernel_id</span><span class="p">,</span> <span class="n">ti</span> <span class="ow">in</span> <span class="n">tis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Engine-451"><a href="#Engine-451"><span class="linenos">451</span></a>                    <span class="n">nzero</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">error_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Engine-452"><a href="#Engine-452"><span class="linenos">452</span></a>                    <span class="n">ntrans</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">error_code</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Engine-453"><a href="#Engine-453"><span class="linenos">453</span></a>                    <span class="n">cts</span><span class="p">[</span><span class="n">kernel_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">nzero</span><span class="p">,</span> <span class="n">ntrans</span><span class="p">)</span>
</span><span id="Engine-454"><a href="#Engine-454"><span class="linenos">454</span></a>                <span class="k">return</span> <span class="n">cts</span>
</span><span id="Engine-455"><a href="#Engine-455"><span class="linenos">455</span></a>
</span><span id="Engine-456"><a href="#Engine-456"><span class="linenos">456</span></a>            <span class="n">error_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ti_option</span><span class="o">.</span><span class="n">map_or</span><span class="p">(</span>
</span><span id="Engine-457"><a href="#Engine-457"><span class="linenos">457</span></a>                <span class="p">{},</span> <span class="n">count_non_zero_error_codes</span>
</span><span id="Engine-458"><a href="#Engine-458"><span class="linenos">458</span></a>            <span class="p">)</span>
</span><span id="Engine-459"><a href="#Engine-459"><span class="linenos">459</span></a>
</span><span id="Engine-460"><a href="#Engine-460"><span class="linenos">460</span></a>            <span class="k">for</span> <span class="n">kid</span><span class="p">,</span> <span class="n">kcts</span> <span class="ow">in</span> <span class="n">error_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Engine-461"><a href="#Engine-461"><span class="linenos">461</span></a>                <span class="k">if</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">kcts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Engine-462"><a href="#Engine-462"><span class="linenos">462</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="Engine-463"><a href="#Engine-463"><span class="linenos">463</span></a>                        <span class="sa">f</span><span class="s2">&quot;Errors per chain for </span><span class="si">{</span><span class="n">kid</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="Engine-464"><a href="#Engine-464"><span class="linenos">464</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">kcts</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">kcts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> transitions&quot;</span>
</span><span id="Engine-465"><a href="#Engine-465"><span class="linenos">465</span></a>                    <span class="p">)</span>
</span><span id="Engine-466"><a href="#Engine-466"><span class="linenos">466</span></a>
</span><span id="Engine-467"><a href="#Engine-467"><span class="linenos">467</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Finished epoch&quot;</span><span class="p">)</span>
</span><span id="Engine-468"><a href="#Engine-468"><span class="linenos">468</span></a>
</span><span id="Engine-469"><a href="#Engine-469"><span class="linenos">469</span></a>        <span class="c1"># no epoch is active anymore</span>
</span><span id="Engine-470"><a href="#Engine-470"><span class="linenos">470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine-471"><a href="#Engine-471"><span class="linenos">471</span></a>
</span><span id="Engine-472"><a href="#Engine-472"><span class="linenos">472</span></a>    <span class="k">def</span> <span class="nf">_tune_kernels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">):</span>
</span><span id="Engine-473"><a href="#Engine-473"><span class="linenos">473</span></a>        <span class="sd">&quot;&quot;&quot;Trigger tuning if epoch is an adaptation phase.&quot;&quot;&quot;</span>
</span><span id="Engine-474"><a href="#Engine-474"><span class="linenos">474</span></a>        <span class="k">if</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">is_adaptation</span><span class="p">(</span><span class="n">epoch</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">type</span><span class="p">):</span>
</span><span id="Engine-475"><a href="#Engine-475"><span class="linenos">475</span></a>            <span class="n">tune_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_prng_key_one</span><span class="p">()</span>
</span><span id="Engine-476"><a href="#Engine-476"><span class="linenos">476</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history_required_for_tuning</span><span class="p">:</span>
</span><span id="Engine-477"><a href="#Engine-477"><span class="linenos">477</span></a>                <span class="n">history</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Engine-478"><a href="#Engine-478"><span class="linenos">478</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_position_chain</span><span class="o">.</span><span class="n">get_current_chain</span><span class="p">()</span>
</span><span id="Engine-479"><a href="#Engine-479"><span class="linenos">479</span></a>                    <span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="Engine-480"><a href="#Engine-480"><span class="linenos">480</span></a>                    <span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;The history must contain samples.&quot;</span><span class="p">)</span>
</span><span id="Engine-481"><a href="#Engine-481"><span class="linenos">481</span></a>                <span class="p">)</span>
</span><span id="Engine-482"><a href="#Engine-482"><span class="linenos">482</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Engine-483"><a href="#Engine-483"><span class="linenos">483</span></a>                <span class="n">history</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine-484"><a href="#Engine-484"><span class="linenos">484</span></a>
</span><span id="Engine-485"><a href="#Engine-485"><span class="linenos">485</span></a>            <span class="n">tune_output</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span>
</span><span id="Engine-486"><a href="#Engine-486"><span class="linenos">486</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">tune</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Engine-487"><a href="#Engine-487"><span class="linenos">487</span></a>            <span class="p">)(</span><span class="n">tune_keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
</span><span id="Engine-488"><a href="#Engine-488"><span class="linenos">488</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span> <span class="o">=</span> <span class="n">tune_output</span><span class="o">.</span><span class="n">kernel_states</span>
</span><span id="Engine-489"><a href="#Engine-489"><span class="linenos">489</span></a>
</span><span id="Engine-490"><a href="#Engine-490"><span class="linenos">490</span></a>            <span class="c1"># we need to add the time dimension</span>
</span><span id="Engine-491"><a href="#Engine-491"><span class="linenos">491</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tuning_info_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Engine-492"><a href="#Engine-492"><span class="linenos">492</span></a>                <span class="n">_add_time_dimension</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">tune_output</span><span class="o">.</span><span class="n">infos</span><span class="p">)</span>
</span><span id="Engine-493"><a href="#Engine-493"><span class="linenos">493</span></a>            <span class="p">)</span>
</span><span id="Engine-494"><a href="#Engine-494"><span class="linenos">494</span></a>
</span><span id="Engine-495"><a href="#Engine-495"><span class="linenos">495</span></a>    <span class="k">def</span> <span class="nf">_sample_many</span><span class="p">(</span>
</span><span id="Engine-496"><a href="#Engine-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Engine-497"><a href="#Engine-497"><span class="linenos">497</span></a>        <span class="n">keys</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="Engine-498"><a href="#Engine-498"><span class="linenos">498</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="Engine-499"><a href="#Engine-499"><span class="linenos">499</span></a>        <span class="n">kernel_states</span><span class="p">:</span> <span class="n">KernelStates</span><span class="p">,</span>
</span><span id="Engine-500"><a href="#Engine-500"><span class="linenos">500</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="Engine-501"><a href="#Engine-501"><span class="linenos">501</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
</span><span id="Engine-502"><a href="#Engine-502"><span class="linenos">502</span></a>        <span class="n">EpochState</span><span class="p">,</span>
</span><span id="Engine-503"><a href="#Engine-503"><span class="linenos">503</span></a>        <span class="n">KernelStates</span><span class="p">,</span>
</span><span id="Engine-504"><a href="#Engine-504"><span class="linenos">504</span></a>        <span class="n">ModelState</span><span class="p">,</span>
</span><span id="Engine-505"><a href="#Engine-505"><span class="linenos">505</span></a>        <span class="n">Position</span><span class="p">,</span>
</span><span id="Engine-506"><a href="#Engine-506"><span class="linenos">506</span></a>        <span class="n">TransitionInfos</span><span class="p">,</span>
</span><span id="Engine-507"><a href="#Engine-507"><span class="linenos">507</span></a>        <span class="kc">None</span> <span class="o">|</span> <span class="n">KernelStates</span><span class="p">,</span>
</span><span id="Engine-508"><a href="#Engine-508"><span class="linenos">508</span></a>        <span class="kc">None</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">GeneratedQuantity</span><span class="p">],</span>
</span><span id="Engine-509"><a href="#Engine-509"><span class="linenos">509</span></a>    <span class="p">]:</span>
</span><span id="Engine-510"><a href="#Engine-510"><span class="linenos">510</span></a>        <span class="k">def</span> <span class="nf">scan_f</span><span class="p">(</span>
</span><span id="Engine-511"><a href="#Engine-511"><span class="linenos">511</span></a>            <span class="n">carry</span><span class="p">:</span> <span class="n">Carry</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">KeyArray</span>
</span><span id="Engine-512"><a href="#Engine-512"><span class="linenos">512</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
</span><span id="Engine-513"><a href="#Engine-513"><span class="linenos">513</span></a>            <span class="n">Carry</span><span class="p">,</span>
</span><span id="Engine-514"><a href="#Engine-514"><span class="linenos">514</span></a>            <span class="nb">tuple</span><span class="p">[</span>
</span><span id="Engine-515"><a href="#Engine-515"><span class="linenos">515</span></a>                <span class="n">Position</span><span class="p">,</span>
</span><span id="Engine-516"><a href="#Engine-516"><span class="linenos">516</span></a>                <span class="n">TransitionInfos</span><span class="p">,</span>
</span><span id="Engine-517"><a href="#Engine-517"><span class="linenos">517</span></a>                <span class="kc">None</span> <span class="o">|</span> <span class="n">KernelStates</span><span class="p">,</span>
</span><span id="Engine-518"><a href="#Engine-518"><span class="linenos">518</span></a>                <span class="kc">None</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">GeneratedQuantity</span><span class="p">],</span>
</span><span id="Engine-519"><a href="#Engine-519"><span class="linenos">519</span></a>            <span class="p">],</span>
</span><span id="Engine-520"><a href="#Engine-520"><span class="linenos">520</span></a>        <span class="p">]:</span>
</span><span id="Engine-521"><a href="#Engine-521"><span class="linenos">521</span></a>            <span class="n">key_trans</span><span class="p">,</span> <span class="n">key_quants</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Engine-522"><a href="#Engine-522"><span class="linenos">522</span></a>            <span class="n">epoch</span> <span class="o">=</span> <span class="n">carry</span><span class="o">.</span><span class="n">epoch</span>
</span><span id="Engine-523"><a href="#Engine-523"><span class="linenos">523</span></a>            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">transition</span><span class="p">(</span>
</span><span id="Engine-524"><a href="#Engine-524"><span class="linenos">524</span></a>                <span class="n">key_trans</span><span class="p">,</span> <span class="n">carry</span><span class="o">.</span><span class="n">kernel_states</span><span class="p">,</span> <span class="n">carry</span><span class="o">.</span><span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span>
</span><span id="Engine-525"><a href="#Engine-525"><span class="linenos">525</span></a>            <span class="p">)</span>
</span><span id="Engine-526"><a href="#Engine-526"><span class="linenos">526</span></a>            <span class="n">epoch</span><span class="o">.</span><span class="n">advance_time</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Engine-527"><a href="#Engine-527"><span class="linenos">527</span></a>            <span class="n">new_carry</span> <span class="o">=</span> <span class="n">Carry</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">kernel_states</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="Engine-528"><a href="#Engine-528"><span class="linenos">528</span></a>
</span><span id="Engine-529"><a href="#Engine-529"><span class="linenos">529</span></a>            <span class="c1"># extract the position specified to store in chain</span>
</span><span id="Engine-530"><a href="#Engine-530"><span class="linenos">530</span></a>            <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">extract_position</span><span class="p">(</span>
</span><span id="Engine-531"><a href="#Engine-531"><span class="linenos">531</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_position_keys</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">model_state</span>
</span><span id="Engine-532"><a href="#Engine-532"><span class="linenos">532</span></a>            <span class="p">)</span>
</span><span id="Engine-533"><a href="#Engine-533"><span class="linenos">533</span></a>
</span><span id="Engine-534"><a href="#Engine-534"><span class="linenos">534</span></a>            <span class="c1"># minimize transition infos if requested</span>
</span><span id="Engine-535"><a href="#Engine-535"><span class="linenos">535</span></a>            <span class="n">tinfos</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">infos</span>
</span><span id="Engine-536"><a href="#Engine-536"><span class="linenos">536</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimize_transition_infos</span><span class="p">:</span>
</span><span id="Engine-537"><a href="#Engine-537"><span class="linenos">537</span></a>                <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">tinfos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Engine-538"><a href="#Engine-538"><span class="linenos">538</span></a>                    <span class="n">tinfos</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">tinfos</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">minimize</span><span class="p">()</span>
</span><span id="Engine-539"><a href="#Engine-539"><span class="linenos">539</span></a>
</span><span id="Engine-540"><a href="#Engine-540"><span class="linenos">540</span></a>            <span class="n">ks</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine-541"><a href="#Engine-541"><span class="linenos">541</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store_kernel_states</span><span class="p">:</span>
</span><span id="Engine-542"><a href="#Engine-542"><span class="linenos">542</span></a>                <span class="n">ks</span> <span class="o">=</span> <span class="n">new_carry</span><span class="o">.</span><span class="n">kernel_states</span>
</span><span id="Engine-543"><a href="#Engine-543"><span class="linenos">543</span></a>
</span><span id="Engine-544"><a href="#Engine-544"><span class="linenos">544</span></a>            <span class="n">quants</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine-545"><a href="#Engine-545"><span class="linenos">545</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span>
</span><span id="Engine-546"><a href="#Engine-546"><span class="linenos">546</span></a>                <span class="n">quants</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Engine-547"><a href="#Engine-547"><span class="linenos">547</span></a>                <span class="n">keys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key_quants</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">))</span>
</span><span id="Engine-548"><a href="#Engine-548"><span class="linenos">548</span></a>                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">qg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">):</span>
</span><span id="Engine-549"><a href="#Engine-549"><span class="linenos">549</span></a>                    <span class="n">key</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Engine-550"><a href="#Engine-550"><span class="linenos">550</span></a>                    <span class="n">quant</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="Engine-551"><a href="#Engine-551"><span class="linenos">551</span></a>                    <span class="n">quants</span><span class="p">[</span><span class="n">qg</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant</span>
</span><span id="Engine-552"><a href="#Engine-552"><span class="linenos">552</span></a>
</span><span id="Engine-553"><a href="#Engine-553"><span class="linenos">553</span></a>            <span class="k">return</span> <span class="n">new_carry</span><span class="p">,</span> <span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">tinfos</span><span class="p">,</span> <span class="n">ks</span><span class="p">,</span> <span class="n">quants</span><span class="p">)</span>
</span><span id="Engine-554"><a href="#Engine-554"><span class="linenos">554</span></a>
</span><span id="Engine-555"><a href="#Engine-555"><span class="linenos">555</span></a>        <span class="n">inital_carry</span> <span class="o">=</span> <span class="n">Carry</span><span class="p">(</span><span class="n">kernel_states</span><span class="p">,</span> <span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="Engine-556"><a href="#Engine-556"><span class="linenos">556</span></a>        <span class="n">carry</span><span class="p">,</span> <span class="n">chain</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">scan_f</span><span class="p">,</span> <span class="n">inital_carry</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
</span><span id="Engine-557"><a href="#Engine-557"><span class="linenos">557</span></a>        <span class="n">kernel_states</span> <span class="o">=</span> <span class="n">carry</span><span class="o">.</span><span class="n">kernel_states</span>
</span><span id="Engine-558"><a href="#Engine-558"><span class="linenos">558</span></a>        <span class="n">model_state</span> <span class="o">=</span> <span class="n">carry</span><span class="o">.</span><span class="n">model_state</span>
</span><span id="Engine-559"><a href="#Engine-559"><span class="linenos">559</span></a>        <span class="n">epoch</span> <span class="o">=</span> <span class="n">carry</span><span class="o">.</span><span class="n">epoch</span>
</span><span id="Engine-560"><a href="#Engine-560"><span class="linenos">560</span></a>
</span><span id="Engine-561"><a href="#Engine-561"><span class="linenos">561</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="Engine-562"><a href="#Engine-562"><span class="linenos">562</span></a>            <span class="n">epoch</span><span class="p">,</span>
</span><span id="Engine-563"><a href="#Engine-563"><span class="linenos">563</span></a>            <span class="n">kernel_states</span><span class="p">,</span>
</span><span id="Engine-564"><a href="#Engine-564"><span class="linenos">564</span></a>            <span class="n">model_state</span><span class="p">,</span>
</span><span id="Engine-565"><a href="#Engine-565"><span class="linenos">565</span></a>            <span class="n">chain</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Engine-566"><a href="#Engine-566"><span class="linenos">566</span></a>            <span class="n">chain</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Engine-567"><a href="#Engine-567"><span class="linenos">567</span></a>            <span class="n">chain</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="Engine-568"><a href="#Engine-568"><span class="linenos">568</span></a>            <span class="n">chain</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="Engine-569"><a href="#Engine-569"><span class="linenos">569</span></a>        <span class="p">)</span>
</span><span id="Engine-570"><a href="#Engine-570"><span class="linenos">570</span></a>
</span><span id="Engine-571"><a href="#Engine-571"><span class="linenos">571</span></a>    <span class="k">def</span> <span class="nf">_sample_for_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Engine-572"><a href="#Engine-572"><span class="linenos">572</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">time_left</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">duration</span><span class="p">:</span>
</span><span id="Engine-573"><a href="#Engine-573"><span class="linenos">573</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Not enough time left in epoch&quot;</span><span class="p">)</span>
</span><span id="Engine-574"><a href="#Engine-574"><span class="linenos">574</span></a>
</span><span id="Engine-575"><a href="#Engine-575"><span class="linenos">575</span></a>        <span class="k">if</span> <span class="n">duration</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jitted_sample_duration</span><span class="p">:</span>
</span><span id="Engine-576"><a href="#Engine-576"><span class="linenos">576</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Engine-577"><a href="#Engine-577"><span class="linenos">577</span></a>                <span class="sa">f</span><span class="s2">&quot;Duration </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> is not a multiple of the &quot;</span>
</span><span id="Engine-578"><a href="#Engine-578"><span class="linenos">578</span></a>                <span class="sa">f</span><span class="s2">&quot;jitted sampling duration </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_jitted_sample_duration</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Engine-579"><a href="#Engine-579"><span class="linenos">579</span></a>            <span class="p">)</span>
</span><span id="Engine-580"><a href="#Engine-580"><span class="linenos">580</span></a>
</span><span id="Engine-581"><a href="#Engine-581"><span class="linenos">581</span></a>        <span class="c1"># convert to non-weak device arrays to avoid recompilation</span>
</span><span id="Engine-582"><a href="#Engine-582"><span class="linenos">582</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span> <span class="o">=</span> <span class="n">as_strong_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span><span class="p">)</span>
</span><span id="Engine-583"><a href="#Engine-583"><span class="linenos">583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span> <span class="o">=</span> <span class="n">as_strong_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span><span class="p">)</span>
</span><span id="Engine-584"><a href="#Engine-584"><span class="linenos">584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span> <span class="o">=</span> <span class="n">as_strong_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span><span class="p">)</span>
</span><span id="Engine-585"><a href="#Engine-585"><span class="linenos">585</span></a>
</span><span id="Engine-586"><a href="#Engine-586"><span class="linenos">586</span></a>        <span class="n">it</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">duration</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jitted_sample_duration</span><span class="p">)</span>
</span><span id="Engine-587"><a href="#Engine-587"><span class="linenos">587</span></a>
</span><span id="Engine-588"><a href="#Engine-588"><span class="linenos">588</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">:</span>
</span><span id="Engine-589"><a href="#Engine-589"><span class="linenos">589</span></a>            <span class="n">it</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;chunk&quot;</span><span class="p">)</span>
</span><span id="Engine-590"><a href="#Engine-590"><span class="linenos">590</span></a>
</span><span id="Engine-591"><a href="#Engine-591"><span class="linenos">591</span></a>        <span class="k">for</span> <span class="n">dur_i</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
</span><span id="Engine-592"><a href="#Engine-592"><span class="linenos">592</span></a>            <span class="c1"># FIXME: split for entire duration instead of each loop iteration</span>
</span><span id="Engine-593"><a href="#Engine-593"><span class="linenos">593</span></a>            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_prng_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jitted_sample_duration</span><span class="p">)</span>
</span><span id="Engine-594"><a href="#Engine-594"><span class="linenos">594</span></a>            <span class="p">(</span>
</span><span id="Engine-595"><a href="#Engine-595"><span class="linenos">595</span></a>                <span class="n">new_epoch</span><span class="p">,</span>
</span><span id="Engine-596"><a href="#Engine-596"><span class="linenos">596</span></a>                <span class="n">new_ks</span><span class="p">,</span>
</span><span id="Engine-597"><a href="#Engine-597"><span class="linenos">597</span></a>                <span class="n">new_ms</span><span class="p">,</span>
</span><span id="Engine-598"><a href="#Engine-598"><span class="linenos">598</span></a>                <span class="n">position_chain</span><span class="p">,</span>
</span><span id="Engine-599"><a href="#Engine-599"><span class="linenos">599</span></a>                <span class="n">infos</span><span class="p">,</span>
</span><span id="Engine-600"><a href="#Engine-600"><span class="linenos">600</span></a>                <span class="n">ksc</span><span class="p">,</span>
</span><span id="Engine-601"><a href="#Engine-601"><span class="linenos">601</span></a>                <span class="n">quants</span><span class="p">,</span>
</span><span id="Engine-602"><a href="#Engine-602"><span class="linenos">602</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_many_jitted</span><span class="p">(</span>
</span><span id="Engine-603"><a href="#Engine-603"><span class="linenos">603</span></a>                <span class="n">keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span>
</span><span id="Engine-604"><a href="#Engine-604"><span class="linenos">604</span></a>            <span class="p">)</span>
</span><span id="Engine-605"><a href="#Engine-605"><span class="linenos">605</span></a>
</span><span id="Engine-606"><a href="#Engine-606"><span class="linenos">606</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span> <span class="o">=</span> <span class="n">new_epoch</span>
</span><span id="Engine-607"><a href="#Engine-607"><span class="linenos">607</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span> <span class="o">=</span> <span class="n">new_ks</span>
</span><span id="Engine-608"><a href="#Engine-608"><span class="linenos">608</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span> <span class="o">=</span> <span class="n">new_ms</span>
</span><span id="Engine-609"><a href="#Engine-609"><span class="linenos">609</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_position_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position_chain</span><span class="p">)</span>
</span><span id="Engine-610"><a href="#Engine-610"><span class="linenos">610</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_transition_info_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infos</span><span class="p">)</span>
</span><span id="Engine-611"><a href="#Engine-611"><span class="linenos">611</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store_kernel_states</span><span class="p">:</span>
</span><span id="Engine-612"><a href="#Engine-612"><span class="linenos">612</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_state_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ksc</span><span class="p">)</span>
</span><span id="Engine-613"><a href="#Engine-613"><span class="linenos">613</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span>
</span><span id="Engine-614"><a href="#Engine-614"><span class="linenos">614</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quants</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>MCMC engine capable of combining multiple transition kernels.</p>
</div>


                            <div id="Engine.__init__" class="classattr">
                                        <input id="Engine.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Engine</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">seeds</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">model_states</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">kernel_sequence</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel_sequence</span><span class="o">.</span><span class="n">KernelSequence</span>,</span><span class="param">	<span class="n">epoch_configs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochConfig</span><span class="p">]</span>,</span><span class="param">	<span class="n">jitted_sample_duration</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">ModelInterface</span>,</span><span class="param">	<span class="n">position_keys</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>,</span><span class="param">	<span class="n">minimize_transition_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">store_kernel_states</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">quantity_generators</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">QuantityGenerator</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="Engine.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Engine.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Engine.__init__-180"><a href="#Engine.__init__-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Engine.__init__-181"><a href="#Engine.__init__-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Engine.__init__-182"><a href="#Engine.__init__-182"><span class="linenos">182</span></a>        <span class="n">seeds</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="Engine.__init__-183"><a href="#Engine.__init__-183"><span class="linenos">183</span></a>        <span class="n">model_states</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="Engine.__init__-184"><a href="#Engine.__init__-184"><span class="linenos">184</span></a>        <span class="n">kernel_sequence</span><span class="p">:</span> <span class="n">KernelSequence</span><span class="p">,</span>
</span><span id="Engine.__init__-185"><a href="#Engine.__init__-185"><span class="linenos">185</span></a>        <span class="n">epoch_configs</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">EpochConfig</span><span class="p">],</span>
</span><span id="Engine.__init__-186"><a href="#Engine.__init__-186"><span class="linenos">186</span></a>        <span class="n">jitted_sample_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Engine.__init__-187"><a href="#Engine.__init__-187"><span class="linenos">187</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">ModelInterface</span><span class="p">,</span>
</span><span id="Engine.__init__-188"><a href="#Engine.__init__-188"><span class="linenos">188</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Engine.__init__-189"><a href="#Engine.__init__-189"><span class="linenos">189</span></a>        <span class="n">minimize_transition_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Engine.__init__-190"><a href="#Engine.__init__-190"><span class="linenos">190</span></a>        <span class="n">store_kernel_states</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Engine.__init__-191"><a href="#Engine.__init__-191"><span class="linenos">191</span></a>        <span class="n">quantity_generators</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">QuantityGenerator</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="Engine.__init__-192"><a href="#Engine.__init__-192"><span class="linenos">192</span></a>        <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Engine.__init__-193"><a href="#Engine.__init__-193"><span class="linenos">193</span></a>    <span class="p">):</span>
</span><span id="Engine.__init__-194"><a href="#Engine.__init__-194"><span class="linenos">194</span></a>        <span class="c1"># fill slots that can be filled directly</span>
</span><span id="Engine.__init__-195"><a href="#Engine.__init__-195"><span class="linenos">195</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_inital_states</span> <span class="o">=</span> <span class="n">model_states</span>
</span><span id="Engine.__init__-196"><a href="#Engine.__init__-196"><span class="linenos">196</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_seeds</span> <span class="o">=</span> <span class="n">seeds</span>
</span><span id="Engine.__init__-197"><a href="#Engine.__init__-197"><span class="linenos">197</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_jitted_sample_duration</span> <span class="o">=</span> <span class="n">jitted_sample_duration</span>
</span><span id="Engine.__init__-198"><a href="#Engine.__init__-198"><span class="linenos">198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_minimize_transition_infos</span> <span class="o">=</span> <span class="n">minimize_transition_infos</span>
</span><span id="Engine.__init__-199"><a href="#Engine.__init__-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_store_kernel_states</span> <span class="o">=</span> <span class="n">store_kernel_states</span>
</span><span id="Engine.__init__-200"><a href="#Engine.__init__-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span> <span class="o">=</span> <span class="n">model_states</span>
</span><span id="Engine.__init__-201"><a href="#Engine.__init__-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span> <span class="o">=</span> <span class="n">quantity_generators</span>
</span><span id="Engine.__init__-202"><a href="#Engine.__init__-202"><span class="linenos">202</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span> <span class="o">=</span> <span class="n">show_progress</span>
</span><span id="Engine.__init__-203"><a href="#Engine.__init__-203"><span class="linenos">203</span></a>
</span><span id="Engine.__init__-204"><a href="#Engine.__init__-204"><span class="linenos">204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span> <span class="o">=</span> <span class="n">kernel_sequence</span>
</span><span id="Engine.__init__-205"><a href="#Engine.__init__-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_manager</span> <span class="o">=</span> <span class="n">EpochManager</span><span class="p">(</span><span class="n">epoch_configs</span><span class="p">)</span>
</span><span id="Engine.__init__-206"><a href="#Engine.__init__-206"><span class="linenos">206</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_has_ended</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Engine.__init__-207"><a href="#Engine.__init__-207"><span class="linenos">207</span></a>
</span><span id="Engine.__init__-208"><a href="#Engine.__init__-208"><span class="linenos">208</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">position_keys</span><span class="p">:</span>
</span><span id="Engine.__init__-209"><a href="#Engine.__init__-209"><span class="linenos">209</span></a>            <span class="n">position_keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Engine.__init__-210"><a href="#Engine.__init__-210"><span class="linenos">210</span></a>                <span class="n">key</span>
</span><span id="Engine.__init__-211"><a href="#Engine.__init__-211"><span class="linenos">211</span></a>                <span class="k">for</span> <span class="n">ker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">_kernels</span>  <span class="c1"># FIXME: use of private field</span>
</span><span id="Engine.__init__-212"><a href="#Engine.__init__-212"><span class="linenos">212</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ker</span><span class="o">.</span><span class="n">position_keys</span>
</span><span id="Engine.__init__-213"><a href="#Engine.__init__-213"><span class="linenos">213</span></a>            <span class="p">]</span>
</span><span id="Engine.__init__-214"><a href="#Engine.__init__-214"><span class="linenos">214</span></a>
</span><span id="Engine.__init__-215"><a href="#Engine.__init__-215"><span class="linenos">215</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_position_keys</span> <span class="o">=</span> <span class="n">position_keys</span>
</span><span id="Engine.__init__-216"><a href="#Engine.__init__-216"><span class="linenos">216</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="Engine.__init__-217"><a href="#Engine.__init__-217"><span class="linenos">217</span></a>
</span><span id="Engine.__init__-218"><a href="#Engine.__init__-218"><span class="linenos">218</span></a>        <span class="c1"># feed in history if at least one kernel requires history for tuning</span>
</span><span id="Engine.__init__-219"><a href="#Engine.__init__-219"><span class="linenos">219</span></a>        <span class="c1">#</span>
</span><span id="Engine.__init__-220"><a href="#Engine.__init__-220"><span class="linenos">220</span></a>        <span class="c1"># FIXME: automatically fetch position keys</span>
</span><span id="Engine.__init__-221"><a href="#Engine.__init__-221"><span class="linenos">221</span></a>        <span class="c1">#</span>
</span><span id="Engine.__init__-222"><a href="#Engine.__init__-222"><span class="linenos">222</span></a>        <span class="c1"># fetch kernels&#39; position keys and add them automatically to track them</span>
</span><span id="Engine.__init__-223"><a href="#Engine.__init__-223"><span class="linenos">223</span></a>        <span class="c1"># in the position chain</span>
</span><span id="Engine.__init__-224"><a href="#Engine.__init__-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_history_required_for_tuning</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="Engine.__init__-225"><a href="#Engine.__init__-225"><span class="linenos">225</span></a>            <span class="p">[</span><span class="n">ker</span><span class="o">.</span><span class="n">needs_history</span> <span class="k">for</span> <span class="n">ker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">_kernels</span><span class="p">]</span>
</span><span id="Engine.__init__-226"><a href="#Engine.__init__-226"><span class="linenos">226</span></a>        <span class="p">)</span>  <span class="c1"># FIXME: use of private field</span>
</span><span id="Engine.__init__-227"><a href="#Engine.__init__-227"><span class="linenos">227</span></a>
</span><span id="Engine.__init__-228"><a href="#Engine.__init__-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prng_key</span> <span class="o">=</span> <span class="n">seeds</span>
</span><span id="Engine.__init__-229"><a href="#Engine.__init__-229"><span class="linenos">229</span></a>
</span><span id="Engine.__init__-230"><a href="#Engine.__init__-230"><span class="linenos">230</span></a>        <span class="c1"># setup storage</span>
</span><span id="Engine.__init__-231"><a href="#Engine.__init__-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_position_chain</span><span class="p">:</span> <span class="n">EpochChainManager</span> <span class="o">=</span> <span class="n">EpochChainManager</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Engine.__init__-232"><a href="#Engine.__init__-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_transition_info_chain</span><span class="p">:</span> <span class="n">EpochChainManager</span> <span class="o">=</span> <span class="n">EpochChainManager</span><span class="p">(</span>
</span><span id="Engine.__init__-233"><a href="#Engine.__init__-233"><span class="linenos">233</span></a>            <span class="n">multichain</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Engine.__init__-234"><a href="#Engine.__init__-234"><span class="linenos">234</span></a>        <span class="p">)</span>
</span><span id="Engine.__init__-235"><a href="#Engine.__init__-235"><span class="linenos">235</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tuning_info_chain</span><span class="p">:</span> <span class="n">ListChain</span> <span class="o">=</span> <span class="n">ListChain</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Engine.__init__-236"><a href="#Engine.__init__-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_state_chain</span><span class="p">:</span> <span class="n">EpochChainManager</span> <span class="o">=</span> <span class="n">EpochChainManager</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Engine.__init__-237"><a href="#Engine.__init__-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_chain</span><span class="p">:</span> <span class="n">EpochChainManager</span> <span class="o">=</span> <span class="n">EpochChainManager</span><span class="p">(</span><span class="n">multichain</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Engine.__init__-238"><a href="#Engine.__init__-238"><span class="linenos">238</span></a>
</span><span id="Engine.__init__-239"><a href="#Engine.__init__-239"><span class="linenos">239</span></a>        <span class="c1"># initialize kernel state</span>
</span><span id="Engine.__init__-240"><a href="#Engine.__init__-240"><span class="linenos">240</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_prng_key_one</span><span class="p">()</span>
</span><span id="Engine.__init__-241"><a href="#Engine.__init__-241"><span class="linenos">241</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_states</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernel_sequence</span><span class="o">.</span><span class="n">init_states</span><span class="p">)(</span>
</span><span id="Engine.__init__-242"><a href="#Engine.__init__-242"><span class="linenos">242</span></a>            <span class="n">keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_states</span>
</span><span id="Engine.__init__-243"><a href="#Engine.__init__-243"><span class="linenos">243</span></a>        <span class="p">)</span>
</span><span id="Engine.__init__-244"><a href="#Engine.__init__-244"><span class="linenos">244</span></a>
</span><span id="Engine.__init__-245"><a href="#Engine.__init__-245"><span class="linenos">245</span></a>        <span class="c1"># current epoch</span>
</span><span id="Engine.__init__-246"><a href="#Engine.__init__-246"><span class="linenos">246</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch</span><span class="p">:</span> <span class="n">EpochState</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine.__init__-247"><a href="#Engine.__init__-247"><span class="linenos">247</span></a>
</span><span id="Engine.__init__-248"><a href="#Engine.__init__-248"><span class="linenos">248</span></a>        <span class="c1"># jit sample function</span>
</span><span id="Engine.__init__-249"><a href="#Engine.__init__-249"><span class="linenos">249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_many_jitted</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span>
</span><span id="Engine.__init__-250"><a href="#Engine.__init__-250"><span class="linenos">250</span></a>            <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span>
</span><span id="Engine.__init__-251"><a href="#Engine.__init__-251"><span class="linenos">251</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_sample_many</span><span class="p">,</span>
</span><span id="Engine.__init__-252"><a href="#Engine.__init__-252"><span class="linenos">252</span></a>                <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="Engine.__init__-253"><a href="#Engine.__init__-253"><span class="linenos">253</span></a>                <span class="n">out_axes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="Engine.__init__-254"><a href="#Engine.__init__-254"><span class="linenos">254</span></a>            <span class="p">)</span>
</span><span id="Engine.__init__-255"><a href="#Engine.__init__-255"><span class="linenos">255</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Engine.current_epoch" class="classattr">
                                <div class="attr variable">
            <span class="name">current_epoch</span><span class="annotation">: liesel.goose.epoch.EpochState</span>

        
    </div>
    <a class="headerlink" href="#Engine.current_epoch"></a>
    
            <div class="docstring"><p>Returns the current epoch.</p>

<p>Raises a <code>RuntimeError</code> if no epoch is active.</p>
</div>


                            </div>
                            <div id="Engine.sample_all_epochs" class="classattr">
                                        <input id="Engine.sample_all_epochs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample_all_epochs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span>)</span>

                <label class="view-source-button" for="Engine.sample_all_epochs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Engine.sample_all_epochs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Engine.sample_all_epochs-269"><a href="#Engine.sample_all_epochs-269"><span class="linenos">269</span></a>    <span class="k">def</span> <span class="nf">sample_all_epochs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine.sample_all_epochs-270"><a href="#Engine.sample_all_epochs-270"><span class="linenos">270</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Engine.sample_all_epochs-271"><a href="#Engine.sample_all_epochs-271"><span class="linenos">271</span></a><span class="sd">        Runs sampling for all remaining epochs.</span>
</span><span id="Engine.sample_all_epochs-272"><a href="#Engine.sample_all_epochs-272"><span class="linenos">272</span></a>
</span><span id="Engine.sample_all_epochs-273"><a href="#Engine.sample_all_epochs-273"><span class="linenos">273</span></a><span class="sd">        Auto-tuning methods are called automatically.</span>
</span><span id="Engine.sample_all_epochs-274"><a href="#Engine.sample_all_epochs-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Engine.sample_all_epochs-275"><a href="#Engine.sample_all_epochs-275"><span class="linenos">275</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_manager</span><span class="o">.</span><span class="n">has_more</span><span class="p">():</span>
</span><span id="Engine.sample_all_epochs-276"><a href="#Engine.sample_all_epochs-276"><span class="linenos">276</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sample_next_epoch</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Runs sampling for all remaining epochs.</p>

<p>Auto-tuning methods are called automatically.</p>
</div>


                            </div>
                            <div id="Engine.sample_next_epoch" class="classattr">
                                        <input id="Engine.sample_next_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample_next_epoch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span>)</span>

                <label class="view-source-button" for="Engine.sample_next_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Engine.sample_next_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Engine.sample_next_epoch-278"><a href="#Engine.sample_next_epoch-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">sample_next_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Engine.sample_next_epoch-279"><a href="#Engine.sample_next_epoch-279"><span class="linenos">279</span></a>        <span class="sd">&quot;&quot;&quot;Runs sampling for the next epoch assuming no epoch is active.&quot;&quot;&quot;</span>
</span><span id="Engine.sample_next_epoch-280"><a href="#Engine.sample_next_epoch-280"><span class="linenos">280</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_start_epoch</span><span class="p">()</span>
</span><span id="Engine.sample_next_epoch-281"><a href="#Engine.sample_next_epoch-281"><span class="linenos">281</span></a>
</span><span id="Engine.sample_next_epoch-282"><a href="#Engine.sample_next_epoch-282"><span class="linenos">282</span></a>        <span class="c1"># special treatment for the initial values</span>
</span><span id="Engine.sample_next_epoch-283"><a href="#Engine.sample_next_epoch-283"><span class="linenos">283</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">INITIAL_VALUES</span><span class="p">:</span>
</span><span id="Engine.sample_next_epoch-284"><a href="#Engine.sample_next_epoch-284"><span class="linenos">284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_inital_values_epoch</span><span class="p">()</span>
</span><span id="Engine.sample_next_epoch-285"><a href="#Engine.sample_next_epoch-285"><span class="linenos">285</span></a>            <span class="k">return</span>
</span><span id="Engine.sample_next_epoch-286"><a href="#Engine.sample_next_epoch-286"><span class="linenos">286</span></a>
</span><span id="Engine.sample_next_epoch-287"><a href="#Engine.sample_next_epoch-287"><span class="linenos">287</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_start_epoch</span><span class="p">()</span>
</span><span id="Engine.sample_next_epoch-288"><a href="#Engine.sample_next_epoch-288"><span class="linenos">288</span></a>
</span><span id="Engine.sample_next_epoch-289"><a href="#Engine.sample_next_epoch-289"><span class="linenos">289</span></a>        <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">duration</span>
</span><span id="Engine.sample_next_epoch-290"><a href="#Engine.sample_next_epoch-290"><span class="linenos">290</span></a>        <span class="n">epoch_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">name</span>
</span><span id="Engine.sample_next_epoch-291"><a href="#Engine.sample_next_epoch-291"><span class="linenos">291</span></a>        <span class="n">jitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jitted_sample_duration</span>
</span><span id="Engine.sample_next_epoch-292"><a href="#Engine.sample_next_epoch-292"><span class="linenos">292</span></a>
</span><span id="Engine.sample_next_epoch-293"><a href="#Engine.sample_next_epoch-293"><span class="linenos">293</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_progress</span><span class="p">:</span>
</span><span id="Engine.sample_next_epoch-294"><a href="#Engine.sample_next_epoch-294"><span class="linenos">294</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="Engine.sample_next_epoch-295"><a href="#Engine.sample_next_epoch-295"><span class="linenos">295</span></a>                <span class="sa">f</span><span class="s2">&quot;Starting epoch: </span><span class="si">{</span><span class="n">epoch_type</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> transitions, &quot;</span>
</span><span id="Engine.sample_next_epoch-296"><a href="#Engine.sample_next_epoch-296"><span class="linenos">296</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">jitted</span><span class="si">}</span><span class="s2"> jitted together&quot;</span>
</span><span id="Engine.sample_next_epoch-297"><a href="#Engine.sample_next_epoch-297"><span class="linenos">297</span></a>            <span class="p">)</span>
</span><span id="Engine.sample_next_epoch-298"><a href="#Engine.sample_next_epoch-298"><span class="linenos">298</span></a>
</span><span id="Engine.sample_next_epoch-299"><a href="#Engine.sample_next_epoch-299"><span class="linenos">299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_for_duration</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
</span><span id="Engine.sample_next_epoch-300"><a href="#Engine.sample_next_epoch-300"><span class="linenos">300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_end_epoch</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Runs sampling for the next epoch assuming no epoch is active.</p>
</div>


                            </div>
                            <div id="Engine.append_epoch" class="classattr">
                                        <input id="Engine.append_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">append_epoch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochConfig</span></span>)</span>

                <label class="view-source-button" for="Engine.append_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Engine.append_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Engine.append_epoch-302"><a href="#Engine.append_epoch-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">append_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochConfig</span><span class="p">):</span>
</span><span id="Engine.append_epoch-303"><a href="#Engine.append_epoch-303"><span class="linenos">303</span></a>        <span class="sd">&quot;&quot;&quot;Appends an epoch to the epochs that should be sampled.&quot;&quot;&quot;</span>
</span><span id="Engine.append_epoch-304"><a href="#Engine.append_epoch-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_manager</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Appends an epoch to the epochs that should be sampled.</p>
</div>


                            </div>
                            <div id="Engine.is_sampling_done" class="classattr">
                                        <input id="Engine.is_sampling_done-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_sampling_done</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Engine.is_sampling_done-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Engine.is_sampling_done"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Engine.is_sampling_done-306"><a href="#Engine.is_sampling_done-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">is_sampling_done</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Engine.is_sampling_done-307"><a href="#Engine.is_sampling_done-307"><span class="linenos">307</span></a>        <span class="sd">&quot;&quot;&quot;Returns true if all configured epochs have been sampled.&quot;&quot;&quot;</span>
</span><span id="Engine.is_sampling_done-308"><a href="#Engine.is_sampling_done-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epoch_manager</span><span class="o">.</span><span class="n">has_more</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Returns true if all configured epochs have been sampled.</p>
</div>


                            </div>
                            <div id="Engine.get_results" class="classattr">
                                        <input id="Engine.get_results-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_results</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SamplingResult</span>:</span></span>

                <label class="view-source-button" for="Engine.get_results-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Engine.get_results"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Engine.get_results-310"><a href="#Engine.get_results-310"><span class="linenos">310</span></a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SamplingResult</span><span class="p">:</span>
</span><span id="Engine.get_results-311"><a href="#Engine.get_results-311"><span class="linenos">311</span></a>        <span class="sd">&quot;&quot;&quot;Returns the results of the sampling process.&quot;&quot;&quot;</span>
</span><span id="Engine.get_results-312"><a href="#Engine.get_results-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_store_kernel_states</span><span class="p">:</span>
</span><span id="Engine.get_results-313"><a href="#Engine.get_results-313"><span class="linenos">313</span></a>            <span class="n">ksc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernel_state_chain</span>
</span><span id="Engine.get_results-314"><a href="#Engine.get_results-314"><span class="linenos">314</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Engine.get_results-315"><a href="#Engine.get_results-315"><span class="linenos">315</span></a>            <span class="n">ksc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine.get_results-316"><a href="#Engine.get_results-316"><span class="linenos">316</span></a>
</span><span id="Engine.get_results-317"><a href="#Engine.get_results-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span>
</span><span id="Engine.get_results-318"><a href="#Engine.get_results-318"><span class="linenos">318</span></a>            <span class="n">gqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_chain</span>
</span><span id="Engine.get_results-319"><a href="#Engine.get_results-319"><span class="linenos">319</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Engine.get_results-320"><a href="#Engine.get_results-320"><span class="linenos">320</span></a>            <span class="n">gqs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Engine.get_results-321"><a href="#Engine.get_results-321"><span class="linenos">321</span></a>
</span><span id="Engine.get_results-322"><a href="#Engine.get_results-322"><span class="linenos">322</span></a>        <span class="k">return</span> <span class="n">SamplingResult</span><span class="p">(</span>
</span><span id="Engine.get_results-323"><a href="#Engine.get_results-323"><span class="linenos">323</span></a>            <span class="n">positions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_position_chain</span><span class="p">,</span>
</span><span id="Engine.get_results-324"><a href="#Engine.get_results-324"><span class="linenos">324</span></a>            <span class="n">transition_infos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_transition_info_chain</span><span class="p">,</span>
</span><span id="Engine.get_results-325"><a href="#Engine.get_results-325"><span class="linenos">325</span></a>            <span class="n">generated_quantities</span><span class="o">=</span><span class="n">Option</span><span class="p">(</span><span class="n">gqs</span><span class="p">),</span>
</span><span id="Engine.get_results-326"><a href="#Engine.get_results-326"><span class="linenos">326</span></a>            <span class="n">tuning_infos</span><span class="o">=</span><span class="n">Option</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tuning_info_chain</span><span class="p">),</span>
</span><span id="Engine.get_results-327"><a href="#Engine.get_results-327"><span class="linenos">327</span></a>            <span class="n">kernel_states</span><span class="o">=</span><span class="n">Option</span><span class="p">(</span><span class="n">ksc</span><span class="p">),</span>
</span><span id="Engine.get_results-328"><a href="#Engine.get_results-328"><span class="linenos">328</span></a>            <span class="n">full_model_states</span><span class="o">=</span><span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
</span><span id="Engine.get_results-329"><a href="#Engine.get_results-329"><span class="linenos">329</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the results of the sampling process.</p>
</div>


                            </div>
                </section>
                <section id="EngineBuilder">
                            <input id="EngineBuilder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EngineBuilder</span>:

                <label class="view-source-button" for="EngineBuilder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder-41"><a href="#EngineBuilder-41"><span class="linenos"> 41</span></a><span class="k">class</span> <span class="nc">EngineBuilder</span><span class="p">:</span>
</span><span id="EngineBuilder-42"><a href="#EngineBuilder-42"><span class="linenos"> 42</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-43"><a href="#EngineBuilder-43"><span class="linenos"> 43</span></a><span class="sd">    The `EngineBuilder` is used to construct an MCMC Engine.</span>
</span><span id="EngineBuilder-44"><a href="#EngineBuilder-44"><span class="linenos"> 44</span></a>
</span><span id="EngineBuilder-45"><a href="#EngineBuilder-45"><span class="linenos"> 45</span></a><span class="sd">    Currently, the `EngineBuilder` builds an object of the class `Engine`.</span>
</span><span id="EngineBuilder-46"><a href="#EngineBuilder-46"><span class="linenos"> 46</span></a>
</span><span id="EngineBuilder-47"><a href="#EngineBuilder-47"><span class="linenos"> 47</span></a><span class="sd">    By default, every position key associated with an MCMC kernel is tracked.</span>
</span><span id="EngineBuilder-48"><a href="#EngineBuilder-48"><span class="linenos"> 48</span></a><span class="sd">    This behavior can be adjusted with the fields `positions_included`</span>
</span><span id="EngineBuilder-49"><a href="#EngineBuilder-49"><span class="linenos"> 49</span></a><span class="sd">    and `positions_excluded`.</span>
</span><span id="EngineBuilder-50"><a href="#EngineBuilder-50"><span class="linenos"> 50</span></a>
</span><span id="EngineBuilder-51"><a href="#EngineBuilder-51"><span class="linenos"> 51</span></a><span class="sd">    ## Parameters</span>
</span><span id="EngineBuilder-52"><a href="#EngineBuilder-52"><span class="linenos"> 52</span></a>
</span><span id="EngineBuilder-53"><a href="#EngineBuilder-53"><span class="linenos"> 53</span></a><span class="sd">    - `seed`: Used to initialize the PRNG for the building process. The PRNG state</span>
</span><span id="EngineBuilder-54"><a href="#EngineBuilder-54"><span class="linenos"> 54</span></a><span class="sd">      is also used to initialize the PRNG state of the engine. A user-specific seed</span>
</span><span id="EngineBuilder-55"><a href="#EngineBuilder-55"><span class="linenos"> 55</span></a><span class="sd">      to initialize the engine can be set with the method `set_engine_seed`.</span>
</span><span id="EngineBuilder-56"><a href="#EngineBuilder-56"><span class="linenos"> 56</span></a><span class="sd">    - `num_chains`: The number of chains to be used.</span>
</span><span id="EngineBuilder-57"><a href="#EngineBuilder-57"><span class="linenos"> 57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EngineBuilder-58"><a href="#EngineBuilder-58"><span class="linenos"> 58</span></a>
</span><span id="EngineBuilder-59"><a href="#EngineBuilder-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_chains</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="EngineBuilder-60"><a href="#EngineBuilder-60"><span class="linenos"> 60</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
</span><span id="EngineBuilder-61"><a href="#EngineBuilder-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prng_key</span><span class="p">:</span> <span class="n">KeyArray</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EngineBuilder-62"><a href="#EngineBuilder-62"><span class="linenos"> 62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_engine_key</span><span class="p">:</span> <span class="n">KeyArray</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="EngineBuilder-63"><a href="#EngineBuilder-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_chains</span>
</span><span id="EngineBuilder-64"><a href="#EngineBuilder-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Kernel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder-65"><a href="#EngineBuilder-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">QuantityGenerator</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder-66"><a href="#EngineBuilder-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_state</span><span class="p">:</span> <span class="n">Option</span><span class="p">[</span><span class="n">ModelState</span><span class="p">]</span> <span class="o">=</span> <span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="EngineBuilder-67"><a href="#EngineBuilder-67"><span class="linenos"> 67</span></a>
</span><span id="EngineBuilder-68"><a href="#EngineBuilder-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">:</span> <span class="n">Option</span><span class="p">[</span><span class="n">ModelInterface</span><span class="p">]</span> <span class="o">=</span> <span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="EngineBuilder-69"><a href="#EngineBuilder-69"><span class="linenos"> 69</span></a>
</span><span id="EngineBuilder-70"><a href="#EngineBuilder-70"><span class="linenos"> 70</span></a>        <span class="c1"># public fields, only simple states</span>
</span><span id="EngineBuilder-71"><a href="#EngineBuilder-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_kernel_states</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EngineBuilder-72"><a href="#EngineBuilder-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minimize_transition_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EngineBuilder-73"><a href="#EngineBuilder-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EngineBuilder-74"><a href="#EngineBuilder-74"><span class="linenos"> 74</span></a>
</span><span id="EngineBuilder-75"><a href="#EngineBuilder-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">positions_included</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder-76"><a href="#EngineBuilder-76"><span class="linenos"> 76</span></a>        <span class="sd">&quot;&quot;&quot;List of additional position keys that should be tracked.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-77"><a href="#EngineBuilder-77"><span class="linenos"> 77</span></a>
</span><span id="EngineBuilder-78"><a href="#EngineBuilder-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">positions_excluded</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder-79"><a href="#EngineBuilder-79"><span class="linenos"> 79</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-80"><a href="#EngineBuilder-80"><span class="linenos"> 80</span></a><span class="sd">        List of position keys that should not be tracked.</span>
</span><span id="EngineBuilder-81"><a href="#EngineBuilder-81"><span class="linenos"> 81</span></a>
</span><span id="EngineBuilder-82"><a href="#EngineBuilder-82"><span class="linenos"> 82</span></a><span class="sd">        Excluded keys override additional keys.</span>
</span><span id="EngineBuilder-83"><a href="#EngineBuilder-83"><span class="linenos"> 83</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EngineBuilder-84"><a href="#EngineBuilder-84"><span class="linenos"> 84</span></a>
</span><span id="EngineBuilder-85"><a href="#EngineBuilder-85"><span class="linenos"> 85</span></a>    <span class="k">def</span> <span class="nf">set_engine_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">KeyArray</span><span class="p">):</span>
</span><span id="EngineBuilder-86"><a href="#EngineBuilder-86"><span class="linenos"> 86</span></a>        <span class="sd">&quot;&quot;&quot;Sets a seed used to initialize the MCMC engine.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-87"><a href="#EngineBuilder-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="n">jnp</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
</span><span id="EngineBuilder-88"><a href="#EngineBuilder-88"><span class="linenos"> 88</span></a>            <span class="n">seed_int</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
</span><span id="EngineBuilder-89"><a href="#EngineBuilder-89"><span class="linenos"> 89</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_engine_key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed_int</span><span class="p">)</span>
</span><span id="EngineBuilder-90"><a href="#EngineBuilder-90"><span class="linenos"> 90</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EngineBuilder-91"><a href="#EngineBuilder-91"><span class="linenos"> 91</span></a>            <span class="n">seed_keyarray</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">KeyArray</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
</span><span id="EngineBuilder-92"><a href="#EngineBuilder-92"><span class="linenos"> 92</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_engine_key</span> <span class="o">=</span> <span class="n">seed_keyarray</span>
</span><span id="EngineBuilder-93"><a href="#EngineBuilder-93"><span class="linenos"> 93</span></a>
</span><span id="EngineBuilder-94"><a href="#EngineBuilder-94"><span class="linenos"> 94</span></a>    <span class="nd">@property</span>
</span><span id="EngineBuilder-95"><a href="#EngineBuilder-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="nf">engine_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeyArray</span><span class="p">:</span>
</span><span id="EngineBuilder-96"><a href="#EngineBuilder-96"><span class="linenos"> 96</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine_key</span>
</span><span id="EngineBuilder-97"><a href="#EngineBuilder-97"><span class="linenos"> 97</span></a>
</span><span id="EngineBuilder-98"><a href="#EngineBuilder-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">add_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="p">:</span> <span class="n">Kernel</span><span class="p">):</span>
</span><span id="EngineBuilder-99"><a href="#EngineBuilder-99"><span class="linenos"> 99</span></a>        <span class="sd">&quot;&quot;&quot;Adds a `Kernel`.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-100"><a href="#EngineBuilder-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
</span><span id="EngineBuilder-101"><a href="#EngineBuilder-101"><span class="linenos">101</span></a>
</span><span id="EngineBuilder-102"><a href="#EngineBuilder-102"><span class="linenos">102</span></a>    <span class="nd">@property</span>
</span><span id="EngineBuilder-103"><a href="#EngineBuilder-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">kernels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Kernel</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="EngineBuilder-104"><a href="#EngineBuilder-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span><span class="p">)</span>
</span><span id="EngineBuilder-105"><a href="#EngineBuilder-105"><span class="linenos">105</span></a>
</span><span id="EngineBuilder-106"><a href="#EngineBuilder-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="nf">add_quantity_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="n">QuantityGenerator</span><span class="p">):</span>
</span><span id="EngineBuilder-107"><a href="#EngineBuilder-107"><span class="linenos">107</span></a>        <span class="sd">&quot;&quot;&quot;Adds a `QuantityGenerator`.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-108"><a href="#EngineBuilder-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
</span><span id="EngineBuilder-109"><a href="#EngineBuilder-109"><span class="linenos">109</span></a>
</span><span id="EngineBuilder-110"><a href="#EngineBuilder-110"><span class="linenos">110</span></a>    <span class="nd">@property</span>
</span><span id="EngineBuilder-111"><a href="#EngineBuilder-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">quantity_generators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QuantityGenerator</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="EngineBuilder-112"><a href="#EngineBuilder-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">)</span>
</span><span id="EngineBuilder-113"><a href="#EngineBuilder-113"><span class="linenos">113</span></a>
</span><span id="EngineBuilder-114"><a href="#EngineBuilder-114"><span class="linenos">114</span></a>    <span class="k">def</span> <span class="nf">set_initial_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span> <span class="n">multiple_chains</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="EngineBuilder-115"><a href="#EngineBuilder-115"><span class="linenos">115</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-116"><a href="#EngineBuilder-116"><span class="linenos">116</span></a><span class="sd">        Sets the initial model state.</span>
</span><span id="EngineBuilder-117"><a href="#EngineBuilder-117"><span class="linenos">117</span></a>
</span><span id="EngineBuilder-118"><a href="#EngineBuilder-118"><span class="linenos">118</span></a><span class="sd">        If `multiple_chains` is true the `model_state` will be used as is;</span>
</span><span id="EngineBuilder-119"><a href="#EngineBuilder-119"><span class="linenos">119</span></a><span class="sd">        otherwise `model_state` will be used as the initial values for each chain.</span>
</span><span id="EngineBuilder-120"><a href="#EngineBuilder-120"><span class="linenos">120</span></a><span class="sd">        Note that if `multiple_chains` is true, the first axis of each leaf of</span>
</span><span id="EngineBuilder-121"><a href="#EngineBuilder-121"><span class="linenos">121</span></a><span class="sd">        `model_state` refers to the chain.</span>
</span><span id="EngineBuilder-122"><a href="#EngineBuilder-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EngineBuilder-123"><a href="#EngineBuilder-123"><span class="linenos">123</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">multiple_chains</span><span class="p">:</span>
</span><span id="EngineBuilder-124"><a href="#EngineBuilder-124"><span class="linenos">124</span></a>            <span class="n">model_states</span> <span class="o">=</span> <span class="n">stack_leaves</span><span class="p">(</span><span class="n">model_state</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">))</span>
</span><span id="EngineBuilder-125"><a href="#EngineBuilder-125"><span class="linenos">125</span></a>
</span><span id="EngineBuilder-126"><a href="#EngineBuilder-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_state</span> <span class="o">=</span> <span class="n">Option</span><span class="p">(</span><span class="n">model_states</span><span class="p">)</span>
</span><span id="EngineBuilder-127"><a href="#EngineBuilder-127"><span class="linenos">127</span></a>
</span><span id="EngineBuilder-128"><a href="#EngineBuilder-128"><span class="linenos">128</span></a>    <span class="nd">@property</span>
</span><span id="EngineBuilder-129"><a href="#EngineBuilder-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">model_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Option</span><span class="p">[</span><span class="n">ModelState</span><span class="p">]:</span>
</span><span id="EngineBuilder-130"><a href="#EngineBuilder-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_state</span>
</span><span id="EngineBuilder-131"><a href="#EngineBuilder-131"><span class="linenos">131</span></a>
</span><span id="EngineBuilder-132"><a href="#EngineBuilder-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">set_epochs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epochs</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">EpochConfig</span><span class="p">]):</span>
</span><span id="EngineBuilder-133"><a href="#EngineBuilder-133"><span class="linenos">133</span></a>        <span class="sd">&quot;&quot;&quot;Sets epochs.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-134"><a href="#EngineBuilder-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epochs</span> <span class="o">=</span> <span class="n">EpochManager</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>
</span><span id="EngineBuilder-135"><a href="#EngineBuilder-135"><span class="linenos">135</span></a>
</span><span id="EngineBuilder-136"><a href="#EngineBuilder-136"><span class="linenos">136</span></a>    <span class="k">def</span> <span class="nf">set_duration</span><span class="p">(</span>
</span><span id="EngineBuilder-137"><a href="#EngineBuilder-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">warmup_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">posterior_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">term_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="EngineBuilder-138"><a href="#EngineBuilder-138"><span class="linenos">138</span></a>    <span class="p">):</span>
</span><span id="EngineBuilder-139"><a href="#EngineBuilder-139"><span class="linenos">139</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-140"><a href="#EngineBuilder-140"><span class="linenos">140</span></a><span class="sd">        Sets epochs using the `stan_epochs` function.</span>
</span><span id="EngineBuilder-141"><a href="#EngineBuilder-141"><span class="linenos">141</span></a>
</span><span id="EngineBuilder-142"><a href="#EngineBuilder-142"><span class="linenos">142</span></a><span class="sd">        Note that `term_duration` needs to be long enough that tuning algorithms</span>
</span><span id="EngineBuilder-143"><a href="#EngineBuilder-143"><span class="linenos">143</span></a><span class="sd">        like dual averaging can converge.</span>
</span><span id="EngineBuilder-144"><a href="#EngineBuilder-144"><span class="linenos">144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EngineBuilder-145"><a href="#EngineBuilder-145"><span class="linenos">145</span></a>        <span class="n">epochs</span> <span class="o">=</span> <span class="n">stan_epochs</span><span class="p">(</span>
</span><span id="EngineBuilder-146"><a href="#EngineBuilder-146"><span class="linenos">146</span></a>            <span class="n">warmup_duration</span><span class="p">,</span> <span class="n">posterior_duration</span><span class="p">,</span> <span class="n">term_duration</span><span class="o">=</span><span class="n">term_duration</span>
</span><span id="EngineBuilder-147"><a href="#EngineBuilder-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="EngineBuilder-148"><a href="#EngineBuilder-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epochs</span> <span class="o">=</span> <span class="n">EpochManager</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>
</span><span id="EngineBuilder-149"><a href="#EngineBuilder-149"><span class="linenos">149</span></a>
</span><span id="EngineBuilder-150"><a href="#EngineBuilder-150"><span class="linenos">150</span></a>    <span class="nd">@property</span>
</span><span id="EngineBuilder-151"><a href="#EngineBuilder-151"><span class="linenos">151</span></a>    <span class="k">def</span> <span class="nf">epochs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">EpochConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="EngineBuilder-152"><a href="#EngineBuilder-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_epochs</span><span class="o">.</span><span class="n">_configs</span><span class="p">)</span>
</span><span id="EngineBuilder-153"><a href="#EngineBuilder-153"><span class="linenos">153</span></a>
</span><span id="EngineBuilder-154"><a href="#EngineBuilder-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">set_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">ModelInterface</span><span class="p">):</span>
</span><span id="EngineBuilder-155"><a href="#EngineBuilder-155"><span class="linenos">155</span></a>        <span class="sd">&quot;&quot;&quot;Sets the model interface for all kernels and quantity generators.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-156"><a href="#EngineBuilder-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">Option</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="EngineBuilder-157"><a href="#EngineBuilder-157"><span class="linenos">157</span></a>
</span><span id="EngineBuilder-158"><a href="#EngineBuilder-158"><span class="linenos">158</span></a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Engine</span><span class="p">:</span>
</span><span id="EngineBuilder-159"><a href="#EngineBuilder-159"><span class="linenos">159</span></a>        <span class="sd">&quot;&quot;&quot;Builds the MCMC engine with the provided setup.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder-160"><a href="#EngineBuilder-160"><span class="linenos">160</span></a>        <span class="c1"># build list of position keys</span>
</span><span id="EngineBuilder-161"><a href="#EngineBuilder-161"><span class="linenos">161</span></a>        <span class="n">pos_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder-162"><a href="#EngineBuilder-162"><span class="linenos">162</span></a>        <span class="k">for</span> <span class="n">ker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span><span class="p">:</span>
</span><span id="EngineBuilder-163"><a href="#EngineBuilder-163"><span class="linenos">163</span></a>            <span class="n">pos_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ker</span><span class="o">.</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="EngineBuilder-164"><a href="#EngineBuilder-164"><span class="linenos">164</span></a>        <span class="n">dupl</span> <span class="o">=</span> <span class="n">_find_duplicate</span><span class="p">(</span><span class="n">pos_keys</span><span class="p">)</span>
</span><span id="EngineBuilder-165"><a href="#EngineBuilder-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="n">dupl</span><span class="o">.</span><span class="n">is_some</span><span class="p">():</span>
</span><span id="EngineBuilder-166"><a href="#EngineBuilder-166"><span class="linenos">166</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="EngineBuilder-167"><a href="#EngineBuilder-167"><span class="linenos">167</span></a>                <span class="sa">f</span><span class="s2">&quot;The position key </span><span class="si">{</span><span class="n">dupl</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span><span class="si">}</span><span class="s2"> is claimed by multiple kernels&quot;</span>
</span><span id="EngineBuilder-168"><a href="#EngineBuilder-168"><span class="linenos">168</span></a>            <span class="p">)</span>
</span><span id="EngineBuilder-169"><a href="#EngineBuilder-169"><span class="linenos">169</span></a>
</span><span id="EngineBuilder-170"><a href="#EngineBuilder-170"><span class="linenos">170</span></a>        <span class="n">pos_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions_included</span><span class="p">)</span>
</span><span id="EngineBuilder-171"><a href="#EngineBuilder-171"><span class="linenos">171</span></a>        <span class="n">pos_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pos_keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions_excluded</span><span class="p">]</span>
</span><span id="EngineBuilder-172"><a href="#EngineBuilder-172"><span class="linenos">172</span></a>
</span><span id="EngineBuilder-173"><a href="#EngineBuilder-173"><span class="linenos">173</span></a>        <span class="c1"># find good jittable number</span>
</span><span id="EngineBuilder-174"><a href="#EngineBuilder-174"><span class="linenos">174</span></a>        <span class="n">epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epochs</span><span class="o">.</span><span class="n">_configs</span>  <span class="c1"># FIXME: use of private field</span>
</span><span id="EngineBuilder-175"><a href="#EngineBuilder-175"><span class="linenos">175</span></a>        <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">duration</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
</span><span id="EngineBuilder-176"><a href="#EngineBuilder-176"><span class="linenos">176</span></a>        <span class="n">jit_duration</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="o">*</span><span class="n">durations</span><span class="p">)</span>
</span><span id="EngineBuilder-177"><a href="#EngineBuilder-177"><span class="linenos">177</span></a>
</span><span id="EngineBuilder-178"><a href="#EngineBuilder-178"><span class="linenos">178</span></a>        <span class="c1"># seeds</span>
</span><span id="EngineBuilder-179"><a href="#EngineBuilder-179"><span class="linenos">179</span></a>        <span class="n">seeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine_key</span>
</span><span id="EngineBuilder-180"><a href="#EngineBuilder-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="n">seeds</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,):</span>
</span><span id="EngineBuilder-181"><a href="#EngineBuilder-181"><span class="linenos">181</span></a>            <span class="c1"># no multi-chain key</span>
</span><span id="EngineBuilder-182"><a href="#EngineBuilder-182"><span class="linenos">182</span></a>            <span class="n">seeds</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">seeds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">)</span>
</span><span id="EngineBuilder-183"><a href="#EngineBuilder-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="n">seeds</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="EngineBuilder-184"><a href="#EngineBuilder-184"><span class="linenos">184</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="EngineBuilder-185"><a href="#EngineBuilder-185"><span class="linenos">185</span></a>                <span class="sa">f</span><span class="s2">&quot;MCMC seed has the wrong dimensions </span><span class="si">{</span><span class="n">seeds</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="EngineBuilder-186"><a href="#EngineBuilder-186"><span class="linenos">186</span></a>                <span class="sa">f</span><span class="s2">&quot;Expected is </span><span class="si">{</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EngineBuilder-187"><a href="#EngineBuilder-187"><span class="linenos">187</span></a>            <span class="p">)</span>
</span><span id="EngineBuilder-188"><a href="#EngineBuilder-188"><span class="linenos">188</span></a>
</span><span id="EngineBuilder-189"><a href="#EngineBuilder-189"><span class="linenos">189</span></a>        <span class="c1"># check for duplicated identifiers in self._quantity_generators</span>
</span><span id="EngineBuilder-190"><a href="#EngineBuilder-190"><span class="linenos">190</span></a>        <span class="n">idents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder-191"><a href="#EngineBuilder-191"><span class="linenos">191</span></a>        <span class="k">for</span> <span class="n">qg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span>
</span><span id="EngineBuilder-192"><a href="#EngineBuilder-192"><span class="linenos">192</span></a>            <span class="n">idents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="EngineBuilder-193"><a href="#EngineBuilder-193"><span class="linenos">193</span></a>
</span><span id="EngineBuilder-194"><a href="#EngineBuilder-194"><span class="linenos">194</span></a>        <span class="n">dupl</span> <span class="o">=</span> <span class="n">_find_duplicate</span><span class="p">(</span><span class="n">idents</span><span class="p">)</span>
</span><span id="EngineBuilder-195"><a href="#EngineBuilder-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="n">dupl</span><span class="o">.</span><span class="n">is_some</span><span class="p">():</span>
</span><span id="EngineBuilder-196"><a href="#EngineBuilder-196"><span class="linenos">196</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="EngineBuilder-197"><a href="#EngineBuilder-197"><span class="linenos">197</span></a>                <span class="sa">f</span><span class="s2">&quot;The identifier </span><span class="si">{</span><span class="n">dupl</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span><span class="si">}</span><span class="s2"> is used by multiple &quot;</span>
</span><span id="EngineBuilder-198"><a href="#EngineBuilder-198"><span class="linenos">198</span></a>                <span class="s2">&quot;quantity generators&quot;</span>
</span><span id="EngineBuilder-199"><a href="#EngineBuilder-199"><span class="linenos">199</span></a>            <span class="p">)</span>
</span><span id="EngineBuilder-200"><a href="#EngineBuilder-200"><span class="linenos">200</span></a>
</span><span id="EngineBuilder-201"><a href="#EngineBuilder-201"><span class="linenos">201</span></a>        <span class="c1"># set model interface for all kernels and quantity generators</span>
</span><span id="EngineBuilder-202"><a href="#EngineBuilder-202"><span class="linenos">202</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Model interface must be set&quot;</span><span class="p">)</span>
</span><span id="EngineBuilder-203"><a href="#EngineBuilder-203"><span class="linenos">203</span></a>        <span class="k">for</span> <span class="n">ker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">:</span>
</span><span id="EngineBuilder-204"><a href="#EngineBuilder-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ker</span><span class="o">.</span><span class="n">has_model</span><span class="p">():</span>
</span><span id="EngineBuilder-205"><a href="#EngineBuilder-205"><span class="linenos">205</span></a>                <span class="n">ker</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="EngineBuilder-206"><a href="#EngineBuilder-206"><span class="linenos">206</span></a>        <span class="k">for</span> <span class="n">qg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity_generators</span><span class="p">:</span>
</span><span id="EngineBuilder-207"><a href="#EngineBuilder-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">qg</span><span class="o">.</span><span class="n">has_model</span><span class="p">():</span>
</span><span id="EngineBuilder-208"><a href="#EngineBuilder-208"><span class="linenos">208</span></a>                <span class="n">qg</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="EngineBuilder-209"><a href="#EngineBuilder-209"><span class="linenos">209</span></a>
</span><span id="EngineBuilder-210"><a href="#EngineBuilder-210"><span class="linenos">210</span></a>        <span class="c1"># assign identifiers to kernels</span>
</span><span id="EngineBuilder-211"><a href="#EngineBuilder-211"><span class="linenos">211</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">):</span>
</span><span id="EngineBuilder-212"><a href="#EngineBuilder-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ker</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span>
</span><span id="EngineBuilder-213"><a href="#EngineBuilder-213"><span class="linenos">213</span></a>                <span class="n">ker</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;kernel_</span><span class="si">{</span><span class="n">idx</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EngineBuilder-214"><a href="#EngineBuilder-214"><span class="linenos">214</span></a>
</span><span id="EngineBuilder-215"><a href="#EngineBuilder-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="n">Engine</span><span class="p">(</span>
</span><span id="EngineBuilder-216"><a href="#EngineBuilder-216"><span class="linenos">216</span></a>            <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
</span><span id="EngineBuilder-217"><a href="#EngineBuilder-217"><span class="linenos">217</span></a>            <span class="n">model_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_state</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Model state must be set&quot;</span><span class="p">),</span>
</span><span id="EngineBuilder-218"><a href="#EngineBuilder-218"><span class="linenos">218</span></a>            <span class="n">kernel_sequence</span><span class="o">=</span><span class="n">KernelSequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">),</span>
</span><span id="EngineBuilder-219"><a href="#EngineBuilder-219"><span class="linenos">219</span></a>            <span class="n">epoch_configs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
</span><span id="EngineBuilder-220"><a href="#EngineBuilder-220"><span class="linenos">220</span></a>            <span class="n">jitted_sample_duration</span><span class="o">=</span><span class="n">jit_duration</span><span class="p">,</span>
</span><span id="EngineBuilder-221"><a href="#EngineBuilder-221"><span class="linenos">221</span></a>            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="EngineBuilder-222"><a href="#EngineBuilder-222"><span class="linenos">222</span></a>            <span class="n">position_keys</span><span class="o">=</span><span class="n">pos_keys</span><span class="p">,</span>
</span><span id="EngineBuilder-223"><a href="#EngineBuilder-223"><span class="linenos">223</span></a>            <span class="n">minimize_transition_infos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimize_transition_infos</span><span class="p">,</span>
</span><span id="EngineBuilder-224"><a href="#EngineBuilder-224"><span class="linenos">224</span></a>            <span class="n">store_kernel_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store_kernel_states</span><span class="p">,</span>
</span><span id="EngineBuilder-225"><a href="#EngineBuilder-225"><span class="linenos">225</span></a>            <span class="n">quantity_generators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity_generators</span><span class="p">,</span>
</span><span id="EngineBuilder-226"><a href="#EngineBuilder-226"><span class="linenos">226</span></a>            <span class="n">show_progress</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
</span><span id="EngineBuilder-227"><a href="#EngineBuilder-227"><span class="linenos">227</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#EngineBuilder">EngineBuilder</a></code> is used to construct an MCMC Engine.</p>

<p>Currently, the <code><a href="#EngineBuilder">EngineBuilder</a></code> builds an object of the class <code><a href="#Engine">Engine</a></code>.</p>

<p>By default, every position key associated with an MCMC kernel is tracked.
This behavior can be adjusted with the fields <code><a href="#EngineBuilder.positions_included">positions_included</a></code>
and <code><a href="#EngineBuilder.positions_excluded">positions_excluded</a></code>.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><code>seed</code>: Used to initialize the PRNG for the building process. The PRNG state
is also used to initialize the PRNG state of the engine. A user-specific seed
to initialize the engine can be set with the method <code><a href="#EngineBuilder.set_engine_seed">set_engine_seed</a></code>.</li>
<li><code>num_chains</code>: The number of chains to be used.</li>
</ul>
</div>


                            <div id="EngineBuilder.__init__" class="classattr">
                                        <input id="EngineBuilder.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EngineBuilder</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">num_chains</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

                <label class="view-source-button" for="EngineBuilder.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder.__init__-59"><a href="#EngineBuilder.__init__-59"><span class="linenos">59</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_chains</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="EngineBuilder.__init__-60"><a href="#EngineBuilder.__init__-60"><span class="linenos">60</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>
</span><span id="EngineBuilder.__init__-61"><a href="#EngineBuilder.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prng_key</span><span class="p">:</span> <span class="n">KeyArray</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EngineBuilder.__init__-62"><a href="#EngineBuilder.__init__-62"><span class="linenos">62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_engine_key</span><span class="p">:</span> <span class="n">KeyArray</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="EngineBuilder.__init__-63"><a href="#EngineBuilder.__init__-63"><span class="linenos">63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">num_chains</span>
</span><span id="EngineBuilder.__init__-64"><a href="#EngineBuilder.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Kernel</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder.__init__-65"><a href="#EngineBuilder.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">QuantityGenerator</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder.__init__-66"><a href="#EngineBuilder.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_state</span><span class="p">:</span> <span class="n">Option</span><span class="p">[</span><span class="n">ModelState</span><span class="p">]</span> <span class="o">=</span> <span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="EngineBuilder.__init__-67"><a href="#EngineBuilder.__init__-67"><span class="linenos">67</span></a>
</span><span id="EngineBuilder.__init__-68"><a href="#EngineBuilder.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">:</span> <span class="n">Option</span><span class="p">[</span><span class="n">ModelInterface</span><span class="p">]</span> <span class="o">=</span> <span class="n">Option</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="EngineBuilder.__init__-69"><a href="#EngineBuilder.__init__-69"><span class="linenos">69</span></a>
</span><span id="EngineBuilder.__init__-70"><a href="#EngineBuilder.__init__-70"><span class="linenos">70</span></a>        <span class="c1"># public fields, only simple states</span>
</span><span id="EngineBuilder.__init__-71"><a href="#EngineBuilder.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_kernel_states</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EngineBuilder.__init__-72"><a href="#EngineBuilder.__init__-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">minimize_transition_infos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EngineBuilder.__init__-73"><a href="#EngineBuilder.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EngineBuilder.__init__-74"><a href="#EngineBuilder.__init__-74"><span class="linenos">74</span></a>
</span><span id="EngineBuilder.__init__-75"><a href="#EngineBuilder.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">positions_included</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder.__init__-76"><a href="#EngineBuilder.__init__-76"><span class="linenos">76</span></a>        <span class="sd">&quot;&quot;&quot;List of additional position keys that should be tracked.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.__init__-77"><a href="#EngineBuilder.__init__-77"><span class="linenos">77</span></a>
</span><span id="EngineBuilder.__init__-78"><a href="#EngineBuilder.__init__-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">positions_excluded</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder.__init__-79"><a href="#EngineBuilder.__init__-79"><span class="linenos">79</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.__init__-80"><a href="#EngineBuilder.__init__-80"><span class="linenos">80</span></a><span class="sd">        List of position keys that should not be tracked.</span>
</span><span id="EngineBuilder.__init__-81"><a href="#EngineBuilder.__init__-81"><span class="linenos">81</span></a>
</span><span id="EngineBuilder.__init__-82"><a href="#EngineBuilder.__init__-82"><span class="linenos">82</span></a><span class="sd">        Excluded keys override additional keys.</span>
</span><span id="EngineBuilder.__init__-83"><a href="#EngineBuilder.__init__-83"><span class="linenos">83</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


    

                            </div>
                            <div id="EngineBuilder.positions_included" class="classattr">
                                <div class="attr variable">
            <span class="name">positions_included</span><span class="annotation">: list[str]</span>

        
    </div>
    <a class="headerlink" href="#EngineBuilder.positions_included"></a>
    
            <div class="docstring"><p>List of additional position keys that should be tracked.</p>
</div>


                            </div>
                            <div id="EngineBuilder.positions_excluded" class="classattr">
                                <div class="attr variable">
            <span class="name">positions_excluded</span><span class="annotation">: list[str]</span>

        
    </div>
    <a class="headerlink" href="#EngineBuilder.positions_excluded"></a>
    
            <div class="docstring"><p>List of position keys that should not be tracked.</p>

<p>Excluded keys override additional keys.</p>
</div>


                            </div>
                            <div id="EngineBuilder.set_engine_seed" class="classattr">
                                        <input id="EngineBuilder.set_engine_seed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_engine_seed</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span></span>)</span>

                <label class="view-source-button" for="EngineBuilder.set_engine_seed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder.set_engine_seed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder.set_engine_seed-85"><a href="#EngineBuilder.set_engine_seed-85"><span class="linenos">85</span></a>    <span class="k">def</span> <span class="nf">set_engine_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">KeyArray</span><span class="p">):</span>
</span><span id="EngineBuilder.set_engine_seed-86"><a href="#EngineBuilder.set_engine_seed-86"><span class="linenos">86</span></a>        <span class="sd">&quot;&quot;&quot;Sets a seed used to initialize the MCMC engine.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.set_engine_seed-87"><a href="#EngineBuilder.set_engine_seed-87"><span class="linenos">87</span></a>        <span class="k">if</span> <span class="n">jnp</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
</span><span id="EngineBuilder.set_engine_seed-88"><a href="#EngineBuilder.set_engine_seed-88"><span class="linenos">88</span></a>            <span class="n">seed_int</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
</span><span id="EngineBuilder.set_engine_seed-89"><a href="#EngineBuilder.set_engine_seed-89"><span class="linenos">89</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_engine_key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed_int</span><span class="p">)</span>
</span><span id="EngineBuilder.set_engine_seed-90"><a href="#EngineBuilder.set_engine_seed-90"><span class="linenos">90</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EngineBuilder.set_engine_seed-91"><a href="#EngineBuilder.set_engine_seed-91"><span class="linenos">91</span></a>            <span class="n">seed_keyarray</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">KeyArray</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
</span><span id="EngineBuilder.set_engine_seed-92"><a href="#EngineBuilder.set_engine_seed-92"><span class="linenos">92</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_engine_key</span> <span class="o">=</span> <span class="n">seed_keyarray</span>
</span></pre></div>


            <div class="docstring"><p>Sets a seed used to initialize the MCMC engine.</p>
</div>


                            </div>
                            <div id="EngineBuilder.engine_seed" class="classattr">
                                <div class="attr variable">
            <span class="name">engine_seed</span><span class="annotation">: jax._src.prng.PRNGKeyArray</span>

        
    </div>
    <a class="headerlink" href="#EngineBuilder.engine_seed"></a>
    
    

                            </div>
                            <div id="EngineBuilder.add_kernel" class="classattr">
                                        <input id="EngineBuilder.add_kernel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_kernel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">kernel</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Kernel</span></span>)</span>

                <label class="view-source-button" for="EngineBuilder.add_kernel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder.add_kernel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder.add_kernel-98"><a href="#EngineBuilder.add_kernel-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">add_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="p">:</span> <span class="n">Kernel</span><span class="p">):</span>
</span><span id="EngineBuilder.add_kernel-99"><a href="#EngineBuilder.add_kernel-99"><span class="linenos"> 99</span></a>        <span class="sd">&quot;&quot;&quot;Adds a `Kernel`.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.add_kernel-100"><a href="#EngineBuilder.add_kernel-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds a <code>Kernel</code>.</p>
</div>


                            </div>
                            <div id="EngineBuilder.kernels" class="classattr">
                                <div class="attr variable">
            <span class="name">kernels</span><span class="annotation">: tuple[liesel.goose.types.Kernel, ...]</span>

        
    </div>
    <a class="headerlink" href="#EngineBuilder.kernels"></a>
    
    

                            </div>
                            <div id="EngineBuilder.add_quantity_generator" class="classattr">
                                        <input id="EngineBuilder.add_quantity_generator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_quantity_generator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">generator</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">QuantityGenerator</span></span>)</span>

                <label class="view-source-button" for="EngineBuilder.add_quantity_generator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder.add_quantity_generator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder.add_quantity_generator-106"><a href="#EngineBuilder.add_quantity_generator-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="nf">add_quantity_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generator</span><span class="p">:</span> <span class="n">QuantityGenerator</span><span class="p">):</span>
</span><span id="EngineBuilder.add_quantity_generator-107"><a href="#EngineBuilder.add_quantity_generator-107"><span class="linenos">107</span></a>        <span class="sd">&quot;&quot;&quot;Adds a `QuantityGenerator`.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.add_quantity_generator-108"><a href="#EngineBuilder.add_quantity_generator-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds a <code>QuantityGenerator</code>.</p>
</div>


                            </div>
                            <div id="EngineBuilder.quantity_generators" class="classattr">
                                <div class="attr variable">
            <span class="name">quantity_generators</span><span class="annotation">: tuple[liesel.goose.types.QuantityGenerator, ...]</span>

        
    </div>
    <a class="headerlink" href="#EngineBuilder.quantity_generators"></a>
    
    

                            </div>
                            <div id="EngineBuilder.set_initial_values" class="classattr">
                                        <input id="EngineBuilder.set_initial_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_initial_values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">multiple_chains</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="EngineBuilder.set_initial_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder.set_initial_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder.set_initial_values-114"><a href="#EngineBuilder.set_initial_values-114"><span class="linenos">114</span></a>    <span class="k">def</span> <span class="nf">set_initial_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span> <span class="n">multiple_chains</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="EngineBuilder.set_initial_values-115"><a href="#EngineBuilder.set_initial_values-115"><span class="linenos">115</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.set_initial_values-116"><a href="#EngineBuilder.set_initial_values-116"><span class="linenos">116</span></a><span class="sd">        Sets the initial model state.</span>
</span><span id="EngineBuilder.set_initial_values-117"><a href="#EngineBuilder.set_initial_values-117"><span class="linenos">117</span></a>
</span><span id="EngineBuilder.set_initial_values-118"><a href="#EngineBuilder.set_initial_values-118"><span class="linenos">118</span></a><span class="sd">        If `multiple_chains` is true the `model_state` will be used as is;</span>
</span><span id="EngineBuilder.set_initial_values-119"><a href="#EngineBuilder.set_initial_values-119"><span class="linenos">119</span></a><span class="sd">        otherwise `model_state` will be used as the initial values for each chain.</span>
</span><span id="EngineBuilder.set_initial_values-120"><a href="#EngineBuilder.set_initial_values-120"><span class="linenos">120</span></a><span class="sd">        Note that if `multiple_chains` is true, the first axis of each leaf of</span>
</span><span id="EngineBuilder.set_initial_values-121"><a href="#EngineBuilder.set_initial_values-121"><span class="linenos">121</span></a><span class="sd">        `model_state` refers to the chain.</span>
</span><span id="EngineBuilder.set_initial_values-122"><a href="#EngineBuilder.set_initial_values-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EngineBuilder.set_initial_values-123"><a href="#EngineBuilder.set_initial_values-123"><span class="linenos">123</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">multiple_chains</span><span class="p">:</span>
</span><span id="EngineBuilder.set_initial_values-124"><a href="#EngineBuilder.set_initial_values-124"><span class="linenos">124</span></a>            <span class="n">model_states</span> <span class="o">=</span> <span class="n">stack_leaves</span><span class="p">(</span><span class="n">model_state</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">))</span>
</span><span id="EngineBuilder.set_initial_values-125"><a href="#EngineBuilder.set_initial_values-125"><span class="linenos">125</span></a>
</span><span id="EngineBuilder.set_initial_values-126"><a href="#EngineBuilder.set_initial_values-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model_state</span> <span class="o">=</span> <span class="n">Option</span><span class="p">(</span><span class="n">model_states</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets the initial model state.</p>

<p>If <code>multiple_chains</code> is true the <code><a href="#EngineBuilder.model_state">model_state</a></code> will be used as is;
otherwise <code><a href="#EngineBuilder.model_state">model_state</a></code> will be used as the initial values for each chain.
Note that if <code>multiple_chains</code> is true, the first axis of each leaf of
<code><a href="#EngineBuilder.model_state">model_state</a></code> refers to the chain.</p>
</div>


                            </div>
                            <div id="EngineBuilder.model_state" class="classattr">
                                <div class="attr variable">
            <span class="name">model_state</span><span class="annotation">: liesel.option.Option[typing.Any]</span>

        
    </div>
    <a class="headerlink" href="#EngineBuilder.model_state"></a>
    
    

                            </div>
                            <div id="EngineBuilder.set_epochs" class="classattr">
                                        <input id="EngineBuilder.set_epochs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_epochs</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">epochs</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochConfig</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="EngineBuilder.set_epochs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder.set_epochs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder.set_epochs-132"><a href="#EngineBuilder.set_epochs-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">set_epochs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epochs</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">EpochConfig</span><span class="p">]):</span>
</span><span id="EngineBuilder.set_epochs-133"><a href="#EngineBuilder.set_epochs-133"><span class="linenos">133</span></a>        <span class="sd">&quot;&quot;&quot;Sets epochs.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.set_epochs-134"><a href="#EngineBuilder.set_epochs-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epochs</span> <span class="o">=</span> <span class="n">EpochManager</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets epochs.</p>
</div>


                            </div>
                            <div id="EngineBuilder.set_duration" class="classattr">
                                        <input id="EngineBuilder.set_duration-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_duration</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">warmup_duration</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">posterior_duration</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">term_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span></span>)</span>

                <label class="view-source-button" for="EngineBuilder.set_duration-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder.set_duration"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder.set_duration-136"><a href="#EngineBuilder.set_duration-136"><span class="linenos">136</span></a>    <span class="k">def</span> <span class="nf">set_duration</span><span class="p">(</span>
</span><span id="EngineBuilder.set_duration-137"><a href="#EngineBuilder.set_duration-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">warmup_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">posterior_duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">term_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>
</span><span id="EngineBuilder.set_duration-138"><a href="#EngineBuilder.set_duration-138"><span class="linenos">138</span></a>    <span class="p">):</span>
</span><span id="EngineBuilder.set_duration-139"><a href="#EngineBuilder.set_duration-139"><span class="linenos">139</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.set_duration-140"><a href="#EngineBuilder.set_duration-140"><span class="linenos">140</span></a><span class="sd">        Sets epochs using the `stan_epochs` function.</span>
</span><span id="EngineBuilder.set_duration-141"><a href="#EngineBuilder.set_duration-141"><span class="linenos">141</span></a>
</span><span id="EngineBuilder.set_duration-142"><a href="#EngineBuilder.set_duration-142"><span class="linenos">142</span></a><span class="sd">        Note that `term_duration` needs to be long enough that tuning algorithms</span>
</span><span id="EngineBuilder.set_duration-143"><a href="#EngineBuilder.set_duration-143"><span class="linenos">143</span></a><span class="sd">        like dual averaging can converge.</span>
</span><span id="EngineBuilder.set_duration-144"><a href="#EngineBuilder.set_duration-144"><span class="linenos">144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EngineBuilder.set_duration-145"><a href="#EngineBuilder.set_duration-145"><span class="linenos">145</span></a>        <span class="n">epochs</span> <span class="o">=</span> <span class="n">stan_epochs</span><span class="p">(</span>
</span><span id="EngineBuilder.set_duration-146"><a href="#EngineBuilder.set_duration-146"><span class="linenos">146</span></a>            <span class="n">warmup_duration</span><span class="p">,</span> <span class="n">posterior_duration</span><span class="p">,</span> <span class="n">term_duration</span><span class="o">=</span><span class="n">term_duration</span>
</span><span id="EngineBuilder.set_duration-147"><a href="#EngineBuilder.set_duration-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="EngineBuilder.set_duration-148"><a href="#EngineBuilder.set_duration-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_epochs</span> <span class="o">=</span> <span class="n">EpochManager</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets epochs using the <code><a href="#stan_epochs">stan_epochs</a></code> function.</p>

<p>Note that <code>term_duration</code> needs to be long enough that tuning algorithms
like dual averaging can converge.</p>
</div>


                            </div>
                            <div id="EngineBuilder.epochs" class="classattr">
                                <div class="attr variable">
            <span class="name">epochs</span><span class="annotation">: tuple[<a href="#EpochConfig">liesel.goose.EpochConfig</a>, ...]</span>

        
    </div>
    <a class="headerlink" href="#EngineBuilder.epochs"></a>
    
    

                            </div>
                            <div id="EngineBuilder.set_model" class="classattr">
                                        <input id="EngineBuilder.set_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">ModelInterface</span></span>)</span>

                <label class="view-source-button" for="EngineBuilder.set_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder.set_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder.set_model-154"><a href="#EngineBuilder.set_model-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">set_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">ModelInterface</span><span class="p">):</span>
</span><span id="EngineBuilder.set_model-155"><a href="#EngineBuilder.set_model-155"><span class="linenos">155</span></a>        <span class="sd">&quot;&quot;&quot;Sets the model interface for all kernels and quantity generators.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.set_model-156"><a href="#EngineBuilder.set_model-156"><span class="linenos">156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">Option</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets the model interface for all kernels and quantity generators.</p>
</div>


                            </div>
                            <div id="EngineBuilder.build" class="classattr">
                                        <input id="EngineBuilder.build-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">Engine</span>:</span></span>

                <label class="view-source-button" for="EngineBuilder.build-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EngineBuilder.build"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EngineBuilder.build-158"><a href="#EngineBuilder.build-158"><span class="linenos">158</span></a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Engine</span><span class="p">:</span>
</span><span id="EngineBuilder.build-159"><a href="#EngineBuilder.build-159"><span class="linenos">159</span></a>        <span class="sd">&quot;&quot;&quot;Builds the MCMC engine with the provided setup.&quot;&quot;&quot;</span>
</span><span id="EngineBuilder.build-160"><a href="#EngineBuilder.build-160"><span class="linenos">160</span></a>        <span class="c1"># build list of position keys</span>
</span><span id="EngineBuilder.build-161"><a href="#EngineBuilder.build-161"><span class="linenos">161</span></a>        <span class="n">pos_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder.build-162"><a href="#EngineBuilder.build-162"><span class="linenos">162</span></a>        <span class="k">for</span> <span class="n">ker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kernels</span><span class="p">:</span>
</span><span id="EngineBuilder.build-163"><a href="#EngineBuilder.build-163"><span class="linenos">163</span></a>            <span class="n">pos_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ker</span><span class="o">.</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="EngineBuilder.build-164"><a href="#EngineBuilder.build-164"><span class="linenos">164</span></a>        <span class="n">dupl</span> <span class="o">=</span> <span class="n">_find_duplicate</span><span class="p">(</span><span class="n">pos_keys</span><span class="p">)</span>
</span><span id="EngineBuilder.build-165"><a href="#EngineBuilder.build-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="n">dupl</span><span class="o">.</span><span class="n">is_some</span><span class="p">():</span>
</span><span id="EngineBuilder.build-166"><a href="#EngineBuilder.build-166"><span class="linenos">166</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="EngineBuilder.build-167"><a href="#EngineBuilder.build-167"><span class="linenos">167</span></a>                <span class="sa">f</span><span class="s2">&quot;The position key </span><span class="si">{</span><span class="n">dupl</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span><span class="si">}</span><span class="s2"> is claimed by multiple kernels&quot;</span>
</span><span id="EngineBuilder.build-168"><a href="#EngineBuilder.build-168"><span class="linenos">168</span></a>            <span class="p">)</span>
</span><span id="EngineBuilder.build-169"><a href="#EngineBuilder.build-169"><span class="linenos">169</span></a>
</span><span id="EngineBuilder.build-170"><a href="#EngineBuilder.build-170"><span class="linenos">170</span></a>        <span class="n">pos_keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions_included</span><span class="p">)</span>
</span><span id="EngineBuilder.build-171"><a href="#EngineBuilder.build-171"><span class="linenos">171</span></a>        <span class="n">pos_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pos_keys</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions_excluded</span><span class="p">]</span>
</span><span id="EngineBuilder.build-172"><a href="#EngineBuilder.build-172"><span class="linenos">172</span></a>
</span><span id="EngineBuilder.build-173"><a href="#EngineBuilder.build-173"><span class="linenos">173</span></a>        <span class="c1"># find good jittable number</span>
</span><span id="EngineBuilder.build-174"><a href="#EngineBuilder.build-174"><span class="linenos">174</span></a>        <span class="n">epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epochs</span><span class="o">.</span><span class="n">_configs</span>  <span class="c1"># FIXME: use of private field</span>
</span><span id="EngineBuilder.build-175"><a href="#EngineBuilder.build-175"><span class="linenos">175</span></a>        <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">duration</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">epochs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
</span><span id="EngineBuilder.build-176"><a href="#EngineBuilder.build-176"><span class="linenos">176</span></a>        <span class="n">jit_duration</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="o">*</span><span class="n">durations</span><span class="p">)</span>
</span><span id="EngineBuilder.build-177"><a href="#EngineBuilder.build-177"><span class="linenos">177</span></a>
</span><span id="EngineBuilder.build-178"><a href="#EngineBuilder.build-178"><span class="linenos">178</span></a>        <span class="c1"># seeds</span>
</span><span id="EngineBuilder.build-179"><a href="#EngineBuilder.build-179"><span class="linenos">179</span></a>        <span class="n">seeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine_key</span>
</span><span id="EngineBuilder.build-180"><a href="#EngineBuilder.build-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="n">seeds</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span><span class="p">,):</span>
</span><span id="EngineBuilder.build-181"><a href="#EngineBuilder.build-181"><span class="linenos">181</span></a>            <span class="c1"># no multi-chain key</span>
</span><span id="EngineBuilder.build-182"><a href="#EngineBuilder.build-182"><span class="linenos">182</span></a>            <span class="n">seeds</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">seeds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">)</span>
</span><span id="EngineBuilder.build-183"><a href="#EngineBuilder.build-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="n">seeds</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="EngineBuilder.build-184"><a href="#EngineBuilder.build-184"><span class="linenos">184</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="EngineBuilder.build-185"><a href="#EngineBuilder.build-185"><span class="linenos">185</span></a>                <span class="sa">f</span><span class="s2">&quot;MCMC seed has the wrong dimensions </span><span class="si">{</span><span class="n">seeds</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="EngineBuilder.build-186"><a href="#EngineBuilder.build-186"><span class="linenos">186</span></a>                <span class="sa">f</span><span class="s2">&quot;Expected is </span><span class="si">{</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_chains</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EngineBuilder.build-187"><a href="#EngineBuilder.build-187"><span class="linenos">187</span></a>            <span class="p">)</span>
</span><span id="EngineBuilder.build-188"><a href="#EngineBuilder.build-188"><span class="linenos">188</span></a>
</span><span id="EngineBuilder.build-189"><a href="#EngineBuilder.build-189"><span class="linenos">189</span></a>        <span class="c1"># check for duplicated identifiers in self._quantity_generators</span>
</span><span id="EngineBuilder.build-190"><a href="#EngineBuilder.build-190"><span class="linenos">190</span></a>        <span class="n">idents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EngineBuilder.build-191"><a href="#EngineBuilder.build-191"><span class="linenos">191</span></a>        <span class="k">for</span> <span class="n">qg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantity_generators</span><span class="p">:</span>
</span><span id="EngineBuilder.build-192"><a href="#EngineBuilder.build-192"><span class="linenos">192</span></a>            <span class="n">idents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="EngineBuilder.build-193"><a href="#EngineBuilder.build-193"><span class="linenos">193</span></a>
</span><span id="EngineBuilder.build-194"><a href="#EngineBuilder.build-194"><span class="linenos">194</span></a>        <span class="n">dupl</span> <span class="o">=</span> <span class="n">_find_duplicate</span><span class="p">(</span><span class="n">idents</span><span class="p">)</span>
</span><span id="EngineBuilder.build-195"><a href="#EngineBuilder.build-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="n">dupl</span><span class="o">.</span><span class="n">is_some</span><span class="p">():</span>
</span><span id="EngineBuilder.build-196"><a href="#EngineBuilder.build-196"><span class="linenos">196</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="EngineBuilder.build-197"><a href="#EngineBuilder.build-197"><span class="linenos">197</span></a>                <span class="sa">f</span><span class="s2">&quot;The identifier </span><span class="si">{</span><span class="n">dupl</span><span class="o">.</span><span class="n">unwrap</span><span class="p">()</span><span class="si">}</span><span class="s2"> is used by multiple &quot;</span>
</span><span id="EngineBuilder.build-198"><a href="#EngineBuilder.build-198"><span class="linenos">198</span></a>                <span class="s2">&quot;quantity generators&quot;</span>
</span><span id="EngineBuilder.build-199"><a href="#EngineBuilder.build-199"><span class="linenos">199</span></a>            <span class="p">)</span>
</span><span id="EngineBuilder.build-200"><a href="#EngineBuilder.build-200"><span class="linenos">200</span></a>
</span><span id="EngineBuilder.build-201"><a href="#EngineBuilder.build-201"><span class="linenos">201</span></a>        <span class="c1"># set model interface for all kernels and quantity generators</span>
</span><span id="EngineBuilder.build-202"><a href="#EngineBuilder.build-202"><span class="linenos">202</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Model interface must be set&quot;</span><span class="p">)</span>
</span><span id="EngineBuilder.build-203"><a href="#EngineBuilder.build-203"><span class="linenos">203</span></a>        <span class="k">for</span> <span class="n">ker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">:</span>
</span><span id="EngineBuilder.build-204"><a href="#EngineBuilder.build-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ker</span><span class="o">.</span><span class="n">has_model</span><span class="p">():</span>
</span><span id="EngineBuilder.build-205"><a href="#EngineBuilder.build-205"><span class="linenos">205</span></a>                <span class="n">ker</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="EngineBuilder.build-206"><a href="#EngineBuilder.build-206"><span class="linenos">206</span></a>        <span class="k">for</span> <span class="n">qg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity_generators</span><span class="p">:</span>
</span><span id="EngineBuilder.build-207"><a href="#EngineBuilder.build-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">qg</span><span class="o">.</span><span class="n">has_model</span><span class="p">():</span>
</span><span id="EngineBuilder.build-208"><a href="#EngineBuilder.build-208"><span class="linenos">208</span></a>                <span class="n">qg</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="EngineBuilder.build-209"><a href="#EngineBuilder.build-209"><span class="linenos">209</span></a>
</span><span id="EngineBuilder.build-210"><a href="#EngineBuilder.build-210"><span class="linenos">210</span></a>        <span class="c1"># assign identifiers to kernels</span>
</span><span id="EngineBuilder.build-211"><a href="#EngineBuilder.build-211"><span class="linenos">211</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">):</span>
</span><span id="EngineBuilder.build-212"><a href="#EngineBuilder.build-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ker</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span>
</span><span id="EngineBuilder.build-213"><a href="#EngineBuilder.build-213"><span class="linenos">213</span></a>                <span class="n">ker</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;kernel_</span><span class="si">{</span><span class="n">idx</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="EngineBuilder.build-214"><a href="#EngineBuilder.build-214"><span class="linenos">214</span></a>
</span><span id="EngineBuilder.build-215"><a href="#EngineBuilder.build-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="n">Engine</span><span class="p">(</span>
</span><span id="EngineBuilder.build-216"><a href="#EngineBuilder.build-216"><span class="linenos">216</span></a>            <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
</span><span id="EngineBuilder.build-217"><a href="#EngineBuilder.build-217"><span class="linenos">217</span></a>            <span class="n">model_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_state</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Model state must be set&quot;</span><span class="p">),</span>
</span><span id="EngineBuilder.build-218"><a href="#EngineBuilder.build-218"><span class="linenos">218</span></a>            <span class="n">kernel_sequence</span><span class="o">=</span><span class="n">KernelSequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernels</span><span class="p">),</span>
</span><span id="EngineBuilder.build-219"><a href="#EngineBuilder.build-219"><span class="linenos">219</span></a>            <span class="n">epoch_configs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
</span><span id="EngineBuilder.build-220"><a href="#EngineBuilder.build-220"><span class="linenos">220</span></a>            <span class="n">jitted_sample_duration</span><span class="o">=</span><span class="n">jit_duration</span><span class="p">,</span>
</span><span id="EngineBuilder.build-221"><a href="#EngineBuilder.build-221"><span class="linenos">221</span></a>            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
</span><span id="EngineBuilder.build-222"><a href="#EngineBuilder.build-222"><span class="linenos">222</span></a>            <span class="n">position_keys</span><span class="o">=</span><span class="n">pos_keys</span><span class="p">,</span>
</span><span id="EngineBuilder.build-223"><a href="#EngineBuilder.build-223"><span class="linenos">223</span></a>            <span class="n">minimize_transition_infos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimize_transition_infos</span><span class="p">,</span>
</span><span id="EngineBuilder.build-224"><a href="#EngineBuilder.build-224"><span class="linenos">224</span></a>            <span class="n">store_kernel_states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store_kernel_states</span><span class="p">,</span>
</span><span id="EngineBuilder.build-225"><a href="#EngineBuilder.build-225"><span class="linenos">225</span></a>            <span class="n">quantity_generators</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity_generators</span><span class="p">,</span>
</span><span id="EngineBuilder.build-226"><a href="#EngineBuilder.build-226"><span class="linenos">226</span></a>            <span class="n">show_progress</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
</span><span id="EngineBuilder.build-227"><a href="#EngineBuilder.build-227"><span class="linenos">227</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Builds the MCMC engine with the provided setup.</p>
</div>


                            </div>
                </section>
                <section id="EpochConfig">
                            <input id="EpochConfig-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@register_dataclass_as_pytree</div>
        <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">EpochConfig</span>:

                <label class="view-source-button" for="EpochConfig-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EpochConfig"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EpochConfig-50"><a href="#EpochConfig-50"><span class="linenos">50</span></a><span class="nd">@register_dataclass_as_pytree</span>
</span><span id="EpochConfig-51"><a href="#EpochConfig-51"><span class="linenos">51</span></a><span class="nd">@dataclass</span>
</span><span id="EpochConfig-52"><a href="#EpochConfig-52"><span class="linenos">52</span></a><span class="k">class</span> <span class="nc">EpochConfig</span><span class="p">:</span>
</span><span id="EpochConfig-53"><a href="#EpochConfig-53"><span class="linenos">53</span></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">EpochType</span>
</span><span id="EpochConfig-54"><a href="#EpochConfig-54"><span class="linenos">54</span></a>    <span class="n">duration</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="EpochConfig-55"><a href="#EpochConfig-55"><span class="linenos">55</span></a>    <span class="n">thinning</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="EpochConfig-56"><a href="#EpochConfig-56"><span class="linenos">56</span></a>    <span class="n">optional</span><span class="p">:</span> <span class="n">PyTree</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="EpochConfig-57"><a href="#EpochConfig-57"><span class="linenos">57</span></a>
</span><span id="EpochConfig-58"><a href="#EpochConfig-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">to_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nth_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">time_before_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EpochState</span><span class="p">:</span>
</span><span id="EpochConfig-59"><a href="#EpochConfig-59"><span class="linenos">59</span></a>        <span class="k">return</span> <span class="n">EpochState</span><span class="p">(</span>
</span><span id="EpochConfig-60"><a href="#EpochConfig-60"><span class="linenos">60</span></a>            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="EpochConfig-61"><a href="#EpochConfig-61"><span class="linenos">61</span></a>            <span class="n">nth_epoch</span><span class="o">=</span><span class="n">nth_epoch</span><span class="p">,</span>
</span><span id="EpochConfig-62"><a href="#EpochConfig-62"><span class="linenos">62</span></a>            <span class="n">time</span><span class="o">=</span><span class="n">time_before_epoch</span><span class="p">,</span>
</span><span id="EpochConfig-63"><a href="#EpochConfig-63"><span class="linenos">63</span></a>            <span class="n">time_before_epoch</span><span class="o">=</span><span class="n">time_before_epoch</span><span class="p">,</span>
</span><span id="EpochConfig-64"><a href="#EpochConfig-64"><span class="linenos">64</span></a>            <span class="n">time_in_epoch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="EpochConfig-65"><a href="#EpochConfig-65"><span class="linenos">65</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>EpochConfig(type: 'EpochType', duration: 'int', thinning: 'int', optional: 'PyTree | None')</p>
</div>


                            <div id="EpochConfig.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">EpochConfig</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="nb">type</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochType</span>,</span><span class="param">	<span class="n">duration</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">thinning</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">optional</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#EpochConfig.__init__"></a>
    
    

                            </div>
                            <div id="EpochConfig.to_state" class="classattr">
                                        <input id="EpochConfig.to_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_state</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">nth_epoch</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">time_before_epoch</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span>:</span></span>

                <label class="view-source-button" for="EpochConfig.to_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EpochConfig.to_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EpochConfig.to_state-58"><a href="#EpochConfig.to_state-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">to_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nth_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">time_before_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EpochState</span><span class="p">:</span>
</span><span id="EpochConfig.to_state-59"><a href="#EpochConfig.to_state-59"><span class="linenos">59</span></a>        <span class="k">return</span> <span class="n">EpochState</span><span class="p">(</span>
</span><span id="EpochConfig.to_state-60"><a href="#EpochConfig.to_state-60"><span class="linenos">60</span></a>            <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="EpochConfig.to_state-61"><a href="#EpochConfig.to_state-61"><span class="linenos">61</span></a>            <span class="n">nth_epoch</span><span class="o">=</span><span class="n">nth_epoch</span><span class="p">,</span>
</span><span id="EpochConfig.to_state-62"><a href="#EpochConfig.to_state-62"><span class="linenos">62</span></a>            <span class="n">time</span><span class="o">=</span><span class="n">time_before_epoch</span><span class="p">,</span>
</span><span id="EpochConfig.to_state-63"><a href="#EpochConfig.to_state-63"><span class="linenos">63</span></a>            <span class="n">time_before_epoch</span><span class="o">=</span><span class="n">time_before_epoch</span><span class="p">,</span>
</span><span id="EpochConfig.to_state-64"><a href="#EpochConfig.to_state-64"><span class="linenos">64</span></a>            <span class="n">time_in_epoch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="EpochConfig.to_state-65"><a href="#EpochConfig.to_state-65"><span class="linenos">65</span></a>        <span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="EpochType">
                            <input id="EpochType-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EpochType</span><wbr>(<span class="base">enum.IntEnum</span>):

                <label class="view-source-button" for="EpochType-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EpochType"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EpochType-16"><a href="#EpochType-16"><span class="linenos">16</span></a><span class="k">class</span> <span class="nc">EpochType</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span id="EpochType-17"><a href="#EpochType-17"><span class="linenos">17</span></a>    <span class="sd">&quot;&quot;&quot;Indicates which MCMC phase the epoch is part of.&quot;&quot;&quot;</span>
</span><span id="EpochType-18"><a href="#EpochType-18"><span class="linenos">18</span></a>
</span><span id="EpochType-19"><a href="#EpochType-19"><span class="linenos">19</span></a>    <span class="n">INITIAL_VALUES</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="EpochType-20"><a href="#EpochType-20"><span class="linenos">20</span></a>    <span class="n">FAST_ADAPTATION</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="EpochType-21"><a href="#EpochType-21"><span class="linenos">21</span></a>    <span class="n">SLOW_ADAPTATION</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="EpochType-22"><a href="#EpochType-22"><span class="linenos">22</span></a>    <span class="n">BURNIN</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="EpochType-23"><a href="#EpochType-23"><span class="linenos">23</span></a>    <span class="n">POSTERIOR</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="EpochType-24"><a href="#EpochType-24"><span class="linenos">24</span></a>
</span><span id="EpochType-25"><a href="#EpochType-25"><span class="linenos">25</span></a>    <span class="nd">@staticmethod</span>
</span><span id="EpochType-26"><a href="#EpochType-26"><span class="linenos">26</span></a>    <span class="k">def</span> <span class="nf">is_adaptation</span><span class="p">(</span><span class="n">epoch_type</span><span class="p">:</span> <span class="n">EpochType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="EpochType-27"><a href="#EpochType-27"><span class="linenos">27</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EpochType-28"><a href="#EpochType-28"><span class="linenos">28</span></a><span class="sd">        Returns `True` if the epoch is part of the adaptation phase.</span>
</span><span id="EpochType-29"><a href="#EpochType-29"><span class="linenos">29</span></a><span class="sd">        Implemented as a static method to make it jittable.</span>
</span><span id="EpochType-30"><a href="#EpochType-30"><span class="linenos">30</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EpochType-31"><a href="#EpochType-31"><span class="linenos">31</span></a>        <span class="n">lhs</span> <span class="o">=</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">INITIAL_VALUES</span> <span class="o">&lt;</span> <span class="n">epoch_type</span>
</span><span id="EpochType-32"><a href="#EpochType-32"><span class="linenos">32</span></a>        <span class="n">rhs</span> <span class="o">=</span> <span class="n">epoch_type</span> <span class="o">&lt;</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">BURNIN</span>
</span><span id="EpochType-33"><a href="#EpochType-33"><span class="linenos">33</span></a>        <span class="c1"># using `*` instead of `and` for jax.jit</span>
</span><span id="EpochType-34"><a href="#EpochType-34"><span class="linenos">34</span></a>        <span class="c1"># `cast` is a no-op used to satisfy mypy</span>
</span><span id="EpochType-35"><a href="#EpochType-35"><span class="linenos">35</span></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">lhs</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">)</span>
</span><span id="EpochType-36"><a href="#EpochType-36"><span class="linenos">36</span></a>
</span><span id="EpochType-37"><a href="#EpochType-37"><span class="linenos">37</span></a>    <span class="nd">@staticmethod</span>
</span><span id="EpochType-38"><a href="#EpochType-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="nf">is_warmup</span><span class="p">(</span><span class="n">epoch_type</span><span class="p">:</span> <span class="n">EpochType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="EpochType-39"><a href="#EpochType-39"><span class="linenos">39</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EpochType-40"><a href="#EpochType-40"><span class="linenos">40</span></a><span class="sd">        Returns `True` if the epoch is part of the warmup phase.</span>
</span><span id="EpochType-41"><a href="#EpochType-41"><span class="linenos">41</span></a><span class="sd">        Implemented as a static method to make it jittable.</span>
</span><span id="EpochType-42"><a href="#EpochType-42"><span class="linenos">42</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EpochType-43"><a href="#EpochType-43"><span class="linenos">43</span></a>        <span class="n">rhs</span> <span class="o">=</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">INITIAL_VALUES</span> <span class="o">&lt;</span> <span class="n">epoch_type</span>
</span><span id="EpochType-44"><a href="#EpochType-44"><span class="linenos">44</span></a>        <span class="n">lhs</span> <span class="o">=</span> <span class="n">epoch_type</span> <span class="o">&lt;</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">POSTERIOR</span>
</span><span id="EpochType-45"><a href="#EpochType-45"><span class="linenos">45</span></a>        <span class="c1"># using `*` instead of `and` for jax.jit</span>
</span><span id="EpochType-46"><a href="#EpochType-46"><span class="linenos">46</span></a>        <span class="c1"># `cast` is a no-op used to satisfy mypy</span>
</span><span id="EpochType-47"><a href="#EpochType-47"><span class="linenos">47</span></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">lhs</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Indicates which MCMC phase the epoch is part of.</p>
</div>


                            <div id="EpochType.INITIAL_VALUES" class="classattr">
                                <div class="attr variable">
            <span class="name">INITIAL_VALUES</span><span class="default_value"> = &lt;<a href="#EpochType.INITIAL_VALUES">EpochType.INITIAL_VALUES</a>: 0&gt;</span>

        
    </div>
    <a class="headerlink" href="#EpochType.INITIAL_VALUES"></a>
    
    

                            </div>
                            <div id="EpochType.FAST_ADAPTATION" class="classattr">
                                <div class="attr variable">
            <span class="name">FAST_ADAPTATION</span><span class="default_value"> = &lt;<a href="#EpochType.FAST_ADAPTATION">EpochType.FAST_ADAPTATION</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#EpochType.FAST_ADAPTATION"></a>
    
    

                            </div>
                            <div id="EpochType.SLOW_ADAPTATION" class="classattr">
                                <div class="attr variable">
            <span class="name">SLOW_ADAPTATION</span><span class="default_value"> = &lt;<a href="#EpochType.SLOW_ADAPTATION">EpochType.SLOW_ADAPTATION</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#EpochType.SLOW_ADAPTATION"></a>
    
    

                            </div>
                            <div id="EpochType.BURNIN" class="classattr">
                                <div class="attr variable">
            <span class="name">BURNIN</span><span class="default_value"> = &lt;<a href="#EpochType.BURNIN">EpochType.BURNIN</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#EpochType.BURNIN"></a>
    
    

                            </div>
                            <div id="EpochType.POSTERIOR" class="classattr">
                                <div class="attr variable">
            <span class="name">POSTERIOR</span><span class="default_value"> = &lt;<a href="#EpochType.POSTERIOR">EpochType.POSTERIOR</a>: 4&gt;</span>

        
    </div>
    <a class="headerlink" href="#EpochType.POSTERIOR"></a>
    
    

                            </div>
                            <div id="EpochType.is_adaptation" class="classattr">
                                        <input id="EpochType.is_adaptation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">is_adaptation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">epoch_type</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochType</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="EpochType.is_adaptation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EpochType.is_adaptation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EpochType.is_adaptation-25"><a href="#EpochType.is_adaptation-25"><span class="linenos">25</span></a>    <span class="nd">@staticmethod</span>
</span><span id="EpochType.is_adaptation-26"><a href="#EpochType.is_adaptation-26"><span class="linenos">26</span></a>    <span class="k">def</span> <span class="nf">is_adaptation</span><span class="p">(</span><span class="n">epoch_type</span><span class="p">:</span> <span class="n">EpochType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="EpochType.is_adaptation-27"><a href="#EpochType.is_adaptation-27"><span class="linenos">27</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EpochType.is_adaptation-28"><a href="#EpochType.is_adaptation-28"><span class="linenos">28</span></a><span class="sd">        Returns `True` if the epoch is part of the adaptation phase.</span>
</span><span id="EpochType.is_adaptation-29"><a href="#EpochType.is_adaptation-29"><span class="linenos">29</span></a><span class="sd">        Implemented as a static method to make it jittable.</span>
</span><span id="EpochType.is_adaptation-30"><a href="#EpochType.is_adaptation-30"><span class="linenos">30</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EpochType.is_adaptation-31"><a href="#EpochType.is_adaptation-31"><span class="linenos">31</span></a>        <span class="n">lhs</span> <span class="o">=</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">INITIAL_VALUES</span> <span class="o">&lt;</span> <span class="n">epoch_type</span>
</span><span id="EpochType.is_adaptation-32"><a href="#EpochType.is_adaptation-32"><span class="linenos">32</span></a>        <span class="n">rhs</span> <span class="o">=</span> <span class="n">epoch_type</span> <span class="o">&lt;</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">BURNIN</span>
</span><span id="EpochType.is_adaptation-33"><a href="#EpochType.is_adaptation-33"><span class="linenos">33</span></a>        <span class="c1"># using `*` instead of `and` for jax.jit</span>
</span><span id="EpochType.is_adaptation-34"><a href="#EpochType.is_adaptation-34"><span class="linenos">34</span></a>        <span class="c1"># `cast` is a no-op used to satisfy mypy</span>
</span><span id="EpochType.is_adaptation-35"><a href="#EpochType.is_adaptation-35"><span class="linenos">35</span></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">lhs</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns <code>True</code> if the epoch is part of the adaptation phase.
Implemented as a static method to make it jittable.</p>
</div>


                            </div>
                            <div id="EpochType.is_warmup" class="classattr">
                                        <input id="EpochType.is_warmup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">is_warmup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">epoch_type</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochType</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="EpochType.is_warmup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EpochType.is_warmup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EpochType.is_warmup-37"><a href="#EpochType.is_warmup-37"><span class="linenos">37</span></a>    <span class="nd">@staticmethod</span>
</span><span id="EpochType.is_warmup-38"><a href="#EpochType.is_warmup-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="nf">is_warmup</span><span class="p">(</span><span class="n">epoch_type</span><span class="p">:</span> <span class="n">EpochType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="EpochType.is_warmup-39"><a href="#EpochType.is_warmup-39"><span class="linenos">39</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EpochType.is_warmup-40"><a href="#EpochType.is_warmup-40"><span class="linenos">40</span></a><span class="sd">        Returns `True` if the epoch is part of the warmup phase.</span>
</span><span id="EpochType.is_warmup-41"><a href="#EpochType.is_warmup-41"><span class="linenos">41</span></a><span class="sd">        Implemented as a static method to make it jittable.</span>
</span><span id="EpochType.is_warmup-42"><a href="#EpochType.is_warmup-42"><span class="linenos">42</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EpochType.is_warmup-43"><a href="#EpochType.is_warmup-43"><span class="linenos">43</span></a>        <span class="n">rhs</span> <span class="o">=</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">INITIAL_VALUES</span> <span class="o">&lt;</span> <span class="n">epoch_type</span>
</span><span id="EpochType.is_warmup-44"><a href="#EpochType.is_warmup-44"><span class="linenos">44</span></a>        <span class="n">lhs</span> <span class="o">=</span> <span class="n">epoch_type</span> <span class="o">&lt;</span> <span class="n">EpochType</span><span class="o">.</span><span class="n">POSTERIOR</span>
</span><span id="EpochType.is_warmup-45"><a href="#EpochType.is_warmup-45"><span class="linenos">45</span></a>        <span class="c1"># using `*` instead of `and` for jax.jit</span>
</span><span id="EpochType.is_warmup-46"><a href="#EpochType.is_warmup-46"><span class="linenos">46</span></a>        <span class="c1"># `cast` is a no-op used to satisfy mypy</span>
</span><span id="EpochType.is_warmup-47"><a href="#EpochType.is_warmup-47"><span class="linenos">47</span></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">lhs</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns <code>True</code> if the epoch is part of the warmup phase.
Implemented as a static method to make it jittable.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="EpochType.name" class="variable">name</dd>
                <dd id="EpochType.value" class="variable">value</dd>

            </div>
            <div><dt>builtins.int</dt>
                                <dd id="EpochType.conjugate" class="function">conjugate</dd>
                <dd id="EpochType.bit_length" class="function">bit_length</dd>
                <dd id="EpochType.bit_count" class="function">bit_count</dd>
                <dd id="EpochType.to_bytes" class="function">to_bytes</dd>
                <dd id="EpochType.from_bytes" class="function">from_bytes</dd>
                <dd id="EpochType.as_integer_ratio" class="function">as_integer_ratio</dd>
                <dd id="EpochType.real" class="variable">real</dd>
                <dd id="EpochType.imag" class="variable">imag</dd>
                <dd id="EpochType.numerator" class="variable">numerator</dd>
                <dd id="EpochType.denominator" class="variable">denominator</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="GibbsKernel">
                            <input id="GibbsKernel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GibbsKernel</span><wbr>(<span class="base">liesel.goose.kernel.ModelMixin</span>, <span class="base">liesel.goose.types.Kernel[typing.Any, liesel.goose.kernel.DefaultTransitionInfo, liesel.goose.kernel.DefaultTuningInfo]</span>):

                <label class="view-source-button" for="GibbsKernel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GibbsKernel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GibbsKernel-24"><a href="#GibbsKernel-24"><span class="linenos"> 24</span></a><span class="k">class</span> <span class="nc">GibbsKernel</span><span class="p">(</span>
</span><span id="GibbsKernel-25"><a href="#GibbsKernel-25"><span class="linenos"> 25</span></a>    <span class="n">ModelMixin</span><span class="p">,</span> <span class="n">Kernel</span><span class="p">[</span><span class="n">GibbsKernelState</span><span class="p">,</span> <span class="n">GibbsTransitionInfo</span><span class="p">,</span> <span class="n">GibbsTuningInfo</span><span class="p">]</span>
</span><span id="GibbsKernel-26"><a href="#GibbsKernel-26"><span class="linenos"> 26</span></a><span class="p">):</span>
</span><span id="GibbsKernel-27"><a href="#GibbsKernel-27"><span class="linenos"> 27</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel-28"><a href="#GibbsKernel-28"><span class="linenos"> 28</span></a><span class="sd">    A Gibbs kernel implementing the `liesel.goose.types.Kernel` protocol.</span>
</span><span id="GibbsKernel-29"><a href="#GibbsKernel-29"><span class="linenos"> 29</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GibbsKernel-30"><a href="#GibbsKernel-30"><span class="linenos"> 30</span></a>
</span><span id="GibbsKernel-31"><a href="#GibbsKernel-31"><span class="linenos"> 31</span></a>    <span class="n">error_book</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;no errors&quot;</span><span class="p">}</span>
</span><span id="GibbsKernel-32"><a href="#GibbsKernel-32"><span class="linenos"> 32</span></a>    <span class="n">needs_history</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="GibbsKernel-33"><a href="#GibbsKernel-33"><span class="linenos"> 33</span></a>    <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="GibbsKernel-34"><a href="#GibbsKernel-34"><span class="linenos"> 34</span></a>
</span><span id="GibbsKernel-35"><a href="#GibbsKernel-35"><span class="linenos"> 35</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="GibbsKernel-36"><a href="#GibbsKernel-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel-37"><a href="#GibbsKernel-37"><span class="linenos"> 37</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="GibbsKernel-38"><a href="#GibbsKernel-38"><span class="linenos"> 38</span></a>        <span class="n">transition_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">KeyArray</span><span class="p">,</span> <span class="n">ModelState</span><span class="p">],</span> <span class="n">Position</span><span class="p">],</span>
</span><span id="GibbsKernel-39"><a href="#GibbsKernel-39"><span class="linenos"> 39</span></a>    <span class="p">):</span>
</span><span id="GibbsKernel-40"><a href="#GibbsKernel-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GibbsKernel-41"><a href="#GibbsKernel-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="GibbsKernel-42"><a href="#GibbsKernel-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_transition_fn</span> <span class="o">=</span> <span class="n">transition_fn</span>
</span><span id="GibbsKernel-43"><a href="#GibbsKernel-43"><span class="linenos"> 43</span></a>
</span><span id="GibbsKernel-44"><a href="#GibbsKernel-44"><span class="linenos"> 44</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="GibbsKernel-45"><a href="#GibbsKernel-45"><span class="linenos"> 45</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel-46"><a href="#GibbsKernel-46"><span class="linenos"> 46</span></a><span class="sd">        Initializes an (empty) kernel state.</span>
</span><span id="GibbsKernel-47"><a href="#GibbsKernel-47"><span class="linenos"> 47</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel-48"><a href="#GibbsKernel-48"><span class="linenos"> 48</span></a>
</span><span id="GibbsKernel-49"><a href="#GibbsKernel-49"><span class="linenos"> 49</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="GibbsKernel-50"><a href="#GibbsKernel-50"><span class="linenos"> 50</span></a>
</span><span id="GibbsKernel-51"><a href="#GibbsKernel-51"><span class="linenos"> 51</span></a>    <span class="k">def</span> <span class="nf">transition</span><span class="p">(</span>
</span><span id="GibbsKernel-52"><a href="#GibbsKernel-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel-53"><a href="#GibbsKernel-53"><span class="linenos"> 53</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel-54"><a href="#GibbsKernel-54"><span class="linenos"> 54</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel-55"><a href="#GibbsKernel-55"><span class="linenos"> 55</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel-56"><a href="#GibbsKernel-56"><span class="linenos"> 56</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="GibbsKernel-57"><a href="#GibbsKernel-57"><span class="linenos"> 57</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">KernelState</span><span class="p">,</span> <span class="n">GibbsTransitionInfo</span><span class="p">]:</span>
</span><span id="GibbsKernel-58"><a href="#GibbsKernel-58"><span class="linenos"> 58</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel-59"><a href="#GibbsKernel-59"><span class="linenos"> 59</span></a><span class="sd">        Performs an MCMC transition.</span>
</span><span id="GibbsKernel-60"><a href="#GibbsKernel-60"><span class="linenos"> 60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel-61"><a href="#GibbsKernel-61"><span class="linenos"> 61</span></a>
</span><span id="GibbsKernel-62"><a href="#GibbsKernel-62"><span class="linenos"> 62</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">GibbsTransitionInfo</span><span class="p">(</span>
</span><span id="GibbsKernel-63"><a href="#GibbsKernel-63"><span class="linenos"> 63</span></a>            <span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="GibbsKernel-64"><a href="#GibbsKernel-64"><span class="linenos"> 64</span></a>            <span class="n">acceptance_prob</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span id="GibbsKernel-65"><a href="#GibbsKernel-65"><span class="linenos"> 65</span></a>            <span class="n">position_moved</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="GibbsKernel-66"><a href="#GibbsKernel-66"><span class="linenos"> 66</span></a>        <span class="p">)</span>
</span><span id="GibbsKernel-67"><a href="#GibbsKernel-67"><span class="linenos"> 67</span></a>
</span><span id="GibbsKernel-68"><a href="#GibbsKernel-68"><span class="linenos"> 68</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transition_fn</span><span class="p">(</span><span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="GibbsKernel-69"><a href="#GibbsKernel-69"><span class="linenos"> 69</span></a>        <span class="n">model_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="GibbsKernel-70"><a href="#GibbsKernel-70"><span class="linenos"> 70</span></a>        <span class="k">return</span> <span class="n">TransitionOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="GibbsKernel-71"><a href="#GibbsKernel-71"><span class="linenos"> 71</span></a>
</span><span id="GibbsKernel-72"><a href="#GibbsKernel-72"><span class="linenos"> 72</span></a>    <span class="k">def</span> <span class="nf">tune</span><span class="p">(</span>
</span><span id="GibbsKernel-73"><a href="#GibbsKernel-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel-74"><a href="#GibbsKernel-74"><span class="linenos"> 74</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel-75"><a href="#GibbsKernel-75"><span class="linenos"> 75</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel-76"><a href="#GibbsKernel-76"><span class="linenos"> 76</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel-77"><a href="#GibbsKernel-77"><span class="linenos"> 77</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="GibbsKernel-78"><a href="#GibbsKernel-78"><span class="linenos"> 78</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GibbsKernel-79"><a href="#GibbsKernel-79"><span class="linenos"> 79</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">KernelState</span><span class="p">,</span> <span class="n">GibbsTuningInfo</span><span class="p">]:</span>
</span><span id="GibbsKernel-80"><a href="#GibbsKernel-80"><span class="linenos"> 80</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel-81"><a href="#GibbsKernel-81"><span class="linenos"> 81</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="GibbsKernel-82"><a href="#GibbsKernel-82"><span class="linenos"> 82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel-83"><a href="#GibbsKernel-83"><span class="linenos"> 83</span></a>
</span><span id="GibbsKernel-84"><a href="#GibbsKernel-84"><span class="linenos"> 84</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">GibbsTuningInfo</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</span><span id="GibbsKernel-85"><a href="#GibbsKernel-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="n">TuningOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">)</span>
</span><span id="GibbsKernel-86"><a href="#GibbsKernel-86"><span class="linenos"> 86</span></a>
</span><span id="GibbsKernel-87"><a href="#GibbsKernel-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="GibbsKernel-88"><a href="#GibbsKernel-88"><span class="linenos"> 88</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel-89"><a href="#GibbsKernel-89"><span class="linenos"> 89</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel-90"><a href="#GibbsKernel-90"><span class="linenos"> 90</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel-91"><a href="#GibbsKernel-91"><span class="linenos"> 91</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel-92"><a href="#GibbsKernel-92"><span class="linenos"> 92</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="GibbsKernel-93"><a href="#GibbsKernel-93"><span class="linenos"> 93</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KernelState</span><span class="p">:</span>
</span><span id="GibbsKernel-94"><a href="#GibbsKernel-94"><span class="linenos"> 94</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel-95"><a href="#GibbsKernel-95"><span class="linenos"> 95</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="GibbsKernel-96"><a href="#GibbsKernel-96"><span class="linenos"> 96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel-97"><a href="#GibbsKernel-97"><span class="linenos"> 97</span></a>
</span><span id="GibbsKernel-98"><a href="#GibbsKernel-98"><span class="linenos"> 98</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="GibbsKernel-99"><a href="#GibbsKernel-99"><span class="linenos"> 99</span></a>
</span><span id="GibbsKernel-100"><a href="#GibbsKernel-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="GibbsKernel-101"><a href="#GibbsKernel-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel-102"><a href="#GibbsKernel-102"><span class="linenos">102</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel-103"><a href="#GibbsKernel-103"><span class="linenos">103</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel-104"><a href="#GibbsKernel-104"><span class="linenos">104</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel-105"><a href="#GibbsKernel-105"><span class="linenos">105</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="GibbsKernel-106"><a href="#GibbsKernel-106"><span class="linenos">106</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KernelState</span><span class="p">:</span>
</span><span id="GibbsKernel-107"><a href="#GibbsKernel-107"><span class="linenos">107</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel-108"><a href="#GibbsKernel-108"><span class="linenos">108</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="GibbsKernel-109"><a href="#GibbsKernel-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel-110"><a href="#GibbsKernel-110"><span class="linenos">110</span></a>
</span><span id="GibbsKernel-111"><a href="#GibbsKernel-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="GibbsKernel-112"><a href="#GibbsKernel-112"><span class="linenos">112</span></a>
</span><span id="GibbsKernel-113"><a href="#GibbsKernel-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="GibbsKernel-114"><a href="#GibbsKernel-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel-115"><a href="#GibbsKernel-115"><span class="linenos">115</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel-116"><a href="#GibbsKernel-116"><span class="linenos">116</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel-117"><a href="#GibbsKernel-117"><span class="linenos">117</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel-118"><a href="#GibbsKernel-118"><span class="linenos">118</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">TuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GibbsKernel-119"><a href="#GibbsKernel-119"><span class="linenos">119</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">KernelState</span><span class="p">]:</span>
</span><span id="GibbsKernel-120"><a href="#GibbsKernel-120"><span class="linenos">120</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel-121"><a href="#GibbsKernel-121"><span class="linenos">121</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="GibbsKernel-122"><a href="#GibbsKernel-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel-123"><a href="#GibbsKernel-123"><span class="linenos">123</span></a>
</span><span id="GibbsKernel-124"><a href="#GibbsKernel-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A Gibbs kernel implementing the <code>liesel.goose.types.Kernel</code> protocol.</p>
</div>


                            <div id="GibbsKernel.__init__" class="classattr">
                                        <input id="GibbsKernel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GibbsKernel</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">transition_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Position</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="GibbsKernel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GibbsKernel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GibbsKernel.__init__-35"><a href="#GibbsKernel.__init__-35"><span class="linenos">35</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="GibbsKernel.__init__-36"><a href="#GibbsKernel.__init__-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel.__init__-37"><a href="#GibbsKernel.__init__-37"><span class="linenos">37</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="GibbsKernel.__init__-38"><a href="#GibbsKernel.__init__-38"><span class="linenos">38</span></a>        <span class="n">transition_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">KeyArray</span><span class="p">,</span> <span class="n">ModelState</span><span class="p">],</span> <span class="n">Position</span><span class="p">],</span>
</span><span id="GibbsKernel.__init__-39"><a href="#GibbsKernel.__init__-39"><span class="linenos">39</span></a>    <span class="p">):</span>
</span><span id="GibbsKernel.__init__-40"><a href="#GibbsKernel.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GibbsKernel.__init__-41"><a href="#GibbsKernel.__init__-41"><span class="linenos">41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="GibbsKernel.__init__-42"><a href="#GibbsKernel.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_transition_fn</span> <span class="o">=</span> <span class="n">transition_fn</span>
</span></pre></div>


    

                            </div>
                            <div id="GibbsKernel.error_book" class="classattr">
                                <div class="attr variable">
            <span class="name">error_book</span><span class="annotation">: ClassVar[dict[int, str]]</span><span class="default_value"> = {0: &#39;no errors&#39;}</span>

        
    </div>
    <a class="headerlink" href="#GibbsKernel.error_book"></a>
    
            <div class="docstring"><p>Maps error codes to error messages.</p>

<p>We use -1 if an error code is required but the kernel is skipped.</p>
</div>


                            </div>
                            <div id="GibbsKernel.needs_history" class="classattr">
                                <div class="attr variable">
            <span class="name">needs_history</span><span class="annotation">: ClassVar[bool]</span><span class="default_value"> = False</span>

        
    </div>
    <a class="headerlink" href="#GibbsKernel.needs_history"></a>
    
            <div class="docstring"><p>Is set to true if the kernel expects the history for tuning.</p>
</div>


                            </div>
                            <div id="GibbsKernel.identifier" class="classattr">
                                <div class="attr variable">
            <span class="name">identifier</span><span class="annotation">: str</span><span class="default_value"> = &#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#GibbsKernel.identifier"></a>
    
            <div class="docstring"><p>An identifier for the kernel object that is set by the <code><a href="#EngineBuilder">EngineBuilder</a></code>
if it is an empty string.</p>
</div>


                            </div>
                            <div id="GibbsKernel.init_state" class="classattr">
                                        <input id="GibbsKernel.init_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prng_key</span>, </span><span class="param"><span class="n">model_state</span></span>)</span>

                <label class="view-source-button" for="GibbsKernel.init_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GibbsKernel.init_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GibbsKernel.init_state-44"><a href="#GibbsKernel.init_state-44"><span class="linenos">44</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="GibbsKernel.init_state-45"><a href="#GibbsKernel.init_state-45"><span class="linenos">45</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel.init_state-46"><a href="#GibbsKernel.init_state-46"><span class="linenos">46</span></a><span class="sd">        Initializes an (empty) kernel state.</span>
</span><span id="GibbsKernel.init_state-47"><a href="#GibbsKernel.init_state-47"><span class="linenos">47</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel.init_state-48"><a href="#GibbsKernel.init_state-48"><span class="linenos">48</span></a>
</span><span id="GibbsKernel.init_state-49"><a href="#GibbsKernel.init_state-49"><span class="linenos">49</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Initializes an (empty) kernel state.</p>
</div>


                            </div>
                            <div id="GibbsKernel.transition" class="classattr">
                                        <input id="GibbsKernel.transition-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">transition</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">DefaultTransitionInfo</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GibbsKernel.transition-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GibbsKernel.transition"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GibbsKernel.transition-51"><a href="#GibbsKernel.transition-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="nf">transition</span><span class="p">(</span>
</span><span id="GibbsKernel.transition-52"><a href="#GibbsKernel.transition-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel.transition-53"><a href="#GibbsKernel.transition-53"><span class="linenos">53</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel.transition-54"><a href="#GibbsKernel.transition-54"><span class="linenos">54</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel.transition-55"><a href="#GibbsKernel.transition-55"><span class="linenos">55</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel.transition-56"><a href="#GibbsKernel.transition-56"><span class="linenos">56</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="GibbsKernel.transition-57"><a href="#GibbsKernel.transition-57"><span class="linenos">57</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">KernelState</span><span class="p">,</span> <span class="n">GibbsTransitionInfo</span><span class="p">]:</span>
</span><span id="GibbsKernel.transition-58"><a href="#GibbsKernel.transition-58"><span class="linenos">58</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel.transition-59"><a href="#GibbsKernel.transition-59"><span class="linenos">59</span></a><span class="sd">        Performs an MCMC transition.</span>
</span><span id="GibbsKernel.transition-60"><a href="#GibbsKernel.transition-60"><span class="linenos">60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel.transition-61"><a href="#GibbsKernel.transition-61"><span class="linenos">61</span></a>
</span><span id="GibbsKernel.transition-62"><a href="#GibbsKernel.transition-62"><span class="linenos">62</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">GibbsTransitionInfo</span><span class="p">(</span>
</span><span id="GibbsKernel.transition-63"><a href="#GibbsKernel.transition-63"><span class="linenos">63</span></a>            <span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="GibbsKernel.transition-64"><a href="#GibbsKernel.transition-64"><span class="linenos">64</span></a>            <span class="n">acceptance_prob</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span id="GibbsKernel.transition-65"><a href="#GibbsKernel.transition-65"><span class="linenos">65</span></a>            <span class="n">position_moved</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="GibbsKernel.transition-66"><a href="#GibbsKernel.transition-66"><span class="linenos">66</span></a>        <span class="p">)</span>
</span><span id="GibbsKernel.transition-67"><a href="#GibbsKernel.transition-67"><span class="linenos">67</span></a>
</span><span id="GibbsKernel.transition-68"><a href="#GibbsKernel.transition-68"><span class="linenos">68</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transition_fn</span><span class="p">(</span><span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="GibbsKernel.transition-69"><a href="#GibbsKernel.transition-69"><span class="linenos">69</span></a>        <span class="n">model_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="GibbsKernel.transition-70"><a href="#GibbsKernel.transition-70"><span class="linenos">70</span></a>        <span class="k">return</span> <span class="n">TransitionOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs an MCMC transition.</p>
</div>


                            </div>
                            <div id="GibbsKernel.tune" class="classattr">
                                        <input id="GibbsKernel.tune-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tune</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span>,</span><span class="param">	<span class="n">history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Position</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">TuningOutcome</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">DefaultTuningInfo</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GibbsKernel.tune-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GibbsKernel.tune"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GibbsKernel.tune-72"><a href="#GibbsKernel.tune-72"><span class="linenos">72</span></a>    <span class="k">def</span> <span class="nf">tune</span><span class="p">(</span>
</span><span id="GibbsKernel.tune-73"><a href="#GibbsKernel.tune-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel.tune-74"><a href="#GibbsKernel.tune-74"><span class="linenos">74</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel.tune-75"><a href="#GibbsKernel.tune-75"><span class="linenos">75</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel.tune-76"><a href="#GibbsKernel.tune-76"><span class="linenos">76</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel.tune-77"><a href="#GibbsKernel.tune-77"><span class="linenos">77</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="GibbsKernel.tune-78"><a href="#GibbsKernel.tune-78"><span class="linenos">78</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GibbsKernel.tune-79"><a href="#GibbsKernel.tune-79"><span class="linenos">79</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">KernelState</span><span class="p">,</span> <span class="n">GibbsTuningInfo</span><span class="p">]:</span>
</span><span id="GibbsKernel.tune-80"><a href="#GibbsKernel.tune-80"><span class="linenos">80</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel.tune-81"><a href="#GibbsKernel.tune-81"><span class="linenos">81</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="GibbsKernel.tune-82"><a href="#GibbsKernel.tune-82"><span class="linenos">82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel.tune-83"><a href="#GibbsKernel.tune-83"><span class="linenos">83</span></a>
</span><span id="GibbsKernel.tune-84"><a href="#GibbsKernel.tune-84"><span class="linenos">84</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">GibbsTuningInfo</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</span><span id="GibbsKernel.tune-85"><a href="#GibbsKernel.tune-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="n">TuningOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div id="GibbsKernel.start_epoch" class="classattr">
                                        <input id="GibbsKernel.start_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="GibbsKernel.start_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GibbsKernel.start_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GibbsKernel.start_epoch-87"><a href="#GibbsKernel.start_epoch-87"><span class="linenos">87</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="GibbsKernel.start_epoch-88"><a href="#GibbsKernel.start_epoch-88"><span class="linenos">88</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel.start_epoch-89"><a href="#GibbsKernel.start_epoch-89"><span class="linenos">89</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel.start_epoch-90"><a href="#GibbsKernel.start_epoch-90"><span class="linenos">90</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel.start_epoch-91"><a href="#GibbsKernel.start_epoch-91"><span class="linenos">91</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel.start_epoch-92"><a href="#GibbsKernel.start_epoch-92"><span class="linenos">92</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="GibbsKernel.start_epoch-93"><a href="#GibbsKernel.start_epoch-93"><span class="linenos">93</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KernelState</span><span class="p">:</span>
</span><span id="GibbsKernel.start_epoch-94"><a href="#GibbsKernel.start_epoch-94"><span class="linenos">94</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel.start_epoch-95"><a href="#GibbsKernel.start_epoch-95"><span class="linenos">95</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="GibbsKernel.start_epoch-96"><a href="#GibbsKernel.start_epoch-96"><span class="linenos">96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel.start_epoch-97"><a href="#GibbsKernel.start_epoch-97"><span class="linenos">97</span></a>
</span><span id="GibbsKernel.start_epoch-98"><a href="#GibbsKernel.start_epoch-98"><span class="linenos">98</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div id="GibbsKernel.end_epoch" class="classattr">
                                        <input id="GibbsKernel.end_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="GibbsKernel.end_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GibbsKernel.end_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GibbsKernel.end_epoch-100"><a href="#GibbsKernel.end_epoch-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="GibbsKernel.end_epoch-101"><a href="#GibbsKernel.end_epoch-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel.end_epoch-102"><a href="#GibbsKernel.end_epoch-102"><span class="linenos">102</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel.end_epoch-103"><a href="#GibbsKernel.end_epoch-103"><span class="linenos">103</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel.end_epoch-104"><a href="#GibbsKernel.end_epoch-104"><span class="linenos">104</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel.end_epoch-105"><a href="#GibbsKernel.end_epoch-105"><span class="linenos">105</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="GibbsKernel.end_epoch-106"><a href="#GibbsKernel.end_epoch-106"><span class="linenos">106</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KernelState</span><span class="p">:</span>
</span><span id="GibbsKernel.end_epoch-107"><a href="#GibbsKernel.end_epoch-107"><span class="linenos">107</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel.end_epoch-108"><a href="#GibbsKernel.end_epoch-108"><span class="linenos">108</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="GibbsKernel.end_epoch-109"><a href="#GibbsKernel.end_epoch-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel.end_epoch-110"><a href="#GibbsKernel.end_epoch-110"><span class="linenos">110</span></a>
</span><span id="GibbsKernel.end_epoch-111"><a href="#GibbsKernel.end_epoch-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div id="GibbsKernel.end_warmup" class="classattr">
                                        <input id="GibbsKernel.end_warmup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_warmup</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">tuning_history</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TuningInfo</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GibbsKernel.end_warmup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GibbsKernel.end_warmup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GibbsKernel.end_warmup-113"><a href="#GibbsKernel.end_warmup-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="GibbsKernel.end_warmup-114"><a href="#GibbsKernel.end_warmup-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GibbsKernel.end_warmup-115"><a href="#GibbsKernel.end_warmup-115"><span class="linenos">115</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="GibbsKernel.end_warmup-116"><a href="#GibbsKernel.end_warmup-116"><span class="linenos">116</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">KernelState</span><span class="p">,</span>
</span><span id="GibbsKernel.end_warmup-117"><a href="#GibbsKernel.end_warmup-117"><span class="linenos">117</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="GibbsKernel.end_warmup-118"><a href="#GibbsKernel.end_warmup-118"><span class="linenos">118</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">TuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GibbsKernel.end_warmup-119"><a href="#GibbsKernel.end_warmup-119"><span class="linenos">119</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">KernelState</span><span class="p">]:</span>
</span><span id="GibbsKernel.end_warmup-120"><a href="#GibbsKernel.end_warmup-120"><span class="linenos">120</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="GibbsKernel.end_warmup-121"><a href="#GibbsKernel.end_warmup-121"><span class="linenos">121</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="GibbsKernel.end_warmup-122"><a href="#GibbsKernel.end_warmup-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GibbsKernel.end_warmup-123"><a href="#GibbsKernel.end_warmup-123"><span class="linenos">123</span></a>
</span><span id="GibbsKernel.end_warmup-124"><a href="#GibbsKernel.end_warmup-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>liesel.goose.kernel.ModelMixin</dt>
                                <dd id="GibbsKernel.position_keys" class="variable">position_keys</dd>
                <dd id="GibbsKernel.model" class="variable">model</dd>
                <dd id="GibbsKernel.set_model" class="function">set_model</dd>
                <dd id="GibbsKernel.has_model" class="function">has_model</dd>
                <dd id="GibbsKernel.position" class="function">position</dd>
                <dd id="GibbsKernel.log_prob_fn" class="function">log_prob_fn</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="HMCKernel">
                            <input id="HMCKernel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HMCKernel</span><wbr>(<span class="base">liesel.goose.kernel.ModelMixin</span>, <span class="base">liesel.goose.kernel.TransitionMixin[liesel.goose.hmc.HMCKernelState, liesel.goose.hmc.HMCTransitionInfo]</span>, <span class="base">liesel.goose.kernel.TuningMixin[liesel.goose.hmc.HMCKernelState, liesel.goose.kernel.DefaultTuningInfo]</span>):

                <label class="view-source-button" for="HMCKernel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HMCKernel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HMCKernel-76"><a href="#HMCKernel-76"><span class="linenos"> 76</span></a><span class="k">class</span> <span class="nc">HMCKernel</span><span class="p">(</span>
</span><span id="HMCKernel-77"><a href="#HMCKernel-77"><span class="linenos"> 77</span></a>    <span class="n">ModelMixin</span><span class="p">,</span>
</span><span id="HMCKernel-78"><a href="#HMCKernel-78"><span class="linenos"> 78</span></a>    <span class="n">TransitionMixin</span><span class="p">[</span><span class="n">HMCKernelState</span><span class="p">,</span> <span class="n">HMCTransitionInfo</span><span class="p">],</span>
</span><span id="HMCKernel-79"><a href="#HMCKernel-79"><span class="linenos"> 79</span></a>    <span class="n">TuningMixin</span><span class="p">[</span><span class="n">HMCKernelState</span><span class="p">,</span> <span class="n">HMCTuningInfo</span><span class="p">],</span>
</span><span id="HMCKernel-80"><a href="#HMCKernel-80"><span class="linenos"> 80</span></a><span class="p">):</span>
</span><span id="HMCKernel-81"><a href="#HMCKernel-81"><span class="linenos"> 81</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel-82"><a href="#HMCKernel-82"><span class="linenos"> 82</span></a><span class="sd">    A HMC kernel with dual averaging and an inverse mass matrix tuner,</span>
</span><span id="HMCKernel-83"><a href="#HMCKernel-83"><span class="linenos"> 83</span></a><span class="sd">    implementing the `liesel.goose.types.Kernel` protocol.</span>
</span><span id="HMCKernel-84"><a href="#HMCKernel-84"><span class="linenos"> 84</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HMCKernel-85"><a href="#HMCKernel-85"><span class="linenos"> 85</span></a>
</span><span id="HMCKernel-86"><a href="#HMCKernel-86"><span class="linenos"> 86</span></a>    <span class="n">error_book</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;no errors&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;divergent transition&quot;</span><span class="p">}</span>
</span><span id="HMCKernel-87"><a href="#HMCKernel-87"><span class="linenos"> 87</span></a>    <span class="n">needs_history</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HMCKernel-88"><a href="#HMCKernel-88"><span class="linenos"> 88</span></a>    <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="HMCKernel-89"><a href="#HMCKernel-89"><span class="linenos"> 89</span></a>
</span><span id="HMCKernel-90"><a href="#HMCKernel-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="HMCKernel-91"><a href="#HMCKernel-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel-92"><a href="#HMCKernel-92"><span class="linenos"> 92</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="HMCKernel-93"><a href="#HMCKernel-93"><span class="linenos"> 93</span></a>        <span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HMCKernel-94"><a href="#HMCKernel-94"><span class="linenos"> 94</span></a>        <span class="n">initial_inverse_mass_matrix</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HMCKernel-95"><a href="#HMCKernel-95"><span class="linenos"> 95</span></a>        <span class="n">num_integration_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="HMCKernel-96"><a href="#HMCKernel-96"><span class="linenos"> 96</span></a>        <span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="HMCKernel-97"><a href="#HMCKernel-97"><span class="linenos"> 97</span></a>        <span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="HMCKernel-98"><a href="#HMCKernel-98"><span class="linenos"> 98</span></a>        <span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="HMCKernel-99"><a href="#HMCKernel-99"><span class="linenos"> 99</span></a>        <span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="HMCKernel-100"><a href="#HMCKernel-100"><span class="linenos">100</span></a>        <span class="n">mm_diag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="HMCKernel-101"><a href="#HMCKernel-101"><span class="linenos">101</span></a>    <span class="p">):</span>
</span><span id="HMCKernel-102"><a href="#HMCKernel-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="HMCKernel-103"><a href="#HMCKernel-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HMCKernel-104"><a href="#HMCKernel-104"><span class="linenos">104</span></a>
</span><span id="HMCKernel-105"><a href="#HMCKernel-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="o">=</span> <span class="n">initial_step_size</span>
</span><span id="HMCKernel-106"><a href="#HMCKernel-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span> <span class="o">=</span> <span class="n">initial_inverse_mass_matrix</span>
</span><span id="HMCKernel-107"><a href="#HMCKernel-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_integration_steps</span> <span class="o">=</span> <span class="n">num_integration_steps</span>
</span><span id="HMCKernel-108"><a href="#HMCKernel-108"><span class="linenos">108</span></a>
</span><span id="HMCKernel-109"><a href="#HMCKernel-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span> <span class="o">=</span> <span class="n">da_target_accept</span>
</span><span id="HMCKernel-110"><a href="#HMCKernel-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span> <span class="o">=</span> <span class="n">da_gamma</span>
</span><span id="HMCKernel-111"><a href="#HMCKernel-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span> <span class="o">=</span> <span class="n">da_kappa</span>
</span><span id="HMCKernel-112"><a href="#HMCKernel-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span> <span class="o">=</span> <span class="n">da_t0</span>
</span><span id="HMCKernel-113"><a href="#HMCKernel-113"><span class="linenos">113</span></a>
</span><span id="HMCKernel-114"><a href="#HMCKernel-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span> <span class="o">=</span> <span class="n">mm_diag</span>
</span><span id="HMCKernel-115"><a href="#HMCKernel-115"><span class="linenos">115</span></a>
</span><span id="HMCKernel-116"><a href="#HMCKernel-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">_blackjax_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hmc</span><span class="o">.</span><span class="n">HMCState</span><span class="p">:</span>
</span><span id="HMCKernel-117"><a href="#HMCKernel-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="n">hmc</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">))</span>
</span><span id="HMCKernel-118"><a href="#HMCKernel-118"><span class="linenos">118</span></a>
</span><span id="HMCKernel-119"><a href="#HMCKernel-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">_blackjax_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="HMCKernel-120"><a href="#HMCKernel-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="n">hmc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</span><span id="HMCKernel-121"><a href="#HMCKernel-121"><span class="linenos">121</span></a>
</span><span id="HMCKernel-122"><a href="#HMCKernel-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="HMCKernel-123"><a href="#HMCKernel-123"><span class="linenos">123</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel-124"><a href="#HMCKernel-124"><span class="linenos">124</span></a><span class="sd">        Initializes the kernel state with an identity inverse mass matrix</span>
</span><span id="HMCKernel-125"><a href="#HMCKernel-125"><span class="linenos">125</span></a><span class="sd">        and a reasonable step size (unless explicit arguments were provided</span>
</span><span id="HMCKernel-126"><a href="#HMCKernel-126"><span class="linenos">126</span></a><span class="sd">        by the user).</span>
</span><span id="HMCKernel-127"><a href="#HMCKernel-127"><span class="linenos">127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel-128"><a href="#HMCKernel-128"><span class="linenos">128</span></a>
</span><span id="HMCKernel-129"><a href="#HMCKernel-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HMCKernel-130"><a href="#HMCKernel-130"><span class="linenos">130</span></a>            <span class="n">flat_position</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ravel_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">))</span>
</span><span id="HMCKernel-131"><a href="#HMCKernel-131"><span class="linenos">131</span></a>
</span><span id="HMCKernel-132"><a href="#HMCKernel-132"><span class="linenos">132</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span><span class="p">:</span>
</span><span id="HMCKernel-133"><a href="#HMCKernel-133"><span class="linenos">133</span></a>                <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">flat_position</span><span class="p">)</span>
</span><span id="HMCKernel-134"><a href="#HMCKernel-134"><span class="linenos">134</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="HMCKernel-135"><a href="#HMCKernel-135"><span class="linenos">135</span></a>                <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">flat_position</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="HMCKernel-136"><a href="#HMCKernel-136"><span class="linenos">136</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HMCKernel-137"><a href="#HMCKernel-137"><span class="linenos">137</span></a>            <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span>
</span><span id="HMCKernel-138"><a href="#HMCKernel-138"><span class="linenos">138</span></a>
</span><span id="HMCKernel-139"><a href="#HMCKernel-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HMCKernel-140"><a href="#HMCKernel-140"><span class="linenos">140</span></a>            <span class="n">blackjax_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_kernel</span><span class="p">()</span>
</span><span id="HMCKernel-141"><a href="#HMCKernel-141"><span class="linenos">141</span></a>            <span class="n">blackjax_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_state</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="HMCKernel-142"><a href="#HMCKernel-142"><span class="linenos">142</span></a>            <span class="n">log_prob_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="HMCKernel-143"><a href="#HMCKernel-143"><span class="linenos">143</span></a>
</span><span id="HMCKernel-144"><a href="#HMCKernel-144"><span class="linenos">144</span></a>            <span class="k">def</span> <span class="nf">kernel_generator</span><span class="p">(</span><span class="n">step_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="HMCKernel-145"><a href="#HMCKernel-145"><span class="linenos">145</span></a>                <span class="k">return</span> <span class="n">partial</span><span class="p">(</span>
</span><span id="HMCKernel-146"><a href="#HMCKernel-146"><span class="linenos">146</span></a>                    <span class="n">blackjax_kernel</span><span class="p">,</span>
</span><span id="HMCKernel-147"><a href="#HMCKernel-147"><span class="linenos">147</span></a>                    <span class="n">logprob_fn</span><span class="o">=</span><span class="n">log_prob_fn</span><span class="p">,</span>
</span><span id="HMCKernel-148"><a href="#HMCKernel-148"><span class="linenos">148</span></a>                    <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span>
</span><span id="HMCKernel-149"><a href="#HMCKernel-149"><span class="linenos">149</span></a>                    <span class="n">inverse_mass_matrix</span><span class="o">=</span><span class="n">inverse_mass_matrix</span><span class="p">,</span>
</span><span id="HMCKernel-150"><a href="#HMCKernel-150"><span class="linenos">150</span></a>                    <span class="n">num_integration_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_integration_steps</span><span class="p">,</span>
</span><span id="HMCKernel-151"><a href="#HMCKernel-151"><span class="linenos">151</span></a>                <span class="p">)</span>
</span><span id="HMCKernel-152"><a href="#HMCKernel-152"><span class="linenos">152</span></a>
</span><span id="HMCKernel-153"><a href="#HMCKernel-153"><span class="linenos">153</span></a>            <span class="n">step_size</span> <span class="o">=</span> <span class="n">find_reasonable_step_size</span><span class="p">(</span>
</span><span id="HMCKernel-154"><a href="#HMCKernel-154"><span class="linenos">154</span></a>                <span class="n">prng_key</span><span class="p">,</span>
</span><span id="HMCKernel-155"><a href="#HMCKernel-155"><span class="linenos">155</span></a>                <span class="n">kernel_generator</span><span class="p">,</span>
</span><span id="HMCKernel-156"><a href="#HMCKernel-156"><span class="linenos">156</span></a>                <span class="n">blackjax_state</span><span class="p">,</span>
</span><span id="HMCKernel-157"><a href="#HMCKernel-157"><span class="linenos">157</span></a>                <span class="n">initial_step_size</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
</span><span id="HMCKernel-158"><a href="#HMCKernel-158"><span class="linenos">158</span></a>                <span class="n">target_accept</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span><span class="p">,</span>
</span><span id="HMCKernel-159"><a href="#HMCKernel-159"><span class="linenos">159</span></a>            <span class="p">)</span>
</span><span id="HMCKernel-160"><a href="#HMCKernel-160"><span class="linenos">160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HMCKernel-161"><a href="#HMCKernel-161"><span class="linenos">161</span></a>            <span class="n">step_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span>
</span><span id="HMCKernel-162"><a href="#HMCKernel-162"><span class="linenos">162</span></a>
</span><span id="HMCKernel-163"><a href="#HMCKernel-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">HMCKernelState</span><span class="p">(</span><span class="n">step_size</span><span class="p">,</span> <span class="n">inverse_mass_matrix</span><span class="p">)</span>
</span><span id="HMCKernel-164"><a href="#HMCKernel-164"><span class="linenos">164</span></a>
</span><span id="HMCKernel-165"><a href="#HMCKernel-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="nf">_standard_transition</span><span class="p">(</span>
</span><span id="HMCKernel-166"><a href="#HMCKernel-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel-167"><a href="#HMCKernel-167"><span class="linenos">167</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel-168"><a href="#HMCKernel-168"><span class="linenos">168</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel-169"><a href="#HMCKernel-169"><span class="linenos">169</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel-170"><a href="#HMCKernel-170"><span class="linenos">170</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="HMCKernel-171"><a href="#HMCKernel-171"><span class="linenos">171</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">HMCKernelState</span><span class="p">,</span> <span class="n">HMCTransitionInfo</span><span class="p">]:</span>
</span><span id="HMCKernel-172"><a href="#HMCKernel-172"><span class="linenos">172</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel-173"><a href="#HMCKernel-173"><span class="linenos">173</span></a><span class="sd">        Performs an MCMC transition *without* dual averaging.</span>
</span><span id="HMCKernel-174"><a href="#HMCKernel-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel-175"><a href="#HMCKernel-175"><span class="linenos">175</span></a>
</span><span id="HMCKernel-176"><a href="#HMCKernel-176"><span class="linenos">176</span></a>        <span class="n">blackjax_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_kernel</span><span class="p">()</span>
</span><span id="HMCKernel-177"><a href="#HMCKernel-177"><span class="linenos">177</span></a>        <span class="n">blackjax_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_state</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="HMCKernel-178"><a href="#HMCKernel-178"><span class="linenos">178</span></a>        <span class="n">log_prob_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="HMCKernel-179"><a href="#HMCKernel-179"><span class="linenos">179</span></a>
</span><span id="HMCKernel-180"><a href="#HMCKernel-180"><span class="linenos">180</span></a>        <span class="n">blackjax_state</span><span class="p">,</span> <span class="n">blackjax_info</span> <span class="o">=</span> <span class="n">blackjax_kernel</span><span class="p">(</span>
</span><span id="HMCKernel-181"><a href="#HMCKernel-181"><span class="linenos">181</span></a>            <span class="n">prng_key</span><span class="p">,</span>
</span><span id="HMCKernel-182"><a href="#HMCKernel-182"><span class="linenos">182</span></a>            <span class="n">blackjax_state</span><span class="p">,</span>
</span><span id="HMCKernel-183"><a href="#HMCKernel-183"><span class="linenos">183</span></a>            <span class="n">log_prob_fn</span><span class="p">,</span>
</span><span id="HMCKernel-184"><a href="#HMCKernel-184"><span class="linenos">184</span></a>            <span class="n">kernel_state</span><span class="o">.</span><span class="n">step_size</span><span class="p">,</span>
</span><span id="HMCKernel-185"><a href="#HMCKernel-185"><span class="linenos">185</span></a>            <span class="n">kernel_state</span><span class="o">.</span><span class="n">inverse_mass_matrix</span><span class="p">,</span>
</span><span id="HMCKernel-186"><a href="#HMCKernel-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">num_integration_steps</span><span class="p">,</span>
</span><span id="HMCKernel-187"><a href="#HMCKernel-187"><span class="linenos">187</span></a>        <span class="p">)</span>
</span><span id="HMCKernel-188"><a href="#HMCKernel-188"><span class="linenos">188</span></a>
</span><span id="HMCKernel-189"><a href="#HMCKernel-189"><span class="linenos">189</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">_goose_info</span><span class="p">(</span><span class="n">blackjax_info</span><span class="p">)</span>
</span><span id="HMCKernel-190"><a href="#HMCKernel-190"><span class="linenos">190</span></a>        <span class="n">model_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">blackjax_state</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="HMCKernel-191"><a href="#HMCKernel-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="n">TransitionOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="HMCKernel-192"><a href="#HMCKernel-192"><span class="linenos">192</span></a>
</span><span id="HMCKernel-193"><a href="#HMCKernel-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="nf">_adaptive_transition</span><span class="p">(</span>
</span><span id="HMCKernel-194"><a href="#HMCKernel-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel-195"><a href="#HMCKernel-195"><span class="linenos">195</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel-196"><a href="#HMCKernel-196"><span class="linenos">196</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel-197"><a href="#HMCKernel-197"><span class="linenos">197</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel-198"><a href="#HMCKernel-198"><span class="linenos">198</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="HMCKernel-199"><a href="#HMCKernel-199"><span class="linenos">199</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">HMCKernelState</span><span class="p">,</span> <span class="n">HMCTransitionInfo</span><span class="p">]:</span>
</span><span id="HMCKernel-200"><a href="#HMCKernel-200"><span class="linenos">200</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel-201"><a href="#HMCKernel-201"><span class="linenos">201</span></a><span class="sd">        Performs an MCMC transition *with* dual averaging.</span>
</span><span id="HMCKernel-202"><a href="#HMCKernel-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel-203"><a href="#HMCKernel-203"><span class="linenos">203</span></a>
</span><span id="HMCKernel-204"><a href="#HMCKernel-204"><span class="linenos">204</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard_transition</span><span class="p">(</span><span class="n">prng_key</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="HMCKernel-205"><a href="#HMCKernel-205"><span class="linenos">205</span></a>
</span><span id="HMCKernel-206"><a href="#HMCKernel-206"><span class="linenos">206</span></a>        <span class="n">da_step</span><span class="p">(</span>
</span><span id="HMCKernel-207"><a href="#HMCKernel-207"><span class="linenos">207</span></a>            <span class="n">outcome</span><span class="o">.</span><span class="n">kernel_state</span><span class="p">,</span>
</span><span id="HMCKernel-208"><a href="#HMCKernel-208"><span class="linenos">208</span></a>            <span class="n">outcome</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">acceptance_prob</span><span class="p">,</span>
</span><span id="HMCKernel-209"><a href="#HMCKernel-209"><span class="linenos">209</span></a>            <span class="n">epoch</span><span class="o">.</span><span class="n">time_in_epoch</span><span class="p">,</span>
</span><span id="HMCKernel-210"><a href="#HMCKernel-210"><span class="linenos">210</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span><span class="p">,</span>
</span><span id="HMCKernel-211"><a href="#HMCKernel-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span><span class="p">,</span>
</span><span id="HMCKernel-212"><a href="#HMCKernel-212"><span class="linenos">212</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span><span class="p">,</span>
</span><span id="HMCKernel-213"><a href="#HMCKernel-213"><span class="linenos">213</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span><span class="p">,</span>
</span><span id="HMCKernel-214"><a href="#HMCKernel-214"><span class="linenos">214</span></a>        <span class="p">)</span>
</span><span id="HMCKernel-215"><a href="#HMCKernel-215"><span class="linenos">215</span></a>
</span><span id="HMCKernel-216"><a href="#HMCKernel-216"><span class="linenos">216</span></a>        <span class="k">return</span> <span class="n">outcome</span>
</span><span id="HMCKernel-217"><a href="#HMCKernel-217"><span class="linenos">217</span></a>
</span><span id="HMCKernel-218"><a href="#HMCKernel-218"><span class="linenos">218</span></a>    <span class="k">def</span> <span class="nf">_tune_fast</span><span class="p">(</span>
</span><span id="HMCKernel-219"><a href="#HMCKernel-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel-220"><a href="#HMCKernel-220"><span class="linenos">220</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel-221"><a href="#HMCKernel-221"><span class="linenos">221</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel-222"><a href="#HMCKernel-222"><span class="linenos">222</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel-223"><a href="#HMCKernel-223"><span class="linenos">223</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="HMCKernel-224"><a href="#HMCKernel-224"><span class="linenos">224</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HMCKernel-225"><a href="#HMCKernel-225"><span class="linenos">225</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">HMCKernelState</span><span class="p">,</span> <span class="n">HMCTuningInfo</span><span class="p">]:</span>
</span><span id="HMCKernel-226"><a href="#HMCKernel-226"><span class="linenos">226</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel-227"><a href="#HMCKernel-227"><span class="linenos">227</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="HMCKernel-228"><a href="#HMCKernel-228"><span class="linenos">228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel-229"><a href="#HMCKernel-229"><span class="linenos">229</span></a>
</span><span id="HMCKernel-230"><a href="#HMCKernel-230"><span class="linenos">230</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">HMCTuningInfo</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</span><span id="HMCKernel-231"><a href="#HMCKernel-231"><span class="linenos">231</span></a>        <span class="k">return</span> <span class="n">TuningOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">)</span>
</span><span id="HMCKernel-232"><a href="#HMCKernel-232"><span class="linenos">232</span></a>
</span><span id="HMCKernel-233"><a href="#HMCKernel-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">_tune_slow</span><span class="p">(</span>
</span><span id="HMCKernel-234"><a href="#HMCKernel-234"><span class="linenos">234</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel-235"><a href="#HMCKernel-235"><span class="linenos">235</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel-236"><a href="#HMCKernel-236"><span class="linenos">236</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel-237"><a href="#HMCKernel-237"><span class="linenos">237</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel-238"><a href="#HMCKernel-238"><span class="linenos">238</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="HMCKernel-239"><a href="#HMCKernel-239"><span class="linenos">239</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HMCKernel-240"><a href="#HMCKernel-240"><span class="linenos">240</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">HMCKernelState</span><span class="p">,</span> <span class="n">HMCTuningInfo</span><span class="p">]:</span>
</span><span id="HMCKernel-241"><a href="#HMCKernel-241"><span class="linenos">241</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel-242"><a href="#HMCKernel-242"><span class="linenos">242</span></a><span class="sd">        Tunes the inverse mass vector or matrix using the samples from the last epoch.</span>
</span><span id="HMCKernel-243"><a href="#HMCKernel-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel-244"><a href="#HMCKernel-244"><span class="linenos">244</span></a>
</span><span id="HMCKernel-245"><a href="#HMCKernel-245"><span class="linenos">245</span></a>        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HMCKernel-246"><a href="#HMCKernel-246"><span class="linenos">246</span></a>            <span class="n">history</span> <span class="o">=</span> <span class="n">Position</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">history</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span><span class="p">})</span>
</span><span id="HMCKernel-247"><a href="#HMCKernel-247"><span class="linenos">247</span></a>
</span><span id="HMCKernel-248"><a href="#HMCKernel-248"><span class="linenos">248</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span><span class="p">:</span>
</span><span id="HMCKernel-249"><a href="#HMCKernel-249"><span class="linenos">249</span></a>                <span class="n">new_inv_mm</span> <span class="o">=</span> <span class="n">tune_inv_mm_diag</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</span><span id="HMCKernel-250"><a href="#HMCKernel-250"><span class="linenos">250</span></a>                <span class="n">trace_fn</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span>
</span><span id="HMCKernel-251"><a href="#HMCKernel-251"><span class="linenos">251</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="HMCKernel-252"><a href="#HMCKernel-252"><span class="linenos">252</span></a>                <span class="n">new_inv_mm</span> <span class="o">=</span> <span class="n">tune_inv_mm_full</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</span><span id="HMCKernel-253"><a href="#HMCKernel-253"><span class="linenos">253</span></a>                <span class="n">trace_fn</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">trace</span>
</span><span id="HMCKernel-254"><a href="#HMCKernel-254"><span class="linenos">254</span></a>
</span><span id="HMCKernel-255"><a href="#HMCKernel-255"><span class="linenos">255</span></a>            <span class="n">old_inv_mm</span> <span class="o">=</span> <span class="n">kernel_state</span><span class="o">.</span><span class="n">inverse_mass_matrix</span>
</span><span id="HMCKernel-256"><a href="#HMCKernel-256"><span class="linenos">256</span></a>            <span class="n">adjustment</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">trace_fn</span><span class="p">(</span><span class="n">old_inv_mm</span><span class="p">)</span> <span class="o">/</span> <span class="n">trace_fn</span><span class="p">(</span><span class="n">new_inv_mm</span><span class="p">))</span>
</span><span id="HMCKernel-257"><a href="#HMCKernel-257"><span class="linenos">257</span></a>            <span class="n">kernel_state</span><span class="o">.</span><span class="n">step_size</span> <span class="o">=</span> <span class="n">adjustment</span> <span class="o">*</span> <span class="n">kernel_state</span><span class="o">.</span><span class="n">step_size</span>
</span><span id="HMCKernel-258"><a href="#HMCKernel-258"><span class="linenos">258</span></a>
</span><span id="HMCKernel-259"><a href="#HMCKernel-259"><span class="linenos">259</span></a>            <span class="n">kernel_state</span><span class="o">.</span><span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">new_inv_mm</span>
</span><span id="HMCKernel-260"><a href="#HMCKernel-260"><span class="linenos">260</span></a>
</span><span id="HMCKernel-261"><a href="#HMCKernel-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tune_fast</span><span class="p">(</span><span class="n">prng_key</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
</span><span id="HMCKernel-262"><a href="#HMCKernel-262"><span class="linenos">262</span></a>
</span><span id="HMCKernel-263"><a href="#HMCKernel-263"><span class="linenos">263</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="HMCKernel-264"><a href="#HMCKernel-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel-265"><a href="#HMCKernel-265"><span class="linenos">265</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel-266"><a href="#HMCKernel-266"><span class="linenos">266</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel-267"><a href="#HMCKernel-267"><span class="linenos">267</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel-268"><a href="#HMCKernel-268"><span class="linenos">268</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="HMCKernel-269"><a href="#HMCKernel-269"><span class="linenos">269</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HMCKernelState</span><span class="p">:</span>
</span><span id="HMCKernel-270"><a href="#HMCKernel-270"><span class="linenos">270</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel-271"><a href="#HMCKernel-271"><span class="linenos">271</span></a><span class="sd">        Resets the state of the dual averaging algorithm.</span>
</span><span id="HMCKernel-272"><a href="#HMCKernel-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel-273"><a href="#HMCKernel-273"><span class="linenos">273</span></a>
</span><span id="HMCKernel-274"><a href="#HMCKernel-274"><span class="linenos">274</span></a>        <span class="n">da_init</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="HMCKernel-275"><a href="#HMCKernel-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="HMCKernel-276"><a href="#HMCKernel-276"><span class="linenos">276</span></a>
</span><span id="HMCKernel-277"><a href="#HMCKernel-277"><span class="linenos">277</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="HMCKernel-278"><a href="#HMCKernel-278"><span class="linenos">278</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel-279"><a href="#HMCKernel-279"><span class="linenos">279</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel-280"><a href="#HMCKernel-280"><span class="linenos">280</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel-281"><a href="#HMCKernel-281"><span class="linenos">281</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel-282"><a href="#HMCKernel-282"><span class="linenos">282</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="HMCKernel-283"><a href="#HMCKernel-283"><span class="linenos">283</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HMCKernelState</span><span class="p">:</span>
</span><span id="HMCKernel-284"><a href="#HMCKernel-284"><span class="linenos">284</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel-285"><a href="#HMCKernel-285"><span class="linenos">285</span></a><span class="sd">        Sets the step size as found by the dual averaging algorithm.</span>
</span><span id="HMCKernel-286"><a href="#HMCKernel-286"><span class="linenos">286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel-287"><a href="#HMCKernel-287"><span class="linenos">287</span></a>
</span><span id="HMCKernel-288"><a href="#HMCKernel-288"><span class="linenos">288</span></a>        <span class="n">da_finalize</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="HMCKernel-289"><a href="#HMCKernel-289"><span class="linenos">289</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="HMCKernel-290"><a href="#HMCKernel-290"><span class="linenos">290</span></a>
</span><span id="HMCKernel-291"><a href="#HMCKernel-291"><span class="linenos">291</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="HMCKernel-292"><a href="#HMCKernel-292"><span class="linenos">292</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel-293"><a href="#HMCKernel-293"><span class="linenos">293</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel-294"><a href="#HMCKernel-294"><span class="linenos">294</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel-295"><a href="#HMCKernel-295"><span class="linenos">295</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel-296"><a href="#HMCKernel-296"><span class="linenos">296</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">HMCTuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HMCKernel-297"><a href="#HMCKernel-297"><span class="linenos">297</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">HMCKernelState</span><span class="p">]:</span>
</span><span id="HMCKernel-298"><a href="#HMCKernel-298"><span class="linenos">298</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel-299"><a href="#HMCKernel-299"><span class="linenos">299</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="HMCKernel-300"><a href="#HMCKernel-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel-301"><a href="#HMCKernel-301"><span class="linenos">301</span></a>
</span><span id="HMCKernel-302"><a href="#HMCKernel-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A HMC kernel with dual averaging and an inverse mass matrix tuner,
implementing the <code>liesel.goose.types.Kernel</code> protocol.</p>
</div>


                            <div id="HMCKernel.__init__" class="classattr">
                                        <input id="HMCKernel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HMCKernel</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">initial_inverse_mass_matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">num_integration_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span>,</span><span class="param">	<span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>,</span><span class="param">	<span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span>,</span><span class="param">	<span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">mm_diag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="HMCKernel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HMCKernel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HMCKernel.__init__-90"><a href="#HMCKernel.__init__-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="HMCKernel.__init__-91"><a href="#HMCKernel.__init__-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel.__init__-92"><a href="#HMCKernel.__init__-92"><span class="linenos"> 92</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="HMCKernel.__init__-93"><a href="#HMCKernel.__init__-93"><span class="linenos"> 93</span></a>        <span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HMCKernel.__init__-94"><a href="#HMCKernel.__init__-94"><span class="linenos"> 94</span></a>        <span class="n">initial_inverse_mass_matrix</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HMCKernel.__init__-95"><a href="#HMCKernel.__init__-95"><span class="linenos"> 95</span></a>        <span class="n">num_integration_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="HMCKernel.__init__-96"><a href="#HMCKernel.__init__-96"><span class="linenos"> 96</span></a>        <span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="HMCKernel.__init__-97"><a href="#HMCKernel.__init__-97"><span class="linenos"> 97</span></a>        <span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="HMCKernel.__init__-98"><a href="#HMCKernel.__init__-98"><span class="linenos"> 98</span></a>        <span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="HMCKernel.__init__-99"><a href="#HMCKernel.__init__-99"><span class="linenos"> 99</span></a>        <span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="HMCKernel.__init__-100"><a href="#HMCKernel.__init__-100"><span class="linenos">100</span></a>        <span class="n">mm_diag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="HMCKernel.__init__-101"><a href="#HMCKernel.__init__-101"><span class="linenos">101</span></a>    <span class="p">):</span>
</span><span id="HMCKernel.__init__-102"><a href="#HMCKernel.__init__-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="HMCKernel.__init__-103"><a href="#HMCKernel.__init__-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HMCKernel.__init__-104"><a href="#HMCKernel.__init__-104"><span class="linenos">104</span></a>
</span><span id="HMCKernel.__init__-105"><a href="#HMCKernel.__init__-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="o">=</span> <span class="n">initial_step_size</span>
</span><span id="HMCKernel.__init__-106"><a href="#HMCKernel.__init__-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span> <span class="o">=</span> <span class="n">initial_inverse_mass_matrix</span>
</span><span id="HMCKernel.__init__-107"><a href="#HMCKernel.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_integration_steps</span> <span class="o">=</span> <span class="n">num_integration_steps</span>
</span><span id="HMCKernel.__init__-108"><a href="#HMCKernel.__init__-108"><span class="linenos">108</span></a>
</span><span id="HMCKernel.__init__-109"><a href="#HMCKernel.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span> <span class="o">=</span> <span class="n">da_target_accept</span>
</span><span id="HMCKernel.__init__-110"><a href="#HMCKernel.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span> <span class="o">=</span> <span class="n">da_gamma</span>
</span><span id="HMCKernel.__init__-111"><a href="#HMCKernel.__init__-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span> <span class="o">=</span> <span class="n">da_kappa</span>
</span><span id="HMCKernel.__init__-112"><a href="#HMCKernel.__init__-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span> <span class="o">=</span> <span class="n">da_t0</span>
</span><span id="HMCKernel.__init__-113"><a href="#HMCKernel.__init__-113"><span class="linenos">113</span></a>
</span><span id="HMCKernel.__init__-114"><a href="#HMCKernel.__init__-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span> <span class="o">=</span> <span class="n">mm_diag</span>
</span></pre></div>


    

                            </div>
                            <div id="HMCKernel.error_book" class="classattr">
                                <div class="attr variable">
            <span class="name">error_book</span><span class="annotation">: ClassVar[dict[int, str]]</span><span class="default_value"> = {0: &#39;no errors&#39;, 1: &#39;divergent transition&#39;}</span>

        
    </div>
    <a class="headerlink" href="#HMCKernel.error_book"></a>
    
    

                            </div>
                            <div id="HMCKernel.needs_history" class="classattr">
                                <div class="attr variable">
            <span class="name">needs_history</span><span class="annotation">: ClassVar[bool]</span><span class="default_value"> = True</span>

        
    </div>
    <a class="headerlink" href="#HMCKernel.needs_history"></a>
    
    

                            </div>
                            <div id="HMCKernel.identifier" class="classattr">
                                <div class="attr variable">
            <span class="name">identifier</span><span class="annotation">: str</span><span class="default_value"> = &#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#HMCKernel.identifier"></a>
    
    

                            </div>
                            <div id="HMCKernel.init_state" class="classattr">
                                        <input id="HMCKernel.init_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prng_key</span>, </span><span class="param"><span class="n">model_state</span></span>)</span>

                <label class="view-source-button" for="HMCKernel.init_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HMCKernel.init_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HMCKernel.init_state-122"><a href="#HMCKernel.init_state-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="HMCKernel.init_state-123"><a href="#HMCKernel.init_state-123"><span class="linenos">123</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel.init_state-124"><a href="#HMCKernel.init_state-124"><span class="linenos">124</span></a><span class="sd">        Initializes the kernel state with an identity inverse mass matrix</span>
</span><span id="HMCKernel.init_state-125"><a href="#HMCKernel.init_state-125"><span class="linenos">125</span></a><span class="sd">        and a reasonable step size (unless explicit arguments were provided</span>
</span><span id="HMCKernel.init_state-126"><a href="#HMCKernel.init_state-126"><span class="linenos">126</span></a><span class="sd">        by the user).</span>
</span><span id="HMCKernel.init_state-127"><a href="#HMCKernel.init_state-127"><span class="linenos">127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel.init_state-128"><a href="#HMCKernel.init_state-128"><span class="linenos">128</span></a>
</span><span id="HMCKernel.init_state-129"><a href="#HMCKernel.init_state-129"><span class="linenos">129</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HMCKernel.init_state-130"><a href="#HMCKernel.init_state-130"><span class="linenos">130</span></a>            <span class="n">flat_position</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ravel_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">))</span>
</span><span id="HMCKernel.init_state-131"><a href="#HMCKernel.init_state-131"><span class="linenos">131</span></a>
</span><span id="HMCKernel.init_state-132"><a href="#HMCKernel.init_state-132"><span class="linenos">132</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span><span class="p">:</span>
</span><span id="HMCKernel.init_state-133"><a href="#HMCKernel.init_state-133"><span class="linenos">133</span></a>                <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">flat_position</span><span class="p">)</span>
</span><span id="HMCKernel.init_state-134"><a href="#HMCKernel.init_state-134"><span class="linenos">134</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="HMCKernel.init_state-135"><a href="#HMCKernel.init_state-135"><span class="linenos">135</span></a>                <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">flat_position</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="HMCKernel.init_state-136"><a href="#HMCKernel.init_state-136"><span class="linenos">136</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HMCKernel.init_state-137"><a href="#HMCKernel.init_state-137"><span class="linenos">137</span></a>            <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span>
</span><span id="HMCKernel.init_state-138"><a href="#HMCKernel.init_state-138"><span class="linenos">138</span></a>
</span><span id="HMCKernel.init_state-139"><a href="#HMCKernel.init_state-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HMCKernel.init_state-140"><a href="#HMCKernel.init_state-140"><span class="linenos">140</span></a>            <span class="n">blackjax_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_kernel</span><span class="p">()</span>
</span><span id="HMCKernel.init_state-141"><a href="#HMCKernel.init_state-141"><span class="linenos">141</span></a>            <span class="n">blackjax_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_state</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="HMCKernel.init_state-142"><a href="#HMCKernel.init_state-142"><span class="linenos">142</span></a>            <span class="n">log_prob_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="HMCKernel.init_state-143"><a href="#HMCKernel.init_state-143"><span class="linenos">143</span></a>
</span><span id="HMCKernel.init_state-144"><a href="#HMCKernel.init_state-144"><span class="linenos">144</span></a>            <span class="k">def</span> <span class="nf">kernel_generator</span><span class="p">(</span><span class="n">step_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="HMCKernel.init_state-145"><a href="#HMCKernel.init_state-145"><span class="linenos">145</span></a>                <span class="k">return</span> <span class="n">partial</span><span class="p">(</span>
</span><span id="HMCKernel.init_state-146"><a href="#HMCKernel.init_state-146"><span class="linenos">146</span></a>                    <span class="n">blackjax_kernel</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-147"><a href="#HMCKernel.init_state-147"><span class="linenos">147</span></a>                    <span class="n">logprob_fn</span><span class="o">=</span><span class="n">log_prob_fn</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-148"><a href="#HMCKernel.init_state-148"><span class="linenos">148</span></a>                    <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-149"><a href="#HMCKernel.init_state-149"><span class="linenos">149</span></a>                    <span class="n">inverse_mass_matrix</span><span class="o">=</span><span class="n">inverse_mass_matrix</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-150"><a href="#HMCKernel.init_state-150"><span class="linenos">150</span></a>                    <span class="n">num_integration_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_integration_steps</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-151"><a href="#HMCKernel.init_state-151"><span class="linenos">151</span></a>                <span class="p">)</span>
</span><span id="HMCKernel.init_state-152"><a href="#HMCKernel.init_state-152"><span class="linenos">152</span></a>
</span><span id="HMCKernel.init_state-153"><a href="#HMCKernel.init_state-153"><span class="linenos">153</span></a>            <span class="n">step_size</span> <span class="o">=</span> <span class="n">find_reasonable_step_size</span><span class="p">(</span>
</span><span id="HMCKernel.init_state-154"><a href="#HMCKernel.init_state-154"><span class="linenos">154</span></a>                <span class="n">prng_key</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-155"><a href="#HMCKernel.init_state-155"><span class="linenos">155</span></a>                <span class="n">kernel_generator</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-156"><a href="#HMCKernel.init_state-156"><span class="linenos">156</span></a>                <span class="n">blackjax_state</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-157"><a href="#HMCKernel.init_state-157"><span class="linenos">157</span></a>                <span class="n">initial_step_size</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-158"><a href="#HMCKernel.init_state-158"><span class="linenos">158</span></a>                <span class="n">target_accept</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span><span class="p">,</span>
</span><span id="HMCKernel.init_state-159"><a href="#HMCKernel.init_state-159"><span class="linenos">159</span></a>            <span class="p">)</span>
</span><span id="HMCKernel.init_state-160"><a href="#HMCKernel.init_state-160"><span class="linenos">160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HMCKernel.init_state-161"><a href="#HMCKernel.init_state-161"><span class="linenos">161</span></a>            <span class="n">step_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span>
</span><span id="HMCKernel.init_state-162"><a href="#HMCKernel.init_state-162"><span class="linenos">162</span></a>
</span><span id="HMCKernel.init_state-163"><a href="#HMCKernel.init_state-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">HMCKernelState</span><span class="p">(</span><span class="n">step_size</span><span class="p">,</span> <span class="n">inverse_mass_matrix</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the kernel state with an identity inverse mass matrix
and a reasonable step size (unless explicit arguments were provided
by the user).</p>
</div>


                            </div>
                            <div id="HMCKernel.start_epoch" class="classattr">
                                        <input id="HMCKernel.start_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">hmc</span><span class="o">.</span><span class="n">HMCKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">hmc</span><span class="o">.</span><span class="n">HMCKernelState</span>:</span></span>

                <label class="view-source-button" for="HMCKernel.start_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HMCKernel.start_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HMCKernel.start_epoch-263"><a href="#HMCKernel.start_epoch-263"><span class="linenos">263</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="HMCKernel.start_epoch-264"><a href="#HMCKernel.start_epoch-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel.start_epoch-265"><a href="#HMCKernel.start_epoch-265"><span class="linenos">265</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel.start_epoch-266"><a href="#HMCKernel.start_epoch-266"><span class="linenos">266</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel.start_epoch-267"><a href="#HMCKernel.start_epoch-267"><span class="linenos">267</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel.start_epoch-268"><a href="#HMCKernel.start_epoch-268"><span class="linenos">268</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="HMCKernel.start_epoch-269"><a href="#HMCKernel.start_epoch-269"><span class="linenos">269</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HMCKernelState</span><span class="p">:</span>
</span><span id="HMCKernel.start_epoch-270"><a href="#HMCKernel.start_epoch-270"><span class="linenos">270</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel.start_epoch-271"><a href="#HMCKernel.start_epoch-271"><span class="linenos">271</span></a><span class="sd">        Resets the state of the dual averaging algorithm.</span>
</span><span id="HMCKernel.start_epoch-272"><a href="#HMCKernel.start_epoch-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel.start_epoch-273"><a href="#HMCKernel.start_epoch-273"><span class="linenos">273</span></a>
</span><span id="HMCKernel.start_epoch-274"><a href="#HMCKernel.start_epoch-274"><span class="linenos">274</span></a>        <span class="n">da_init</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="HMCKernel.start_epoch-275"><a href="#HMCKernel.start_epoch-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Resets the state of the dual averaging algorithm.</p>
</div>


                            </div>
                            <div id="HMCKernel.end_epoch" class="classattr">
                                        <input id="HMCKernel.end_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">hmc</span><span class="o">.</span><span class="n">HMCKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">hmc</span><span class="o">.</span><span class="n">HMCKernelState</span>:</span></span>

                <label class="view-source-button" for="HMCKernel.end_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HMCKernel.end_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HMCKernel.end_epoch-277"><a href="#HMCKernel.end_epoch-277"><span class="linenos">277</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="HMCKernel.end_epoch-278"><a href="#HMCKernel.end_epoch-278"><span class="linenos">278</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel.end_epoch-279"><a href="#HMCKernel.end_epoch-279"><span class="linenos">279</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel.end_epoch-280"><a href="#HMCKernel.end_epoch-280"><span class="linenos">280</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel.end_epoch-281"><a href="#HMCKernel.end_epoch-281"><span class="linenos">281</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel.end_epoch-282"><a href="#HMCKernel.end_epoch-282"><span class="linenos">282</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="HMCKernel.end_epoch-283"><a href="#HMCKernel.end_epoch-283"><span class="linenos">283</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HMCKernelState</span><span class="p">:</span>
</span><span id="HMCKernel.end_epoch-284"><a href="#HMCKernel.end_epoch-284"><span class="linenos">284</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel.end_epoch-285"><a href="#HMCKernel.end_epoch-285"><span class="linenos">285</span></a><span class="sd">        Sets the step size as found by the dual averaging algorithm.</span>
</span><span id="HMCKernel.end_epoch-286"><a href="#HMCKernel.end_epoch-286"><span class="linenos">286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel.end_epoch-287"><a href="#HMCKernel.end_epoch-287"><span class="linenos">287</span></a>
</span><span id="HMCKernel.end_epoch-288"><a href="#HMCKernel.end_epoch-288"><span class="linenos">288</span></a>        <span class="n">da_finalize</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="HMCKernel.end_epoch-289"><a href="#HMCKernel.end_epoch-289"><span class="linenos">289</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Sets the step size as found by the dual averaging algorithm.</p>
</div>


                            </div>
                            <div id="HMCKernel.end_warmup" class="classattr">
                                        <input id="HMCKernel.end_warmup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_warmup</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">hmc</span><span class="o">.</span><span class="n">HMCKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">tuning_history</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">DefaultTuningInfo</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">hmc</span><span class="o">.</span><span class="n">HMCKernelState</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="HMCKernel.end_warmup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HMCKernel.end_warmup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HMCKernel.end_warmup-291"><a href="#HMCKernel.end_warmup-291"><span class="linenos">291</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="HMCKernel.end_warmup-292"><a href="#HMCKernel.end_warmup-292"><span class="linenos">292</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HMCKernel.end_warmup-293"><a href="#HMCKernel.end_warmup-293"><span class="linenos">293</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="HMCKernel.end_warmup-294"><a href="#HMCKernel.end_warmup-294"><span class="linenos">294</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">HMCKernelState</span><span class="p">,</span>
</span><span id="HMCKernel.end_warmup-295"><a href="#HMCKernel.end_warmup-295"><span class="linenos">295</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="HMCKernel.end_warmup-296"><a href="#HMCKernel.end_warmup-296"><span class="linenos">296</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">HMCTuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HMCKernel.end_warmup-297"><a href="#HMCKernel.end_warmup-297"><span class="linenos">297</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">HMCKernelState</span><span class="p">]:</span>
</span><span id="HMCKernel.end_warmup-298"><a href="#HMCKernel.end_warmup-298"><span class="linenos">298</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="HMCKernel.end_warmup-299"><a href="#HMCKernel.end_warmup-299"><span class="linenos">299</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="HMCKernel.end_warmup-300"><a href="#HMCKernel.end_warmup-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HMCKernel.end_warmup-301"><a href="#HMCKernel.end_warmup-301"><span class="linenos">301</span></a>
</span><span id="HMCKernel.end_warmup-302"><a href="#HMCKernel.end_warmup-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>liesel.goose.kernel.ModelMixin</dt>
                                <dd id="HMCKernel.model" class="variable">model</dd>
                <dd id="HMCKernel.set_model" class="function">set_model</dd>
                <dd id="HMCKernel.has_model" class="function">has_model</dd>
                <dd id="HMCKernel.position" class="function">position</dd>
                <dd id="HMCKernel.log_prob_fn" class="function">log_prob_fn</dd>

            </div>
            <div><dt>liesel.goose.kernel.TransitionMixin</dt>
                                <dd id="HMCKernel.transition" class="function">transition</dd>

            </div>
            <div><dt>liesel.goose.kernel.TuningMixin</dt>
                                <dd id="HMCKernel.tune" class="function">tune</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="IWLSKernel">
                            <input id="IWLSKernel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IWLSKernel</span><wbr>(<span class="base">liesel.goose.kernel.ModelMixin</span>, <span class="base">liesel.goose.kernel.TransitionMixin[liesel.goose.iwls.IWLSKernelState, liesel.goose.kernel.DefaultTransitionInfo]</span>):

                <label class="view-source-button" for="IWLSKernel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IWLSKernel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IWLSKernel-52"><a href="#IWLSKernel-52"><span class="linenos"> 52</span></a><span class="k">class</span> <span class="nc">IWLSKernel</span><span class="p">(</span><span class="n">ModelMixin</span><span class="p">,</span> <span class="n">TransitionMixin</span><span class="p">[</span><span class="n">IWLSKernelState</span><span class="p">,</span> <span class="n">IWLSTransitionInfo</span><span class="p">]):</span>
</span><span id="IWLSKernel-53"><a href="#IWLSKernel-53"><span class="linenos"> 53</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-54"><a href="#IWLSKernel-54"><span class="linenos"> 54</span></a><span class="sd">    An IWLS kernel with dual averaging and an (optional) user-defined function</span>
</span><span id="IWLSKernel-55"><a href="#IWLSKernel-55"><span class="linenos"> 55</span></a><span class="sd">    for computing the Cholesky decomposition of the Fisher information matrix,</span>
</span><span id="IWLSKernel-56"><a href="#IWLSKernel-56"><span class="linenos"> 56</span></a><span class="sd">    implementing the `liesel.goose.types.Kernel` protocol.</span>
</span><span id="IWLSKernel-57"><a href="#IWLSKernel-57"><span class="linenos"> 57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-58"><a href="#IWLSKernel-58"><span class="linenos"> 58</span></a>
</span><span id="IWLSKernel-59"><a href="#IWLSKernel-59"><span class="linenos"> 59</span></a>    <span class="n">error_book</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;no errors&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">:</span> <span class="s2">&quot;nan acceptance prob&quot;</span><span class="p">}</span>
</span><span id="IWLSKernel-60"><a href="#IWLSKernel-60"><span class="linenos"> 60</span></a>    <span class="n">needs_history</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="IWLSKernel-61"><a href="#IWLSKernel-61"><span class="linenos"> 61</span></a>    <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="IWLSKernel-62"><a href="#IWLSKernel-62"><span class="linenos"> 62</span></a>
</span><span id="IWLSKernel-63"><a href="#IWLSKernel-63"><span class="linenos"> 63</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="IWLSKernel-64"><a href="#IWLSKernel-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel-65"><a href="#IWLSKernel-65"><span class="linenos"> 65</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="IWLSKernel-66"><a href="#IWLSKernel-66"><span class="linenos"> 66</span></a>        <span class="n">chol_info_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ModelState</span><span class="p">],</span> <span class="n">Array</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="IWLSKernel-67"><a href="#IWLSKernel-67"><span class="linenos"> 67</span></a>        <span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
</span><span id="IWLSKernel-68"><a href="#IWLSKernel-68"><span class="linenos"> 68</span></a>        <span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="IWLSKernel-69"><a href="#IWLSKernel-69"><span class="linenos"> 69</span></a>        <span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="IWLSKernel-70"><a href="#IWLSKernel-70"><span class="linenos"> 70</span></a>        <span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="IWLSKernel-71"><a href="#IWLSKernel-71"><span class="linenos"> 71</span></a>        <span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="IWLSKernel-72"><a href="#IWLSKernel-72"><span class="linenos"> 72</span></a>    <span class="p">):</span>
</span><span id="IWLSKernel-73"><a href="#IWLSKernel-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="IWLSKernel-74"><a href="#IWLSKernel-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="IWLSKernel-75"><a href="#IWLSKernel-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chol_info_fn</span> <span class="o">=</span> <span class="n">chol_info_fn</span>
</span><span id="IWLSKernel-76"><a href="#IWLSKernel-76"><span class="linenos"> 76</span></a>
</span><span id="IWLSKernel-77"><a href="#IWLSKernel-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="o">=</span> <span class="n">initial_step_size</span>
</span><span id="IWLSKernel-78"><a href="#IWLSKernel-78"><span class="linenos"> 78</span></a>
</span><span id="IWLSKernel-79"><a href="#IWLSKernel-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span> <span class="o">=</span> <span class="n">da_target_accept</span>
</span><span id="IWLSKernel-80"><a href="#IWLSKernel-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span> <span class="o">=</span> <span class="n">da_gamma</span>
</span><span id="IWLSKernel-81"><a href="#IWLSKernel-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span> <span class="o">=</span> <span class="n">da_kappa</span>
</span><span id="IWLSKernel-82"><a href="#IWLSKernel-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span> <span class="o">=</span> <span class="n">da_t0</span>
</span><span id="IWLSKernel-83"><a href="#IWLSKernel-83"><span class="linenos"> 83</span></a>
</span><span id="IWLSKernel-84"><a href="#IWLSKernel-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="nf">_flat_log_prob_fn</span><span class="p">(</span>
</span><span id="IWLSKernel-85"><a href="#IWLSKernel-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span> <span class="n">unravel_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Array</span><span class="p">],</span> <span class="n">Position</span><span class="p">]</span>
</span><span id="IWLSKernel-86"><a href="#IWLSKernel-86"><span class="linenos"> 86</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Array</span><span class="p">],</span> <span class="nb">float</span><span class="p">]:</span>
</span><span id="IWLSKernel-87"><a href="#IWLSKernel-87"><span class="linenos"> 87</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-88"><a href="#IWLSKernel-88"><span class="linenos"> 88</span></a><span class="sd">        Returns a callable which takes a flat position and returns the log-probability</span>
</span><span id="IWLSKernel-89"><a href="#IWLSKernel-89"><span class="linenos"> 89</span></a><span class="sd">        of the model.</span>
</span><span id="IWLSKernel-90"><a href="#IWLSKernel-90"><span class="linenos"> 90</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-91"><a href="#IWLSKernel-91"><span class="linenos"> 91</span></a>
</span><span id="IWLSKernel-92"><a href="#IWLSKernel-92"><span class="linenos"> 92</span></a>        <span class="k">def</span> <span class="nf">flat_log_prob_fn</span><span class="p">(</span><span class="n">flat_position</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="IWLSKernel-93"><a href="#IWLSKernel-93"><span class="linenos"> 93</span></a>            <span class="n">position</span> <span class="o">=</span> <span class="n">unravel_fn</span><span class="p">(</span><span class="n">flat_position</span><span class="p">)</span>
</span><span id="IWLSKernel-94"><a href="#IWLSKernel-94"><span class="linenos"> 94</span></a>            <span class="n">new_model_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="IWLSKernel-95"><a href="#IWLSKernel-95"><span class="linenos"> 95</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">new_model_state</span><span class="p">)</span>
</span><span id="IWLSKernel-96"><a href="#IWLSKernel-96"><span class="linenos"> 96</span></a>
</span><span id="IWLSKernel-97"><a href="#IWLSKernel-97"><span class="linenos"> 97</span></a>        <span class="k">return</span> <span class="n">flat_log_prob_fn</span>
</span><span id="IWLSKernel-98"><a href="#IWLSKernel-98"><span class="linenos"> 98</span></a>
</span><span id="IWLSKernel-99"><a href="#IWLSKernel-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">_score</span><span class="p">(</span>
</span><span id="IWLSKernel-100"><a href="#IWLSKernel-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span> <span class="n">flat_score_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Array</span><span class="p">],</span> <span class="n">Array</span><span class="p">]</span>
</span><span id="IWLSKernel-101"><a href="#IWLSKernel-101"><span class="linenos">101</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="IWLSKernel-102"><a href="#IWLSKernel-102"><span class="linenos">102</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-103"><a href="#IWLSKernel-103"><span class="linenos">103</span></a><span class="sd">        Calls `flat_score_fn` on a flat position.</span>
</span><span id="IWLSKernel-104"><a href="#IWLSKernel-104"><span class="linenos">104</span></a>
</span><span id="IWLSKernel-105"><a href="#IWLSKernel-105"><span class="linenos">105</span></a><span class="sd">        The flat position is extracted from the `model_state`.</span>
</span><span id="IWLSKernel-106"><a href="#IWLSKernel-106"><span class="linenos">106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-107"><a href="#IWLSKernel-107"><span class="linenos">107</span></a>
</span><span id="IWLSKernel-108"><a href="#IWLSKernel-108"><span class="linenos">108</span></a>        <span class="n">flat_position</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ravel_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">))</span>
</span><span id="IWLSKernel-109"><a href="#IWLSKernel-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="n">flat_score_fn</span><span class="p">(</span><span class="n">flat_position</span><span class="p">)</span>
</span><span id="IWLSKernel-110"><a href="#IWLSKernel-110"><span class="linenos">110</span></a>
</span><span id="IWLSKernel-111"><a href="#IWLSKernel-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">_chol_info</span><span class="p">(</span>
</span><span id="IWLSKernel-112"><a href="#IWLSKernel-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span> <span class="n">flat_hessian_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Array</span><span class="p">],</span> <span class="n">Array</span><span class="p">]</span>
</span><span id="IWLSKernel-113"><a href="#IWLSKernel-113"><span class="linenos">113</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="IWLSKernel-114"><a href="#IWLSKernel-114"><span class="linenos">114</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-115"><a href="#IWLSKernel-115"><span class="linenos">115</span></a><span class="sd">        Computes the Cholesky decomposition of the Fisher information matrix</span>
</span><span id="IWLSKernel-116"><a href="#IWLSKernel-116"><span class="linenos">116</span></a><span class="sd">        via `flat_hessian_fn`.</span>
</span><span id="IWLSKernel-117"><a href="#IWLSKernel-117"><span class="linenos">117</span></a>
</span><span id="IWLSKernel-118"><a href="#IWLSKernel-118"><span class="linenos">118</span></a><span class="sd">        The flat position is extracted from the `model_state`. If the user provided a</span>
</span><span id="IWLSKernel-119"><a href="#IWLSKernel-119"><span class="linenos">119</span></a><span class="sd">        `chol_info_fn` when initializing the kernel, this function is called instead.</span>
</span><span id="IWLSKernel-120"><a href="#IWLSKernel-120"><span class="linenos">120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-121"><a href="#IWLSKernel-121"><span class="linenos">121</span></a>
</span><span id="IWLSKernel-122"><a href="#IWLSKernel-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chol_info_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="IWLSKernel-123"><a href="#IWLSKernel-123"><span class="linenos">123</span></a>            <span class="n">flat_position</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ravel_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">))</span>
</span><span id="IWLSKernel-124"><a href="#IWLSKernel-124"><span class="linenos">124</span></a>            <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="o">-</span><span class="n">flat_hessian_fn</span><span class="p">(</span><span class="n">flat_position</span><span class="p">))</span>
</span><span id="IWLSKernel-125"><a href="#IWLSKernel-125"><span class="linenos">125</span></a>
</span><span id="IWLSKernel-126"><a href="#IWLSKernel-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chol_info_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="IWLSKernel-127"><a href="#IWLSKernel-127"><span class="linenos">127</span></a>
</span><span id="IWLSKernel-128"><a href="#IWLSKernel-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="IWLSKernel-129"><a href="#IWLSKernel-129"><span class="linenos">129</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-130"><a href="#IWLSKernel-130"><span class="linenos">130</span></a><span class="sd">        Initializes the kernel state.</span>
</span><span id="IWLSKernel-131"><a href="#IWLSKernel-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-132"><a href="#IWLSKernel-132"><span class="linenos">132</span></a>
</span><span id="IWLSKernel-133"><a href="#IWLSKernel-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">IWLSKernelState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span><span class="p">)</span>
</span><span id="IWLSKernel-134"><a href="#IWLSKernel-134"><span class="linenos">134</span></a>
</span><span id="IWLSKernel-135"><a href="#IWLSKernel-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">_standard_transition</span><span class="p">(</span>
</span><span id="IWLSKernel-136"><a href="#IWLSKernel-136"><span class="linenos">136</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel-137"><a href="#IWLSKernel-137"><span class="linenos">137</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel-138"><a href="#IWLSKernel-138"><span class="linenos">138</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel-139"><a href="#IWLSKernel-139"><span class="linenos">139</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel-140"><a href="#IWLSKernel-140"><span class="linenos">140</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="IWLSKernel-141"><a href="#IWLSKernel-141"><span class="linenos">141</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">IWLSKernelState</span><span class="p">,</span> <span class="n">IWLSTransitionInfo</span><span class="p">]:</span>
</span><span id="IWLSKernel-142"><a href="#IWLSKernel-142"><span class="linenos">142</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-143"><a href="#IWLSKernel-143"><span class="linenos">143</span></a><span class="sd">        Performs an MCMC transition *without* dual averaging.</span>
</span><span id="IWLSKernel-144"><a href="#IWLSKernel-144"><span class="linenos">144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-145"><a href="#IWLSKernel-145"><span class="linenos">145</span></a>
</span><span id="IWLSKernel-146"><a href="#IWLSKernel-146"><span class="linenos">146</span></a>        <span class="n">key</span><span class="p">,</span> <span class="n">subkey</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">prng_key</span><span class="p">)</span>
</span><span id="IWLSKernel-147"><a href="#IWLSKernel-147"><span class="linenos">147</span></a>        <span class="n">step_size</span> <span class="o">=</span> <span class="n">kernel_state</span><span class="o">.</span><span class="n">step_size</span>
</span><span id="IWLSKernel-148"><a href="#IWLSKernel-148"><span class="linenos">148</span></a>
</span><span id="IWLSKernel-149"><a href="#IWLSKernel-149"><span class="linenos">149</span></a>        <span class="n">flat_pos</span><span class="p">,</span> <span class="n">unravel_fn</span> <span class="o">=</span> <span class="n">ravel_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">))</span>
</span><span id="IWLSKernel-150"><a href="#IWLSKernel-150"><span class="linenos">150</span></a>        <span class="n">flat_log_prob_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flat_log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">,</span> <span class="n">unravel_fn</span><span class="p">)</span>
</span><span id="IWLSKernel-151"><a href="#IWLSKernel-151"><span class="linenos">151</span></a>        <span class="n">flat_score_fn</span> <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">flat_log_prob_fn</span><span class="p">)</span>
</span><span id="IWLSKernel-152"><a href="#IWLSKernel-152"><span class="linenos">152</span></a>        <span class="n">flat_hessian_fn</span> <span class="o">=</span> <span class="n">jacfwd</span><span class="p">(</span><span class="n">flat_score_fn</span><span class="p">)</span>
</span><span id="IWLSKernel-153"><a href="#IWLSKernel-153"><span class="linenos">153</span></a>
</span><span id="IWLSKernel-154"><a href="#IWLSKernel-154"><span class="linenos">154</span></a>        <span class="c1"># proposal and forward probability</span>
</span><span id="IWLSKernel-155"><a href="#IWLSKernel-155"><span class="linenos">155</span></a>
</span><span id="IWLSKernel-156"><a href="#IWLSKernel-156"><span class="linenos">156</span></a>        <span class="n">score_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">(</span><span class="n">model_state</span><span class="p">,</span> <span class="n">flat_score_fn</span><span class="p">)</span>
</span><span id="IWLSKernel-157"><a href="#IWLSKernel-157"><span class="linenos">157</span></a>        <span class="n">chol_info_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chol_info</span><span class="p">(</span><span class="n">model_state</span><span class="p">,</span> <span class="n">flat_hessian_fn</span><span class="p">)</span>
</span><span id="IWLSKernel-158"><a href="#IWLSKernel-158"><span class="linenos">158</span></a>        <span class="n">mu_pos</span> <span class="o">=</span> <span class="n">flat_pos</span> <span class="o">+</span> <span class="p">((</span><span class="n">step_size</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">solve</span><span class="p">(</span><span class="n">chol_info_pos</span><span class="p">,</span> <span class="n">score_pos</span><span class="p">)</span>
</span><span id="IWLSKernel-159"><a href="#IWLSKernel-159"><span class="linenos">159</span></a>        <span class="n">flat_prop</span> <span class="o">=</span> <span class="n">mvn_sample</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">mu_pos</span><span class="p">,</span> <span class="n">chol_info_pos</span> <span class="o">/</span> <span class="n">step_size</span><span class="p">)</span>
</span><span id="IWLSKernel-160"><a href="#IWLSKernel-160"><span class="linenos">160</span></a>        <span class="n">proposal</span> <span class="o">=</span> <span class="n">unravel_fn</span><span class="p">(</span><span class="n">flat_prop</span><span class="p">)</span>
</span><span id="IWLSKernel-161"><a href="#IWLSKernel-161"><span class="linenos">161</span></a>
</span><span id="IWLSKernel-162"><a href="#IWLSKernel-162"><span class="linenos">162</span></a>        <span class="n">fwd_log_prob</span> <span class="o">=</span> <span class="n">mvn_log_prob</span><span class="p">(</span><span class="n">flat_prop</span><span class="p">,</span> <span class="n">mu_pos</span><span class="p">,</span> <span class="n">chol_info_pos</span> <span class="o">/</span> <span class="n">step_size</span><span class="p">)</span>
</span><span id="IWLSKernel-163"><a href="#IWLSKernel-163"><span class="linenos">163</span></a>
</span><span id="IWLSKernel-164"><a href="#IWLSKernel-164"><span class="linenos">164</span></a>        <span class="c1"># backward probability</span>
</span><span id="IWLSKernel-165"><a href="#IWLSKernel-165"><span class="linenos">165</span></a>
</span><span id="IWLSKernel-166"><a href="#IWLSKernel-166"><span class="linenos">166</span></a>        <span class="n">model_state_prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="IWLSKernel-167"><a href="#IWLSKernel-167"><span class="linenos">167</span></a>
</span><span id="IWLSKernel-168"><a href="#IWLSKernel-168"><span class="linenos">168</span></a>        <span class="n">score_prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_score</span><span class="p">(</span><span class="n">model_state_prop</span><span class="p">,</span> <span class="n">flat_score_fn</span><span class="p">)</span>
</span><span id="IWLSKernel-169"><a href="#IWLSKernel-169"><span class="linenos">169</span></a>        <span class="n">chol_info_prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chol_info</span><span class="p">(</span><span class="n">model_state_prop</span><span class="p">,</span> <span class="n">flat_hessian_fn</span><span class="p">)</span>
</span><span id="IWLSKernel-170"><a href="#IWLSKernel-170"><span class="linenos">170</span></a>        <span class="n">mu_prop</span> <span class="o">=</span> <span class="n">flat_prop</span> <span class="o">+</span> <span class="p">((</span><span class="n">step_size</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">solve</span><span class="p">(</span><span class="n">chol_info_prop</span><span class="p">,</span> <span class="n">score_prop</span><span class="p">)</span>
</span><span id="IWLSKernel-171"><a href="#IWLSKernel-171"><span class="linenos">171</span></a>        <span class="n">bwd_log_prob</span> <span class="o">=</span> <span class="n">mvn_log_prob</span><span class="p">(</span><span class="n">flat_pos</span><span class="p">,</span> <span class="n">mu_prop</span><span class="p">,</span> <span class="n">chol_info_prop</span> <span class="o">/</span> <span class="n">step_size</span><span class="p">)</span>
</span><span id="IWLSKernel-172"><a href="#IWLSKernel-172"><span class="linenos">172</span></a>
</span><span id="IWLSKernel-173"><a href="#IWLSKernel-173"><span class="linenos">173</span></a>        <span class="n">correction</span> <span class="o">=</span> <span class="n">bwd_log_prob</span> <span class="o">-</span> <span class="n">fwd_log_prob</span>
</span><span id="IWLSKernel-174"><a href="#IWLSKernel-174"><span class="linenos">174</span></a>
</span><span id="IWLSKernel-175"><a href="#IWLSKernel-175"><span class="linenos">175</span></a>        <span class="n">info</span><span class="p">,</span> <span class="n">model_state</span> <span class="o">=</span> <span class="n">mh_step</span><span class="p">(</span>
</span><span id="IWLSKernel-176"><a href="#IWLSKernel-176"><span class="linenos">176</span></a>            <span class="n">subkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">proposal</span><span class="p">,</span> <span class="n">model_state</span><span class="p">,</span> <span class="n">correction</span>
</span><span id="IWLSKernel-177"><a href="#IWLSKernel-177"><span class="linenos">177</span></a>        <span class="p">)</span>
</span><span id="IWLSKernel-178"><a href="#IWLSKernel-178"><span class="linenos">178</span></a>
</span><span id="IWLSKernel-179"><a href="#IWLSKernel-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="n">TransitionOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="IWLSKernel-180"><a href="#IWLSKernel-180"><span class="linenos">180</span></a>
</span><span id="IWLSKernel-181"><a href="#IWLSKernel-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">_adaptive_transition</span><span class="p">(</span>
</span><span id="IWLSKernel-182"><a href="#IWLSKernel-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel-183"><a href="#IWLSKernel-183"><span class="linenos">183</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel-184"><a href="#IWLSKernel-184"><span class="linenos">184</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel-185"><a href="#IWLSKernel-185"><span class="linenos">185</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel-186"><a href="#IWLSKernel-186"><span class="linenos">186</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="IWLSKernel-187"><a href="#IWLSKernel-187"><span class="linenos">187</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">IWLSKernelState</span><span class="p">,</span> <span class="n">IWLSTransitionInfo</span><span class="p">]:</span>
</span><span id="IWLSKernel-188"><a href="#IWLSKernel-188"><span class="linenos">188</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-189"><a href="#IWLSKernel-189"><span class="linenos">189</span></a><span class="sd">        Performs an MCMC transition *with* dual averaging.</span>
</span><span id="IWLSKernel-190"><a href="#IWLSKernel-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-191"><a href="#IWLSKernel-191"><span class="linenos">191</span></a>
</span><span id="IWLSKernel-192"><a href="#IWLSKernel-192"><span class="linenos">192</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard_transition</span><span class="p">(</span><span class="n">prng_key</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="IWLSKernel-193"><a href="#IWLSKernel-193"><span class="linenos">193</span></a>
</span><span id="IWLSKernel-194"><a href="#IWLSKernel-194"><span class="linenos">194</span></a>        <span class="n">da_step</span><span class="p">(</span>
</span><span id="IWLSKernel-195"><a href="#IWLSKernel-195"><span class="linenos">195</span></a>            <span class="n">outcome</span><span class="o">.</span><span class="n">kernel_state</span><span class="p">,</span>
</span><span id="IWLSKernel-196"><a href="#IWLSKernel-196"><span class="linenos">196</span></a>            <span class="n">outcome</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">acceptance_prob</span><span class="p">,</span>
</span><span id="IWLSKernel-197"><a href="#IWLSKernel-197"><span class="linenos">197</span></a>            <span class="n">epoch</span><span class="o">.</span><span class="n">time_in_epoch</span><span class="p">,</span>
</span><span id="IWLSKernel-198"><a href="#IWLSKernel-198"><span class="linenos">198</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span><span class="p">,</span>
</span><span id="IWLSKernel-199"><a href="#IWLSKernel-199"><span class="linenos">199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span><span class="p">,</span>
</span><span id="IWLSKernel-200"><a href="#IWLSKernel-200"><span class="linenos">200</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span><span class="p">,</span>
</span><span id="IWLSKernel-201"><a href="#IWLSKernel-201"><span class="linenos">201</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span><span class="p">,</span>
</span><span id="IWLSKernel-202"><a href="#IWLSKernel-202"><span class="linenos">202</span></a>        <span class="p">)</span>
</span><span id="IWLSKernel-203"><a href="#IWLSKernel-203"><span class="linenos">203</span></a>
</span><span id="IWLSKernel-204"><a href="#IWLSKernel-204"><span class="linenos">204</span></a>        <span class="k">return</span> <span class="n">outcome</span>
</span><span id="IWLSKernel-205"><a href="#IWLSKernel-205"><span class="linenos">205</span></a>
</span><span id="IWLSKernel-206"><a href="#IWLSKernel-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">tune</span><span class="p">(</span>
</span><span id="IWLSKernel-207"><a href="#IWLSKernel-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel-208"><a href="#IWLSKernel-208"><span class="linenos">208</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel-209"><a href="#IWLSKernel-209"><span class="linenos">209</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel-210"><a href="#IWLSKernel-210"><span class="linenos">210</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel-211"><a href="#IWLSKernel-211"><span class="linenos">211</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="IWLSKernel-212"><a href="#IWLSKernel-212"><span class="linenos">212</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="IWLSKernel-213"><a href="#IWLSKernel-213"><span class="linenos">213</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">IWLSKernelState</span><span class="p">,</span> <span class="n">IWLSTuningInfo</span><span class="p">]:</span>
</span><span id="IWLSKernel-214"><a href="#IWLSKernel-214"><span class="linenos">214</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-215"><a href="#IWLSKernel-215"><span class="linenos">215</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="IWLSKernel-216"><a href="#IWLSKernel-216"><span class="linenos">216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-217"><a href="#IWLSKernel-217"><span class="linenos">217</span></a>
</span><span id="IWLSKernel-218"><a href="#IWLSKernel-218"><span class="linenos">218</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">IWLSTuningInfo</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</span><span id="IWLSKernel-219"><a href="#IWLSKernel-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">TuningOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">)</span>
</span><span id="IWLSKernel-220"><a href="#IWLSKernel-220"><span class="linenos">220</span></a>
</span><span id="IWLSKernel-221"><a href="#IWLSKernel-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="IWLSKernel-222"><a href="#IWLSKernel-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel-223"><a href="#IWLSKernel-223"><span class="linenos">223</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel-224"><a href="#IWLSKernel-224"><span class="linenos">224</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel-225"><a href="#IWLSKernel-225"><span class="linenos">225</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel-226"><a href="#IWLSKernel-226"><span class="linenos">226</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="IWLSKernel-227"><a href="#IWLSKernel-227"><span class="linenos">227</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IWLSKernelState</span><span class="p">:</span>
</span><span id="IWLSKernel-228"><a href="#IWLSKernel-228"><span class="linenos">228</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-229"><a href="#IWLSKernel-229"><span class="linenos">229</span></a><span class="sd">        Resets the state of the dual averaging algorithm.</span>
</span><span id="IWLSKernel-230"><a href="#IWLSKernel-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-231"><a href="#IWLSKernel-231"><span class="linenos">231</span></a>
</span><span id="IWLSKernel-232"><a href="#IWLSKernel-232"><span class="linenos">232</span></a>        <span class="n">da_init</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="IWLSKernel-233"><a href="#IWLSKernel-233"><span class="linenos">233</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="IWLSKernel-234"><a href="#IWLSKernel-234"><span class="linenos">234</span></a>
</span><span id="IWLSKernel-235"><a href="#IWLSKernel-235"><span class="linenos">235</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="IWLSKernel-236"><a href="#IWLSKernel-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel-237"><a href="#IWLSKernel-237"><span class="linenos">237</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel-238"><a href="#IWLSKernel-238"><span class="linenos">238</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel-239"><a href="#IWLSKernel-239"><span class="linenos">239</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel-240"><a href="#IWLSKernel-240"><span class="linenos">240</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="IWLSKernel-241"><a href="#IWLSKernel-241"><span class="linenos">241</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IWLSKernelState</span><span class="p">:</span>
</span><span id="IWLSKernel-242"><a href="#IWLSKernel-242"><span class="linenos">242</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-243"><a href="#IWLSKernel-243"><span class="linenos">243</span></a><span class="sd">        Sets the step size as found by the dual averaging algorithm.</span>
</span><span id="IWLSKernel-244"><a href="#IWLSKernel-244"><span class="linenos">244</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-245"><a href="#IWLSKernel-245"><span class="linenos">245</span></a>
</span><span id="IWLSKernel-246"><a href="#IWLSKernel-246"><span class="linenos">246</span></a>        <span class="n">da_finalize</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="IWLSKernel-247"><a href="#IWLSKernel-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="IWLSKernel-248"><a href="#IWLSKernel-248"><span class="linenos">248</span></a>
</span><span id="IWLSKernel-249"><a href="#IWLSKernel-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="IWLSKernel-250"><a href="#IWLSKernel-250"><span class="linenos">250</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel-251"><a href="#IWLSKernel-251"><span class="linenos">251</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel-252"><a href="#IWLSKernel-252"><span class="linenos">252</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel-253"><a href="#IWLSKernel-253"><span class="linenos">253</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel-254"><a href="#IWLSKernel-254"><span class="linenos">254</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">IWLSTuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="IWLSKernel-255"><a href="#IWLSKernel-255"><span class="linenos">255</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">IWLSKernelState</span><span class="p">]:</span>
</span><span id="IWLSKernel-256"><a href="#IWLSKernel-256"><span class="linenos">256</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel-257"><a href="#IWLSKernel-257"><span class="linenos">257</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="IWLSKernel-258"><a href="#IWLSKernel-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel-259"><a href="#IWLSKernel-259"><span class="linenos">259</span></a>
</span><span id="IWLSKernel-260"><a href="#IWLSKernel-260"><span class="linenos">260</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>An IWLS kernel with dual averaging and an (optional) user-defined function
for computing the Cholesky decomposition of the Fisher information matrix,
implementing the <code>liesel.goose.types.Kernel</code> protocol.</p>
</div>


                            <div id="IWLSKernel.__init__" class="classattr">
                                        <input id="IWLSKernel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">IWLSKernel</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">chol_info_fn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>,</span><span class="param">	<span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span>,</span><span class="param">	<span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>,</span><span class="param">	<span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span>,</span><span class="param">	<span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span>)</span>

                <label class="view-source-button" for="IWLSKernel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IWLSKernel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IWLSKernel.__init__-63"><a href="#IWLSKernel.__init__-63"><span class="linenos">63</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="IWLSKernel.__init__-64"><a href="#IWLSKernel.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel.__init__-65"><a href="#IWLSKernel.__init__-65"><span class="linenos">65</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="IWLSKernel.__init__-66"><a href="#IWLSKernel.__init__-66"><span class="linenos">66</span></a>        <span class="n">chol_info_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ModelState</span><span class="p">],</span> <span class="n">Array</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="IWLSKernel.__init__-67"><a href="#IWLSKernel.__init__-67"><span class="linenos">67</span></a>        <span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
</span><span id="IWLSKernel.__init__-68"><a href="#IWLSKernel.__init__-68"><span class="linenos">68</span></a>        <span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="IWLSKernel.__init__-69"><a href="#IWLSKernel.__init__-69"><span class="linenos">69</span></a>        <span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="IWLSKernel.__init__-70"><a href="#IWLSKernel.__init__-70"><span class="linenos">70</span></a>        <span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="IWLSKernel.__init__-71"><a href="#IWLSKernel.__init__-71"><span class="linenos">71</span></a>        <span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="IWLSKernel.__init__-72"><a href="#IWLSKernel.__init__-72"><span class="linenos">72</span></a>    <span class="p">):</span>
</span><span id="IWLSKernel.__init__-73"><a href="#IWLSKernel.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="IWLSKernel.__init__-74"><a href="#IWLSKernel.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="IWLSKernel.__init__-75"><a href="#IWLSKernel.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chol_info_fn</span> <span class="o">=</span> <span class="n">chol_info_fn</span>
</span><span id="IWLSKernel.__init__-76"><a href="#IWLSKernel.__init__-76"><span class="linenos">76</span></a>
</span><span id="IWLSKernel.__init__-77"><a href="#IWLSKernel.__init__-77"><span class="linenos">77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="o">=</span> <span class="n">initial_step_size</span>
</span><span id="IWLSKernel.__init__-78"><a href="#IWLSKernel.__init__-78"><span class="linenos">78</span></a>
</span><span id="IWLSKernel.__init__-79"><a href="#IWLSKernel.__init__-79"><span class="linenos">79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span> <span class="o">=</span> <span class="n">da_target_accept</span>
</span><span id="IWLSKernel.__init__-80"><a href="#IWLSKernel.__init__-80"><span class="linenos">80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span> <span class="o">=</span> <span class="n">da_gamma</span>
</span><span id="IWLSKernel.__init__-81"><a href="#IWLSKernel.__init__-81"><span class="linenos">81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span> <span class="o">=</span> <span class="n">da_kappa</span>
</span><span id="IWLSKernel.__init__-82"><a href="#IWLSKernel.__init__-82"><span class="linenos">82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span> <span class="o">=</span> <span class="n">da_t0</span>
</span></pre></div>


    

                            </div>
                            <div id="IWLSKernel.error_book" class="classattr">
                                <div class="attr variable">
            <span class="name">error_book</span><span class="annotation">: ClassVar[dict[int, str]]</span><span class="default_value"> = {0: &#39;no errors&#39;, 90: &#39;nan acceptance prob&#39;}</span>

        
    </div>
    <a class="headerlink" href="#IWLSKernel.error_book"></a>
    
    

                            </div>
                            <div id="IWLSKernel.needs_history" class="classattr">
                                <div class="attr variable">
            <span class="name">needs_history</span><span class="annotation">: ClassVar[bool]</span><span class="default_value"> = False</span>

        
    </div>
    <a class="headerlink" href="#IWLSKernel.needs_history"></a>
    
    

                            </div>
                            <div id="IWLSKernel.identifier" class="classattr">
                                <div class="attr variable">
            <span class="name">identifier</span><span class="annotation">: str</span><span class="default_value"> = &#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#IWLSKernel.identifier"></a>
    
    

                            </div>
                            <div id="IWLSKernel.init_state" class="classattr">
                                        <input id="IWLSKernel.init_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prng_key</span>, </span><span class="param"><span class="n">model_state</span></span>)</span>

                <label class="view-source-button" for="IWLSKernel.init_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IWLSKernel.init_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IWLSKernel.init_state-128"><a href="#IWLSKernel.init_state-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="IWLSKernel.init_state-129"><a href="#IWLSKernel.init_state-129"><span class="linenos">129</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel.init_state-130"><a href="#IWLSKernel.init_state-130"><span class="linenos">130</span></a><span class="sd">        Initializes the kernel state.</span>
</span><span id="IWLSKernel.init_state-131"><a href="#IWLSKernel.init_state-131"><span class="linenos">131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel.init_state-132"><a href="#IWLSKernel.init_state-132"><span class="linenos">132</span></a>
</span><span id="IWLSKernel.init_state-133"><a href="#IWLSKernel.init_state-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">IWLSKernelState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the kernel state.</p>
</div>


                            </div>
                            <div id="IWLSKernel.tune" class="classattr">
                                        <input id="IWLSKernel.tune-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tune</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">iwls</span><span class="o">.</span><span class="n">IWLSKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span>,</span><span class="param">	<span class="n">history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Position</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">TuningOutcome</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">iwls</span><span class="o">.</span><span class="n">IWLSKernelState</span><span class="p">,</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">DefaultTuningInfo</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IWLSKernel.tune-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IWLSKernel.tune"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IWLSKernel.tune-206"><a href="#IWLSKernel.tune-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">tune</span><span class="p">(</span>
</span><span id="IWLSKernel.tune-207"><a href="#IWLSKernel.tune-207"><span class="linenos">207</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel.tune-208"><a href="#IWLSKernel.tune-208"><span class="linenos">208</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel.tune-209"><a href="#IWLSKernel.tune-209"><span class="linenos">209</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel.tune-210"><a href="#IWLSKernel.tune-210"><span class="linenos">210</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel.tune-211"><a href="#IWLSKernel.tune-211"><span class="linenos">211</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="IWLSKernel.tune-212"><a href="#IWLSKernel.tune-212"><span class="linenos">212</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="IWLSKernel.tune-213"><a href="#IWLSKernel.tune-213"><span class="linenos">213</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">IWLSKernelState</span><span class="p">,</span> <span class="n">IWLSTuningInfo</span><span class="p">]:</span>
</span><span id="IWLSKernel.tune-214"><a href="#IWLSKernel.tune-214"><span class="linenos">214</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel.tune-215"><a href="#IWLSKernel.tune-215"><span class="linenos">215</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="IWLSKernel.tune-216"><a href="#IWLSKernel.tune-216"><span class="linenos">216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel.tune-217"><a href="#IWLSKernel.tune-217"><span class="linenos">217</span></a>
</span><span id="IWLSKernel.tune-218"><a href="#IWLSKernel.tune-218"><span class="linenos">218</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">IWLSTuningInfo</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</span><span id="IWLSKernel.tune-219"><a href="#IWLSKernel.tune-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">TuningOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div id="IWLSKernel.start_epoch" class="classattr">
                                        <input id="IWLSKernel.start_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">iwls</span><span class="o">.</span><span class="n">IWLSKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">iwls</span><span class="o">.</span><span class="n">IWLSKernelState</span>:</span></span>

                <label class="view-source-button" for="IWLSKernel.start_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IWLSKernel.start_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IWLSKernel.start_epoch-221"><a href="#IWLSKernel.start_epoch-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="IWLSKernel.start_epoch-222"><a href="#IWLSKernel.start_epoch-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel.start_epoch-223"><a href="#IWLSKernel.start_epoch-223"><span class="linenos">223</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel.start_epoch-224"><a href="#IWLSKernel.start_epoch-224"><span class="linenos">224</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel.start_epoch-225"><a href="#IWLSKernel.start_epoch-225"><span class="linenos">225</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel.start_epoch-226"><a href="#IWLSKernel.start_epoch-226"><span class="linenos">226</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="IWLSKernel.start_epoch-227"><a href="#IWLSKernel.start_epoch-227"><span class="linenos">227</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IWLSKernelState</span><span class="p">:</span>
</span><span id="IWLSKernel.start_epoch-228"><a href="#IWLSKernel.start_epoch-228"><span class="linenos">228</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel.start_epoch-229"><a href="#IWLSKernel.start_epoch-229"><span class="linenos">229</span></a><span class="sd">        Resets the state of the dual averaging algorithm.</span>
</span><span id="IWLSKernel.start_epoch-230"><a href="#IWLSKernel.start_epoch-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel.start_epoch-231"><a href="#IWLSKernel.start_epoch-231"><span class="linenos">231</span></a>
</span><span id="IWLSKernel.start_epoch-232"><a href="#IWLSKernel.start_epoch-232"><span class="linenos">232</span></a>        <span class="n">da_init</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="IWLSKernel.start_epoch-233"><a href="#IWLSKernel.start_epoch-233"><span class="linenos">233</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Resets the state of the dual averaging algorithm.</p>
</div>


                            </div>
                            <div id="IWLSKernel.end_epoch" class="classattr">
                                        <input id="IWLSKernel.end_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">iwls</span><span class="o">.</span><span class="n">IWLSKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">iwls</span><span class="o">.</span><span class="n">IWLSKernelState</span>:</span></span>

                <label class="view-source-button" for="IWLSKernel.end_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IWLSKernel.end_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IWLSKernel.end_epoch-235"><a href="#IWLSKernel.end_epoch-235"><span class="linenos">235</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="IWLSKernel.end_epoch-236"><a href="#IWLSKernel.end_epoch-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel.end_epoch-237"><a href="#IWLSKernel.end_epoch-237"><span class="linenos">237</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel.end_epoch-238"><a href="#IWLSKernel.end_epoch-238"><span class="linenos">238</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel.end_epoch-239"><a href="#IWLSKernel.end_epoch-239"><span class="linenos">239</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel.end_epoch-240"><a href="#IWLSKernel.end_epoch-240"><span class="linenos">240</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="IWLSKernel.end_epoch-241"><a href="#IWLSKernel.end_epoch-241"><span class="linenos">241</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IWLSKernelState</span><span class="p">:</span>
</span><span id="IWLSKernel.end_epoch-242"><a href="#IWLSKernel.end_epoch-242"><span class="linenos">242</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel.end_epoch-243"><a href="#IWLSKernel.end_epoch-243"><span class="linenos">243</span></a><span class="sd">        Sets the step size as found by the dual averaging algorithm.</span>
</span><span id="IWLSKernel.end_epoch-244"><a href="#IWLSKernel.end_epoch-244"><span class="linenos">244</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel.end_epoch-245"><a href="#IWLSKernel.end_epoch-245"><span class="linenos">245</span></a>
</span><span id="IWLSKernel.end_epoch-246"><a href="#IWLSKernel.end_epoch-246"><span class="linenos">246</span></a>        <span class="n">da_finalize</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="IWLSKernel.end_epoch-247"><a href="#IWLSKernel.end_epoch-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Sets the step size as found by the dual averaging algorithm.</p>
</div>


                            </div>
                            <div id="IWLSKernel.end_warmup" class="classattr">
                                        <input id="IWLSKernel.end_warmup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_warmup</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">iwls</span><span class="o">.</span><span class="n">IWLSKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">tuning_history</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">DefaultTuningInfo</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">iwls</span><span class="o">.</span><span class="n">IWLSKernelState</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="IWLSKernel.end_warmup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IWLSKernel.end_warmup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IWLSKernel.end_warmup-249"><a href="#IWLSKernel.end_warmup-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="IWLSKernel.end_warmup-250"><a href="#IWLSKernel.end_warmup-250"><span class="linenos">250</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="IWLSKernel.end_warmup-251"><a href="#IWLSKernel.end_warmup-251"><span class="linenos">251</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="IWLSKernel.end_warmup-252"><a href="#IWLSKernel.end_warmup-252"><span class="linenos">252</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">IWLSKernelState</span><span class="p">,</span>
</span><span id="IWLSKernel.end_warmup-253"><a href="#IWLSKernel.end_warmup-253"><span class="linenos">253</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="IWLSKernel.end_warmup-254"><a href="#IWLSKernel.end_warmup-254"><span class="linenos">254</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">IWLSTuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="IWLSKernel.end_warmup-255"><a href="#IWLSKernel.end_warmup-255"><span class="linenos">255</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">IWLSKernelState</span><span class="p">]:</span>
</span><span id="IWLSKernel.end_warmup-256"><a href="#IWLSKernel.end_warmup-256"><span class="linenos">256</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="IWLSKernel.end_warmup-257"><a href="#IWLSKernel.end_warmup-257"><span class="linenos">257</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="IWLSKernel.end_warmup-258"><a href="#IWLSKernel.end_warmup-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="IWLSKernel.end_warmup-259"><a href="#IWLSKernel.end_warmup-259"><span class="linenos">259</span></a>
</span><span id="IWLSKernel.end_warmup-260"><a href="#IWLSKernel.end_warmup-260"><span class="linenos">260</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>liesel.goose.kernel.ModelMixin</dt>
                                <dd id="IWLSKernel.model" class="variable">model</dd>
                <dd id="IWLSKernel.set_model" class="function">set_model</dd>
                <dd id="IWLSKernel.has_model" class="function">has_model</dd>
                <dd id="IWLSKernel.position" class="function">position</dd>
                <dd id="IWLSKernel.log_prob_fn" class="function">log_prob_fn</dd>

            </div>
            <div><dt>liesel.goose.kernel.TransitionMixin</dt>
                                <dd id="IWLSKernel.transition" class="function">transition</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ModelInterface">
                            <input id="ModelInterface-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ModelInterface</span><wbr>(<span class="base">typing.Protocol</span>):

                <label class="view-source-button" for="ModelInterface-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelInterface"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelInterface-63"><a href="#ModelInterface-63"><span class="linenos">63</span></a><span class="k">class</span> <span class="nc">ModelInterface</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
</span><span id="ModelInterface-64"><a href="#ModelInterface-64"><span class="linenos">64</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ModelInterface-65"><a href="#ModelInterface-65"><span class="linenos">65</span></a><span class="sd">    The model interface defines a standardized way for Goose to communicate</span>
</span><span id="ModelInterface-66"><a href="#ModelInterface-66"><span class="linenos">66</span></a><span class="sd">    with a statistical model, that is, to update the model state and to compute</span>
</span><span id="ModelInterface-67"><a href="#ModelInterface-67"><span class="linenos">67</span></a><span class="sd">    the log-probability.</span>
</span><span id="ModelInterface-68"><a href="#ModelInterface-68"><span class="linenos">68</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ModelInterface-69"><a href="#ModelInterface-69"><span class="linenos">69</span></a>
</span><span id="ModelInterface-70"><a href="#ModelInterface-70"><span class="linenos">70</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ModelInterface-71"><a href="#ModelInterface-71"><span class="linenos">71</span></a>    <span class="k">def</span> <span class="nf">extract_position</span><span class="p">(</span>
</span><span id="ModelInterface-72"><a href="#ModelInterface-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span>
</span><span id="ModelInterface-73"><a href="#ModelInterface-73"><span class="linenos">73</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Position</span><span class="p">:</span>
</span><span id="ModelInterface-74"><a href="#ModelInterface-74"><span class="linenos">74</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ModelInterface-75"><a href="#ModelInterface-75"><span class="linenos">75</span></a><span class="sd">        Extracts the position from the model state given a sequence of position keys.</span>
</span><span id="ModelInterface-76"><a href="#ModelInterface-76"><span class="linenos">76</span></a>
</span><span id="ModelInterface-77"><a href="#ModelInterface-77"><span class="linenos">77</span></a><span class="sd">        The returned position must have the same order as the supplied key sequence.</span>
</span><span id="ModelInterface-78"><a href="#ModelInterface-78"><span class="linenos">78</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModelInterface-79"><a href="#ModelInterface-79"><span class="linenos">79</span></a>
</span><span id="ModelInterface-80"><a href="#ModelInterface-80"><span class="linenos">80</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="ModelInterface-81"><a href="#ModelInterface-81"><span class="linenos">81</span></a>
</span><span id="ModelInterface-82"><a href="#ModelInterface-82"><span class="linenos">82</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ModelInterface-83"><a href="#ModelInterface-83"><span class="linenos">83</span></a>    <span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">Position</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelState</span><span class="p">:</span>
</span><span id="ModelInterface-84"><a href="#ModelInterface-84"><span class="linenos">84</span></a>        <span class="sd">&quot;&quot;&quot;Updates the model state with the values in the position.&quot;&quot;&quot;</span>
</span><span id="ModelInterface-85"><a href="#ModelInterface-85"><span class="linenos">85</span></a>
</span><span id="ModelInterface-86"><a href="#ModelInterface-86"><span class="linenos">86</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="ModelInterface-87"><a href="#ModelInterface-87"><span class="linenos">87</span></a>
</span><span id="ModelInterface-88"><a href="#ModelInterface-88"><span class="linenos">88</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ModelInterface-89"><a href="#ModelInterface-89"><span class="linenos">89</span></a>    <span class="k">def</span> <span class="nf">log_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ModelInterface-90"><a href="#ModelInterface-90"><span class="linenos">90</span></a>        <span class="sd">&quot;&quot;&quot;Computes the unnormalized log-probability given the model state.&quot;&quot;&quot;</span>
</span><span id="ModelInterface-91"><a href="#ModelInterface-91"><span class="linenos">91</span></a>
</span><span id="ModelInterface-92"><a href="#ModelInterface-92"><span class="linenos">92</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>The model interface defines a standardized way for Goose to communicate
with a statistical model, that is, to update the model state and to compute
the log-probability.</p>
</div>


                            <div id="ModelInterface.extract_position" class="classattr">
                                        <input id="ModelInterface.extract_position-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">extract_position</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Position</span>:</span></span>

                <label class="view-source-button" for="ModelInterface.extract_position-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelInterface.extract_position"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelInterface.extract_position-70"><a href="#ModelInterface.extract_position-70"><span class="linenos">70</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ModelInterface.extract_position-71"><a href="#ModelInterface.extract_position-71"><span class="linenos">71</span></a>    <span class="k">def</span> <span class="nf">extract_position</span><span class="p">(</span>
</span><span id="ModelInterface.extract_position-72"><a href="#ModelInterface.extract_position-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span>
</span><span id="ModelInterface.extract_position-73"><a href="#ModelInterface.extract_position-73"><span class="linenos">73</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Position</span><span class="p">:</span>
</span><span id="ModelInterface.extract_position-74"><a href="#ModelInterface.extract_position-74"><span class="linenos">74</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ModelInterface.extract_position-75"><a href="#ModelInterface.extract_position-75"><span class="linenos">75</span></a><span class="sd">        Extracts the position from the model state given a sequence of position keys.</span>
</span><span id="ModelInterface.extract_position-76"><a href="#ModelInterface.extract_position-76"><span class="linenos">76</span></a>
</span><span id="ModelInterface.extract_position-77"><a href="#ModelInterface.extract_position-77"><span class="linenos">77</span></a><span class="sd">        The returned position must have the same order as the supplied key sequence.</span>
</span><span id="ModelInterface.extract_position-78"><a href="#ModelInterface.extract_position-78"><span class="linenos">78</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ModelInterface.extract_position-79"><a href="#ModelInterface.extract_position-79"><span class="linenos">79</span></a>
</span><span id="ModelInterface.extract_position-80"><a href="#ModelInterface.extract_position-80"><span class="linenos">80</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Extracts the position from the model state given a sequence of position keys.</p>

<p>The returned position must have the same order as the supplied key sequence.</p>
</div>


                            </div>
                            <div id="ModelInterface.update_state" class="classattr">
                                        <input id="ModelInterface.update_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">update_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">position</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Position</span>, </span><span class="param"><span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="ModelInterface.update_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelInterface.update_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelInterface.update_state-82"><a href="#ModelInterface.update_state-82"><span class="linenos">82</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ModelInterface.update_state-83"><a href="#ModelInterface.update_state-83"><span class="linenos">83</span></a>    <span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="n">Position</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelState</span><span class="p">:</span>
</span><span id="ModelInterface.update_state-84"><a href="#ModelInterface.update_state-84"><span class="linenos">84</span></a>        <span class="sd">&quot;&quot;&quot;Updates the model state with the values in the position.&quot;&quot;&quot;</span>
</span><span id="ModelInterface.update_state-85"><a href="#ModelInterface.update_state-85"><span class="linenos">85</span></a>
</span><span id="ModelInterface.update_state-86"><a href="#ModelInterface.update_state-86"><span class="linenos">86</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Updates the model state with the values in the position.</p>
</div>


                            </div>
                            <div id="ModelInterface.log_prob" class="classattr">
                                        <input id="ModelInterface.log_prob-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">log_prob</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="ModelInterface.log_prob-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ModelInterface.log_prob"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ModelInterface.log_prob-88"><a href="#ModelInterface.log_prob-88"><span class="linenos">88</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ModelInterface.log_prob-89"><a href="#ModelInterface.log_prob-89"><span class="linenos">89</span></a>    <span class="k">def</span> <span class="nf">log_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="ModelInterface.log_prob-90"><a href="#ModelInterface.log_prob-90"><span class="linenos">90</span></a>        <span class="sd">&quot;&quot;&quot;Computes the unnormalized log-probability given the model state.&quot;&quot;&quot;</span>
</span><span id="ModelInterface.log_prob-91"><a href="#ModelInterface.log_prob-91"><span class="linenos">91</span></a>
</span><span id="ModelInterface.log_prob-92"><a href="#ModelInterface.log_prob-92"><span class="linenos">92</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Computes the unnormalized log-probability given the model state.</p>
</div>


                            </div>
                </section>
                <section id="NUTSKernel">
                            <input id="NUTSKernel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NUTSKernel</span><wbr>(<span class="base">liesel.goose.kernel.ModelMixin</span>, <span class="base">liesel.goose.kernel.TransitionMixin[liesel.goose.nuts.NUTSKernelState, liesel.goose.nuts.NUTSTransitionInfo]</span>, <span class="base">liesel.goose.kernel.TuningMixin[liesel.goose.nuts.NUTSKernelState, liesel.goose.kernel.DefaultTuningInfo]</span>):

                <label class="view-source-button" for="NUTSKernel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NUTSKernel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NUTSKernel-92"><a href="#NUTSKernel-92"><span class="linenos"> 92</span></a><span class="k">class</span> <span class="nc">NUTSKernel</span><span class="p">(</span>
</span><span id="NUTSKernel-93"><a href="#NUTSKernel-93"><span class="linenos"> 93</span></a>    <span class="n">ModelMixin</span><span class="p">,</span>
</span><span id="NUTSKernel-94"><a href="#NUTSKernel-94"><span class="linenos"> 94</span></a>    <span class="n">TransitionMixin</span><span class="p">[</span><span class="n">NUTSKernelState</span><span class="p">,</span> <span class="n">NUTSTransitionInfo</span><span class="p">],</span>
</span><span id="NUTSKernel-95"><a href="#NUTSKernel-95"><span class="linenos"> 95</span></a>    <span class="n">TuningMixin</span><span class="p">[</span><span class="n">NUTSKernelState</span><span class="p">,</span> <span class="n">NUTSTuningInfo</span><span class="p">],</span>
</span><span id="NUTSKernel-96"><a href="#NUTSKernel-96"><span class="linenos"> 96</span></a><span class="p">):</span>
</span><span id="NUTSKernel-97"><a href="#NUTSKernel-97"><span class="linenos"> 97</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel-98"><a href="#NUTSKernel-98"><span class="linenos"> 98</span></a><span class="sd">    A NUTS kernel with dual averaging and an inverse mass matrix tuner,</span>
</span><span id="NUTSKernel-99"><a href="#NUTSKernel-99"><span class="linenos"> 99</span></a><span class="sd">    implementing the `liesel.goose.types.Kernel` protocol.</span>
</span><span id="NUTSKernel-100"><a href="#NUTSKernel-100"><span class="linenos">100</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NUTSKernel-101"><a href="#NUTSKernel-101"><span class="linenos">101</span></a>
</span><span id="NUTSKernel-102"><a href="#NUTSKernel-102"><span class="linenos">102</span></a>    <span class="n">error_book</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;no errors&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;divergent transition&quot;</span><span class="p">}</span>
</span><span id="NUTSKernel-103"><a href="#NUTSKernel-103"><span class="linenos">103</span></a>    <span class="n">needs_history</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NUTSKernel-104"><a href="#NUTSKernel-104"><span class="linenos">104</span></a>    <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="NUTSKernel-105"><a href="#NUTSKernel-105"><span class="linenos">105</span></a>
</span><span id="NUTSKernel-106"><a href="#NUTSKernel-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="NUTSKernel-107"><a href="#NUTSKernel-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel-108"><a href="#NUTSKernel-108"><span class="linenos">108</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="NUTSKernel-109"><a href="#NUTSKernel-109"><span class="linenos">109</span></a>        <span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NUTSKernel-110"><a href="#NUTSKernel-110"><span class="linenos">110</span></a>        <span class="n">initial_inverse_mass_matrix</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NUTSKernel-111"><a href="#NUTSKernel-111"><span class="linenos">111</span></a>        <span class="n">max_num_doublings</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="NUTSKernel-112"><a href="#NUTSKernel-112"><span class="linenos">112</span></a>        <span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="NUTSKernel-113"><a href="#NUTSKernel-113"><span class="linenos">113</span></a>        <span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="NUTSKernel-114"><a href="#NUTSKernel-114"><span class="linenos">114</span></a>        <span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="NUTSKernel-115"><a href="#NUTSKernel-115"><span class="linenos">115</span></a>        <span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="NUTSKernel-116"><a href="#NUTSKernel-116"><span class="linenos">116</span></a>        <span class="n">mm_diag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NUTSKernel-117"><a href="#NUTSKernel-117"><span class="linenos">117</span></a>    <span class="p">):</span>
</span><span id="NUTSKernel-118"><a href="#NUTSKernel-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="NUTSKernel-119"><a href="#NUTSKernel-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NUTSKernel-120"><a href="#NUTSKernel-120"><span class="linenos">120</span></a>
</span><span id="NUTSKernel-121"><a href="#NUTSKernel-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="o">=</span> <span class="n">initial_step_size</span>
</span><span id="NUTSKernel-122"><a href="#NUTSKernel-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span> <span class="o">=</span> <span class="n">initial_inverse_mass_matrix</span>
</span><span id="NUTSKernel-123"><a href="#NUTSKernel-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_doublings</span> <span class="o">=</span> <span class="n">max_num_doublings</span>
</span><span id="NUTSKernel-124"><a href="#NUTSKernel-124"><span class="linenos">124</span></a>
</span><span id="NUTSKernel-125"><a href="#NUTSKernel-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span> <span class="o">=</span> <span class="n">da_target_accept</span>
</span><span id="NUTSKernel-126"><a href="#NUTSKernel-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span> <span class="o">=</span> <span class="n">da_gamma</span>
</span><span id="NUTSKernel-127"><a href="#NUTSKernel-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span> <span class="o">=</span> <span class="n">da_kappa</span>
</span><span id="NUTSKernel-128"><a href="#NUTSKernel-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span> <span class="o">=</span> <span class="n">da_t0</span>
</span><span id="NUTSKernel-129"><a href="#NUTSKernel-129"><span class="linenos">129</span></a>
</span><span id="NUTSKernel-130"><a href="#NUTSKernel-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span> <span class="o">=</span> <span class="n">mm_diag</span>
</span><span id="NUTSKernel-131"><a href="#NUTSKernel-131"><span class="linenos">131</span></a>
</span><span id="NUTSKernel-132"><a href="#NUTSKernel-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">_blackjax_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">hmc</span><span class="o">.</span><span class="n">HMCState</span><span class="p">:</span>
</span><span id="NUTSKernel-133"><a href="#NUTSKernel-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">nuts</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">))</span>
</span><span id="NUTSKernel-134"><a href="#NUTSKernel-134"><span class="linenos">134</span></a>
</span><span id="NUTSKernel-135"><a href="#NUTSKernel-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">_blackjax_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="NUTSKernel-136"><a href="#NUTSKernel-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">nuts</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">max_num_doublings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_num_doublings</span><span class="p">)</span>
</span><span id="NUTSKernel-137"><a href="#NUTSKernel-137"><span class="linenos">137</span></a>
</span><span id="NUTSKernel-138"><a href="#NUTSKernel-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="NUTSKernel-139"><a href="#NUTSKernel-139"><span class="linenos">139</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel-140"><a href="#NUTSKernel-140"><span class="linenos">140</span></a><span class="sd">        Initializes the kernel state with an identity inverse mass matrix</span>
</span><span id="NUTSKernel-141"><a href="#NUTSKernel-141"><span class="linenos">141</span></a><span class="sd">        and a reasonable step size (unless explicit arguments were provided</span>
</span><span id="NUTSKernel-142"><a href="#NUTSKernel-142"><span class="linenos">142</span></a><span class="sd">        by the user).</span>
</span><span id="NUTSKernel-143"><a href="#NUTSKernel-143"><span class="linenos">143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel-144"><a href="#NUTSKernel-144"><span class="linenos">144</span></a>
</span><span id="NUTSKernel-145"><a href="#NUTSKernel-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NUTSKernel-146"><a href="#NUTSKernel-146"><span class="linenos">146</span></a>            <span class="n">flat_position</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ravel_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">))</span>
</span><span id="NUTSKernel-147"><a href="#NUTSKernel-147"><span class="linenos">147</span></a>
</span><span id="NUTSKernel-148"><a href="#NUTSKernel-148"><span class="linenos">148</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span><span class="p">:</span>
</span><span id="NUTSKernel-149"><a href="#NUTSKernel-149"><span class="linenos">149</span></a>                <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">flat_position</span><span class="p">)</span>
</span><span id="NUTSKernel-150"><a href="#NUTSKernel-150"><span class="linenos">150</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NUTSKernel-151"><a href="#NUTSKernel-151"><span class="linenos">151</span></a>                <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">flat_position</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="NUTSKernel-152"><a href="#NUTSKernel-152"><span class="linenos">152</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NUTSKernel-153"><a href="#NUTSKernel-153"><span class="linenos">153</span></a>            <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span>
</span><span id="NUTSKernel-154"><a href="#NUTSKernel-154"><span class="linenos">154</span></a>
</span><span id="NUTSKernel-155"><a href="#NUTSKernel-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NUTSKernel-156"><a href="#NUTSKernel-156"><span class="linenos">156</span></a>            <span class="n">blackjax_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_kernel</span><span class="p">()</span>
</span><span id="NUTSKernel-157"><a href="#NUTSKernel-157"><span class="linenos">157</span></a>            <span class="n">blackjax_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_state</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="NUTSKernel-158"><a href="#NUTSKernel-158"><span class="linenos">158</span></a>            <span class="n">log_prob_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="NUTSKernel-159"><a href="#NUTSKernel-159"><span class="linenos">159</span></a>
</span><span id="NUTSKernel-160"><a href="#NUTSKernel-160"><span class="linenos">160</span></a>            <span class="k">def</span> <span class="nf">kernel_generator</span><span class="p">(</span><span class="n">step_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="NUTSKernel-161"><a href="#NUTSKernel-161"><span class="linenos">161</span></a>                <span class="k">return</span> <span class="n">partial</span><span class="p">(</span>
</span><span id="NUTSKernel-162"><a href="#NUTSKernel-162"><span class="linenos">162</span></a>                    <span class="n">blackjax_kernel</span><span class="p">,</span>
</span><span id="NUTSKernel-163"><a href="#NUTSKernel-163"><span class="linenos">163</span></a>                    <span class="n">logprob_fn</span><span class="o">=</span><span class="n">log_prob_fn</span><span class="p">,</span>
</span><span id="NUTSKernel-164"><a href="#NUTSKernel-164"><span class="linenos">164</span></a>                    <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span>
</span><span id="NUTSKernel-165"><a href="#NUTSKernel-165"><span class="linenos">165</span></a>                    <span class="n">inverse_mass_matrix</span><span class="o">=</span><span class="n">inverse_mass_matrix</span><span class="p">,</span>
</span><span id="NUTSKernel-166"><a href="#NUTSKernel-166"><span class="linenos">166</span></a>                <span class="p">)</span>
</span><span id="NUTSKernel-167"><a href="#NUTSKernel-167"><span class="linenos">167</span></a>
</span><span id="NUTSKernel-168"><a href="#NUTSKernel-168"><span class="linenos">168</span></a>            <span class="n">step_size</span> <span class="o">=</span> <span class="n">find_reasonable_step_size</span><span class="p">(</span>
</span><span id="NUTSKernel-169"><a href="#NUTSKernel-169"><span class="linenos">169</span></a>                <span class="n">prng_key</span><span class="p">,</span>
</span><span id="NUTSKernel-170"><a href="#NUTSKernel-170"><span class="linenos">170</span></a>                <span class="n">kernel_generator</span><span class="p">,</span>
</span><span id="NUTSKernel-171"><a href="#NUTSKernel-171"><span class="linenos">171</span></a>                <span class="n">blackjax_state</span><span class="p">,</span>
</span><span id="NUTSKernel-172"><a href="#NUTSKernel-172"><span class="linenos">172</span></a>                <span class="n">initial_step_size</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
</span><span id="NUTSKernel-173"><a href="#NUTSKernel-173"><span class="linenos">173</span></a>                <span class="n">target_accept</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span><span class="p">,</span>
</span><span id="NUTSKernel-174"><a href="#NUTSKernel-174"><span class="linenos">174</span></a>            <span class="p">)</span>
</span><span id="NUTSKernel-175"><a href="#NUTSKernel-175"><span class="linenos">175</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NUTSKernel-176"><a href="#NUTSKernel-176"><span class="linenos">176</span></a>            <span class="n">step_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span>
</span><span id="NUTSKernel-177"><a href="#NUTSKernel-177"><span class="linenos">177</span></a>
</span><span id="NUTSKernel-178"><a href="#NUTSKernel-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="n">NUTSKernelState</span><span class="p">(</span><span class="n">step_size</span><span class="p">,</span> <span class="n">inverse_mass_matrix</span><span class="p">)</span>
</span><span id="NUTSKernel-179"><a href="#NUTSKernel-179"><span class="linenos">179</span></a>
</span><span id="NUTSKernel-180"><a href="#NUTSKernel-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">_standard_transition</span><span class="p">(</span>
</span><span id="NUTSKernel-181"><a href="#NUTSKernel-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel-182"><a href="#NUTSKernel-182"><span class="linenos">182</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel-183"><a href="#NUTSKernel-183"><span class="linenos">183</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel-184"><a href="#NUTSKernel-184"><span class="linenos">184</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel-185"><a href="#NUTSKernel-185"><span class="linenos">185</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="NUTSKernel-186"><a href="#NUTSKernel-186"><span class="linenos">186</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">NUTSKernelState</span><span class="p">,</span> <span class="n">NUTSTransitionInfo</span><span class="p">]:</span>
</span><span id="NUTSKernel-187"><a href="#NUTSKernel-187"><span class="linenos">187</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel-188"><a href="#NUTSKernel-188"><span class="linenos">188</span></a><span class="sd">        Performs an MCMC transition *without* dual averaging.</span>
</span><span id="NUTSKernel-189"><a href="#NUTSKernel-189"><span class="linenos">189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel-190"><a href="#NUTSKernel-190"><span class="linenos">190</span></a>
</span><span id="NUTSKernel-191"><a href="#NUTSKernel-191"><span class="linenos">191</span></a>        <span class="n">blackjax_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_kernel</span><span class="p">()</span>
</span><span id="NUTSKernel-192"><a href="#NUTSKernel-192"><span class="linenos">192</span></a>        <span class="n">blackjax_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_state</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="NUTSKernel-193"><a href="#NUTSKernel-193"><span class="linenos">193</span></a>        <span class="n">log_prob_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="NUTSKernel-194"><a href="#NUTSKernel-194"><span class="linenos">194</span></a>
</span><span id="NUTSKernel-195"><a href="#NUTSKernel-195"><span class="linenos">195</span></a>        <span class="n">blackjax_state</span><span class="p">,</span> <span class="n">blackjax_info</span> <span class="o">=</span> <span class="n">blackjax_kernel</span><span class="p">(</span>
</span><span id="NUTSKernel-196"><a href="#NUTSKernel-196"><span class="linenos">196</span></a>            <span class="n">prng_key</span><span class="p">,</span>
</span><span id="NUTSKernel-197"><a href="#NUTSKernel-197"><span class="linenos">197</span></a>            <span class="n">blackjax_state</span><span class="p">,</span>
</span><span id="NUTSKernel-198"><a href="#NUTSKernel-198"><span class="linenos">198</span></a>            <span class="n">log_prob_fn</span><span class="p">,</span>
</span><span id="NUTSKernel-199"><a href="#NUTSKernel-199"><span class="linenos">199</span></a>            <span class="n">kernel_state</span><span class="o">.</span><span class="n">step_size</span><span class="p">,</span>
</span><span id="NUTSKernel-200"><a href="#NUTSKernel-200"><span class="linenos">200</span></a>            <span class="n">kernel_state</span><span class="o">.</span><span class="n">inverse_mass_matrix</span><span class="p">,</span>
</span><span id="NUTSKernel-201"><a href="#NUTSKernel-201"><span class="linenos">201</span></a>        <span class="p">)</span>
</span><span id="NUTSKernel-202"><a href="#NUTSKernel-202"><span class="linenos">202</span></a>
</span><span id="NUTSKernel-203"><a href="#NUTSKernel-203"><span class="linenos">203</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">_goose_info</span><span class="p">(</span><span class="n">blackjax_info</span><span class="p">)</span>
</span><span id="NUTSKernel-204"><a href="#NUTSKernel-204"><span class="linenos">204</span></a>        <span class="n">model_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">blackjax_state</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="NUTSKernel-205"><a href="#NUTSKernel-205"><span class="linenos">205</span></a>        <span class="k">return</span> <span class="n">TransitionOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="NUTSKernel-206"><a href="#NUTSKernel-206"><span class="linenos">206</span></a>
</span><span id="NUTSKernel-207"><a href="#NUTSKernel-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">_adaptive_transition</span><span class="p">(</span>
</span><span id="NUTSKernel-208"><a href="#NUTSKernel-208"><span class="linenos">208</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel-209"><a href="#NUTSKernel-209"><span class="linenos">209</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel-210"><a href="#NUTSKernel-210"><span class="linenos">210</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel-211"><a href="#NUTSKernel-211"><span class="linenos">211</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel-212"><a href="#NUTSKernel-212"><span class="linenos">212</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="NUTSKernel-213"><a href="#NUTSKernel-213"><span class="linenos">213</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">NUTSKernelState</span><span class="p">,</span> <span class="n">NUTSTransitionInfo</span><span class="p">]:</span>
</span><span id="NUTSKernel-214"><a href="#NUTSKernel-214"><span class="linenos">214</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel-215"><a href="#NUTSKernel-215"><span class="linenos">215</span></a><span class="sd">        Performs an MCMC transition *with* dual averaging.</span>
</span><span id="NUTSKernel-216"><a href="#NUTSKernel-216"><span class="linenos">216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel-217"><a href="#NUTSKernel-217"><span class="linenos">217</span></a>
</span><span id="NUTSKernel-218"><a href="#NUTSKernel-218"><span class="linenos">218</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard_transition</span><span class="p">(</span><span class="n">prng_key</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="NUTSKernel-219"><a href="#NUTSKernel-219"><span class="linenos">219</span></a>
</span><span id="NUTSKernel-220"><a href="#NUTSKernel-220"><span class="linenos">220</span></a>        <span class="n">da_step</span><span class="p">(</span>
</span><span id="NUTSKernel-221"><a href="#NUTSKernel-221"><span class="linenos">221</span></a>            <span class="n">outcome</span><span class="o">.</span><span class="n">kernel_state</span><span class="p">,</span>
</span><span id="NUTSKernel-222"><a href="#NUTSKernel-222"><span class="linenos">222</span></a>            <span class="n">outcome</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">acceptance_prob</span><span class="p">,</span>
</span><span id="NUTSKernel-223"><a href="#NUTSKernel-223"><span class="linenos">223</span></a>            <span class="n">epoch</span><span class="o">.</span><span class="n">time_in_epoch</span><span class="p">,</span>
</span><span id="NUTSKernel-224"><a href="#NUTSKernel-224"><span class="linenos">224</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span><span class="p">,</span>
</span><span id="NUTSKernel-225"><a href="#NUTSKernel-225"><span class="linenos">225</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span><span class="p">,</span>
</span><span id="NUTSKernel-226"><a href="#NUTSKernel-226"><span class="linenos">226</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span><span class="p">,</span>
</span><span id="NUTSKernel-227"><a href="#NUTSKernel-227"><span class="linenos">227</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span><span class="p">,</span>
</span><span id="NUTSKernel-228"><a href="#NUTSKernel-228"><span class="linenos">228</span></a>        <span class="p">)</span>
</span><span id="NUTSKernel-229"><a href="#NUTSKernel-229"><span class="linenos">229</span></a>
</span><span id="NUTSKernel-230"><a href="#NUTSKernel-230"><span class="linenos">230</span></a>        <span class="k">return</span> <span class="n">outcome</span>
</span><span id="NUTSKernel-231"><a href="#NUTSKernel-231"><span class="linenos">231</span></a>
</span><span id="NUTSKernel-232"><a href="#NUTSKernel-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">_tune_fast</span><span class="p">(</span>
</span><span id="NUTSKernel-233"><a href="#NUTSKernel-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel-234"><a href="#NUTSKernel-234"><span class="linenos">234</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel-235"><a href="#NUTSKernel-235"><span class="linenos">235</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel-236"><a href="#NUTSKernel-236"><span class="linenos">236</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel-237"><a href="#NUTSKernel-237"><span class="linenos">237</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="NUTSKernel-238"><a href="#NUTSKernel-238"><span class="linenos">238</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NUTSKernel-239"><a href="#NUTSKernel-239"><span class="linenos">239</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">NUTSKernelState</span><span class="p">,</span> <span class="n">NUTSTuningInfo</span><span class="p">]:</span>
</span><span id="NUTSKernel-240"><a href="#NUTSKernel-240"><span class="linenos">240</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel-241"><a href="#NUTSKernel-241"><span class="linenos">241</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="NUTSKernel-242"><a href="#NUTSKernel-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel-243"><a href="#NUTSKernel-243"><span class="linenos">243</span></a>
</span><span id="NUTSKernel-244"><a href="#NUTSKernel-244"><span class="linenos">244</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">NUTSTuningInfo</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</span><span id="NUTSKernel-245"><a href="#NUTSKernel-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">TuningOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">)</span>
</span><span id="NUTSKernel-246"><a href="#NUTSKernel-246"><span class="linenos">246</span></a>
</span><span id="NUTSKernel-247"><a href="#NUTSKernel-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">_tune_slow</span><span class="p">(</span>
</span><span id="NUTSKernel-248"><a href="#NUTSKernel-248"><span class="linenos">248</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel-249"><a href="#NUTSKernel-249"><span class="linenos">249</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel-250"><a href="#NUTSKernel-250"><span class="linenos">250</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel-251"><a href="#NUTSKernel-251"><span class="linenos">251</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel-252"><a href="#NUTSKernel-252"><span class="linenos">252</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="NUTSKernel-253"><a href="#NUTSKernel-253"><span class="linenos">253</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NUTSKernel-254"><a href="#NUTSKernel-254"><span class="linenos">254</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">NUTSKernelState</span><span class="p">,</span> <span class="n">NUTSTuningInfo</span><span class="p">]:</span>
</span><span id="NUTSKernel-255"><a href="#NUTSKernel-255"><span class="linenos">255</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel-256"><a href="#NUTSKernel-256"><span class="linenos">256</span></a><span class="sd">        Tunes the inverse mass vector or matrix using the samples from the last epoch.</span>
</span><span id="NUTSKernel-257"><a href="#NUTSKernel-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel-258"><a href="#NUTSKernel-258"><span class="linenos">258</span></a>
</span><span id="NUTSKernel-259"><a href="#NUTSKernel-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="n">history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NUTSKernel-260"><a href="#NUTSKernel-260"><span class="linenos">260</span></a>            <span class="n">history</span> <span class="o">=</span> <span class="n">Position</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">history</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span><span class="p">})</span>
</span><span id="NUTSKernel-261"><a href="#NUTSKernel-261"><span class="linenos">261</span></a>
</span><span id="NUTSKernel-262"><a href="#NUTSKernel-262"><span class="linenos">262</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span><span class="p">:</span>
</span><span id="NUTSKernel-263"><a href="#NUTSKernel-263"><span class="linenos">263</span></a>                <span class="n">new_inv_mm</span> <span class="o">=</span> <span class="n">tune_inv_mm_diag</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</span><span id="NUTSKernel-264"><a href="#NUTSKernel-264"><span class="linenos">264</span></a>                <span class="n">trace_fn</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span>
</span><span id="NUTSKernel-265"><a href="#NUTSKernel-265"><span class="linenos">265</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NUTSKernel-266"><a href="#NUTSKernel-266"><span class="linenos">266</span></a>                <span class="n">new_inv_mm</span> <span class="o">=</span> <span class="n">tune_inv_mm_full</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
</span><span id="NUTSKernel-267"><a href="#NUTSKernel-267"><span class="linenos">267</span></a>                <span class="n">trace_fn</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">trace</span>
</span><span id="NUTSKernel-268"><a href="#NUTSKernel-268"><span class="linenos">268</span></a>
</span><span id="NUTSKernel-269"><a href="#NUTSKernel-269"><span class="linenos">269</span></a>            <span class="n">old_inv_mm</span> <span class="o">=</span> <span class="n">kernel_state</span><span class="o">.</span><span class="n">inverse_mass_matrix</span>
</span><span id="NUTSKernel-270"><a href="#NUTSKernel-270"><span class="linenos">270</span></a>            <span class="n">adjustment</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">trace_fn</span><span class="p">(</span><span class="n">old_inv_mm</span><span class="p">)</span> <span class="o">/</span> <span class="n">trace_fn</span><span class="p">(</span><span class="n">new_inv_mm</span><span class="p">))</span>
</span><span id="NUTSKernel-271"><a href="#NUTSKernel-271"><span class="linenos">271</span></a>            <span class="n">kernel_state</span><span class="o">.</span><span class="n">step_size</span> <span class="o">=</span> <span class="n">adjustment</span> <span class="o">*</span> <span class="n">kernel_state</span><span class="o">.</span><span class="n">step_size</span>
</span><span id="NUTSKernel-272"><a href="#NUTSKernel-272"><span class="linenos">272</span></a>
</span><span id="NUTSKernel-273"><a href="#NUTSKernel-273"><span class="linenos">273</span></a>            <span class="n">kernel_state</span><span class="o">.</span><span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">new_inv_mm</span>
</span><span id="NUTSKernel-274"><a href="#NUTSKernel-274"><span class="linenos">274</span></a>
</span><span id="NUTSKernel-275"><a href="#NUTSKernel-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tune_fast</span><span class="p">(</span><span class="n">prng_key</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
</span><span id="NUTSKernel-276"><a href="#NUTSKernel-276"><span class="linenos">276</span></a>
</span><span id="NUTSKernel-277"><a href="#NUTSKernel-277"><span class="linenos">277</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="NUTSKernel-278"><a href="#NUTSKernel-278"><span class="linenos">278</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel-279"><a href="#NUTSKernel-279"><span class="linenos">279</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel-280"><a href="#NUTSKernel-280"><span class="linenos">280</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel-281"><a href="#NUTSKernel-281"><span class="linenos">281</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel-282"><a href="#NUTSKernel-282"><span class="linenos">282</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="NUTSKernel-283"><a href="#NUTSKernel-283"><span class="linenos">283</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NUTSKernelState</span><span class="p">:</span>
</span><span id="NUTSKernel-284"><a href="#NUTSKernel-284"><span class="linenos">284</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel-285"><a href="#NUTSKernel-285"><span class="linenos">285</span></a><span class="sd">        Resets the state of the dual averaging algorithm.</span>
</span><span id="NUTSKernel-286"><a href="#NUTSKernel-286"><span class="linenos">286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel-287"><a href="#NUTSKernel-287"><span class="linenos">287</span></a>
</span><span id="NUTSKernel-288"><a href="#NUTSKernel-288"><span class="linenos">288</span></a>        <span class="n">da_init</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="NUTSKernel-289"><a href="#NUTSKernel-289"><span class="linenos">289</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="NUTSKernel-290"><a href="#NUTSKernel-290"><span class="linenos">290</span></a>
</span><span id="NUTSKernel-291"><a href="#NUTSKernel-291"><span class="linenos">291</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="NUTSKernel-292"><a href="#NUTSKernel-292"><span class="linenos">292</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel-293"><a href="#NUTSKernel-293"><span class="linenos">293</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel-294"><a href="#NUTSKernel-294"><span class="linenos">294</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel-295"><a href="#NUTSKernel-295"><span class="linenos">295</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel-296"><a href="#NUTSKernel-296"><span class="linenos">296</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="NUTSKernel-297"><a href="#NUTSKernel-297"><span class="linenos">297</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NUTSKernelState</span><span class="p">:</span>
</span><span id="NUTSKernel-298"><a href="#NUTSKernel-298"><span class="linenos">298</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel-299"><a href="#NUTSKernel-299"><span class="linenos">299</span></a><span class="sd">        Sets the step size as found by the dual averaging algorithm.</span>
</span><span id="NUTSKernel-300"><a href="#NUTSKernel-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel-301"><a href="#NUTSKernel-301"><span class="linenos">301</span></a>
</span><span id="NUTSKernel-302"><a href="#NUTSKernel-302"><span class="linenos">302</span></a>        <span class="n">da_finalize</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="NUTSKernel-303"><a href="#NUTSKernel-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="NUTSKernel-304"><a href="#NUTSKernel-304"><span class="linenos">304</span></a>
</span><span id="NUTSKernel-305"><a href="#NUTSKernel-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="NUTSKernel-306"><a href="#NUTSKernel-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel-307"><a href="#NUTSKernel-307"><span class="linenos">307</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel-308"><a href="#NUTSKernel-308"><span class="linenos">308</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel-309"><a href="#NUTSKernel-309"><span class="linenos">309</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel-310"><a href="#NUTSKernel-310"><span class="linenos">310</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">NUTSTuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NUTSKernel-311"><a href="#NUTSKernel-311"><span class="linenos">311</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">NUTSKernelState</span><span class="p">]:</span>
</span><span id="NUTSKernel-312"><a href="#NUTSKernel-312"><span class="linenos">312</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel-313"><a href="#NUTSKernel-313"><span class="linenos">313</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="NUTSKernel-314"><a href="#NUTSKernel-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel-315"><a href="#NUTSKernel-315"><span class="linenos">315</span></a>
</span><span id="NUTSKernel-316"><a href="#NUTSKernel-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A NUTS kernel with dual averaging and an inverse mass matrix tuner,
implementing the <code>liesel.goose.types.Kernel</code> protocol.</p>
</div>


                            <div id="NUTSKernel.__init__" class="classattr">
                                        <input id="NUTSKernel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">NUTSKernel</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">initial_inverse_mass_matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_num_doublings</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span>,</span><span class="param">	<span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>,</span><span class="param">	<span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span>,</span><span class="param">	<span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">mm_diag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="NUTSKernel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NUTSKernel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NUTSKernel.__init__-106"><a href="#NUTSKernel.__init__-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="NUTSKernel.__init__-107"><a href="#NUTSKernel.__init__-107"><span class="linenos">107</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel.__init__-108"><a href="#NUTSKernel.__init__-108"><span class="linenos">108</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="NUTSKernel.__init__-109"><a href="#NUTSKernel.__init__-109"><span class="linenos">109</span></a>        <span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NUTSKernel.__init__-110"><a href="#NUTSKernel.__init__-110"><span class="linenos">110</span></a>        <span class="n">initial_inverse_mass_matrix</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NUTSKernel.__init__-111"><a href="#NUTSKernel.__init__-111"><span class="linenos">111</span></a>        <span class="n">max_num_doublings</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="NUTSKernel.__init__-112"><a href="#NUTSKernel.__init__-112"><span class="linenos">112</span></a>        <span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="NUTSKernel.__init__-113"><a href="#NUTSKernel.__init__-113"><span class="linenos">113</span></a>        <span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="NUTSKernel.__init__-114"><a href="#NUTSKernel.__init__-114"><span class="linenos">114</span></a>        <span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="NUTSKernel.__init__-115"><a href="#NUTSKernel.__init__-115"><span class="linenos">115</span></a>        <span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="NUTSKernel.__init__-116"><a href="#NUTSKernel.__init__-116"><span class="linenos">116</span></a>        <span class="n">mm_diag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NUTSKernel.__init__-117"><a href="#NUTSKernel.__init__-117"><span class="linenos">117</span></a>    <span class="p">):</span>
</span><span id="NUTSKernel.__init__-118"><a href="#NUTSKernel.__init__-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="NUTSKernel.__init__-119"><a href="#NUTSKernel.__init__-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NUTSKernel.__init__-120"><a href="#NUTSKernel.__init__-120"><span class="linenos">120</span></a>
</span><span id="NUTSKernel.__init__-121"><a href="#NUTSKernel.__init__-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="o">=</span> <span class="n">initial_step_size</span>
</span><span id="NUTSKernel.__init__-122"><a href="#NUTSKernel.__init__-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span> <span class="o">=</span> <span class="n">initial_inverse_mass_matrix</span>
</span><span id="NUTSKernel.__init__-123"><a href="#NUTSKernel.__init__-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_num_doublings</span> <span class="o">=</span> <span class="n">max_num_doublings</span>
</span><span id="NUTSKernel.__init__-124"><a href="#NUTSKernel.__init__-124"><span class="linenos">124</span></a>
</span><span id="NUTSKernel.__init__-125"><a href="#NUTSKernel.__init__-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span> <span class="o">=</span> <span class="n">da_target_accept</span>
</span><span id="NUTSKernel.__init__-126"><a href="#NUTSKernel.__init__-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span> <span class="o">=</span> <span class="n">da_gamma</span>
</span><span id="NUTSKernel.__init__-127"><a href="#NUTSKernel.__init__-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span> <span class="o">=</span> <span class="n">da_kappa</span>
</span><span id="NUTSKernel.__init__-128"><a href="#NUTSKernel.__init__-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span> <span class="o">=</span> <span class="n">da_t0</span>
</span><span id="NUTSKernel.__init__-129"><a href="#NUTSKernel.__init__-129"><span class="linenos">129</span></a>
</span><span id="NUTSKernel.__init__-130"><a href="#NUTSKernel.__init__-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span> <span class="o">=</span> <span class="n">mm_diag</span>
</span></pre></div>


    

                            </div>
                            <div id="NUTSKernel.error_book" class="classattr">
                                <div class="attr variable">
            <span class="name">error_book</span><span class="annotation">: ClassVar[dict[int, str]]</span><span class="default_value"> = {0: &#39;no errors&#39;, 1: &#39;divergent transition&#39;}</span>

        
    </div>
    <a class="headerlink" href="#NUTSKernel.error_book"></a>
    
    

                            </div>
                            <div id="NUTSKernel.needs_history" class="classattr">
                                <div class="attr variable">
            <span class="name">needs_history</span><span class="annotation">: ClassVar[bool]</span><span class="default_value"> = True</span>

        
    </div>
    <a class="headerlink" href="#NUTSKernel.needs_history"></a>
    
    

                            </div>
                            <div id="NUTSKernel.identifier" class="classattr">
                                <div class="attr variable">
            <span class="name">identifier</span><span class="annotation">: str</span><span class="default_value"> = &#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#NUTSKernel.identifier"></a>
    
    

                            </div>
                            <div id="NUTSKernel.init_state" class="classattr">
                                        <input id="NUTSKernel.init_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prng_key</span>, </span><span class="param"><span class="n">model_state</span></span>)</span>

                <label class="view-source-button" for="NUTSKernel.init_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NUTSKernel.init_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NUTSKernel.init_state-138"><a href="#NUTSKernel.init_state-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="NUTSKernel.init_state-139"><a href="#NUTSKernel.init_state-139"><span class="linenos">139</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel.init_state-140"><a href="#NUTSKernel.init_state-140"><span class="linenos">140</span></a><span class="sd">        Initializes the kernel state with an identity inverse mass matrix</span>
</span><span id="NUTSKernel.init_state-141"><a href="#NUTSKernel.init_state-141"><span class="linenos">141</span></a><span class="sd">        and a reasonable step size (unless explicit arguments were provided</span>
</span><span id="NUTSKernel.init_state-142"><a href="#NUTSKernel.init_state-142"><span class="linenos">142</span></a><span class="sd">        by the user).</span>
</span><span id="NUTSKernel.init_state-143"><a href="#NUTSKernel.init_state-143"><span class="linenos">143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel.init_state-144"><a href="#NUTSKernel.init_state-144"><span class="linenos">144</span></a>
</span><span id="NUTSKernel.init_state-145"><a href="#NUTSKernel.init_state-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NUTSKernel.init_state-146"><a href="#NUTSKernel.init_state-146"><span class="linenos">146</span></a>            <span class="n">flat_position</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ravel_pytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">))</span>
</span><span id="NUTSKernel.init_state-147"><a href="#NUTSKernel.init_state-147"><span class="linenos">147</span></a>
</span><span id="NUTSKernel.init_state-148"><a href="#NUTSKernel.init_state-148"><span class="linenos">148</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm_diag</span><span class="p">:</span>
</span><span id="NUTSKernel.init_state-149"><a href="#NUTSKernel.init_state-149"><span class="linenos">149</span></a>                <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">flat_position</span><span class="p">)</span>
</span><span id="NUTSKernel.init_state-150"><a href="#NUTSKernel.init_state-150"><span class="linenos">150</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NUTSKernel.init_state-151"><a href="#NUTSKernel.init_state-151"><span class="linenos">151</span></a>                <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">flat_position</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="NUTSKernel.init_state-152"><a href="#NUTSKernel.init_state-152"><span class="linenos">152</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NUTSKernel.init_state-153"><a href="#NUTSKernel.init_state-153"><span class="linenos">153</span></a>            <span class="n">inverse_mass_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_inverse_mass_matrix</span>
</span><span id="NUTSKernel.init_state-154"><a href="#NUTSKernel.init_state-154"><span class="linenos">154</span></a>
</span><span id="NUTSKernel.init_state-155"><a href="#NUTSKernel.init_state-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NUTSKernel.init_state-156"><a href="#NUTSKernel.init_state-156"><span class="linenos">156</span></a>            <span class="n">blackjax_kernel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_kernel</span><span class="p">()</span>
</span><span id="NUTSKernel.init_state-157"><a href="#NUTSKernel.init_state-157"><span class="linenos">157</span></a>            <span class="n">blackjax_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blackjax_state</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="NUTSKernel.init_state-158"><a href="#NUTSKernel.init_state-158"><span class="linenos">158</span></a>            <span class="n">log_prob_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_prob_fn</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="NUTSKernel.init_state-159"><a href="#NUTSKernel.init_state-159"><span class="linenos">159</span></a>
</span><span id="NUTSKernel.init_state-160"><a href="#NUTSKernel.init_state-160"><span class="linenos">160</span></a>            <span class="k">def</span> <span class="nf">kernel_generator</span><span class="p">(</span><span class="n">step_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="NUTSKernel.init_state-161"><a href="#NUTSKernel.init_state-161"><span class="linenos">161</span></a>                <span class="k">return</span> <span class="n">partial</span><span class="p">(</span>
</span><span id="NUTSKernel.init_state-162"><a href="#NUTSKernel.init_state-162"><span class="linenos">162</span></a>                    <span class="n">blackjax_kernel</span><span class="p">,</span>
</span><span id="NUTSKernel.init_state-163"><a href="#NUTSKernel.init_state-163"><span class="linenos">163</span></a>                    <span class="n">logprob_fn</span><span class="o">=</span><span class="n">log_prob_fn</span><span class="p">,</span>
</span><span id="NUTSKernel.init_state-164"><a href="#NUTSKernel.init_state-164"><span class="linenos">164</span></a>                    <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span>
</span><span id="NUTSKernel.init_state-165"><a href="#NUTSKernel.init_state-165"><span class="linenos">165</span></a>                    <span class="n">inverse_mass_matrix</span><span class="o">=</span><span class="n">inverse_mass_matrix</span><span class="p">,</span>
</span><span id="NUTSKernel.init_state-166"><a href="#NUTSKernel.init_state-166"><span class="linenos">166</span></a>                <span class="p">)</span>
</span><span id="NUTSKernel.init_state-167"><a href="#NUTSKernel.init_state-167"><span class="linenos">167</span></a>
</span><span id="NUTSKernel.init_state-168"><a href="#NUTSKernel.init_state-168"><span class="linenos">168</span></a>            <span class="n">step_size</span> <span class="o">=</span> <span class="n">find_reasonable_step_size</span><span class="p">(</span>
</span><span id="NUTSKernel.init_state-169"><a href="#NUTSKernel.init_state-169"><span class="linenos">169</span></a>                <span class="n">prng_key</span><span class="p">,</span>
</span><span id="NUTSKernel.init_state-170"><a href="#NUTSKernel.init_state-170"><span class="linenos">170</span></a>                <span class="n">kernel_generator</span><span class="p">,</span>
</span><span id="NUTSKernel.init_state-171"><a href="#NUTSKernel.init_state-171"><span class="linenos">171</span></a>                <span class="n">blackjax_state</span><span class="p">,</span>
</span><span id="NUTSKernel.init_state-172"><a href="#NUTSKernel.init_state-172"><span class="linenos">172</span></a>                <span class="n">initial_step_size</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
</span><span id="NUTSKernel.init_state-173"><a href="#NUTSKernel.init_state-173"><span class="linenos">173</span></a>                <span class="n">target_accept</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span><span class="p">,</span>
</span><span id="NUTSKernel.init_state-174"><a href="#NUTSKernel.init_state-174"><span class="linenos">174</span></a>            <span class="p">)</span>
</span><span id="NUTSKernel.init_state-175"><a href="#NUTSKernel.init_state-175"><span class="linenos">175</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NUTSKernel.init_state-176"><a href="#NUTSKernel.init_state-176"><span class="linenos">176</span></a>            <span class="n">step_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span>
</span><span id="NUTSKernel.init_state-177"><a href="#NUTSKernel.init_state-177"><span class="linenos">177</span></a>
</span><span id="NUTSKernel.init_state-178"><a href="#NUTSKernel.init_state-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="n">NUTSKernelState</span><span class="p">(</span><span class="n">step_size</span><span class="p">,</span> <span class="n">inverse_mass_matrix</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the kernel state with an identity inverse mass matrix
and a reasonable step size (unless explicit arguments were provided
by the user).</p>
</div>


                            </div>
                            <div id="NUTSKernel.start_epoch" class="classattr">
                                        <input id="NUTSKernel.start_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">nuts</span><span class="o">.</span><span class="n">NUTSKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">nuts</span><span class="o">.</span><span class="n">NUTSKernelState</span>:</span></span>

                <label class="view-source-button" for="NUTSKernel.start_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NUTSKernel.start_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NUTSKernel.start_epoch-277"><a href="#NUTSKernel.start_epoch-277"><span class="linenos">277</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="NUTSKernel.start_epoch-278"><a href="#NUTSKernel.start_epoch-278"><span class="linenos">278</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel.start_epoch-279"><a href="#NUTSKernel.start_epoch-279"><span class="linenos">279</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel.start_epoch-280"><a href="#NUTSKernel.start_epoch-280"><span class="linenos">280</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel.start_epoch-281"><a href="#NUTSKernel.start_epoch-281"><span class="linenos">281</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel.start_epoch-282"><a href="#NUTSKernel.start_epoch-282"><span class="linenos">282</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="NUTSKernel.start_epoch-283"><a href="#NUTSKernel.start_epoch-283"><span class="linenos">283</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NUTSKernelState</span><span class="p">:</span>
</span><span id="NUTSKernel.start_epoch-284"><a href="#NUTSKernel.start_epoch-284"><span class="linenos">284</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel.start_epoch-285"><a href="#NUTSKernel.start_epoch-285"><span class="linenos">285</span></a><span class="sd">        Resets the state of the dual averaging algorithm.</span>
</span><span id="NUTSKernel.start_epoch-286"><a href="#NUTSKernel.start_epoch-286"><span class="linenos">286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel.start_epoch-287"><a href="#NUTSKernel.start_epoch-287"><span class="linenos">287</span></a>
</span><span id="NUTSKernel.start_epoch-288"><a href="#NUTSKernel.start_epoch-288"><span class="linenos">288</span></a>        <span class="n">da_init</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="NUTSKernel.start_epoch-289"><a href="#NUTSKernel.start_epoch-289"><span class="linenos">289</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Resets the state of the dual averaging algorithm.</p>
</div>


                            </div>
                            <div id="NUTSKernel.end_epoch" class="classattr">
                                        <input id="NUTSKernel.end_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">nuts</span><span class="o">.</span><span class="n">NUTSKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">nuts</span><span class="o">.</span><span class="n">NUTSKernelState</span>:</span></span>

                <label class="view-source-button" for="NUTSKernel.end_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NUTSKernel.end_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NUTSKernel.end_epoch-291"><a href="#NUTSKernel.end_epoch-291"><span class="linenos">291</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="NUTSKernel.end_epoch-292"><a href="#NUTSKernel.end_epoch-292"><span class="linenos">292</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel.end_epoch-293"><a href="#NUTSKernel.end_epoch-293"><span class="linenos">293</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel.end_epoch-294"><a href="#NUTSKernel.end_epoch-294"><span class="linenos">294</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel.end_epoch-295"><a href="#NUTSKernel.end_epoch-295"><span class="linenos">295</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel.end_epoch-296"><a href="#NUTSKernel.end_epoch-296"><span class="linenos">296</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="NUTSKernel.end_epoch-297"><a href="#NUTSKernel.end_epoch-297"><span class="linenos">297</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NUTSKernelState</span><span class="p">:</span>
</span><span id="NUTSKernel.end_epoch-298"><a href="#NUTSKernel.end_epoch-298"><span class="linenos">298</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel.end_epoch-299"><a href="#NUTSKernel.end_epoch-299"><span class="linenos">299</span></a><span class="sd">        Sets the step size as found by the dual averaging algorithm.</span>
</span><span id="NUTSKernel.end_epoch-300"><a href="#NUTSKernel.end_epoch-300"><span class="linenos">300</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel.end_epoch-301"><a href="#NUTSKernel.end_epoch-301"><span class="linenos">301</span></a>
</span><span id="NUTSKernel.end_epoch-302"><a href="#NUTSKernel.end_epoch-302"><span class="linenos">302</span></a>        <span class="n">da_finalize</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="NUTSKernel.end_epoch-303"><a href="#NUTSKernel.end_epoch-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Sets the step size as found by the dual averaging algorithm.</p>
</div>


                            </div>
                            <div id="NUTSKernel.end_warmup" class="classattr">
                                        <input id="NUTSKernel.end_warmup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_warmup</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">nuts</span><span class="o">.</span><span class="n">NUTSKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">tuning_history</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">DefaultTuningInfo</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">nuts</span><span class="o">.</span><span class="n">NUTSKernelState</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="NUTSKernel.end_warmup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NUTSKernel.end_warmup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NUTSKernel.end_warmup-305"><a href="#NUTSKernel.end_warmup-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="NUTSKernel.end_warmup-306"><a href="#NUTSKernel.end_warmup-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NUTSKernel.end_warmup-307"><a href="#NUTSKernel.end_warmup-307"><span class="linenos">307</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="NUTSKernel.end_warmup-308"><a href="#NUTSKernel.end_warmup-308"><span class="linenos">308</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">NUTSKernelState</span><span class="p">,</span>
</span><span id="NUTSKernel.end_warmup-309"><a href="#NUTSKernel.end_warmup-309"><span class="linenos">309</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="NUTSKernel.end_warmup-310"><a href="#NUTSKernel.end_warmup-310"><span class="linenos">310</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">NUTSTuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NUTSKernel.end_warmup-311"><a href="#NUTSKernel.end_warmup-311"><span class="linenos">311</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">NUTSKernelState</span><span class="p">]:</span>
</span><span id="NUTSKernel.end_warmup-312"><a href="#NUTSKernel.end_warmup-312"><span class="linenos">312</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="NUTSKernel.end_warmup-313"><a href="#NUTSKernel.end_warmup-313"><span class="linenos">313</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="NUTSKernel.end_warmup-314"><a href="#NUTSKernel.end_warmup-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NUTSKernel.end_warmup-315"><a href="#NUTSKernel.end_warmup-315"><span class="linenos">315</span></a>
</span><span id="NUTSKernel.end_warmup-316"><a href="#NUTSKernel.end_warmup-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>liesel.goose.kernel.ModelMixin</dt>
                                <dd id="NUTSKernel.model" class="variable">model</dd>
                <dd id="NUTSKernel.set_model" class="function">set_model</dd>
                <dd id="NUTSKernel.has_model" class="function">has_model</dd>
                <dd id="NUTSKernel.position" class="function">position</dd>
                <dd id="NUTSKernel.log_prob_fn" class="function">log_prob_fn</dd>

            </div>
            <div><dt>liesel.goose.kernel.TransitionMixin</dt>
                                <dd id="NUTSKernel.transition" class="function">transition</dd>

            </div>
            <div><dt>liesel.goose.kernel.TuningMixin</dt>
                                <dd id="NUTSKernel.tune" class="function">tune</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Position">
                    <div class="attr variable">
            <span class="name">Position</span><span class="default_value"> = <a href="#Position">liesel.goose.Position</a></span>

        
    </div>
    <a class="headerlink" href="#Position"></a>
    
    

                </section>
                <section id="RWKernel">
                            <input id="RWKernel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RWKernel</span><wbr>(<span class="base">liesel.goose.kernel.ModelMixin</span>, <span class="base">liesel.goose.kernel.TransitionMixin[liesel.goose.rw.RWKernelState, liesel.goose.kernel.DefaultTransitionInfo]</span>):

                <label class="view-source-button" for="RWKernel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RWKernel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RWKernel-49"><a href="#RWKernel-49"><span class="linenos"> 49</span></a><span class="k">class</span> <span class="nc">RWKernel</span><span class="p">(</span><span class="n">ModelMixin</span><span class="p">,</span> <span class="n">TransitionMixin</span><span class="p">[</span><span class="n">RWKernelState</span><span class="p">,</span> <span class="n">RWTransitionInfo</span><span class="p">]):</span>
</span><span id="RWKernel-50"><a href="#RWKernel-50"><span class="linenos"> 50</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel-51"><a href="#RWKernel-51"><span class="linenos"> 51</span></a><span class="sd">    A random walk kernel with Gaussian proposals, Metropolis-Hastings correction and</span>
</span><span id="RWKernel-52"><a href="#RWKernel-52"><span class="linenos"> 52</span></a><span class="sd">    dual averaging, implementing the `liesel.goose.types.Kernel` protocol.</span>
</span><span id="RWKernel-53"><a href="#RWKernel-53"><span class="linenos"> 53</span></a>
</span><span id="RWKernel-54"><a href="#RWKernel-54"><span class="linenos"> 54</span></a><span class="sd">    The kernel uses a default Metropolis-Hastings target acceptance probability</span>
</span><span id="RWKernel-55"><a href="#RWKernel-55"><span class="linenos"> 55</span></a><span class="sd">    of 0.234, which is optimal for a random walk sampler (in a certain sense). See</span>
</span><span id="RWKernel-56"><a href="#RWKernel-56"><span class="linenos"> 56</span></a><span class="sd">    Gelman et al., [Weak convergence and optimal scaling of random walk Metropolis</span>
</span><span id="RWKernel-57"><a href="#RWKernel-57"><span class="linenos"> 57</span></a><span class="sd">    algorithms (1997)](https://doi.org/10.1214/aoap/1034625254).</span>
</span><span id="RWKernel-58"><a href="#RWKernel-58"><span class="linenos"> 58</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RWKernel-59"><a href="#RWKernel-59"><span class="linenos"> 59</span></a>
</span><span id="RWKernel-60"><a href="#RWKernel-60"><span class="linenos"> 60</span></a>    <span class="n">error_book</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;no errors&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">:</span> <span class="s2">&quot;nan acceptance prob&quot;</span><span class="p">}</span>
</span><span id="RWKernel-61"><a href="#RWKernel-61"><span class="linenos"> 61</span></a>    <span class="n">needs_history</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="RWKernel-62"><a href="#RWKernel-62"><span class="linenos"> 62</span></a>    <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="RWKernel-63"><a href="#RWKernel-63"><span class="linenos"> 63</span></a>
</span><span id="RWKernel-64"><a href="#RWKernel-64"><span class="linenos"> 64</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="RWKernel-65"><a href="#RWKernel-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel-66"><a href="#RWKernel-66"><span class="linenos"> 66</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="RWKernel-67"><a href="#RWKernel-67"><span class="linenos"> 67</span></a>        <span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="RWKernel-68"><a href="#RWKernel-68"><span class="linenos"> 68</span></a>        <span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.234</span><span class="p">,</span>
</span><span id="RWKernel-69"><a href="#RWKernel-69"><span class="linenos"> 69</span></a>        <span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="RWKernel-70"><a href="#RWKernel-70"><span class="linenos"> 70</span></a>        <span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="RWKernel-71"><a href="#RWKernel-71"><span class="linenos"> 71</span></a>        <span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="RWKernel-72"><a href="#RWKernel-72"><span class="linenos"> 72</span></a>    <span class="p">):</span>
</span><span id="RWKernel-73"><a href="#RWKernel-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RWKernel-74"><a href="#RWKernel-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="RWKernel-75"><a href="#RWKernel-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="o">=</span> <span class="n">initial_step_size</span>
</span><span id="RWKernel-76"><a href="#RWKernel-76"><span class="linenos"> 76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span> <span class="o">=</span> <span class="n">da_target_accept</span>
</span><span id="RWKernel-77"><a href="#RWKernel-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span> <span class="o">=</span> <span class="n">da_gamma</span>
</span><span id="RWKernel-78"><a href="#RWKernel-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span> <span class="o">=</span> <span class="n">da_kappa</span>
</span><span id="RWKernel-79"><a href="#RWKernel-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span> <span class="o">=</span> <span class="n">da_t0</span>
</span><span id="RWKernel-80"><a href="#RWKernel-80"><span class="linenos"> 80</span></a>
</span><span id="RWKernel-81"><a href="#RWKernel-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="RWKernel-82"><a href="#RWKernel-82"><span class="linenos"> 82</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel-83"><a href="#RWKernel-83"><span class="linenos"> 83</span></a><span class="sd">        Initializes the kernel state.</span>
</span><span id="RWKernel-84"><a href="#RWKernel-84"><span class="linenos"> 84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel-85"><a href="#RWKernel-85"><span class="linenos"> 85</span></a>
</span><span id="RWKernel-86"><a href="#RWKernel-86"><span class="linenos"> 86</span></a>        <span class="k">return</span> <span class="n">RWKernelState</span><span class="p">(</span><span class="n">step_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span><span class="p">)</span>
</span><span id="RWKernel-87"><a href="#RWKernel-87"><span class="linenos"> 87</span></a>
</span><span id="RWKernel-88"><a href="#RWKernel-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">_standard_transition</span><span class="p">(</span>
</span><span id="RWKernel-89"><a href="#RWKernel-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel-90"><a href="#RWKernel-90"><span class="linenos"> 90</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel-91"><a href="#RWKernel-91"><span class="linenos"> 91</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel-92"><a href="#RWKernel-92"><span class="linenos"> 92</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel-93"><a href="#RWKernel-93"><span class="linenos"> 93</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="RWKernel-94"><a href="#RWKernel-94"><span class="linenos"> 94</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">RWKernelState</span><span class="p">,</span> <span class="n">DefaultTransitionInfo</span><span class="p">]:</span>
</span><span id="RWKernel-95"><a href="#RWKernel-95"><span class="linenos"> 95</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel-96"><a href="#RWKernel-96"><span class="linenos"> 96</span></a><span class="sd">        Performs an MCMC transition *without* dual averaging.</span>
</span><span id="RWKernel-97"><a href="#RWKernel-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel-98"><a href="#RWKernel-98"><span class="linenos"> 98</span></a>
</span><span id="RWKernel-99"><a href="#RWKernel-99"><span class="linenos"> 99</span></a>        <span class="n">key</span><span class="p">,</span> <span class="n">subkey</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">prng_key</span><span class="p">)</span>
</span><span id="RWKernel-100"><a href="#RWKernel-100"><span class="linenos">100</span></a>        <span class="n">step_size</span> <span class="o">=</span> <span class="n">kernel_state</span><span class="o">.</span><span class="n">step_size</span>
</span><span id="RWKernel-101"><a href="#RWKernel-101"><span class="linenos">101</span></a>
</span><span id="RWKernel-102"><a href="#RWKernel-102"><span class="linenos">102</span></a>        <span class="c1"># random walk proposal</span>
</span><span id="RWKernel-103"><a href="#RWKernel-103"><span class="linenos">103</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
</span><span id="RWKernel-104"><a href="#RWKernel-104"><span class="linenos">104</span></a>        <span class="n">flat_position</span><span class="p">,</span> <span class="n">unravel_fn</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">flatten_util</span><span class="o">.</span><span class="n">ravel_pytree</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
</span><span id="RWKernel-105"><a href="#RWKernel-105"><span class="linenos">105</span></a>        <span class="n">step</span> <span class="o">=</span> <span class="n">step_size</span> <span class="o">*</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">flat_position</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="RWKernel-106"><a href="#RWKernel-106"><span class="linenos">106</span></a>        <span class="n">flat_proposal</span> <span class="o">=</span> <span class="n">flat_position</span> <span class="o">+</span> <span class="n">step</span>
</span><span id="RWKernel-107"><a href="#RWKernel-107"><span class="linenos">107</span></a>        <span class="n">proposal</span> <span class="o">=</span> <span class="n">unravel_fn</span><span class="p">(</span><span class="n">flat_proposal</span><span class="p">)</span>
</span><span id="RWKernel-108"><a href="#RWKernel-108"><span class="linenos">108</span></a>
</span><span id="RWKernel-109"><a href="#RWKernel-109"><span class="linenos">109</span></a>        <span class="c1"># metropolis-hastings calibration</span>
</span><span id="RWKernel-110"><a href="#RWKernel-110"><span class="linenos">110</span></a>        <span class="n">info</span><span class="p">,</span> <span class="n">model_state</span> <span class="o">=</span> <span class="n">mh_step</span><span class="p">(</span><span class="n">subkey</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">proposal</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="RWKernel-111"><a href="#RWKernel-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="n">TransitionOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">)</span>
</span><span id="RWKernel-112"><a href="#RWKernel-112"><span class="linenos">112</span></a>
</span><span id="RWKernel-113"><a href="#RWKernel-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">_adaptive_transition</span><span class="p">(</span>
</span><span id="RWKernel-114"><a href="#RWKernel-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel-115"><a href="#RWKernel-115"><span class="linenos">115</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel-116"><a href="#RWKernel-116"><span class="linenos">116</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel-117"><a href="#RWKernel-117"><span class="linenos">117</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel-118"><a href="#RWKernel-118"><span class="linenos">118</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="RWKernel-119"><a href="#RWKernel-119"><span class="linenos">119</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TransitionOutcome</span><span class="p">[</span><span class="n">RWKernelState</span><span class="p">,</span> <span class="n">DefaultTransitionInfo</span><span class="p">]:</span>
</span><span id="RWKernel-120"><a href="#RWKernel-120"><span class="linenos">120</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel-121"><a href="#RWKernel-121"><span class="linenos">121</span></a><span class="sd">        Performs an MCMC transition *with* dual averaging.</span>
</span><span id="RWKernel-122"><a href="#RWKernel-122"><span class="linenos">122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel-123"><a href="#RWKernel-123"><span class="linenos">123</span></a>
</span><span id="RWKernel-124"><a href="#RWKernel-124"><span class="linenos">124</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_standard_transition</span><span class="p">(</span><span class="n">prng_key</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">,</span> <span class="n">model_state</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>
</span><span id="RWKernel-125"><a href="#RWKernel-125"><span class="linenos">125</span></a>
</span><span id="RWKernel-126"><a href="#RWKernel-126"><span class="linenos">126</span></a>        <span class="n">da_step</span><span class="p">(</span>
</span><span id="RWKernel-127"><a href="#RWKernel-127"><span class="linenos">127</span></a>            <span class="n">outcome</span><span class="o">.</span><span class="n">kernel_state</span><span class="p">,</span>
</span><span id="RWKernel-128"><a href="#RWKernel-128"><span class="linenos">128</span></a>            <span class="n">outcome</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">acceptance_prob</span><span class="p">,</span>
</span><span id="RWKernel-129"><a href="#RWKernel-129"><span class="linenos">129</span></a>            <span class="n">epoch</span><span class="o">.</span><span class="n">time_in_epoch</span><span class="p">,</span>
</span><span id="RWKernel-130"><a href="#RWKernel-130"><span class="linenos">130</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span><span class="p">,</span>
</span><span id="RWKernel-131"><a href="#RWKernel-131"><span class="linenos">131</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span><span class="p">,</span>
</span><span id="RWKernel-132"><a href="#RWKernel-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span><span class="p">,</span>
</span><span id="RWKernel-133"><a href="#RWKernel-133"><span class="linenos">133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span><span class="p">,</span>
</span><span id="RWKernel-134"><a href="#RWKernel-134"><span class="linenos">134</span></a>        <span class="p">)</span>
</span><span id="RWKernel-135"><a href="#RWKernel-135"><span class="linenos">135</span></a>
</span><span id="RWKernel-136"><a href="#RWKernel-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">outcome</span>
</span><span id="RWKernel-137"><a href="#RWKernel-137"><span class="linenos">137</span></a>
</span><span id="RWKernel-138"><a href="#RWKernel-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">tune</span><span class="p">(</span>
</span><span id="RWKernel-139"><a href="#RWKernel-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel-140"><a href="#RWKernel-140"><span class="linenos">140</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel-141"><a href="#RWKernel-141"><span class="linenos">141</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel-142"><a href="#RWKernel-142"><span class="linenos">142</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel-143"><a href="#RWKernel-143"><span class="linenos">143</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="RWKernel-144"><a href="#RWKernel-144"><span class="linenos">144</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RWKernel-145"><a href="#RWKernel-145"><span class="linenos">145</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">RWKernelState</span><span class="p">,</span> <span class="n">DefaultTuningInfo</span><span class="p">]:</span>
</span><span id="RWKernel-146"><a href="#RWKernel-146"><span class="linenos">146</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel-147"><a href="#RWKernel-147"><span class="linenos">147</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="RWKernel-148"><a href="#RWKernel-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel-149"><a href="#RWKernel-149"><span class="linenos">149</span></a>
</span><span id="RWKernel-150"><a href="#RWKernel-150"><span class="linenos">150</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">RWTuningInfo</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</span><span id="RWKernel-151"><a href="#RWKernel-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="n">TuningOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">)</span>
</span><span id="RWKernel-152"><a href="#RWKernel-152"><span class="linenos">152</span></a>
</span><span id="RWKernel-153"><a href="#RWKernel-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="RWKernel-154"><a href="#RWKernel-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel-155"><a href="#RWKernel-155"><span class="linenos">155</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel-156"><a href="#RWKernel-156"><span class="linenos">156</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel-157"><a href="#RWKernel-157"><span class="linenos">157</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel-158"><a href="#RWKernel-158"><span class="linenos">158</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="RWKernel-159"><a href="#RWKernel-159"><span class="linenos">159</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RWKernelState</span><span class="p">:</span>
</span><span id="RWKernel-160"><a href="#RWKernel-160"><span class="linenos">160</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel-161"><a href="#RWKernel-161"><span class="linenos">161</span></a><span class="sd">        Resets the state of the dual averaging algorithm.</span>
</span><span id="RWKernel-162"><a href="#RWKernel-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel-163"><a href="#RWKernel-163"><span class="linenos">163</span></a>
</span><span id="RWKernel-164"><a href="#RWKernel-164"><span class="linenos">164</span></a>        <span class="n">da_init</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="RWKernel-165"><a href="#RWKernel-165"><span class="linenos">165</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="RWKernel-166"><a href="#RWKernel-166"><span class="linenos">166</span></a>
</span><span id="RWKernel-167"><a href="#RWKernel-167"><span class="linenos">167</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="RWKernel-168"><a href="#RWKernel-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel-169"><a href="#RWKernel-169"><span class="linenos">169</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel-170"><a href="#RWKernel-170"><span class="linenos">170</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel-171"><a href="#RWKernel-171"><span class="linenos">171</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel-172"><a href="#RWKernel-172"><span class="linenos">172</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="RWKernel-173"><a href="#RWKernel-173"><span class="linenos">173</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RWKernelState</span><span class="p">:</span>
</span><span id="RWKernel-174"><a href="#RWKernel-174"><span class="linenos">174</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel-175"><a href="#RWKernel-175"><span class="linenos">175</span></a><span class="sd">        Sets the step size as found by the dual averaging algorithm.</span>
</span><span id="RWKernel-176"><a href="#RWKernel-176"><span class="linenos">176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel-177"><a href="#RWKernel-177"><span class="linenos">177</span></a>
</span><span id="RWKernel-178"><a href="#RWKernel-178"><span class="linenos">178</span></a>        <span class="n">da_finalize</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="RWKernel-179"><a href="#RWKernel-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span><span id="RWKernel-180"><a href="#RWKernel-180"><span class="linenos">180</span></a>
</span><span id="RWKernel-181"><a href="#RWKernel-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="RWKernel-182"><a href="#RWKernel-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel-183"><a href="#RWKernel-183"><span class="linenos">183</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel-184"><a href="#RWKernel-184"><span class="linenos">184</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel-185"><a href="#RWKernel-185"><span class="linenos">185</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel-186"><a href="#RWKernel-186"><span class="linenos">186</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">TuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RWKernel-187"><a href="#RWKernel-187"><span class="linenos">187</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">RWKernelState</span><span class="p">]:</span>
</span><span id="RWKernel-188"><a href="#RWKernel-188"><span class="linenos">188</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel-189"><a href="#RWKernel-189"><span class="linenos">189</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="RWKernel-190"><a href="#RWKernel-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel-191"><a href="#RWKernel-191"><span class="linenos">191</span></a>
</span><span id="RWKernel-192"><a href="#RWKernel-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A random walk kernel with Gaussian proposals, Metropolis-Hastings correction and
dual averaging, implementing the <code>liesel.goose.types.Kernel</code> protocol.</p>

<p>The kernel uses a default Metropolis-Hastings target acceptance probability
of 0.234, which is optimal for a random walk sampler (in a certain sense). See
Gelman et al., <a href="https://doi.org/10.1214/aoap/1034625254">Weak convergence and optimal scaling of random walk Metropolis
algorithms (1997)</a>.</p>
</div>


                            <div id="RWKernel.__init__" class="classattr">
                                        <input id="RWKernel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RWKernel</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.234</span>,</span><span class="param">	<span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>,</span><span class="param">	<span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span>,</span><span class="param">	<span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span>)</span>

                <label class="view-source-button" for="RWKernel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RWKernel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RWKernel.__init__-64"><a href="#RWKernel.__init__-64"><span class="linenos">64</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="RWKernel.__init__-65"><a href="#RWKernel.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel.__init__-66"><a href="#RWKernel.__init__-66"><span class="linenos">66</span></a>        <span class="n">position_keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="RWKernel.__init__-67"><a href="#RWKernel.__init__-67"><span class="linenos">67</span></a>        <span class="n">initial_step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="RWKernel.__init__-68"><a href="#RWKernel.__init__-68"><span class="linenos">68</span></a>        <span class="n">da_target_accept</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.234</span><span class="p">,</span>
</span><span id="RWKernel.__init__-69"><a href="#RWKernel.__init__-69"><span class="linenos">69</span></a>        <span class="n">da_gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
</span><span id="RWKernel.__init__-70"><a href="#RWKernel.__init__-70"><span class="linenos">70</span></a>        <span class="n">da_kappa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span id="RWKernel.__init__-71"><a href="#RWKernel.__init__-71"><span class="linenos">71</span></a>        <span class="n">da_t0</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="RWKernel.__init__-72"><a href="#RWKernel.__init__-72"><span class="linenos">72</span></a>    <span class="p">):</span>
</span><span id="RWKernel.__init__-73"><a href="#RWKernel.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="RWKernel.__init__-74"><a href="#RWKernel.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position_keys</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">position_keys</span><span class="p">)</span>
</span><span id="RWKernel.__init__-75"><a href="#RWKernel.__init__-75"><span class="linenos">75</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span> <span class="o">=</span> <span class="n">initial_step_size</span>
</span><span id="RWKernel.__init__-76"><a href="#RWKernel.__init__-76"><span class="linenos">76</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_target_accept</span> <span class="o">=</span> <span class="n">da_target_accept</span>
</span><span id="RWKernel.__init__-77"><a href="#RWKernel.__init__-77"><span class="linenos">77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_gamma</span> <span class="o">=</span> <span class="n">da_gamma</span>
</span><span id="RWKernel.__init__-78"><a href="#RWKernel.__init__-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_kappa</span> <span class="o">=</span> <span class="n">da_kappa</span>
</span><span id="RWKernel.__init__-79"><a href="#RWKernel.__init__-79"><span class="linenos">79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">da_t0</span> <span class="o">=</span> <span class="n">da_t0</span>
</span></pre></div>


    

                            </div>
                            <div id="RWKernel.error_book" class="classattr">
                                <div class="attr variable">
            <span class="name">error_book</span><span class="annotation">: ClassVar[dict[int, str]]</span><span class="default_value"> = {0: &#39;no errors&#39;, 90: &#39;nan acceptance prob&#39;}</span>

        
    </div>
    <a class="headerlink" href="#RWKernel.error_book"></a>
    
    

                            </div>
                            <div id="RWKernel.needs_history" class="classattr">
                                <div class="attr variable">
            <span class="name">needs_history</span><span class="annotation">: ClassVar[bool]</span><span class="default_value"> = False</span>

        
    </div>
    <a class="headerlink" href="#RWKernel.needs_history"></a>
    
    

                            </div>
                            <div id="RWKernel.identifier" class="classattr">
                                <div class="attr variable">
            <span class="name">identifier</span><span class="annotation">: str</span><span class="default_value"> = &#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#RWKernel.identifier"></a>
    
    

                            </div>
                            <div id="RWKernel.init_state" class="classattr">
                                        <input id="RWKernel.init_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prng_key</span>, </span><span class="param"><span class="n">model_state</span></span>)</span>

                <label class="view-source-button" for="RWKernel.init_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RWKernel.init_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RWKernel.init_state-81"><a href="#RWKernel.init_state-81"><span class="linenos">81</span></a>    <span class="k">def</span> <span class="nf">init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prng_key</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
</span><span id="RWKernel.init_state-82"><a href="#RWKernel.init_state-82"><span class="linenos">82</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel.init_state-83"><a href="#RWKernel.init_state-83"><span class="linenos">83</span></a><span class="sd">        Initializes the kernel state.</span>
</span><span id="RWKernel.init_state-84"><a href="#RWKernel.init_state-84"><span class="linenos">84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel.init_state-85"><a href="#RWKernel.init_state-85"><span class="linenos">85</span></a>
</span><span id="RWKernel.init_state-86"><a href="#RWKernel.init_state-86"><span class="linenos">86</span></a>        <span class="k">return</span> <span class="n">RWKernelState</span><span class="p">(</span><span class="n">step_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_step_size</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the kernel state.</p>
</div>


                            </div>
                            <div id="RWKernel.tune" class="classattr">
                                        <input id="RWKernel.tune-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tune</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">rw</span><span class="o">.</span><span class="n">RWKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span>,</span><span class="param">	<span class="n">history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Position</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">TuningOutcome</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">rw</span><span class="o">.</span><span class="n">RWKernelState</span><span class="p">,</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">DefaultTuningInfo</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RWKernel.tune-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RWKernel.tune"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RWKernel.tune-138"><a href="#RWKernel.tune-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">tune</span><span class="p">(</span>
</span><span id="RWKernel.tune-139"><a href="#RWKernel.tune-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel.tune-140"><a href="#RWKernel.tune-140"><span class="linenos">140</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel.tune-141"><a href="#RWKernel.tune-141"><span class="linenos">141</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel.tune-142"><a href="#RWKernel.tune-142"><span class="linenos">142</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel.tune-143"><a href="#RWKernel.tune-143"><span class="linenos">143</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="RWKernel.tune-144"><a href="#RWKernel.tune-144"><span class="linenos">144</span></a>        <span class="n">history</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RWKernel.tune-145"><a href="#RWKernel.tune-145"><span class="linenos">145</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TuningOutcome</span><span class="p">[</span><span class="n">RWKernelState</span><span class="p">,</span> <span class="n">DefaultTuningInfo</span><span class="p">]:</span>
</span><span id="RWKernel.tune-146"><a href="#RWKernel.tune-146"><span class="linenos">146</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel.tune-147"><a href="#RWKernel.tune-147"><span class="linenos">147</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="RWKernel.tune-148"><a href="#RWKernel.tune-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel.tune-149"><a href="#RWKernel.tune-149"><span class="linenos">149</span></a>
</span><span id="RWKernel.tune-150"><a href="#RWKernel.tune-150"><span class="linenos">150</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">RWTuningInfo</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">epoch</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</span><span id="RWKernel.tune-151"><a href="#RWKernel.tune-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="n">TuningOutcome</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div id="RWKernel.start_epoch" class="classattr">
                                        <input id="RWKernel.start_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">rw</span><span class="o">.</span><span class="n">RWKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">rw</span><span class="o">.</span><span class="n">RWKernelState</span>:</span></span>

                <label class="view-source-button" for="RWKernel.start_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RWKernel.start_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RWKernel.start_epoch-153"><a href="#RWKernel.start_epoch-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">start_epoch</span><span class="p">(</span>
</span><span id="RWKernel.start_epoch-154"><a href="#RWKernel.start_epoch-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel.start_epoch-155"><a href="#RWKernel.start_epoch-155"><span class="linenos">155</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel.start_epoch-156"><a href="#RWKernel.start_epoch-156"><span class="linenos">156</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel.start_epoch-157"><a href="#RWKernel.start_epoch-157"><span class="linenos">157</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel.start_epoch-158"><a href="#RWKernel.start_epoch-158"><span class="linenos">158</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="RWKernel.start_epoch-159"><a href="#RWKernel.start_epoch-159"><span class="linenos">159</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RWKernelState</span><span class="p">:</span>
</span><span id="RWKernel.start_epoch-160"><a href="#RWKernel.start_epoch-160"><span class="linenos">160</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel.start_epoch-161"><a href="#RWKernel.start_epoch-161"><span class="linenos">161</span></a><span class="sd">        Resets the state of the dual averaging algorithm.</span>
</span><span id="RWKernel.start_epoch-162"><a href="#RWKernel.start_epoch-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel.start_epoch-163"><a href="#RWKernel.start_epoch-163"><span class="linenos">163</span></a>
</span><span id="RWKernel.start_epoch-164"><a href="#RWKernel.start_epoch-164"><span class="linenos">164</span></a>        <span class="n">da_init</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="RWKernel.start_epoch-165"><a href="#RWKernel.start_epoch-165"><span class="linenos">165</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Resets the state of the dual averaging algorithm.</p>
</div>


                            </div>
                            <div id="RWKernel.end_epoch" class="classattr">
                                        <input id="RWKernel.end_epoch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_epoch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">rw</span><span class="o">.</span><span class="n">RWKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">epoch</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochState</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">rw</span><span class="o">.</span><span class="n">RWKernelState</span>:</span></span>

                <label class="view-source-button" for="RWKernel.end_epoch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RWKernel.end_epoch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RWKernel.end_epoch-167"><a href="#RWKernel.end_epoch-167"><span class="linenos">167</span></a>    <span class="k">def</span> <span class="nf">end_epoch</span><span class="p">(</span>
</span><span id="RWKernel.end_epoch-168"><a href="#RWKernel.end_epoch-168"><span class="linenos">168</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel.end_epoch-169"><a href="#RWKernel.end_epoch-169"><span class="linenos">169</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel.end_epoch-170"><a href="#RWKernel.end_epoch-170"><span class="linenos">170</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel.end_epoch-171"><a href="#RWKernel.end_epoch-171"><span class="linenos">171</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel.end_epoch-172"><a href="#RWKernel.end_epoch-172"><span class="linenos">172</span></a>        <span class="n">epoch</span><span class="p">:</span> <span class="n">EpochState</span><span class="p">,</span>
</span><span id="RWKernel.end_epoch-173"><a href="#RWKernel.end_epoch-173"><span class="linenos">173</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RWKernelState</span><span class="p">:</span>
</span><span id="RWKernel.end_epoch-174"><a href="#RWKernel.end_epoch-174"><span class="linenos">174</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel.end_epoch-175"><a href="#RWKernel.end_epoch-175"><span class="linenos">175</span></a><span class="sd">        Sets the step size as found by the dual averaging algorithm.</span>
</span><span id="RWKernel.end_epoch-176"><a href="#RWKernel.end_epoch-176"><span class="linenos">176</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel.end_epoch-177"><a href="#RWKernel.end_epoch-177"><span class="linenos">177</span></a>
</span><span id="RWKernel.end_epoch-178"><a href="#RWKernel.end_epoch-178"><span class="linenos">178</span></a>        <span class="n">da_finalize</span><span class="p">(</span><span class="n">kernel_state</span><span class="p">)</span>
</span><span id="RWKernel.end_epoch-179"><a href="#RWKernel.end_epoch-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="n">kernel_state</span>
</span></pre></div>


            <div class="docstring"><p>Sets the step size as found by the dual averaging algorithm.</p>
</div>


                            </div>
                            <div id="RWKernel.end_warmup" class="classattr">
                                        <input id="RWKernel.end_warmup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">end_warmup</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prng_key</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span>,</span><span class="param">	<span class="n">kernel_state</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">rw</span><span class="o">.</span><span class="n">RWKernelState</span>,</span><span class="param">	<span class="n">model_state</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">tuning_history</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">TuningInfo</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">rw</span><span class="o">.</span><span class="n">RWKernelState</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RWKernel.end_warmup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RWKernel.end_warmup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RWKernel.end_warmup-181"><a href="#RWKernel.end_warmup-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">end_warmup</span><span class="p">(</span>
</span><span id="RWKernel.end_warmup-182"><a href="#RWKernel.end_warmup-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="RWKernel.end_warmup-183"><a href="#RWKernel.end_warmup-183"><span class="linenos">183</span></a>        <span class="n">prng_key</span><span class="p">:</span> <span class="n">KeyArray</span><span class="p">,</span>
</span><span id="RWKernel.end_warmup-184"><a href="#RWKernel.end_warmup-184"><span class="linenos">184</span></a>        <span class="n">kernel_state</span><span class="p">:</span> <span class="n">RWKernelState</span><span class="p">,</span>
</span><span id="RWKernel.end_warmup-185"><a href="#RWKernel.end_warmup-185"><span class="linenos">185</span></a>        <span class="n">model_state</span><span class="p">:</span> <span class="n">ModelState</span><span class="p">,</span>
</span><span id="RWKernel.end_warmup-186"><a href="#RWKernel.end_warmup-186"><span class="linenos">186</span></a>        <span class="n">tuning_history</span><span class="p">:</span> <span class="n">TuningInfo</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RWKernel.end_warmup-187"><a href="#RWKernel.end_warmup-187"><span class="linenos">187</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WarmupOutcome</span><span class="p">[</span><span class="n">RWKernelState</span><span class="p">]:</span>
</span><span id="RWKernel.end_warmup-188"><a href="#RWKernel.end_warmup-188"><span class="linenos">188</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="RWKernel.end_warmup-189"><a href="#RWKernel.end_warmup-189"><span class="linenos">189</span></a><span class="sd">        Currently does nothing.</span>
</span><span id="RWKernel.end_warmup-190"><a href="#RWKernel.end_warmup-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RWKernel.end_warmup-191"><a href="#RWKernel.end_warmup-191"><span class="linenos">191</span></a>
</span><span id="RWKernel.end_warmup-192"><a href="#RWKernel.end_warmup-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">WarmupOutcome</span><span class="p">(</span><span class="n">error_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kernel_state</span><span class="o">=</span><span class="n">kernel_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Currently does nothing.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>liesel.goose.kernel.ModelMixin</dt>
                                <dd id="RWKernel.model" class="variable">model</dd>
                <dd id="RWKernel.set_model" class="function">set_model</dd>
                <dd id="RWKernel.has_model" class="function">has_model</dd>
                <dd id="RWKernel.position" class="function">position</dd>
                <dd id="RWKernel.log_prob_fn" class="function">log_prob_fn</dd>

            </div>
            <div><dt>liesel.goose.kernel.TransitionMixin</dt>
                                <dd id="RWKernel.transition" class="function">transition</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Summary">
                            <input id="Summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Summary</span>:

                <label class="view-source-button" for="Summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Summary-564"><a href="#Summary-564"><span class="linenos">564</span></a><span class="nd">@dataclass</span>
</span><span id="Summary-565"><a href="#Summary-565"><span class="linenos">565</span></a><span class="k">class</span> <span class="nc">Summary</span><span class="p">:</span>
</span><span id="Summary-566"><a href="#Summary-566"><span class="linenos">566</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Summary-567"><a href="#Summary-567"><span class="linenos">567</span></a><span class="sd">    A summary object.</span>
</span><span id="Summary-568"><a href="#Summary-568"><span class="linenos">568</span></a>
</span><span id="Summary-569"><a href="#Summary-569"><span class="linenos">569</span></a><span class="sd">    Allows easy programatic access via quantities[quantity_name][var_name]. The</span>
</span><span id="Summary-570"><a href="#Summary-570"><span class="linenos">570</span></a><span class="sd">    array has the a similar shape as the parameter with var_name. However, if</span>
</span><span id="Summary-571"><a href="#Summary-571"><span class="linenos">571</span></a><span class="sd">    `per_chain` is `True` the first dimension refers to the chain index.</span>
</span><span id="Summary-572"><a href="#Summary-572"><span class="linenos">572</span></a><span class="sd">    Additionally, for &quot;hdi&quot; and &quot;quantile&quot; the second dimension refers to the</span>
</span><span id="Summary-573"><a href="#Summary-573"><span class="linenos">573</span></a><span class="sd">    quantile.</span>
</span><span id="Summary-574"><a href="#Summary-574"><span class="linenos">574</span></a>
</span><span id="Summary-575"><a href="#Summary-575"><span class="linenos">575</span></a><span class="sd">    The summary object can be turned into a `pd.DataFrame` using the function</span>
</span><span id="Summary-576"><a href="#Summary-576"><span class="linenos">576</span></a><span class="sd">    `to_dataframe`.</span>
</span><span id="Summary-577"><a href="#Summary-577"><span class="linenos">577</span></a>
</span><span id="Summary-578"><a href="#Summary-578"><span class="linenos">578</span></a><span class="sd">    Experimental.</span>
</span><span id="Summary-579"><a href="#Summary-579"><span class="linenos">579</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Summary-580"><a href="#Summary-580"><span class="linenos">580</span></a>
</span><span id="Summary-581"><a href="#Summary-581"><span class="linenos">581</span></a>    <span class="n">quantities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
</span><span id="Summary-582"><a href="#Summary-582"><span class="linenos">582</span></a>    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="Summary-583"><a href="#Summary-583"><span class="linenos">583</span></a>    <span class="n">sample_info</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="Summary-584"><a href="#Summary-584"><span class="linenos">584</span></a>
</span><span id="Summary-585"><a href="#Summary-585"><span class="linenos">585</span></a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Summary-586"><a href="#Summary-586"><span class="linenos">586</span></a>        <span class="sd">&quot;&quot;&quot;Turns Summary object into a DataFrame object.&quot;&quot;&quot;</span>
</span><span id="Summary-587"><a href="#Summary-587"><span class="linenos">587</span></a>
</span><span id="Summary-588"><a href="#Summary-588"><span class="linenos">588</span></a>        <span class="c1"># don&#39;t change the original data</span>
</span><span id="Summary-589"><a href="#Summary-589"><span class="linenos">589</span></a>        <span class="n">quants</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Summary-590"><a href="#Summary-590"><span class="linenos">590</span></a>
</span><span id="Summary-591"><a href="#Summary-591"><span class="linenos">591</span></a>        <span class="c1"># make new entires for the quantiles</span>
</span><span id="Summary-592"><a href="#Summary-592"><span class="linenos">592</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;quantiles&quot;</span><span class="p">]):</span>
</span><span id="Summary-593"><a href="#Summary-593"><span class="linenos">593</span></a>            <span class="n">quants</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;q_</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;quantile&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Summary-594"><a href="#Summary-594"><span class="linenos">594</span></a>        <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi_low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Summary-595"><a href="#Summary-595"><span class="linenos">595</span></a>        <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi_high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Summary-596"><a href="#Summary-596"><span class="linenos">596</span></a>
</span><span id="Summary-597"><a href="#Summary-597"><span class="linenos">597</span></a>        <span class="c1"># remove the old entries</span>
</span><span id="Summary-598"><a href="#Summary-598"><span class="linenos">598</span></a>        <span class="k">del</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;quantile&quot;</span><span class="p">]</span>
</span><span id="Summary-599"><a href="#Summary-599"><span class="linenos">599</span></a>        <span class="k">del</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi&quot;</span><span class="p">]</span>
</span><span id="Summary-600"><a href="#Summary-600"><span class="linenos">600</span></a>
</span><span id="Summary-601"><a href="#Summary-601"><span class="linenos">601</span></a>        <span class="c1"># create one row per entrie</span>
</span><span id="Summary-602"><a href="#Summary-602"><span class="linenos">602</span></a>        <span class="n">df_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Summary-603"><a href="#Summary-603"><span class="linenos">603</span></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Summary-604"><a href="#Summary-604"><span class="linenos">604</span></a>            <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">quants</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">][</span><span class="n">var</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;multi_index&quot;</span><span class="p">])</span>
</span><span id="Summary-605"><a href="#Summary-605"><span class="linenos">605</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
</span><span id="Summary-606"><a href="#Summary-606"><span class="linenos">606</span></a>                <span class="n">var_fqn</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Summary-607"><a href="#Summary-607"><span class="linenos">607</span></a>                    <span class="n">var</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}{</span><span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Summary-608"><a href="#Summary-608"><span class="linenos">608</span></a>                <span class="p">)</span>
</span><span id="Summary-609"><a href="#Summary-609"><span class="linenos">609</span></a>                <span class="n">quant_per_elem</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Summary-610"><a href="#Summary-610"><span class="linenos">610</span></a>                <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span>
</span><span id="Summary-611"><a href="#Summary-611"><span class="linenos">611</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;chains_merged&quot;</span><span class="p">]:</span>
</span><span id="Summary-612"><a href="#Summary-612"><span class="linenos">612</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;var_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">multi_index</span>
</span><span id="Summary-613"><a href="#Summary-613"><span class="linenos">613</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;sample_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Summary-614"><a href="#Summary-614"><span class="linenos">614</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sample_info</span><span class="p">[</span><span class="s2">&quot;sample_size_per_chain&quot;</span><span class="p">]</span>
</span><span id="Summary-615"><a href="#Summary-615"><span class="linenos">615</span></a>                        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_info</span><span class="p">[</span><span class="s2">&quot;num_chains&quot;</span><span class="p">]</span>
</span><span id="Summary-616"><a href="#Summary-616"><span class="linenos">616</span></a>                    <span class="p">)</span>
</span><span id="Summary-617"><a href="#Summary-617"><span class="linenos">617</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Summary-618"><a href="#Summary-618"><span class="linenos">618</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;chain_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Summary-619"><a href="#Summary-619"><span class="linenos">619</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;var_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="Summary-620"><a href="#Summary-620"><span class="linenos">620</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;sample_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_info</span><span class="p">[</span>
</span><span id="Summary-621"><a href="#Summary-621"><span class="linenos">621</span></a>                        <span class="s2">&quot;sample_size_per_chain&quot;</span>
</span><span id="Summary-622"><a href="#Summary-622"><span class="linenos">622</span></a>                    <span class="p">]</span>
</span><span id="Summary-623"><a href="#Summary-623"><span class="linenos">623</span></a>
</span><span id="Summary-624"><a href="#Summary-624"><span class="linenos">624</span></a>                <span class="k">for</span> <span class="n">quant_name</span><span class="p">,</span> <span class="n">quant_dict</span> <span class="ow">in</span> <span class="n">quants</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Summary-625"><a href="#Summary-625"><span class="linenos">625</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="n">quant_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant_dict</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">]</span>
</span><span id="Summary-626"><a href="#Summary-626"><span class="linenos">626</span></a>
</span><span id="Summary-627"><a href="#Summary-627"><span class="linenos">627</span></a>                <span class="n">df_dict</span><span class="p">[</span><span class="n">var_fqn</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant_per_elem</span>
</span><span id="Summary-628"><a href="#Summary-628"><span class="linenos">628</span></a>
</span><span id="Summary-629"><a href="#Summary-629"><span class="linenos">629</span></a>        <span class="c1"># convert to dataframe and use varname as index</span>
</span><span id="Summary-630"><a href="#Summary-630"><span class="linenos">630</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">df_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="Summary-631"><a href="#Summary-631"><span class="linenos">631</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="Summary-632"><a href="#Summary-632"><span class="linenos">632</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;var_fqn&quot;</span><span class="p">})</span>
</span><span id="Summary-633"><a href="#Summary-633"><span class="linenos">633</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
</span><span id="Summary-634"><a href="#Summary-634"><span class="linenos">634</span></a>
</span><span id="Summary-635"><a href="#Summary-635"><span class="linenos">635</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="Summary-636"><a href="#Summary-636"><span class="linenos">636</span></a>
</span><span id="Summary-637"><a href="#Summary-637"><span class="linenos">637</span></a>    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Summary-638"><a href="#Summary-638"><span class="linenos">638</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
</span><span id="Summary-639"><a href="#Summary-639"><span class="linenos">639</span></a>        <span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;var_fqn&quot;</span><span class="p">]</span>
</span><span id="Summary-640"><a href="#Summary-640"><span class="linenos">640</span></a>        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index_names</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Summary-641"><a href="#Summary-641"><span class="linenos">641</span></a>
</span><span id="Summary-642"><a href="#Summary-642"><span class="linenos">642</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Summary-643"><a href="#Summary-643"><span class="linenos">643</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
</span><span id="Summary-644"><a href="#Summary-644"><span class="linenos">644</span></a>
</span><span id="Summary-645"><a href="#Summary-645"><span class="linenos">645</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Summary-646"><a href="#Summary-646"><span class="linenos">646</span></a>    <span class="k">def</span> <span class="nf">from_result</span><span class="p">(</span>
</span><span id="Summary-647"><a href="#Summary-647"><span class="linenos">647</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">SamplingResult</span><span class="p">,</span>
</span><span id="Summary-648"><a href="#Summary-648"><span class="linenos">648</span></a>        <span class="n">additional_chain</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Summary-649"><a href="#Summary-649"><span class="linenos">649</span></a>        <span class="n">quantiles</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span>
</span><span id="Summary-650"><a href="#Summary-650"><span class="linenos">650</span></a>        <span class="n">hdi_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="Summary-651"><a href="#Summary-651"><span class="linenos">651</span></a>        <span class="n">selected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Summary-652"><a href="#Summary-652"><span class="linenos">652</span></a>        <span class="n">deselected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Summary-653"><a href="#Summary-653"><span class="linenos">653</span></a>        <span class="n">per_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Summary-654"><a href="#Summary-654"><span class="linenos">654</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Summary&quot;</span><span class="p">:</span>
</span><span id="Summary-655"><a href="#Summary-655"><span class="linenos">655</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Summary-656"><a href="#Summary-656"><span class="linenos">656</span></a><span class="sd">        Creates a `Summary` object from a result object.</span>
</span><span id="Summary-657"><a href="#Summary-657"><span class="linenos">657</span></a>
</span><span id="Summary-658"><a href="#Summary-658"><span class="linenos">658</span></a><span class="sd">        An optional `addition_chain` can be supplied to add more parameters to</span>
</span><span id="Summary-659"><a href="#Summary-659"><span class="linenos">659</span></a><span class="sd">        the summary output. `additional_chain` must be a position chain which</span>
</span><span id="Summary-660"><a href="#Summary-660"><span class="linenos">660</span></a><span class="sd">        maches chain and time dimention of the posterior chain as returned by</span>
</span><span id="Summary-661"><a href="#Summary-661"><span class="linenos">661</span></a><span class="sd">        `result.get_posterior_sampels()`.</span>
</span><span id="Summary-662"><a href="#Summary-662"><span class="linenos">662</span></a>
</span><span id="Summary-663"><a href="#Summary-663"><span class="linenos">663</span></a><span class="sd">        The arguments `selected` and `deselected` allow to get a summary only</span>
</span><span id="Summary-664"><a href="#Summary-664"><span class="linenos">664</span></a><span class="sd">        from subset of the position keys.</span>
</span><span id="Summary-665"><a href="#Summary-665"><span class="linenos">665</span></a>
</span><span id="Summary-666"><a href="#Summary-666"><span class="linenos">666</span></a><span class="sd">        When using `per_chain` the summary is calculated on a per chain basis.</span>
</span><span id="Summary-667"><a href="#Summary-667"><span class="linenos">667</span></a><span class="sd">        Certain measures like rhat are not availavle if `per_chain` is true.</span>
</span><span id="Summary-668"><a href="#Summary-668"><span class="linenos">668</span></a>
</span><span id="Summary-669"><a href="#Summary-669"><span class="linenos">669</span></a><span class="sd">        Experimental.</span>
</span><span id="Summary-670"><a href="#Summary-670"><span class="linenos">670</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Summary-671"><a href="#Summary-671"><span class="linenos">671</span></a>
</span><span id="Summary-672"><a href="#Summary-672"><span class="linenos">672</span></a>        <span class="n">posterior_chain</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_posterior_samples</span><span class="p">()</span>
</span><span id="Summary-673"><a href="#Summary-673"><span class="linenos">673</span></a>        <span class="k">if</span> <span class="n">additional_chain</span><span class="p">:</span>
</span><span id="Summary-674"><a href="#Summary-674"><span class="linenos">674</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">additional_chain</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Summary-675"><a href="#Summary-675"><span class="linenos">675</span></a>                <span class="n">posterior_chain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="Summary-676"><a href="#Summary-676"><span class="linenos">676</span></a>
</span><span id="Summary-677"><a href="#Summary-677"><span class="linenos">677</span></a>        <span class="k">if</span> <span class="n">selected</span><span class="p">:</span>
</span><span id="Summary-678"><a href="#Summary-678"><span class="linenos">678</span></a>            <span class="n">posterior_chain</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span>
</span><span id="Summary-679"><a href="#Summary-679"><span class="linenos">679</span></a>                <span class="p">{</span>
</span><span id="Summary-680"><a href="#Summary-680"><span class="linenos">680</span></a>                    <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
</span><span id="Summary-681"><a href="#Summary-681"><span class="linenos">681</span></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">posterior_chain</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Summary-682"><a href="#Summary-682"><span class="linenos">682</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">selected</span>
</span><span id="Summary-683"><a href="#Summary-683"><span class="linenos">683</span></a>                <span class="p">}</span>
</span><span id="Summary-684"><a href="#Summary-684"><span class="linenos">684</span></a>            <span class="p">)</span>
</span><span id="Summary-685"><a href="#Summary-685"><span class="linenos">685</span></a>
</span><span id="Summary-686"><a href="#Summary-686"><span class="linenos">686</span></a>        <span class="k">if</span> <span class="n">deselected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Summary-687"><a href="#Summary-687"><span class="linenos">687</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">deselected</span><span class="p">:</span>
</span><span id="Summary-688"><a href="#Summary-688"><span class="linenos">688</span></a>                <span class="k">del</span> <span class="n">posterior_chain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="Summary-689"><a href="#Summary-689"><span class="linenos">689</span></a>
</span><span id="Summary-690"><a href="#Summary-690"><span class="linenos">690</span></a>        <span class="c1"># get some general infos on the sampling</span>
</span><span id="Summary-691"><a href="#Summary-691"><span class="linenos">691</span></a>        <span class="n">param_chain</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">posterior_chain</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="Summary-692"><a href="#Summary-692"><span class="linenos">692</span></a>        <span class="n">sample_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Summary-693"><a href="#Summary-693"><span class="linenos">693</span></a>            <span class="s2">&quot;num_chains&quot;</span><span class="p">:</span> <span class="n">param_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Summary-694"><a href="#Summary-694"><span class="linenos">694</span></a>            <span class="s2">&quot;sample_size_per_chain&quot;</span><span class="p">:</span> <span class="n">param_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Summary-695"><a href="#Summary-695"><span class="linenos">695</span></a>        <span class="p">}</span>
</span><span id="Summary-696"><a href="#Summary-696"><span class="linenos">696</span></a>
</span><span id="Summary-697"><a href="#Summary-697"><span class="linenos">697</span></a>        <span class="c1">#  converte everything to numpy array</span>
</span><span id="Summary-698"><a href="#Summary-698"><span class="linenos">698</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">posterior_chain</span><span class="p">:</span>
</span><span id="Summary-699"><a href="#Summary-699"><span class="linenos">699</span></a>            <span class="n">posterior_chain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">posterior_chain</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="Summary-700"><a href="#Summary-700"><span class="linenos">700</span></a>
</span><span id="Summary-701"><a href="#Summary-701"><span class="linenos">701</span></a>        <span class="c1"># calculate quantiles either per chain and merge the results or all at once</span>
</span><span id="Summary-702"><a href="#Summary-702"><span class="linenos">702</span></a>        <span class="n">single_chain_summaries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Summary-703"><a href="#Summary-703"><span class="linenos">703</span></a>        <span class="k">if</span> <span class="n">per_chain</span><span class="p">:</span>
</span><span id="Summary-704"><a href="#Summary-704"><span class="linenos">704</span></a>            <span class="k">for</span> <span class="n">chain_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sample_info</span><span class="p">[</span><span class="s2">&quot;num_chains&quot;</span><span class="p">]):</span>
</span><span id="Summary-705"><a href="#Summary-705"><span class="linenos">705</span></a>                <span class="n">single_chain</span> <span class="o">=</span> <span class="n">slice_leaves</span><span class="p">(</span>
</span><span id="Summary-706"><a href="#Summary-706"><span class="linenos">706</span></a>                    <span class="n">posterior_chain</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">chain_idx</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="Summary-707"><a href="#Summary-707"><span class="linenos">707</span></a>                <span class="p">)</span>
</span><span id="Summary-708"><a href="#Summary-708"><span class="linenos">708</span></a>                <span class="n">single_chain_summaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Summary-709"><a href="#Summary-709"><span class="linenos">709</span></a>                    <span class="n">_create_quantity_dict</span><span class="p">(</span><span class="n">single_chain</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="p">)</span>
</span><span id="Summary-710"><a href="#Summary-710"><span class="linenos">710</span></a>                <span class="p">)</span>
</span><span id="Summary-711"><a href="#Summary-711"><span class="linenos">711</span></a>            <span class="n">quantities</span> <span class="o">=</span> <span class="n">stack_leaves</span><span class="p">(</span><span class="n">single_chain_summaries</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Summary-712"><a href="#Summary-712"><span class="linenos">712</span></a>            <span class="k">del</span> <span class="n">quantities</span><span class="p">[</span><span class="s2">&quot;rhat&quot;</span><span class="p">]</span>
</span><span id="Summary-713"><a href="#Summary-713"><span class="linenos">713</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Summary-714"><a href="#Summary-714"><span class="linenos">714</span></a>            <span class="n">quantities</span> <span class="o">=</span> <span class="n">_create_quantity_dict</span><span class="p">(</span><span class="n">posterior_chain</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="p">)</span>
</span><span id="Summary-715"><a href="#Summary-715"><span class="linenos">715</span></a>
</span><span id="Summary-716"><a href="#Summary-716"><span class="linenos">716</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Summary-717"><a href="#Summary-717"><span class="linenos">717</span></a>            <span class="s2">&quot;quantiles&quot;</span><span class="p">:</span> <span class="n">quantiles</span><span class="p">,</span>
</span><span id="Summary-718"><a href="#Summary-718"><span class="linenos">718</span></a>            <span class="s2">&quot;hdi_prob&quot;</span><span class="p">:</span> <span class="n">hdi_prob</span><span class="p">,</span>
</span><span id="Summary-719"><a href="#Summary-719"><span class="linenos">719</span></a>            <span class="s2">&quot;chains_merged&quot;</span><span class="p">:</span> <span class="ow">not</span> <span class="n">per_chain</span><span class="p">,</span>
</span><span id="Summary-720"><a href="#Summary-720"><span class="linenos">720</span></a>        <span class="p">}</span>
</span><span id="Summary-721"><a href="#Summary-721"><span class="linenos">721</span></a>
</span><span id="Summary-722"><a href="#Summary-722"><span class="linenos">722</span></a>        <span class="k">return</span> <span class="n">Summary</span><span class="p">(</span><span class="n">quantities</span><span class="o">=</span><span class="n">quantities</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">sample_info</span><span class="o">=</span><span class="n">sample_info</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A summary object.</p>

<p>Allows easy programatic access via quantities[quantity_name][var_name]. The
array has the a similar shape as the parameter with var_name. However, if
<code>per_chain</code> is <code>True</code> the first dimension refers to the chain index.
Additionally, for "hdi" and "quantile" the second dimension refers to the
quantile.</p>

<p>The summary object can be turned into a <code>pd.DataFrame</code> using the function
<code><a href="#Summary.to_dataframe">to_dataframe</a></code>.</p>

<p>Experimental.</p>
</div>


                            <div id="Summary.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Summary</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">quantities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">config</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">sample_info</span><span class="p">:</span> <span class="nb">dict</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Summary.__init__"></a>
    
    

                            </div>
                            <div id="Summary.to_dataframe" class="classattr">
                                        <input id="Summary.to_dataframe-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_dataframe</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="Summary.to_dataframe-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Summary.to_dataframe"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Summary.to_dataframe-585"><a href="#Summary.to_dataframe-585"><span class="linenos">585</span></a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Summary.to_dataframe-586"><a href="#Summary.to_dataframe-586"><span class="linenos">586</span></a>        <span class="sd">&quot;&quot;&quot;Turns Summary object into a DataFrame object.&quot;&quot;&quot;</span>
</span><span id="Summary.to_dataframe-587"><a href="#Summary.to_dataframe-587"><span class="linenos">587</span></a>
</span><span id="Summary.to_dataframe-588"><a href="#Summary.to_dataframe-588"><span class="linenos">588</span></a>        <span class="c1"># don&#39;t change the original data</span>
</span><span id="Summary.to_dataframe-589"><a href="#Summary.to_dataframe-589"><span class="linenos">589</span></a>        <span class="n">quants</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="Summary.to_dataframe-590"><a href="#Summary.to_dataframe-590"><span class="linenos">590</span></a>
</span><span id="Summary.to_dataframe-591"><a href="#Summary.to_dataframe-591"><span class="linenos">591</span></a>        <span class="c1"># make new entires for the quantiles</span>
</span><span id="Summary.to_dataframe-592"><a href="#Summary.to_dataframe-592"><span class="linenos">592</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;quantiles&quot;</span><span class="p">]):</span>
</span><span id="Summary.to_dataframe-593"><a href="#Summary.to_dataframe-593"><span class="linenos">593</span></a>            <span class="n">quants</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;q_</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;quantile&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Summary.to_dataframe-594"><a href="#Summary.to_dataframe-594"><span class="linenos">594</span></a>        <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi_low&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Summary.to_dataframe-595"><a href="#Summary.to_dataframe-595"><span class="linenos">595</span></a>        <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi_high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Summary.to_dataframe-596"><a href="#Summary.to_dataframe-596"><span class="linenos">596</span></a>
</span><span id="Summary.to_dataframe-597"><a href="#Summary.to_dataframe-597"><span class="linenos">597</span></a>        <span class="c1"># remove the old entries</span>
</span><span id="Summary.to_dataframe-598"><a href="#Summary.to_dataframe-598"><span class="linenos">598</span></a>        <span class="k">del</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;quantile&quot;</span><span class="p">]</span>
</span><span id="Summary.to_dataframe-599"><a href="#Summary.to_dataframe-599"><span class="linenos">599</span></a>        <span class="k">del</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;hdi&quot;</span><span class="p">]</span>
</span><span id="Summary.to_dataframe-600"><a href="#Summary.to_dataframe-600"><span class="linenos">600</span></a>
</span><span id="Summary.to_dataframe-601"><a href="#Summary.to_dataframe-601"><span class="linenos">601</span></a>        <span class="c1"># create one row per entrie</span>
</span><span id="Summary.to_dataframe-602"><a href="#Summary.to_dataframe-602"><span class="linenos">602</span></a>        <span class="n">df_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Summary.to_dataframe-603"><a href="#Summary.to_dataframe-603"><span class="linenos">603</span></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Summary.to_dataframe-604"><a href="#Summary.to_dataframe-604"><span class="linenos">604</span></a>            <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">quants</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">][</span><span class="n">var</span><span class="p">],</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;multi_index&quot;</span><span class="p">])</span>
</span><span id="Summary.to_dataframe-605"><a href="#Summary.to_dataframe-605"><span class="linenos">605</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
</span><span id="Summary.to_dataframe-606"><a href="#Summary.to_dataframe-606"><span class="linenos">606</span></a>                <span class="n">var_fqn</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Summary.to_dataframe-607"><a href="#Summary.to_dataframe-607"><span class="linenos">607</span></a>                    <span class="n">var</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}{</span><span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Summary.to_dataframe-608"><a href="#Summary.to_dataframe-608"><span class="linenos">608</span></a>                <span class="p">)</span>
</span><span id="Summary.to_dataframe-609"><a href="#Summary.to_dataframe-609"><span class="linenos">609</span></a>                <span class="n">quant_per_elem</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Summary.to_dataframe-610"><a href="#Summary.to_dataframe-610"><span class="linenos">610</span></a>                <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span>
</span><span id="Summary.to_dataframe-611"><a href="#Summary.to_dataframe-611"><span class="linenos">611</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;chains_merged&quot;</span><span class="p">]:</span>
</span><span id="Summary.to_dataframe-612"><a href="#Summary.to_dataframe-612"><span class="linenos">612</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;var_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">multi_index</span>
</span><span id="Summary.to_dataframe-613"><a href="#Summary.to_dataframe-613"><span class="linenos">613</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;sample_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Summary.to_dataframe-614"><a href="#Summary.to_dataframe-614"><span class="linenos">614</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">sample_info</span><span class="p">[</span><span class="s2">&quot;sample_size_per_chain&quot;</span><span class="p">]</span>
</span><span id="Summary.to_dataframe-615"><a href="#Summary.to_dataframe-615"><span class="linenos">615</span></a>                        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_info</span><span class="p">[</span><span class="s2">&quot;num_chains&quot;</span><span class="p">]</span>
</span><span id="Summary.to_dataframe-616"><a href="#Summary.to_dataframe-616"><span class="linenos">616</span></a>                    <span class="p">)</span>
</span><span id="Summary.to_dataframe-617"><a href="#Summary.to_dataframe-617"><span class="linenos">617</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Summary.to_dataframe-618"><a href="#Summary.to_dataframe-618"><span class="linenos">618</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;chain_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Summary.to_dataframe-619"><a href="#Summary.to_dataframe-619"><span class="linenos">619</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;var_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="Summary.to_dataframe-620"><a href="#Summary.to_dataframe-620"><span class="linenos">620</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="s2">&quot;sample_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_info</span><span class="p">[</span>
</span><span id="Summary.to_dataframe-621"><a href="#Summary.to_dataframe-621"><span class="linenos">621</span></a>                        <span class="s2">&quot;sample_size_per_chain&quot;</span>
</span><span id="Summary.to_dataframe-622"><a href="#Summary.to_dataframe-622"><span class="linenos">622</span></a>                    <span class="p">]</span>
</span><span id="Summary.to_dataframe-623"><a href="#Summary.to_dataframe-623"><span class="linenos">623</span></a>
</span><span id="Summary.to_dataframe-624"><a href="#Summary.to_dataframe-624"><span class="linenos">624</span></a>                <span class="k">for</span> <span class="n">quant_name</span><span class="p">,</span> <span class="n">quant_dict</span> <span class="ow">in</span> <span class="n">quants</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Summary.to_dataframe-625"><a href="#Summary.to_dataframe-625"><span class="linenos">625</span></a>                    <span class="n">quant_per_elem</span><span class="p">[</span><span class="n">quant_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant_dict</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">]</span>
</span><span id="Summary.to_dataframe-626"><a href="#Summary.to_dataframe-626"><span class="linenos">626</span></a>
</span><span id="Summary.to_dataframe-627"><a href="#Summary.to_dataframe-627"><span class="linenos">627</span></a>                <span class="n">df_dict</span><span class="p">[</span><span class="n">var_fqn</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant_per_elem</span>
</span><span id="Summary.to_dataframe-628"><a href="#Summary.to_dataframe-628"><span class="linenos">628</span></a>
</span><span id="Summary.to_dataframe-629"><a href="#Summary.to_dataframe-629"><span class="linenos">629</span></a>        <span class="c1"># convert to dataframe and use varname as index</span>
</span><span id="Summary.to_dataframe-630"><a href="#Summary.to_dataframe-630"><span class="linenos">630</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">df_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span id="Summary.to_dataframe-631"><a href="#Summary.to_dataframe-631"><span class="linenos">631</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="Summary.to_dataframe-632"><a href="#Summary.to_dataframe-632"><span class="linenos">632</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;var_fqn&quot;</span><span class="p">})</span>
</span><span id="Summary.to_dataframe-633"><a href="#Summary.to_dataframe-633"><span class="linenos">633</span></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
</span><span id="Summary.to_dataframe-634"><a href="#Summary.to_dataframe-634"><span class="linenos">634</span></a>
</span><span id="Summary.to_dataframe-635"><a href="#Summary.to_dataframe-635"><span class="linenos">635</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Turns Summary object into a DataFrame object.</p>
</div>


                            </div>
                            <div id="Summary.from_result" class="classattr">
                                        <input id="Summary.from_result-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">from_result</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">result</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SamplingResult</span>,</span><span class="param">	<span class="n">additional_chain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Position</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">quantiles</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)</span>,</span><span class="param">	<span class="n">hdi_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">selected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">deselected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">per_chain</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">summary_m</span><span class="o">.</span><span class="n">Summary</span>:</span></span>

                <label class="view-source-button" for="Summary.from_result-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Summary.from_result"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Summary.from_result-645"><a href="#Summary.from_result-645"><span class="linenos">645</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Summary.from_result-646"><a href="#Summary.from_result-646"><span class="linenos">646</span></a>    <span class="k">def</span> <span class="nf">from_result</span><span class="p">(</span>
</span><span id="Summary.from_result-647"><a href="#Summary.from_result-647"><span class="linenos">647</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">SamplingResult</span><span class="p">,</span>
</span><span id="Summary.from_result-648"><a href="#Summary.from_result-648"><span class="linenos">648</span></a>        <span class="n">additional_chain</span><span class="p">:</span> <span class="n">Position</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Summary.from_result-649"><a href="#Summary.from_result-649"><span class="linenos">649</span></a>        <span class="n">quantiles</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span>
</span><span id="Summary.from_result-650"><a href="#Summary.from_result-650"><span class="linenos">650</span></a>        <span class="n">hdi_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="Summary.from_result-651"><a href="#Summary.from_result-651"><span class="linenos">651</span></a>        <span class="n">selected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Summary.from_result-652"><a href="#Summary.from_result-652"><span class="linenos">652</span></a>        <span class="n">deselected</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Summary.from_result-653"><a href="#Summary.from_result-653"><span class="linenos">653</span></a>        <span class="n">per_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Summary.from_result-654"><a href="#Summary.from_result-654"><span class="linenos">654</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Summary&quot;</span><span class="p">:</span>
</span><span id="Summary.from_result-655"><a href="#Summary.from_result-655"><span class="linenos">655</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Summary.from_result-656"><a href="#Summary.from_result-656"><span class="linenos">656</span></a><span class="sd">        Creates a `Summary` object from a result object.</span>
</span><span id="Summary.from_result-657"><a href="#Summary.from_result-657"><span class="linenos">657</span></a>
</span><span id="Summary.from_result-658"><a href="#Summary.from_result-658"><span class="linenos">658</span></a><span class="sd">        An optional `addition_chain` can be supplied to add more parameters to</span>
</span><span id="Summary.from_result-659"><a href="#Summary.from_result-659"><span class="linenos">659</span></a><span class="sd">        the summary output. `additional_chain` must be a position chain which</span>
</span><span id="Summary.from_result-660"><a href="#Summary.from_result-660"><span class="linenos">660</span></a><span class="sd">        maches chain and time dimention of the posterior chain as returned by</span>
</span><span id="Summary.from_result-661"><a href="#Summary.from_result-661"><span class="linenos">661</span></a><span class="sd">        `result.get_posterior_sampels()`.</span>
</span><span id="Summary.from_result-662"><a href="#Summary.from_result-662"><span class="linenos">662</span></a>
</span><span id="Summary.from_result-663"><a href="#Summary.from_result-663"><span class="linenos">663</span></a><span class="sd">        The arguments `selected` and `deselected` allow to get a summary only</span>
</span><span id="Summary.from_result-664"><a href="#Summary.from_result-664"><span class="linenos">664</span></a><span class="sd">        from subset of the position keys.</span>
</span><span id="Summary.from_result-665"><a href="#Summary.from_result-665"><span class="linenos">665</span></a>
</span><span id="Summary.from_result-666"><a href="#Summary.from_result-666"><span class="linenos">666</span></a><span class="sd">        When using `per_chain` the summary is calculated on a per chain basis.</span>
</span><span id="Summary.from_result-667"><a href="#Summary.from_result-667"><span class="linenos">667</span></a><span class="sd">        Certain measures like rhat are not availavle if `per_chain` is true.</span>
</span><span id="Summary.from_result-668"><a href="#Summary.from_result-668"><span class="linenos">668</span></a>
</span><span id="Summary.from_result-669"><a href="#Summary.from_result-669"><span class="linenos">669</span></a><span class="sd">        Experimental.</span>
</span><span id="Summary.from_result-670"><a href="#Summary.from_result-670"><span class="linenos">670</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Summary.from_result-671"><a href="#Summary.from_result-671"><span class="linenos">671</span></a>
</span><span id="Summary.from_result-672"><a href="#Summary.from_result-672"><span class="linenos">672</span></a>        <span class="n">posterior_chain</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_posterior_samples</span><span class="p">()</span>
</span><span id="Summary.from_result-673"><a href="#Summary.from_result-673"><span class="linenos">673</span></a>        <span class="k">if</span> <span class="n">additional_chain</span><span class="p">:</span>
</span><span id="Summary.from_result-674"><a href="#Summary.from_result-674"><span class="linenos">674</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">additional_chain</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Summary.from_result-675"><a href="#Summary.from_result-675"><span class="linenos">675</span></a>                <span class="n">posterior_chain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="Summary.from_result-676"><a href="#Summary.from_result-676"><span class="linenos">676</span></a>
</span><span id="Summary.from_result-677"><a href="#Summary.from_result-677"><span class="linenos">677</span></a>        <span class="k">if</span> <span class="n">selected</span><span class="p">:</span>
</span><span id="Summary.from_result-678"><a href="#Summary.from_result-678"><span class="linenos">678</span></a>            <span class="n">posterior_chain</span> <span class="o">=</span> <span class="n">Position</span><span class="p">(</span>
</span><span id="Summary.from_result-679"><a href="#Summary.from_result-679"><span class="linenos">679</span></a>                <span class="p">{</span>
</span><span id="Summary.from_result-680"><a href="#Summary.from_result-680"><span class="linenos">680</span></a>                    <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
</span><span id="Summary.from_result-681"><a href="#Summary.from_result-681"><span class="linenos">681</span></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">posterior_chain</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Summary.from_result-682"><a href="#Summary.from_result-682"><span class="linenos">682</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">selected</span>
</span><span id="Summary.from_result-683"><a href="#Summary.from_result-683"><span class="linenos">683</span></a>                <span class="p">}</span>
</span><span id="Summary.from_result-684"><a href="#Summary.from_result-684"><span class="linenos">684</span></a>            <span class="p">)</span>
</span><span id="Summary.from_result-685"><a href="#Summary.from_result-685"><span class="linenos">685</span></a>
</span><span id="Summary.from_result-686"><a href="#Summary.from_result-686"><span class="linenos">686</span></a>        <span class="k">if</span> <span class="n">deselected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Summary.from_result-687"><a href="#Summary.from_result-687"><span class="linenos">687</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">deselected</span><span class="p">:</span>
</span><span id="Summary.from_result-688"><a href="#Summary.from_result-688"><span class="linenos">688</span></a>                <span class="k">del</span> <span class="n">posterior_chain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="Summary.from_result-689"><a href="#Summary.from_result-689"><span class="linenos">689</span></a>
</span><span id="Summary.from_result-690"><a href="#Summary.from_result-690"><span class="linenos">690</span></a>        <span class="c1"># get some general infos on the sampling</span>
</span><span id="Summary.from_result-691"><a href="#Summary.from_result-691"><span class="linenos">691</span></a>        <span class="n">param_chain</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">posterior_chain</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="Summary.from_result-692"><a href="#Summary.from_result-692"><span class="linenos">692</span></a>        <span class="n">sample_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Summary.from_result-693"><a href="#Summary.from_result-693"><span class="linenos">693</span></a>            <span class="s2">&quot;num_chains&quot;</span><span class="p">:</span> <span class="n">param_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Summary.from_result-694"><a href="#Summary.from_result-694"><span class="linenos">694</span></a>            <span class="s2">&quot;sample_size_per_chain&quot;</span><span class="p">:</span> <span class="n">param_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Summary.from_result-695"><a href="#Summary.from_result-695"><span class="linenos">695</span></a>        <span class="p">}</span>
</span><span id="Summary.from_result-696"><a href="#Summary.from_result-696"><span class="linenos">696</span></a>
</span><span id="Summary.from_result-697"><a href="#Summary.from_result-697"><span class="linenos">697</span></a>        <span class="c1">#  converte everything to numpy array</span>
</span><span id="Summary.from_result-698"><a href="#Summary.from_result-698"><span class="linenos">698</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">posterior_chain</span><span class="p">:</span>
</span><span id="Summary.from_result-699"><a href="#Summary.from_result-699"><span class="linenos">699</span></a>            <span class="n">posterior_chain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">posterior_chain</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="Summary.from_result-700"><a href="#Summary.from_result-700"><span class="linenos">700</span></a>
</span><span id="Summary.from_result-701"><a href="#Summary.from_result-701"><span class="linenos">701</span></a>        <span class="c1"># calculate quantiles either per chain and merge the results or all at once</span>
</span><span id="Summary.from_result-702"><a href="#Summary.from_result-702"><span class="linenos">702</span></a>        <span class="n">single_chain_summaries</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Summary.from_result-703"><a href="#Summary.from_result-703"><span class="linenos">703</span></a>        <span class="k">if</span> <span class="n">per_chain</span><span class="p">:</span>
</span><span id="Summary.from_result-704"><a href="#Summary.from_result-704"><span class="linenos">704</span></a>            <span class="k">for</span> <span class="n">chain_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sample_info</span><span class="p">[</span><span class="s2">&quot;num_chains&quot;</span><span class="p">]):</span>
</span><span id="Summary.from_result-705"><a href="#Summary.from_result-705"><span class="linenos">705</span></a>                <span class="n">single_chain</span> <span class="o">=</span> <span class="n">slice_leaves</span><span class="p">(</span>
</span><span id="Summary.from_result-706"><a href="#Summary.from_result-706"><span class="linenos">706</span></a>                    <span class="n">posterior_chain</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">chain_idx</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="Summary.from_result-707"><a href="#Summary.from_result-707"><span class="linenos">707</span></a>                <span class="p">)</span>
</span><span id="Summary.from_result-708"><a href="#Summary.from_result-708"><span class="linenos">708</span></a>                <span class="n">single_chain_summaries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Summary.from_result-709"><a href="#Summary.from_result-709"><span class="linenos">709</span></a>                    <span class="n">_create_quantity_dict</span><span class="p">(</span><span class="n">single_chain</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="p">)</span>
</span><span id="Summary.from_result-710"><a href="#Summary.from_result-710"><span class="linenos">710</span></a>                <span class="p">)</span>
</span><span id="Summary.from_result-711"><a href="#Summary.from_result-711"><span class="linenos">711</span></a>            <span class="n">quantities</span> <span class="o">=</span> <span class="n">stack_leaves</span><span class="p">(</span><span class="n">single_chain_summaries</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Summary.from_result-712"><a href="#Summary.from_result-712"><span class="linenos">712</span></a>            <span class="k">del</span> <span class="n">quantities</span><span class="p">[</span><span class="s2">&quot;rhat&quot;</span><span class="p">]</span>
</span><span id="Summary.from_result-713"><a href="#Summary.from_result-713"><span class="linenos">713</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Summary.from_result-714"><a href="#Summary.from_result-714"><span class="linenos">714</span></a>            <span class="n">quantities</span> <span class="o">=</span> <span class="n">_create_quantity_dict</span><span class="p">(</span><span class="n">posterior_chain</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">,</span> <span class="n">hdi_prob</span><span class="p">)</span>
</span><span id="Summary.from_result-715"><a href="#Summary.from_result-715"><span class="linenos">715</span></a>
</span><span id="Summary.from_result-716"><a href="#Summary.from_result-716"><span class="linenos">716</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Summary.from_result-717"><a href="#Summary.from_result-717"><span class="linenos">717</span></a>            <span class="s2">&quot;quantiles&quot;</span><span class="p">:</span> <span class="n">quantiles</span><span class="p">,</span>
</span><span id="Summary.from_result-718"><a href="#Summary.from_result-718"><span class="linenos">718</span></a>            <span class="s2">&quot;hdi_prob&quot;</span><span class="p">:</span> <span class="n">hdi_prob</span><span class="p">,</span>
</span><span id="Summary.from_result-719"><a href="#Summary.from_result-719"><span class="linenos">719</span></a>            <span class="s2">&quot;chains_merged&quot;</span><span class="p">:</span> <span class="ow">not</span> <span class="n">per_chain</span><span class="p">,</span>
</span><span id="Summary.from_result-720"><a href="#Summary.from_result-720"><span class="linenos">720</span></a>        <span class="p">}</span>
</span><span id="Summary.from_result-721"><a href="#Summary.from_result-721"><span class="linenos">721</span></a>
</span><span id="Summary.from_result-722"><a href="#Summary.from_result-722"><span class="linenos">722</span></a>        <span class="k">return</span> <span class="n">Summary</span><span class="p">(</span><span class="n">quantities</span><span class="o">=</span><span class="n">quantities</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">sample_info</span><span class="o">=</span><span class="n">sample_info</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a <code><a href="#Summary">Summary</a></code> object from a result object.</p>

<p>An optional <code>addition_chain</code> can be supplied to add more parameters to
the summary output. <code>additional_chain</code> must be a position chain which
maches chain and time dimention of the posterior chain as returned by
<code>result.get_posterior_sampels()</code>.</p>

<p>The arguments <code>selected</code> and <code>deselected</code> allow to get a summary only
from subset of the position keys.</p>

<p>When using <code>per_chain</code> the summary is calculated on a per chain basis.
Certain measures like rhat are not availavle if <code>per_chain</code> is true.</p>

<p>Experimental.</p>
</div>


                            </div>
                </section>
                <section id="plot_cor">
                            <input id="plot_cor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_cor</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">results</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SamplingResult</span>,</span><span class="param">	<span class="n">params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">param_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">max_lags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span>,</span><span class="param">	<span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Lag&#39;</span>,</span><span class="param">	<span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;whitegrid&#39;</span>,</span><span class="param">	<span class="n">color_palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ncol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">aspect_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">seaborn</span><span class="o">.</span><span class="n">axisgrid</span><span class="o">.</span><span class="n">FacetGrid</span>:</span></span>

                <label class="view-source-button" for="plot_cor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_cor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_cor-514"><a href="#plot_cor-514"><span class="linenos">514</span></a><span class="k">def</span> <span class="nf">plot_cor</span><span class="p">(</span>
</span><span id="plot_cor-515"><a href="#plot_cor-515"><span class="linenos">515</span></a>    <span class="n">results</span><span class="p">:</span> <span class="n">SamplingResult</span><span class="p">,</span>
</span><span id="plot_cor-516"><a href="#plot_cor-516"><span class="linenos">516</span></a>    <span class="n">params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_cor-517"><a href="#plot_cor-517"><span class="linenos">517</span></a>    <span class="n">param_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_cor-518"><a href="#plot_cor-518"><span class="linenos">518</span></a>    <span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_cor-519"><a href="#plot_cor-519"><span class="linenos">519</span></a>    <span class="n">max_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="plot_cor-520"><a href="#plot_cor-520"><span class="linenos">520</span></a>    <span class="n">max_lags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_cor-521"><a href="#plot_cor-521"><span class="linenos">521</span></a>    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_cor-522"><a href="#plot_cor-522"><span class="linenos">522</span></a>    <span class="n">title_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">,</span>
</span><span id="plot_cor-523"><a href="#plot_cor-523"><span class="linenos">523</span></a>    <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Lag&quot;</span><span class="p">,</span>
</span><span id="plot_cor-524"><a href="#plot_cor-524"><span class="linenos">524</span></a>    <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;whitegrid&quot;</span><span class="p">,</span>
</span><span id="plot_cor-525"><a href="#plot_cor-525"><span class="linenos">525</span></a>    <span class="n">color_palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_cor-526"><a href="#plot_cor-526"><span class="linenos">526</span></a>    <span class="n">ncol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="plot_cor-527"><a href="#plot_cor-527"><span class="linenos">527</span></a>    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="plot_cor-528"><a href="#plot_cor-528"><span class="linenos">528</span></a>    <span class="n">aspect_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="plot_cor-529"><a href="#plot_cor-529"><span class="linenos">529</span></a>    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_cor-530"><a href="#plot_cor-530"><span class="linenos">530</span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="plot_cor-531"><a href="#plot_cor-531"><span class="linenos">531</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">:</span>
</span><span id="plot_cor-532"><a href="#plot_cor-532"><span class="linenos">532</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_cor-533"><a href="#plot_cor-533"><span class="linenos">533</span></a><span class="sd">    Visualize autocorrelations of posterior samples.</span>
</span><span id="plot_cor-534"><a href="#plot_cor-534"><span class="linenos">534</span></a>
</span><span id="plot_cor-535"><a href="#plot_cor-535"><span class="linenos">535</span></a><span class="sd">    ## Parameters</span>
</span><span id="plot_cor-536"><a href="#plot_cor-536"><span class="linenos">536</span></a>
</span><span id="plot_cor-537"><a href="#plot_cor-537"><span class="linenos">537</span></a><span class="sd">    - `results`:</span>
</span><span id="plot_cor-538"><a href="#plot_cor-538"><span class="linenos">538</span></a><span class="sd">      Result object of the sampling process. Must have a method</span>
</span><span id="plot_cor-539"><a href="#plot_cor-539"><span class="linenos">539</span></a><span class="sd">      `get_posterior_samples()` which extracts all samples from the posterior</span>
</span><span id="plot_cor-540"><a href="#plot_cor-540"><span class="linenos">540</span></a><span class="sd">      distribution.</span>
</span><span id="plot_cor-541"><a href="#plot_cor-541"><span class="linenos">541</span></a>
</span><span id="plot_cor-542"><a href="#plot_cor-542"><span class="linenos">542</span></a><span class="sd">    - `params`:</span>
</span><span id="plot_cor-543"><a href="#plot_cor-543"><span class="linenos">543</span></a><span class="sd">      Names of the model parameters that are contained in the plot. Must coincide with</span>
</span><span id="plot_cor-544"><a href="#plot_cor-544"><span class="linenos">544</span></a><span class="sd">      the dictionary keys of the `Position` with the posterior samples. If `None`,</span>
</span><span id="plot_cor-545"><a href="#plot_cor-545"><span class="linenos">545</span></a><span class="sd">      all parameters are included.</span>
</span><span id="plot_cor-546"><a href="#plot_cor-546"><span class="linenos">546</span></a>
</span><span id="plot_cor-547"><a href="#plot_cor-547"><span class="linenos">547</span></a><span class="sd">    - `param_indices`:</span>
</span><span id="plot_cor-548"><a href="#plot_cor-548"><span class="linenos">548</span></a><span class="sd">      Indices of each model parameter that are contained in the plot. Selects e.g.</span>
</span><span id="plot_cor-549"><a href="#plot_cor-549"><span class="linenos">549</span></a><span class="sd">      `beta_0` out of a `beta` parameter vector.A single index can be specified as an</span>
</span><span id="plot_cor-550"><a href="#plot_cor-550"><span class="linenos">550</span></a><span class="sd">      integer or a sequence containing one integer. If `None`, all subparameters are</span>
</span><span id="plot_cor-551"><a href="#plot_cor-551"><span class="linenos">551</span></a><span class="sd">      included.</span>
</span><span id="plot_cor-552"><a href="#plot_cor-552"><span class="linenos">552</span></a>
</span><span id="plot_cor-553"><a href="#plot_cor-553"><span class="linenos">553</span></a><span class="sd">    - `chain_indices`:</span>
</span><span id="plot_cor-554"><a href="#plot_cor-554"><span class="linenos">554</span></a><span class="sd">      Indices of chains for each model subparameter that are contained in the plot.</span>
</span><span id="plot_cor-555"><a href="#plot_cor-555"><span class="linenos">555</span></a><span class="sd">      Selects e.g. chain 0 and chain 2 out of multiple chains. A single index can be</span>
</span><span id="plot_cor-556"><a href="#plot_cor-556"><span class="linenos">556</span></a><span class="sd">      specified as an integer or a sequence containing one integer. If `None`, all</span>
</span><span id="plot_cor-557"><a href="#plot_cor-557"><span class="linenos">557</span></a><span class="sd">      chains are included.</span>
</span><span id="plot_cor-558"><a href="#plot_cor-558"><span class="linenos">558</span></a>
</span><span id="plot_cor-559"><a href="#plot_cor-559"><span class="linenos">559</span></a><span class="sd">    - `max_chains`:</span>
</span><span id="plot_cor-560"><a href="#plot_cor-560"><span class="linenos">560</span></a><span class="sd">      Upper bound how many chains are included within each subplot/facet. Avoids</span>
</span><span id="plot_cor-561"><a href="#plot_cor-561"><span class="linenos">561</span></a><span class="sd">      overplotting. If `None`, all chains contained in the `results` input are plotted.</span>
</span><span id="plot_cor-562"><a href="#plot_cor-562"><span class="linenos">562</span></a><span class="sd">      Always starts chain selection from the lowest chain index upwards. For selecting</span>
</span><span id="plot_cor-563"><a href="#plot_cor-563"><span class="linenos">563</span></a><span class="sd">      specific chains use the argument `chain_indices`.</span>
</span><span id="plot_cor-564"><a href="#plot_cor-564"><span class="linenos">564</span></a>
</span><span id="plot_cor-565"><a href="#plot_cor-565"><span class="linenos">565</span></a><span class="sd">    - `max_lags`:</span>
</span><span id="plot_cor-566"><a href="#plot_cor-566"><span class="linenos">566</span></a><span class="sd">      Maximum number of time lags shown on the x-axis of the autocorrelation plot. If</span>
</span><span id="plot_cor-567"><a href="#plot_cor-567"><span class="linenos">567</span></a><span class="sd">      `None`, the minimum of the chain lengths and 30 is chosen.</span>
</span><span id="plot_cor-568"><a href="#plot_cor-568"><span class="linenos">568</span></a>
</span><span id="plot_cor-569"><a href="#plot_cor-569"><span class="linenos">569</span></a><span class="sd">    - `title`:</span>
</span><span id="plot_cor-570"><a href="#plot_cor-570"><span class="linenos">570</span></a><span class="sd">      Plot title.</span>
</span><span id="plot_cor-571"><a href="#plot_cor-571"><span class="linenos">571</span></a>
</span><span id="plot_cor-572"><a href="#plot_cor-572"><span class="linenos">572</span></a><span class="sd">    - `title_spacing`:</span>
</span><span id="plot_cor-573"><a href="#plot_cor-573"><span class="linenos">573</span></a><span class="sd">      Determines the margin/whitespace between the plot title (set with</span>
</span><span id="plot_cor-574"><a href="#plot_cor-574"><span class="linenos">574</span></a><span class="sd">      `fig.suptitle()`) and the first row of subplots/facets. Passed to the `top`</span>
</span><span id="plot_cor-575"><a href="#plot_cor-575"><span class="linenos">575</span></a><span class="sd">      argument of `fig.subplots_adjust()`.</span>
</span><span id="plot_cor-576"><a href="#plot_cor-576"><span class="linenos">576</span></a>
</span><span id="plot_cor-577"><a href="#plot_cor-577"><span class="linenos">577</span></a><span class="sd">    - `xlabel`:</span>
</span><span id="plot_cor-578"><a href="#plot_cor-578"><span class="linenos">578</span></a><span class="sd">      Label of the x-axis.</span>
</span><span id="plot_cor-579"><a href="#plot_cor-579"><span class="linenos">579</span></a>
</span><span id="plot_cor-580"><a href="#plot_cor-580"><span class="linenos">580</span></a><span class="sd">    - `style`:</span>
</span><span id="plot_cor-581"><a href="#plot_cor-581"><span class="linenos">581</span></a><span class="sd">      Passed to the `style` argument of `sns.set_theme()`. Valid options are `darkgrid`,</span>
</span><span id="plot_cor-582"><a href="#plot_cor-582"><span class="linenos">582</span></a><span class="sd">      `whitegrid`, `dark`, `white`, and `ticks`.</span>
</span><span id="plot_cor-583"><a href="#plot_cor-583"><span class="linenos">583</span></a>
</span><span id="plot_cor-584"><a href="#plot_cor-584"><span class="linenos">584</span></a><span class="sd">    - `color_palette`:</span>
</span><span id="plot_cor-585"><a href="#plot_cor-585"><span class="linenos">585</span></a><span class="sd">      Passed to the palette argument of `sns.FacetGrid()`. String values must be valid</span>
</span><span id="plot_cor-586"><a href="#plot_cor-586"><span class="linenos">586</span></a><span class="sd">      inputs of `sns.color_palette()` such as a seaborn color palette or a matplotlib</span>
</span><span id="plot_cor-587"><a href="#plot_cor-587"><span class="linenos">587</span></a><span class="sd">      colormap. Custom colors can be set with a list of color strings or a dictionary</span>
</span><span id="plot_cor-588"><a href="#plot_cor-588"><span class="linenos">588</span></a><span class="sd">      with the chain indices as keys and color strings as values. The number of color</span>
</span><span id="plot_cor-589"><a href="#plot_cor-589"><span class="linenos">589</span></a><span class="sd">      strings must coincide with the number of plotted chains. If `None`, the default</span>
</span><span id="plot_cor-590"><a href="#plot_cor-590"><span class="linenos">590</span></a><span class="sd">      `tab10` matplotlib colormap is chosen.</span>
</span><span id="plot_cor-591"><a href="#plot_cor-591"><span class="linenos">591</span></a>
</span><span id="plot_cor-592"><a href="#plot_cor-592"><span class="linenos">592</span></a><span class="sd">    - `ncol`:</span>
</span><span id="plot_cor-593"><a href="#plot_cor-593"><span class="linenos">593</span></a><span class="sd">      Number of subplots/facets within each row of the grid.</span>
</span><span id="plot_cor-594"><a href="#plot_cor-594"><span class="linenos">594</span></a>
</span><span id="plot_cor-595"><a href="#plot_cor-595"><span class="linenos">595</span></a><span class="sd">    - `height`:</span>
</span><span id="plot_cor-596"><a href="#plot_cor-596"><span class="linenos">596</span></a><span class="sd">      Height in inches of each subplot/facet within the grid.</span>
</span><span id="plot_cor-597"><a href="#plot_cor-597"><span class="linenos">597</span></a>
</span><span id="plot_cor-598"><a href="#plot_cor-598"><span class="linenos">598</span></a><span class="sd">    - `aspect_ratio`:</span>
</span><span id="plot_cor-599"><a href="#plot_cor-599"><span class="linenos">599</span></a><span class="sd">      Ratio of width / height of each subplot/facet within the grid,</span>
</span><span id="plot_cor-600"><a href="#plot_cor-600"><span class="linenos">600</span></a><span class="sd">      i.e. `width = aspect_ratio * height`.</span>
</span><span id="plot_cor-601"><a href="#plot_cor-601"><span class="linenos">601</span></a>
</span><span id="plot_cor-602"><a href="#plot_cor-602"><span class="linenos">602</span></a><span class="sd">    - `save_path`:</span>
</span><span id="plot_cor-603"><a href="#plot_cor-603"><span class="linenos">603</span></a><span class="sd">      File path where the plot is saved.</span>
</span><span id="plot_cor-604"><a href="#plot_cor-604"><span class="linenos">604</span></a>
</span><span id="plot_cor-605"><a href="#plot_cor-605"><span class="linenos">605</span></a><span class="sd">    - `**kwargs`:</span>
</span><span id="plot_cor-606"><a href="#plot_cor-606"><span class="linenos">606</span></a><span class="sd">      Further keyword arguments passed to the seaborn `FacetGrid()` function.</span>
</span><span id="plot_cor-607"><a href="#plot_cor-607"><span class="linenos">607</span></a>
</span><span id="plot_cor-608"><a href="#plot_cor-608"><span class="linenos">608</span></a><span class="sd">    ## Returns</span>
</span><span id="plot_cor-609"><a href="#plot_cor-609"><span class="linenos">609</span></a>
</span><span id="plot_cor-610"><a href="#plot_cor-610"><span class="linenos">610</span></a><span class="sd">    A seaborn `FacetGrid`.</span>
</span><span id="plot_cor-611"><a href="#plot_cor-611"><span class="linenos">611</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_cor-612"><a href="#plot_cor-612"><span class="linenos">612</span></a>
</span><span id="plot_cor-613"><a href="#plot_cor-613"><span class="linenos">613</span></a>    <span class="c1"># NOTE: Docstring duplications</span>
</span><span id="plot_cor-614"><a href="#plot_cor-614"><span class="linenos">614</span></a>    <span class="c1"># The entries `results` to `max_chains` are shared with the `summary()`</span>
</span><span id="plot_cor-615"><a href="#plot_cor-615"><span class="linenos">615</span></a>    <span class="c1"># and all user plotting functions.</span>
</span><span id="plot_cor-616"><a href="#plot_cor-616"><span class="linenos">616</span></a>    <span class="c1"># The entries `title` to `save_path` are shared with `plot_trace()`,</span>
</span><span id="plot_cor-617"><a href="#plot_cor-617"><span class="linenos">617</span></a>    <span class="c1"># `plot_density()` and partially with `plot_param()`.</span>
</span><span id="plot_cor-618"><a href="#plot_cor-618"><span class="linenos">618</span></a>    <span class="c1"># The entry `max_lags` is shared with `plot_param()`.</span>
</span><span id="plot_cor-619"><a href="#plot_cor-619"><span class="linenos">619</span></a>
</span><span id="plot_cor-620"><a href="#plot_cor-620"><span class="linenos">620</span></a>    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
</span><span id="plot_cor-621"><a href="#plot_cor-621"><span class="linenos">621</span></a>    <span class="n">plot_df</span> <span class="o">=</span> <span class="n">setup_plot_df</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_indices</span><span class="p">,</span> <span class="n">chain_indices</span><span class="p">,</span> <span class="n">max_chains</span><span class="p">)</span>
</span><span id="plot_cor-622"><a href="#plot_cor-622"><span class="linenos">622</span></a>    <span class="n">max_lags</span> <span class="o">=</span> <span class="n">compute_max_lags</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">max_lags</span><span class="p">)</span>
</span><span id="plot_cor-623"><a href="#plot_cor-623"><span class="linenos">623</span></a>
</span><span id="plot_cor-624"><a href="#plot_cor-624"><span class="linenos">624</span></a>    <span class="k">def</span> <span class="nf">do_acor_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">maxlags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="plot_cor-625"><a href="#plot_cor-625"><span class="linenos">625</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="plot_cor-626"><a href="#plot_cor-626"><span class="linenos">626</span></a>        <span class="n">acor</span> <span class="o">=</span> <span class="n">arviz</span><span class="o">.</span><span class="n">autocorr</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">maxlags</span><span class="p">]</span>
</span><span id="plot_cor-627"><a href="#plot_cor-627"><span class="linenos">627</span></a>        <span class="k">return</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">maxlags</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">acor</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="plot_cor-628"><a href="#plot_cor-628"><span class="linenos">628</span></a>
</span><span id="plot_cor-629"><a href="#plot_cor-629"><span class="linenos">629</span></a>    <span class="n">g</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="plot_cor-630"><a href="#plot_cor-630"><span class="linenos">630</span></a>        <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span>
</span><span id="plot_cor-631"><a href="#plot_cor-631"><span class="linenos">631</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">plot_df</span><span class="p">,</span>
</span><span id="plot_cor-632"><a href="#plot_cor-632"><span class="linenos">632</span></a>            <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;chain_index&quot;</span><span class="p">,</span>
</span><span id="plot_cor-633"><a href="#plot_cor-633"><span class="linenos">633</span></a>            <span class="n">col</span><span class="o">=</span><span class="s2">&quot;param&quot;</span><span class="p">,</span>
</span><span id="plot_cor-634"><a href="#plot_cor-634"><span class="linenos">634</span></a>            <span class="n">col_wrap</span><span class="o">=</span><span class="n">set_plot_cols</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">ncol</span><span class="p">),</span>
</span><span id="plot_cor-635"><a href="#plot_cor-635"><span class="linenos">635</span></a>            <span class="n">palette</span><span class="o">=</span><span class="n">color_palette</span><span class="p">,</span>
</span><span id="plot_cor-636"><a href="#plot_cor-636"><span class="linenos">636</span></a>            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
</span><span id="plot_cor-637"><a href="#plot_cor-637"><span class="linenos">637</span></a>            <span class="n">aspect</span><span class="o">=</span><span class="n">aspect_ratio</span><span class="p">,</span>
</span><span id="plot_cor-638"><a href="#plot_cor-638"><span class="linenos">638</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="plot_cor-639"><a href="#plot_cor-639"><span class="linenos">639</span></a>        <span class="p">)</span>
</span><span id="plot_cor-640"><a href="#plot_cor-640"><span class="linenos">640</span></a>        <span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="plot_cor-641"><a href="#plot_cor-641"><span class="linenos">641</span></a>            <span class="n">do_acor_plot</span><span class="p">,</span>
</span><span id="plot_cor-642"><a href="#plot_cor-642"><span class="linenos">642</span></a>            <span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span id="plot_cor-643"><a href="#plot_cor-643"><span class="linenos">643</span></a>            <span class="n">maxlags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span>
</span><span id="plot_cor-644"><a href="#plot_cor-644"><span class="linenos">644</span></a>        <span class="p">)</span>
</span><span id="plot_cor-645"><a href="#plot_cor-645"><span class="linenos">645</span></a>        <span class="o">.</span><span class="n">set</span><span class="p">(</span>
</span><span id="plot_cor-646"><a href="#plot_cor-646"><span class="linenos">646</span></a>            <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_lags</span><span class="p">),</span>
</span><span id="plot_cor-647"><a href="#plot_cor-647"><span class="linenos">647</span></a>            <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
</span><span id="plot_cor-648"><a href="#plot_cor-648"><span class="linenos">648</span></a>        <span class="p">)</span>
</span><span id="plot_cor-649"><a href="#plot_cor-649"><span class="linenos">649</span></a>        <span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
</span><span id="plot_cor-650"><a href="#plot_cor-650"><span class="linenos">650</span></a>    <span class="p">)</span>
</span><span id="plot_cor-651"><a href="#plot_cor-651"><span class="linenos">651</span></a>
</span><span id="plot_cor-652"><a href="#plot_cor-652"><span class="linenos">652</span></a>    <span class="n">g</span> <span class="o">=</span> <span class="n">set_aesthetics</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">title_spacing</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Autocorrelation&quot;</span><span class="p">)</span>
</span><span id="plot_cor-653"><a href="#plot_cor-653"><span class="linenos">653</span></a>
</span><span id="plot_cor-654"><a href="#plot_cor-654"><span class="linenos">654</span></a>    <span class="n">save_figure</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
</span><span id="plot_cor-655"><a href="#plot_cor-655"><span class="linenos">655</span></a>    <span class="k">return</span> <span class="n">g</span>
</span></pre></div>


            <div class="docstring"><p>Visualize autocorrelations of posterior samples.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><p><code>results</code>:
Result object of the sampling process. Must have a method
<code>get_posterior_samples()</code> which extracts all samples from the posterior
distribution.</p></li>
<li><p><code>params</code>:
Names of the model parameters that are contained in the plot. Must coincide with
the dictionary keys of the <code><a href="#Position">Position</a></code> with the posterior samples. If <code>None</code>,
all parameters are included.</p></li>
<li><p><code>param_indices</code>:
Indices of each model parameter that are contained in the plot. Selects e.g.
<code>beta_0</code> out of a <code>beta</code> parameter vector.A single index can be specified as an
integer or a sequence containing one integer. If <code>None</code>, all subparameters are
included.</p></li>
<li><p><code>chain_indices</code>:
Indices of chains for each model subparameter that are contained in the plot.
Selects e.g. chain 0 and chain 2 out of multiple chains. A single index can be
specified as an integer or a sequence containing one integer. If <code>None</code>, all
chains are included.</p></li>
<li><p><code>max_chains</code>:
Upper bound how many chains are included within each subplot/facet. Avoids
overplotting. If <code>None</code>, all chains contained in the <code>results</code> input are plotted.
Always starts chain selection from the lowest chain index upwards. For selecting
specific chains use the argument <code>chain_indices</code>.</p></li>
<li><p><code>max_lags</code>:
Maximum number of time lags shown on the x-axis of the autocorrelation plot. If
<code>None</code>, the minimum of the chain lengths and 30 is chosen.</p></li>
<li><p><code>title</code>:
Plot title.</p></li>
<li><p><code>title_spacing</code>:
Determines the margin/whitespace between the plot title (set with
<code>fig.suptitle()</code>) and the first row of subplots/facets. Passed to the <code>top</code>
argument of <code>fig.subplots_adjust()</code>.</p></li>
<li><p><code>xlabel</code>:
Label of the x-axis.</p></li>
<li><p><code>style</code>:
Passed to the <code>style</code> argument of <code>sns.set_theme()</code>. Valid options are <code>darkgrid</code>,
<code>whitegrid</code>, <code>dark</code>, <code>white</code>, and <code>ticks</code>.</p></li>
<li><p><code>color_palette</code>:
Passed to the palette argument of <code>sns.FacetGrid()</code>. String values must be valid
inputs of <code>sns.color_palette()</code> such as a seaborn color palette or a matplotlib
colormap. Custom colors can be set with a list of color strings or a dictionary
with the chain indices as keys and color strings as values. The number of color
strings must coincide with the number of plotted chains. If <code>None</code>, the default
<code>tab10</code> matplotlib colormap is chosen.</p></li>
<li><p><code>ncol</code>:
Number of subplots/facets within each row of the grid.</p></li>
<li><p><code>height</code>:
Height in inches of each subplot/facet within the grid.</p></li>
<li><p><code>aspect_ratio</code>:
Ratio of width / height of each subplot/facet within the grid,
i.e. <code>width = aspect_ratio * height</code>.</p></li>
<li><p><code>save_path</code>:
File path where the plot is saved.</p></li>
<li><p><code>**kwargs</code>:
Further keyword arguments passed to the seaborn <code>FacetGrid()</code> function.</p></li>
</ul>

<h2 id="returns">Returns</h2>

<p>A seaborn <code>FacetGrid</code>.</p>
</div>


                </section>
                <section id="plot_density">
                            <input id="plot_density-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_density</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">results</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SamplingResult</span>,</span><span class="param">	<span class="n">params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">param_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span>,</span><span class="param">	<span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Value&#39;</span>,</span><span class="param">	<span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;whitegrid&#39;</span>,</span><span class="param">	<span class="n">color_palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ncol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">aspect_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">seaborn</span><span class="o">.</span><span class="n">axisgrid</span><span class="o">.</span><span class="n">FacetGrid</span>:</span></span>

                <label class="view-source-button" for="plot_density-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_density"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_density-376"><a href="#plot_density-376"><span class="linenos">376</span></a><span class="k">def</span> <span class="nf">plot_density</span><span class="p">(</span>
</span><span id="plot_density-377"><a href="#plot_density-377"><span class="linenos">377</span></a>    <span class="n">results</span><span class="p">:</span> <span class="n">SamplingResult</span><span class="p">,</span>
</span><span id="plot_density-378"><a href="#plot_density-378"><span class="linenos">378</span></a>    <span class="n">params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_density-379"><a href="#plot_density-379"><span class="linenos">379</span></a>    <span class="n">param_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_density-380"><a href="#plot_density-380"><span class="linenos">380</span></a>    <span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_density-381"><a href="#plot_density-381"><span class="linenos">381</span></a>    <span class="n">max_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="plot_density-382"><a href="#plot_density-382"><span class="linenos">382</span></a>    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_density-383"><a href="#plot_density-383"><span class="linenos">383</span></a>    <span class="n">title_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">,</span>
</span><span id="plot_density-384"><a href="#plot_density-384"><span class="linenos">384</span></a>    <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span>
</span><span id="plot_density-385"><a href="#plot_density-385"><span class="linenos">385</span></a>    <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;whitegrid&quot;</span><span class="p">,</span>
</span><span id="plot_density-386"><a href="#plot_density-386"><span class="linenos">386</span></a>    <span class="n">color_palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_density-387"><a href="#plot_density-387"><span class="linenos">387</span></a>    <span class="n">ncol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="plot_density-388"><a href="#plot_density-388"><span class="linenos">388</span></a>    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="plot_density-389"><a href="#plot_density-389"><span class="linenos">389</span></a>    <span class="n">aspect_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="plot_density-390"><a href="#plot_density-390"><span class="linenos">390</span></a>    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_density-391"><a href="#plot_density-391"><span class="linenos">391</span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="plot_density-392"><a href="#plot_density-392"><span class="linenos">392</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">:</span>
</span><span id="plot_density-393"><a href="#plot_density-393"><span class="linenos">393</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_density-394"><a href="#plot_density-394"><span class="linenos">394</span></a><span class="sd">    Visualize posterior distributions with a density plot.</span>
</span><span id="plot_density-395"><a href="#plot_density-395"><span class="linenos">395</span></a>
</span><span id="plot_density-396"><a href="#plot_density-396"><span class="linenos">396</span></a><span class="sd">    ## Parameters</span>
</span><span id="plot_density-397"><a href="#plot_density-397"><span class="linenos">397</span></a>
</span><span id="plot_density-398"><a href="#plot_density-398"><span class="linenos">398</span></a><span class="sd">    - `results`:</span>
</span><span id="plot_density-399"><a href="#plot_density-399"><span class="linenos">399</span></a><span class="sd">      Result object of the sampling process. Must have a method</span>
</span><span id="plot_density-400"><a href="#plot_density-400"><span class="linenos">400</span></a><span class="sd">      `get_posterior_samples()` which extracts all samples from the posterior</span>
</span><span id="plot_density-401"><a href="#plot_density-401"><span class="linenos">401</span></a><span class="sd">      distribution.</span>
</span><span id="plot_density-402"><a href="#plot_density-402"><span class="linenos">402</span></a>
</span><span id="plot_density-403"><a href="#plot_density-403"><span class="linenos">403</span></a><span class="sd">    - `params`:</span>
</span><span id="plot_density-404"><a href="#plot_density-404"><span class="linenos">404</span></a><span class="sd">      Names of the model parameters that are contained in the plot. Must coincide with</span>
</span><span id="plot_density-405"><a href="#plot_density-405"><span class="linenos">405</span></a><span class="sd">      the dictionary keys of the `Position` with the posterior samples. If `None`,</span>
</span><span id="plot_density-406"><a href="#plot_density-406"><span class="linenos">406</span></a><span class="sd">      all parameters are included.</span>
</span><span id="plot_density-407"><a href="#plot_density-407"><span class="linenos">407</span></a>
</span><span id="plot_density-408"><a href="#plot_density-408"><span class="linenos">408</span></a><span class="sd">    - `param_indices`:</span>
</span><span id="plot_density-409"><a href="#plot_density-409"><span class="linenos">409</span></a><span class="sd">      Indices of each model parameter that are contained in the plot. Selects e.g.</span>
</span><span id="plot_density-410"><a href="#plot_density-410"><span class="linenos">410</span></a><span class="sd">      `beta_0` out of a `beta` parameter vector.A single index can be specified as an</span>
</span><span id="plot_density-411"><a href="#plot_density-411"><span class="linenos">411</span></a><span class="sd">      integer or a sequence containing one integer. If `None`, all subparameters are</span>
</span><span id="plot_density-412"><a href="#plot_density-412"><span class="linenos">412</span></a><span class="sd">      included.</span>
</span><span id="plot_density-413"><a href="#plot_density-413"><span class="linenos">413</span></a>
</span><span id="plot_density-414"><a href="#plot_density-414"><span class="linenos">414</span></a><span class="sd">    - `chain_indices`:</span>
</span><span id="plot_density-415"><a href="#plot_density-415"><span class="linenos">415</span></a><span class="sd">      Indices of chains for each model subparameter that are contained in the plot.</span>
</span><span id="plot_density-416"><a href="#plot_density-416"><span class="linenos">416</span></a><span class="sd">      Selects e.g. chain 0 and chain 2 out of multiple chains. A single index can be</span>
</span><span id="plot_density-417"><a href="#plot_density-417"><span class="linenos">417</span></a><span class="sd">      specified as an integer or a sequence containing one integer. If `None`, all</span>
</span><span id="plot_density-418"><a href="#plot_density-418"><span class="linenos">418</span></a><span class="sd">      chains are included.</span>
</span><span id="plot_density-419"><a href="#plot_density-419"><span class="linenos">419</span></a>
</span><span id="plot_density-420"><a href="#plot_density-420"><span class="linenos">420</span></a><span class="sd">    - `max_chains`:</span>
</span><span id="plot_density-421"><a href="#plot_density-421"><span class="linenos">421</span></a><span class="sd">      Upper bound how many chains are included within each subplot/facet. Avoids</span>
</span><span id="plot_density-422"><a href="#plot_density-422"><span class="linenos">422</span></a><span class="sd">      overplotting. If `None`, all chains contained in the `results` input are plotted.</span>
</span><span id="plot_density-423"><a href="#plot_density-423"><span class="linenos">423</span></a><span class="sd">      Always starts chain selection from the lowest chain index upwards. For selecting</span>
</span><span id="plot_density-424"><a href="#plot_density-424"><span class="linenos">424</span></a><span class="sd">      specific chains use the argument `chain_indices`.</span>
</span><span id="plot_density-425"><a href="#plot_density-425"><span class="linenos">425</span></a>
</span><span id="plot_density-426"><a href="#plot_density-426"><span class="linenos">426</span></a><span class="sd">    - `title`:</span>
</span><span id="plot_density-427"><a href="#plot_density-427"><span class="linenos">427</span></a><span class="sd">      Plot title.</span>
</span><span id="plot_density-428"><a href="#plot_density-428"><span class="linenos">428</span></a>
</span><span id="plot_density-429"><a href="#plot_density-429"><span class="linenos">429</span></a><span class="sd">    - `title_spacing`:</span>
</span><span id="plot_density-430"><a href="#plot_density-430"><span class="linenos">430</span></a><span class="sd">      Determines the margin/whitespace between the plot title (set with</span>
</span><span id="plot_density-431"><a href="#plot_density-431"><span class="linenos">431</span></a><span class="sd">      `fig.suptitle()`) and the first row of subplots/facets. Passed to the `top`</span>
</span><span id="plot_density-432"><a href="#plot_density-432"><span class="linenos">432</span></a><span class="sd">      argument of `fig.subplots_adjust()`.</span>
</span><span id="plot_density-433"><a href="#plot_density-433"><span class="linenos">433</span></a>
</span><span id="plot_density-434"><a href="#plot_density-434"><span class="linenos">434</span></a><span class="sd">    - `xlabel`:</span>
</span><span id="plot_density-435"><a href="#plot_density-435"><span class="linenos">435</span></a><span class="sd">      Label of the x-axis.</span>
</span><span id="plot_density-436"><a href="#plot_density-436"><span class="linenos">436</span></a>
</span><span id="plot_density-437"><a href="#plot_density-437"><span class="linenos">437</span></a><span class="sd">    - `style`:</span>
</span><span id="plot_density-438"><a href="#plot_density-438"><span class="linenos">438</span></a><span class="sd">      Passed to the `style` argument of `sns.set_theme()`. Valid options are `darkgrid`,</span>
</span><span id="plot_density-439"><a href="#plot_density-439"><span class="linenos">439</span></a><span class="sd">      `whitegrid`, `dark`, `white`, and `ticks`.</span>
</span><span id="plot_density-440"><a href="#plot_density-440"><span class="linenos">440</span></a>
</span><span id="plot_density-441"><a href="#plot_density-441"><span class="linenos">441</span></a><span class="sd">    - `color_palette`:</span>
</span><span id="plot_density-442"><a href="#plot_density-442"><span class="linenos">442</span></a><span class="sd">      Passed to the palette argument of `sns.displot()`. String values must be valid</span>
</span><span id="plot_density-443"><a href="#plot_density-443"><span class="linenos">443</span></a><span class="sd">      inputs of `sns.color_palette()` such as a seaborn color palette or a matplotlib</span>
</span><span id="plot_density-444"><a href="#plot_density-444"><span class="linenos">444</span></a><span class="sd">      colormap. Custom colors can be set with a list of color strings or a dictionary</span>
</span><span id="plot_density-445"><a href="#plot_density-445"><span class="linenos">445</span></a><span class="sd">      with the chain indices as keys and color strings as values. The number of color</span>
</span><span id="plot_density-446"><a href="#plot_density-446"><span class="linenos">446</span></a><span class="sd">      strings must coincide with the number of plotted chains. If `None`, the default</span>
</span><span id="plot_density-447"><a href="#plot_density-447"><span class="linenos">447</span></a><span class="sd">      `tab10` matplotlib colormap is chosen.</span>
</span><span id="plot_density-448"><a href="#plot_density-448"><span class="linenos">448</span></a>
</span><span id="plot_density-449"><a href="#plot_density-449"><span class="linenos">449</span></a><span class="sd">    - `ncol`:</span>
</span><span id="plot_density-450"><a href="#plot_density-450"><span class="linenos">450</span></a><span class="sd">      Number of subplots/facets within each row of the grid.</span>
</span><span id="plot_density-451"><a href="#plot_density-451"><span class="linenos">451</span></a>
</span><span id="plot_density-452"><a href="#plot_density-452"><span class="linenos">452</span></a><span class="sd">    - `height`:</span>
</span><span id="plot_density-453"><a href="#plot_density-453"><span class="linenos">453</span></a><span class="sd">      Height in inches of each subplot/facet within the grid.</span>
</span><span id="plot_density-454"><a href="#plot_density-454"><span class="linenos">454</span></a>
</span><span id="plot_density-455"><a href="#plot_density-455"><span class="linenos">455</span></a><span class="sd">    - `aspect_ratio`:</span>
</span><span id="plot_density-456"><a href="#plot_density-456"><span class="linenos">456</span></a><span class="sd">      Ratio of width / height of each subplot/facet within the grid,</span>
</span><span id="plot_density-457"><a href="#plot_density-457"><span class="linenos">457</span></a><span class="sd">      i.e. `width = aspect_ratio * height`.</span>
</span><span id="plot_density-458"><a href="#plot_density-458"><span class="linenos">458</span></a>
</span><span id="plot_density-459"><a href="#plot_density-459"><span class="linenos">459</span></a><span class="sd">    - `save_path`:</span>
</span><span id="plot_density-460"><a href="#plot_density-460"><span class="linenos">460</span></a><span class="sd">      File path where the plot is saved.</span>
</span><span id="plot_density-461"><a href="#plot_density-461"><span class="linenos">461</span></a>
</span><span id="plot_density-462"><a href="#plot_density-462"><span class="linenos">462</span></a><span class="sd">    - `**kwargs`:</span>
</span><span id="plot_density-463"><a href="#plot_density-463"><span class="linenos">463</span></a><span class="sd">      Further keyword arguments passed to the seaborn `displot()` function.</span>
</span><span id="plot_density-464"><a href="#plot_density-464"><span class="linenos">464</span></a>
</span><span id="plot_density-465"><a href="#plot_density-465"><span class="linenos">465</span></a><span class="sd">    ## Returns</span>
</span><span id="plot_density-466"><a href="#plot_density-466"><span class="linenos">466</span></a>
</span><span id="plot_density-467"><a href="#plot_density-467"><span class="linenos">467</span></a><span class="sd">    A seaborn `FacetGrid`.</span>
</span><span id="plot_density-468"><a href="#plot_density-468"><span class="linenos">468</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_density-469"><a href="#plot_density-469"><span class="linenos">469</span></a>
</span><span id="plot_density-470"><a href="#plot_density-470"><span class="linenos">470</span></a>    <span class="c1"># NOTE: Docstring duplications</span>
</span><span id="plot_density-471"><a href="#plot_density-471"><span class="linenos">471</span></a>    <span class="c1"># The entries `results` to `max_chains` are shared with the `summary()`</span>
</span><span id="plot_density-472"><a href="#plot_density-472"><span class="linenos">472</span></a>    <span class="c1"># and all user plotting functions.</span>
</span><span id="plot_density-473"><a href="#plot_density-473"><span class="linenos">473</span></a>    <span class="c1"># The entries `title` to `save_path` are shared with `plot_trace()`, `plot_cor()`</span>
</span><span id="plot_density-474"><a href="#plot_density-474"><span class="linenos">474</span></a>    <span class="c1"># and partially with `plot_param()`.</span>
</span><span id="plot_density-475"><a href="#plot_density-475"><span class="linenos">475</span></a>
</span><span id="plot_density-476"><a href="#plot_density-476"><span class="linenos">476</span></a>    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
</span><span id="plot_density-477"><a href="#plot_density-477"><span class="linenos">477</span></a>    <span class="n">plot_df</span> <span class="o">=</span> <span class="n">setup_plot_df</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_indices</span><span class="p">,</span> <span class="n">chain_indices</span><span class="p">,</span> <span class="n">max_chains</span><span class="p">)</span>
</span><span id="plot_density-478"><a href="#plot_density-478"><span class="linenos">478</span></a>
</span><span id="plot_density-479"><a href="#plot_density-479"><span class="linenos">479</span></a>    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span>
</span><span id="plot_density-480"><a href="#plot_density-480"><span class="linenos">480</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">plot_df</span><span class="p">,</span>
</span><span id="plot_density-481"><a href="#plot_density-481"><span class="linenos">481</span></a>        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span><span class="p">,</span>
</span><span id="plot_density-482"><a href="#plot_density-482"><span class="linenos">482</span></a>        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span id="plot_density-483"><a href="#plot_density-483"><span class="linenos">483</span></a>        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="plot_density-484"><a href="#plot_density-484"><span class="linenos">484</span></a>        <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;chain_index&quot;</span><span class="p">,</span>
</span><span id="plot_density-485"><a href="#plot_density-485"><span class="linenos">485</span></a>        <span class="n">col</span><span class="o">=</span><span class="s2">&quot;param&quot;</span><span class="p">,</span>
</span><span id="plot_density-486"><a href="#plot_density-486"><span class="linenos">486</span></a>        <span class="n">col_wrap</span><span class="o">=</span><span class="n">set_plot_cols</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">ncol</span><span class="p">),</span>
</span><span id="plot_density-487"><a href="#plot_density-487"><span class="linenos">487</span></a>        <span class="n">facet_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span id="plot_density-488"><a href="#plot_density-488"><span class="linenos">488</span></a>        <span class="n">palette</span><span class="o">=</span><span class="n">color_palette</span><span class="p">,</span>
</span><span id="plot_density-489"><a href="#plot_density-489"><span class="linenos">489</span></a>        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
</span><span id="plot_density-490"><a href="#plot_density-490"><span class="linenos">490</span></a>        <span class="n">aspect</span><span class="o">=</span><span class="n">aspect_ratio</span><span class="p">,</span>
</span><span id="plot_density-491"><a href="#plot_density-491"><span class="linenos">491</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="plot_density-492"><a href="#plot_density-492"><span class="linenos">492</span></a>    <span class="p">)</span>
</span><span id="plot_density-493"><a href="#plot_density-493"><span class="linenos">493</span></a>
</span><span id="plot_density-494"><a href="#plot_density-494"><span class="linenos">494</span></a>    <span class="n">g</span> <span class="o">=</span> <span class="n">set_aesthetics</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">title_spacing</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="plot_density-495"><a href="#plot_density-495"><span class="linenos">495</span></a>
</span><span id="plot_density-496"><a href="#plot_density-496"><span class="linenos">496</span></a>    <span class="n">save_figure</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
</span><span id="plot_density-497"><a href="#plot_density-497"><span class="linenos">497</span></a>    <span class="k">return</span> <span class="n">g</span>
</span></pre></div>


            <div class="docstring"><p>Visualize posterior distributions with a density plot.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><p><code>results</code>:
Result object of the sampling process. Must have a method
<code>get_posterior_samples()</code> which extracts all samples from the posterior
distribution.</p></li>
<li><p><code>params</code>:
Names of the model parameters that are contained in the plot. Must coincide with
the dictionary keys of the <code><a href="#Position">Position</a></code> with the posterior samples. If <code>None</code>,
all parameters are included.</p></li>
<li><p><code>param_indices</code>:
Indices of each model parameter that are contained in the plot. Selects e.g.
<code>beta_0</code> out of a <code>beta</code> parameter vector.A single index can be specified as an
integer or a sequence containing one integer. If <code>None</code>, all subparameters are
included.</p></li>
<li><p><code>chain_indices</code>:
Indices of chains for each model subparameter that are contained in the plot.
Selects e.g. chain 0 and chain 2 out of multiple chains. A single index can be
specified as an integer or a sequence containing one integer. If <code>None</code>, all
chains are included.</p></li>
<li><p><code>max_chains</code>:
Upper bound how many chains are included within each subplot/facet. Avoids
overplotting. If <code>None</code>, all chains contained in the <code>results</code> input are plotted.
Always starts chain selection from the lowest chain index upwards. For selecting
specific chains use the argument <code>chain_indices</code>.</p></li>
<li><p><code>title</code>:
Plot title.</p></li>
<li><p><code>title_spacing</code>:
Determines the margin/whitespace between the plot title (set with
<code>fig.suptitle()</code>) and the first row of subplots/facets. Passed to the <code>top</code>
argument of <code>fig.subplots_adjust()</code>.</p></li>
<li><p><code>xlabel</code>:
Label of the x-axis.</p></li>
<li><p><code>style</code>:
Passed to the <code>style</code> argument of <code>sns.set_theme()</code>. Valid options are <code>darkgrid</code>,
<code>whitegrid</code>, <code>dark</code>, <code>white</code>, and <code>ticks</code>.</p></li>
<li><p><code>color_palette</code>:
Passed to the palette argument of <code>sns.displot()</code>. String values must be valid
inputs of <code>sns.color_palette()</code> such as a seaborn color palette or a matplotlib
colormap. Custom colors can be set with a list of color strings or a dictionary
with the chain indices as keys and color strings as values. The number of color
strings must coincide with the number of plotted chains. If <code>None</code>, the default
<code>tab10</code> matplotlib colormap is chosen.</p></li>
<li><p><code>ncol</code>:
Number of subplots/facets within each row of the grid.</p></li>
<li><p><code>height</code>:
Height in inches of each subplot/facet within the grid.</p></li>
<li><p><code>aspect_ratio</code>:
Ratio of width / height of each subplot/facet within the grid,
i.e. <code>width = aspect_ratio * height</code>.</p></li>
<li><p><code>save_path</code>:
File path where the plot is saved.</p></li>
<li><p><code>**kwargs</code>:
Further keyword arguments passed to the seaborn <code>displot()</code> function.</p></li>
</ul>

<h2 id="returns">Returns</h2>

<p>A seaborn <code>FacetGrid</code>.</p>
</div>


                </section>
                <section id="plot_param">
                            <input id="plot_param-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_param</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">results</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SamplingResult</span>,</span><span class="param">	<span class="n">param</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">param_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">max_lags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;whitegrid&#39;</span>,</span><span class="param">	<span class="n">color_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">figure_size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>,</span><span class="param">	<span class="n">legend_position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="plot_param-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_param"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_param-761"><a href="#plot_param-761"><span class="linenos">761</span></a><span class="k">def</span> <span class="nf">plot_param</span><span class="p">(</span>
</span><span id="plot_param-762"><a href="#plot_param-762"><span class="linenos">762</span></a>    <span class="n">results</span><span class="p">:</span> <span class="n">SamplingResult</span><span class="p">,</span>
</span><span id="plot_param-763"><a href="#plot_param-763"><span class="linenos">763</span></a>    <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="plot_param-764"><a href="#plot_param-764"><span class="linenos">764</span></a>    <span class="n">param_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_param-765"><a href="#plot_param-765"><span class="linenos">765</span></a>    <span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_param-766"><a href="#plot_param-766"><span class="linenos">766</span></a>    <span class="n">max_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="plot_param-767"><a href="#plot_param-767"><span class="linenos">767</span></a>    <span class="n">max_lags</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_param-768"><a href="#plot_param-768"><span class="linenos">768</span></a>    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_param-769"><a href="#plot_param-769"><span class="linenos">769</span></a>    <span class="n">title_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="plot_param-770"><a href="#plot_param-770"><span class="linenos">770</span></a>    <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;whitegrid&quot;</span><span class="p">,</span>
</span><span id="plot_param-771"><a href="#plot_param-771"><span class="linenos">771</span></a>    <span class="n">color_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_param-772"><a href="#plot_param-772"><span class="linenos">772</span></a>    <span class="n">figure_size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
</span><span id="plot_param-773"><a href="#plot_param-773"><span class="linenos">773</span></a>    <span class="c1"># default values chosen for default figure size of (9, 6)</span>
</span><span id="plot_param-774"><a href="#plot_param-774"><span class="linenos">774</span></a>    <span class="n">legend_position</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span>
</span><span id="plot_param-775"><a href="#plot_param-775"><span class="linenos">775</span></a>    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_param-776"><a href="#plot_param-776"><span class="linenos">776</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="plot_param-777"><a href="#plot_param-777"><span class="linenos">777</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_param-778"><a href="#plot_param-778"><span class="linenos">778</span></a><span class="sd">    Visualize trace plot, density plot and autocorrelation plot of a single</span>
</span><span id="plot_param-779"><a href="#plot_param-779"><span class="linenos">779</span></a><span class="sd">    subparameter.</span>
</span><span id="plot_param-780"><a href="#plot_param-780"><span class="linenos">780</span></a>
</span><span id="plot_param-781"><a href="#plot_param-781"><span class="linenos">781</span></a><span class="sd">    ## Parameters</span>
</span><span id="plot_param-782"><a href="#plot_param-782"><span class="linenos">782</span></a>
</span><span id="plot_param-783"><a href="#plot_param-783"><span class="linenos">783</span></a><span class="sd">    - `results`:</span>
</span><span id="plot_param-784"><a href="#plot_param-784"><span class="linenos">784</span></a><span class="sd">      Result object of the sampling process. Must have a method</span>
</span><span id="plot_param-785"><a href="#plot_param-785"><span class="linenos">785</span></a><span class="sd">      `get_posterior_samples()` which extracts all samples from the posterior</span>
</span><span id="plot_param-786"><a href="#plot_param-786"><span class="linenos">786</span></a><span class="sd">      distribution.</span>
</span><span id="plot_param-787"><a href="#plot_param-787"><span class="linenos">787</span></a>
</span><span id="plot_param-788"><a href="#plot_param-788"><span class="linenos">788</span></a><span class="sd">    - `param`:</span>
</span><span id="plot_param-789"><a href="#plot_param-789"><span class="linenos">789</span></a><span class="sd">      Name of a single model parameter that is contained in the plot. Must coincide with</span>
</span><span id="plot_param-790"><a href="#plot_param-790"><span class="linenos">790</span></a><span class="sd">      one dictionary key of the `Position` with the posterior samples.</span>
</span><span id="plot_param-791"><a href="#plot_param-791"><span class="linenos">791</span></a>
</span><span id="plot_param-792"><a href="#plot_param-792"><span class="linenos">792</span></a><span class="sd">    - `param_index`:</span>
</span><span id="plot_param-793"><a href="#plot_param-793"><span class="linenos">793</span></a><span class="sd">      A single index of the selected model parameter that is contained in the plot.</span>
</span><span id="plot_param-794"><a href="#plot_param-794"><span class="linenos">794</span></a><span class="sd">      Selects e.g. `beta_0` out of a `beta` parameter vector. Can be specified as an</span>
</span><span id="plot_param-795"><a href="#plot_param-795"><span class="linenos">795</span></a><span class="sd">      integer or as a sequence containing one integer. If `None`, the parameter is</span>
</span><span id="plot_param-796"><a href="#plot_param-796"><span class="linenos">796</span></a><span class="sd">      assumed to have only a single index.</span>
</span><span id="plot_param-797"><a href="#plot_param-797"><span class="linenos">797</span></a>
</span><span id="plot_param-798"><a href="#plot_param-798"><span class="linenos">798</span></a><span class="sd">    - `chain_indices`:</span>
</span><span id="plot_param-799"><a href="#plot_param-799"><span class="linenos">799</span></a><span class="sd">      Indices of chains for each model subparameter that are contained in the plot.</span>
</span><span id="plot_param-800"><a href="#plot_param-800"><span class="linenos">800</span></a><span class="sd">      Selects e.g. chain 0 and chain 2 out of multiple chains. A single index can be</span>
</span><span id="plot_param-801"><a href="#plot_param-801"><span class="linenos">801</span></a><span class="sd">      specified as an integer or a sequence containing one integer. If `None`, all</span>
</span><span id="plot_param-802"><a href="#plot_param-802"><span class="linenos">802</span></a><span class="sd">      chains are included.</span>
</span><span id="plot_param-803"><a href="#plot_param-803"><span class="linenos">803</span></a>
</span><span id="plot_param-804"><a href="#plot_param-804"><span class="linenos">804</span></a><span class="sd">    - `max_chains`:</span>
</span><span id="plot_param-805"><a href="#plot_param-805"><span class="linenos">805</span></a><span class="sd">      Upper bound how many chains are included within each subplot/facet. Avoids</span>
</span><span id="plot_param-806"><a href="#plot_param-806"><span class="linenos">806</span></a><span class="sd">      overplotting. If `None`, all chains contained in the `results` input are plotted.</span>
</span><span id="plot_param-807"><a href="#plot_param-807"><span class="linenos">807</span></a><span class="sd">      Always starts chain selection from the lowest chain index upwards. For selecting</span>
</span><span id="plot_param-808"><a href="#plot_param-808"><span class="linenos">808</span></a><span class="sd">      specific chains use the argument `chain_indices`.</span>
</span><span id="plot_param-809"><a href="#plot_param-809"><span class="linenos">809</span></a>
</span><span id="plot_param-810"><a href="#plot_param-810"><span class="linenos">810</span></a><span class="sd">    - `max_lags`:</span>
</span><span id="plot_param-811"><a href="#plot_param-811"><span class="linenos">811</span></a><span class="sd">      Maximum number of time lags shown on the x-axis of the autocorrelation plot. If</span>
</span><span id="plot_param-812"><a href="#plot_param-812"><span class="linenos">812</span></a><span class="sd">      `None`, the minimum of the chain lengths and 30 is chosen.</span>
</span><span id="plot_param-813"><a href="#plot_param-813"><span class="linenos">813</span></a>
</span><span id="plot_param-814"><a href="#plot_param-814"><span class="linenos">814</span></a><span class="sd">    - `title`:</span>
</span><span id="plot_param-815"><a href="#plot_param-815"><span class="linenos">815</span></a><span class="sd">      Plot title.</span>
</span><span id="plot_param-816"><a href="#plot_param-816"><span class="linenos">816</span></a>
</span><span id="plot_param-817"><a href="#plot_param-817"><span class="linenos">817</span></a><span class="sd">    - `title_spacing`:</span>
</span><span id="plot_param-818"><a href="#plot_param-818"><span class="linenos">818</span></a><span class="sd">      Determines the margin/whitespace between the plot title (set with</span>
</span><span id="plot_param-819"><a href="#plot_param-819"><span class="linenos">819</span></a><span class="sd">      `fig.suptitle()`) and the first row of subplots/facets. Passed to the `top`</span>
</span><span id="plot_param-820"><a href="#plot_param-820"><span class="linenos">820</span></a><span class="sd">      argument of `fig.subplots_adjust()`.</span>
</span><span id="plot_param-821"><a href="#plot_param-821"><span class="linenos">821</span></a>
</span><span id="plot_param-822"><a href="#plot_param-822"><span class="linenos">822</span></a><span class="sd">    - `style`:</span>
</span><span id="plot_param-823"><a href="#plot_param-823"><span class="linenos">823</span></a><span class="sd">      Passed to the `style` argument of `sns.set_theme()`. Valid options are `darkgrid`,</span>
</span><span id="plot_param-824"><a href="#plot_param-824"><span class="linenos">824</span></a><span class="sd">      `whitegrid`, `dark`, `white`, and `ticks`.</span>
</span><span id="plot_param-825"><a href="#plot_param-825"><span class="linenos">825</span></a>
</span><span id="plot_param-826"><a href="#plot_param-826"><span class="linenos">826</span></a><span class="sd">    - `color_list`:</span>
</span><span id="plot_param-827"><a href="#plot_param-827"><span class="linenos">827</span></a><span class="sd">      Determines the chain colors for all three subplots. Custom colors can be passed</span>
</span><span id="plot_param-828"><a href="#plot_param-828"><span class="linenos">828</span></a><span class="sd">      with a list of color strings. The length of the list must match the number of</span>
</span><span id="plot_param-829"><a href="#plot_param-829"><span class="linenos">829</span></a><span class="sd">      chains. If `None`, the default `tab10` matplotlib colormap is chosen.</span>
</span><span id="plot_param-830"><a href="#plot_param-830"><span class="linenos">830</span></a>
</span><span id="plot_param-831"><a href="#plot_param-831"><span class="linenos">831</span></a><span class="sd">    - `figure_size`:</span>
</span><span id="plot_param-832"><a href="#plot_param-832"><span class="linenos">832</span></a><span class="sd">      Size of the entire plot grid. Passed to the `figsize` argument of `plt.figure()`.</span>
</span><span id="plot_param-833"><a href="#plot_param-833"><span class="linenos">833</span></a><span class="sd">      When changing the figure size consider changing the `legend_position` as well.</span>
</span><span id="plot_param-834"><a href="#plot_param-834"><span class="linenos">834</span></a><span class="sd">      Generally, a ratio of 3:2 is recommended.</span>
</span><span id="plot_param-835"><a href="#plot_param-835"><span class="linenos">835</span></a>
</span><span id="plot_param-836"><a href="#plot_param-836"><span class="linenos">836</span></a><span class="sd">    - `legend_position`:</span>
</span><span id="plot_param-837"><a href="#plot_param-837"><span class="linenos">837</span></a><span class="sd">      Determines the color legend position. Coordinates are relative to the upper panel</span>
</span><span id="plot_param-838"><a href="#plot_param-838"><span class="linenos">838</span></a><span class="sd">      within the plot grid. The first coordinate specifies the horizontal, the second</span>
</span><span id="plot_param-839"><a href="#plot_param-839"><span class="linenos">839</span></a><span class="sd">      coordinate the vertical position. Might require an adjustment when changing the</span>
</span><span id="plot_param-840"><a href="#plot_param-840"><span class="linenos">840</span></a><span class="sd">      `figure_size` values or the number of chains.</span>
</span><span id="plot_param-841"><a href="#plot_param-841"><span class="linenos">841</span></a>
</span><span id="plot_param-842"><a href="#plot_param-842"><span class="linenos">842</span></a><span class="sd">    - `save_path`:</span>
</span><span id="plot_param-843"><a href="#plot_param-843"><span class="linenos">843</span></a><span class="sd">      File path where the plot is saved.</span>
</span><span id="plot_param-844"><a href="#plot_param-844"><span class="linenos">844</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_param-845"><a href="#plot_param-845"><span class="linenos">845</span></a>
</span><span id="plot_param-846"><a href="#plot_param-846"><span class="linenos">846</span></a>    <span class="c1"># NOTE: Docstring duplications</span>
</span><span id="plot_param-847"><a href="#plot_param-847"><span class="linenos">847</span></a>    <span class="c1"># The entries `results`, `chain_indices` and `max_chains` are shared with the</span>
</span><span id="plot_param-848"><a href="#plot_param-848"><span class="linenos">848</span></a>    <span class="c1"># `summary()` and all user plotting functions.</span>
</span><span id="plot_param-849"><a href="#plot_param-849"><span class="linenos">849</span></a>    <span class="c1"># The entries `title`, `title_spacing`, `style` and `save_path` are shared with</span>
</span><span id="plot_param-850"><a href="#plot_param-850"><span class="linenos">850</span></a>    <span class="c1"># `plot_trace()`, `plot_density()` and `plot_cor()`.</span>
</span><span id="plot_param-851"><a href="#plot_param-851"><span class="linenos">851</span></a>    <span class="c1"># The entry `max_lags` is shared with `plot_cor()`.</span>
</span><span id="plot_param-852"><a href="#plot_param-852"><span class="linenos">852</span></a>
</span><span id="plot_param-853"><a href="#plot_param-853"><span class="linenos">853</span></a>    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
</span><span id="plot_param-854"><a href="#plot_param-854"><span class="linenos">854</span></a>    <span class="n">plot_df</span> <span class="o">=</span> <span class="n">setup_plot_df</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">param_index</span><span class="p">,</span> <span class="n">chain_indices</span><span class="p">,</span> <span class="n">max_chains</span><span class="p">)</span>
</span><span id="plot_param-855"><a href="#plot_param-855"><span class="linenos">855</span></a>    <span class="n">raise_multi_param_error</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
</span><span id="plot_param-856"><a href="#plot_param-856"><span class="linenos">856</span></a>    <span class="n">color_list</span> <span class="o">=</span> <span class="n">set_colors</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">color_list</span><span class="p">)</span>
</span><span id="plot_param-857"><a href="#plot_param-857"><span class="linenos">857</span></a>
</span><span id="plot_param-858"><a href="#plot_param-858"><span class="linenos">858</span></a>    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">setup_grid</span><span class="p">(</span><span class="n">figure_size</span><span class="p">)</span>
</span><span id="plot_param-859"><a href="#plot_param-859"><span class="linenos">859</span></a>    <span class="n">add_lineplot</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">color_list</span><span class="p">)</span>
</span><span id="plot_param-860"><a href="#plot_param-860"><span class="linenos">860</span></a>    <span class="n">add_kdeplot</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">color_list</span><span class="p">)</span>
</span><span id="plot_param-861"><a href="#plot_param-861"><span class="linenos">861</span></a>    <span class="n">add_corplot</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">max_lags</span><span class="p">,</span> <span class="n">color_list</span><span class="p">)</span>
</span><span id="plot_param-862"><a href="#plot_param-862"><span class="linenos">862</span></a>    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Chain&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">legend_position</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="plot_param-863"><a href="#plot_param-863"><span class="linenos">863</span></a>
</span><span id="plot_param-864"><a href="#plot_param-864"><span class="linenos">864</span></a>    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="plot_param-865"><a href="#plot_param-865"><span class="linenos">865</span></a>    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">get_title</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">title</span><span class="p">))</span>
</span><span id="plot_param-866"><a href="#plot_param-866"><span class="linenos">866</span></a>    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">title_spacing</span><span class="p">)</span>
</span><span id="plot_param-867"><a href="#plot_param-867"><span class="linenos">867</span></a>
</span><span id="plot_param-868"><a href="#plot_param-868"><span class="linenos">868</span></a>    <span class="n">save_figure</span><span class="p">(</span><span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Visualize trace plot, density plot and autocorrelation plot of a single
subparameter.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><p><code>results</code>:
Result object of the sampling process. Must have a method
<code>get_posterior_samples()</code> which extracts all samples from the posterior
distribution.</p></li>
<li><p><code>param</code>:
Name of a single model parameter that is contained in the plot. Must coincide with
one dictionary key of the <code><a href="#Position">Position</a></code> with the posterior samples.</p></li>
<li><p><code>param_index</code>:
A single index of the selected model parameter that is contained in the plot.
Selects e.g. <code>beta_0</code> out of a <code>beta</code> parameter vector. Can be specified as an
integer or as a sequence containing one integer. If <code>None</code>, the parameter is
assumed to have only a single index.</p></li>
<li><p><code>chain_indices</code>:
Indices of chains for each model subparameter that are contained in the plot.
Selects e.g. chain 0 and chain 2 out of multiple chains. A single index can be
specified as an integer or a sequence containing one integer. If <code>None</code>, all
chains are included.</p></li>
<li><p><code>max_chains</code>:
Upper bound how many chains are included within each subplot/facet. Avoids
overplotting. If <code>None</code>, all chains contained in the <code>results</code> input are plotted.
Always starts chain selection from the lowest chain index upwards. For selecting
specific chains use the argument <code>chain_indices</code>.</p></li>
<li><p><code>max_lags</code>:
Maximum number of time lags shown on the x-axis of the autocorrelation plot. If
<code>None</code>, the minimum of the chain lengths and 30 is chosen.</p></li>
<li><p><code>title</code>:
Plot title.</p></li>
<li><p><code>title_spacing</code>:
Determines the margin/whitespace between the plot title (set with
<code>fig.suptitle()</code>) and the first row of subplots/facets. Passed to the <code>top</code>
argument of <code>fig.subplots_adjust()</code>.</p></li>
<li><p><code>style</code>:
Passed to the <code>style</code> argument of <code>sns.set_theme()</code>. Valid options are <code>darkgrid</code>,
<code>whitegrid</code>, <code>dark</code>, <code>white</code>, and <code>ticks</code>.</p></li>
<li><p><code>color_list</code>:
Determines the chain colors for all three subplots. Custom colors can be passed
with a list of color strings. The length of the list must match the number of
chains. If <code>None</code>, the default <code>tab10</code> matplotlib colormap is chosen.</p></li>
<li><p><code>figure_size</code>:
Size of the entire plot grid. Passed to the <code>figsize</code> argument of <code>plt.figure()</code>.
When changing the figure size consider changing the <code>legend_position</code> as well.
Generally, a ratio of 3:2 is recommended.</p></li>
<li><p><code>legend_position</code>:
Determines the color legend position. Coordinates are relative to the upper panel
within the plot grid. The first coordinate specifies the horizontal, the second
coordinate the vertical position. Might require an adjustment when changing the
<code>figure_size</code> values or the number of chains.</p></li>
<li><p><code>save_path</code>:
File path where the plot is saved.</p></li>
</ul>
</div>


                </section>
                <section id="plot_trace">
                            <input id="plot_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_trace</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">results</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SamplingResult</span>,</span><span class="param">	<span class="n">params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">param_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span>,</span><span class="param">	<span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Iteration&#39;</span>,</span><span class="param">	<span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;whitegrid&#39;</span>,</span><span class="param">	<span class="n">color_palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ncol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">aspect_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">include_warmup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">seaborn</span><span class="o">.</span><span class="n">axisgrid</span><span class="o">.</span><span class="n">FacetGrid</span>:</span></span>

                <label class="view-source-button" for="plot_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#plot_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="plot_trace-246"><a href="#plot_trace-246"><span class="linenos">246</span></a><span class="k">def</span> <span class="nf">plot_trace</span><span class="p">(</span>
</span><span id="plot_trace-247"><a href="#plot_trace-247"><span class="linenos">247</span></a>    <span class="n">results</span><span class="p">:</span> <span class="n">SamplingResult</span><span class="p">,</span>
</span><span id="plot_trace-248"><a href="#plot_trace-248"><span class="linenos">248</span></a>    <span class="n">params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_trace-249"><a href="#plot_trace-249"><span class="linenos">249</span></a>    <span class="n">param_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_trace-250"><a href="#plot_trace-250"><span class="linenos">250</span></a>    <span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_trace-251"><a href="#plot_trace-251"><span class="linenos">251</span></a>    <span class="n">max_chains</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="plot_trace-252"><a href="#plot_trace-252"><span class="linenos">252</span></a>    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_trace-253"><a href="#plot_trace-253"><span class="linenos">253</span></a>    <span class="n">title_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.85</span><span class="p">,</span>
</span><span id="plot_trace-254"><a href="#plot_trace-254"><span class="linenos">254</span></a>    <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Iteration&quot;</span><span class="p">,</span>
</span><span id="plot_trace-255"><a href="#plot_trace-255"><span class="linenos">255</span></a>    <span class="n">style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;whitegrid&quot;</span><span class="p">,</span>
</span><span id="plot_trace-256"><a href="#plot_trace-256"><span class="linenos">256</span></a>    <span class="n">color_palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_trace-257"><a href="#plot_trace-257"><span class="linenos">257</span></a>    <span class="n">ncol</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="plot_trace-258"><a href="#plot_trace-258"><span class="linenos">258</span></a>    <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="plot_trace-259"><a href="#plot_trace-259"><span class="linenos">259</span></a>    <span class="n">aspect_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="plot_trace-260"><a href="#plot_trace-260"><span class="linenos">260</span></a>    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="plot_trace-261"><a href="#plot_trace-261"><span class="linenos">261</span></a>    <span class="n">include_warmup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="plot_trace-262"><a href="#plot_trace-262"><span class="linenos">262</span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="plot_trace-263"><a href="#plot_trace-263"><span class="linenos">263</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">:</span>
</span><span id="plot_trace-264"><a href="#plot_trace-264"><span class="linenos">264</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="plot_trace-265"><a href="#plot_trace-265"><span class="linenos">265</span></a><span class="sd">    Visualize posterior samples over time with a trace plot.</span>
</span><span id="plot_trace-266"><a href="#plot_trace-266"><span class="linenos">266</span></a>
</span><span id="plot_trace-267"><a href="#plot_trace-267"><span class="linenos">267</span></a><span class="sd">    ## Parameters</span>
</span><span id="plot_trace-268"><a href="#plot_trace-268"><span class="linenos">268</span></a>
</span><span id="plot_trace-269"><a href="#plot_trace-269"><span class="linenos">269</span></a><span class="sd">    - `results`:</span>
</span><span id="plot_trace-270"><a href="#plot_trace-270"><span class="linenos">270</span></a><span class="sd">      Result object of the sampling process. Must have a method</span>
</span><span id="plot_trace-271"><a href="#plot_trace-271"><span class="linenos">271</span></a><span class="sd">      `get_posterior_samples()` which extracts all samples from the posterior</span>
</span><span id="plot_trace-272"><a href="#plot_trace-272"><span class="linenos">272</span></a><span class="sd">      distribution.</span>
</span><span id="plot_trace-273"><a href="#plot_trace-273"><span class="linenos">273</span></a>
</span><span id="plot_trace-274"><a href="#plot_trace-274"><span class="linenos">274</span></a><span class="sd">    - `params`:</span>
</span><span id="plot_trace-275"><a href="#plot_trace-275"><span class="linenos">275</span></a><span class="sd">      Names of the model parameters that are contained in the plot. Must coincide with</span>
</span><span id="plot_trace-276"><a href="#plot_trace-276"><span class="linenos">276</span></a><span class="sd">      the dictionary keys of the `Position` with the posterior samples. If `None`,</span>
</span><span id="plot_trace-277"><a href="#plot_trace-277"><span class="linenos">277</span></a><span class="sd">      all parameters are included.</span>
</span><span id="plot_trace-278"><a href="#plot_trace-278"><span class="linenos">278</span></a>
</span><span id="plot_trace-279"><a href="#plot_trace-279"><span class="linenos">279</span></a><span class="sd">    - `param_indices`:</span>
</span><span id="plot_trace-280"><a href="#plot_trace-280"><span class="linenos">280</span></a><span class="sd">      Indices of each model parameter that are contained in the plot. Selects e.g.</span>
</span><span id="plot_trace-281"><a href="#plot_trace-281"><span class="linenos">281</span></a><span class="sd">      `beta_0` out of a `beta` parameter vector.A single index can be specified as an</span>
</span><span id="plot_trace-282"><a href="#plot_trace-282"><span class="linenos">282</span></a><span class="sd">      integer or a sequence containing one integer. If `None`, all subparameters are</span>
</span><span id="plot_trace-283"><a href="#plot_trace-283"><span class="linenos">283</span></a><span class="sd">      included.</span>
</span><span id="plot_trace-284"><a href="#plot_trace-284"><span class="linenos">284</span></a>
</span><span id="plot_trace-285"><a href="#plot_trace-285"><span class="linenos">285</span></a><span class="sd">    - `chain_indices`:</span>
</span><span id="plot_trace-286"><a href="#plot_trace-286"><span class="linenos">286</span></a><span class="sd">      Indices of chains for each model subparameter that are contained in the plot.</span>
</span><span id="plot_trace-287"><a href="#plot_trace-287"><span class="linenos">287</span></a><span class="sd">      Selects e.g. chain 0 and chain 2 out of multiple chains. A single index can be</span>
</span><span id="plot_trace-288"><a href="#plot_trace-288"><span class="linenos">288</span></a><span class="sd">      specified as an integer or a sequence containing one integer. If `None`, all</span>
</span><span id="plot_trace-289"><a href="#plot_trace-289"><span class="linenos">289</span></a><span class="sd">      chains are included.</span>
</span><span id="plot_trace-290"><a href="#plot_trace-290"><span class="linenos">290</span></a>
</span><span id="plot_trace-291"><a href="#plot_trace-291"><span class="linenos">291</span></a><span class="sd">    - `max_chains`:</span>
</span><span id="plot_trace-292"><a href="#plot_trace-292"><span class="linenos">292</span></a><span class="sd">      Upper bound how many chains are included within each subplot/facet. Avoids</span>
</span><span id="plot_trace-293"><a href="#plot_trace-293"><span class="linenos">293</span></a><span class="sd">      overplotting. If `None`, all chains contained in the `results` input are plotted.</span>
</span><span id="plot_trace-294"><a href="#plot_trace-294"><span class="linenos">294</span></a><span class="sd">      Always starts chain selection from the lowest chain index upwards. For selecting</span>
</span><span id="plot_trace-295"><a href="#plot_trace-295"><span class="linenos">295</span></a><span class="sd">      specific chains use the argument `chain_indices`.</span>
</span><span id="plot_trace-296"><a href="#plot_trace-296"><span class="linenos">296</span></a>
</span><span id="plot_trace-297"><a href="#plot_trace-297"><span class="linenos">297</span></a><span class="sd">    - `title`:</span>
</span><span id="plot_trace-298"><a href="#plot_trace-298"><span class="linenos">298</span></a><span class="sd">      Plot title.</span>
</span><span id="plot_trace-299"><a href="#plot_trace-299"><span class="linenos">299</span></a>
</span><span id="plot_trace-300"><a href="#plot_trace-300"><span class="linenos">300</span></a><span class="sd">    - `title_spacing`:</span>
</span><span id="plot_trace-301"><a href="#plot_trace-301"><span class="linenos">301</span></a><span class="sd">      Determines the margin/whitespace between the plot title (set with</span>
</span><span id="plot_trace-302"><a href="#plot_trace-302"><span class="linenos">302</span></a><span class="sd">      `fig.suptitle()`) and the first row of subplots/facets. Passed to the `top`</span>
</span><span id="plot_trace-303"><a href="#plot_trace-303"><span class="linenos">303</span></a><span class="sd">      argument of `fig.subplots_adjust()`.</span>
</span><span id="plot_trace-304"><a href="#plot_trace-304"><span class="linenos">304</span></a>
</span><span id="plot_trace-305"><a href="#plot_trace-305"><span class="linenos">305</span></a><span class="sd">    - `xlabel`:</span>
</span><span id="plot_trace-306"><a href="#plot_trace-306"><span class="linenos">306</span></a><span class="sd">      Label of the x-axis.</span>
</span><span id="plot_trace-307"><a href="#plot_trace-307"><span class="linenos">307</span></a>
</span><span id="plot_trace-308"><a href="#plot_trace-308"><span class="linenos">308</span></a><span class="sd">    - `style`:</span>
</span><span id="plot_trace-309"><a href="#plot_trace-309"><span class="linenos">309</span></a><span class="sd">      Passed to the `style` argument of `sns.set_theme()`. Valid options are `darkgrid`,</span>
</span><span id="plot_trace-310"><a href="#plot_trace-310"><span class="linenos">310</span></a><span class="sd">      `whitegrid`, `dark`, `white`, and `ticks`.</span>
</span><span id="plot_trace-311"><a href="#plot_trace-311"><span class="linenos">311</span></a>
</span><span id="plot_trace-312"><a href="#plot_trace-312"><span class="linenos">312</span></a><span class="sd">    - `color_palette`:</span>
</span><span id="plot_trace-313"><a href="#plot_trace-313"><span class="linenos">313</span></a><span class="sd">      Passed to the palette argument of `sns.relplot()`. String values must be valid</span>
</span><span id="plot_trace-314"><a href="#plot_trace-314"><span class="linenos">314</span></a><span class="sd">      inputs of `sns.color_palette()` such as a seaborn color palette or a matplotlib</span>
</span><span id="plot_trace-315"><a href="#plot_trace-315"><span class="linenos">315</span></a><span class="sd">      colormap. Custom colors can be set with a list of color strings or a dictionary</span>
</span><span id="plot_trace-316"><a href="#plot_trace-316"><span class="linenos">316</span></a><span class="sd">      with the chain indices as keys and color strings as values. The number of color</span>
</span><span id="plot_trace-317"><a href="#plot_trace-317"><span class="linenos">317</span></a><span class="sd">      strings must coincide with the number of plotted chains. If `None`, the default</span>
</span><span id="plot_trace-318"><a href="#plot_trace-318"><span class="linenos">318</span></a><span class="sd">      `tab10` matplotlib colormap is chosen.</span>
</span><span id="plot_trace-319"><a href="#plot_trace-319"><span class="linenos">319</span></a>
</span><span id="plot_trace-320"><a href="#plot_trace-320"><span class="linenos">320</span></a><span class="sd">    - `ncol`:</span>
</span><span id="plot_trace-321"><a href="#plot_trace-321"><span class="linenos">321</span></a><span class="sd">      Number of subplots/facets within each row of the grid.</span>
</span><span id="plot_trace-322"><a href="#plot_trace-322"><span class="linenos">322</span></a>
</span><span id="plot_trace-323"><a href="#plot_trace-323"><span class="linenos">323</span></a><span class="sd">    - `height`:</span>
</span><span id="plot_trace-324"><a href="#plot_trace-324"><span class="linenos">324</span></a><span class="sd">      Height in inches of each subplot/facet within the grid.</span>
</span><span id="plot_trace-325"><a href="#plot_trace-325"><span class="linenos">325</span></a>
</span><span id="plot_trace-326"><a href="#plot_trace-326"><span class="linenos">326</span></a><span class="sd">    - `aspect_ratio`:</span>
</span><span id="plot_trace-327"><a href="#plot_trace-327"><span class="linenos">327</span></a><span class="sd">      Ratio of width / height of each subplot/facet within the grid,</span>
</span><span id="plot_trace-328"><a href="#plot_trace-328"><span class="linenos">328</span></a><span class="sd">      i.e. `width = aspect_ratio * height`.</span>
</span><span id="plot_trace-329"><a href="#plot_trace-329"><span class="linenos">329</span></a>
</span><span id="plot_trace-330"><a href="#plot_trace-330"><span class="linenos">330</span></a><span class="sd">    - `save_path`:</span>
</span><span id="plot_trace-331"><a href="#plot_trace-331"><span class="linenos">331</span></a><span class="sd">      File path where the plot is saved.</span>
</span><span id="plot_trace-332"><a href="#plot_trace-332"><span class="linenos">332</span></a>
</span><span id="plot_trace-333"><a href="#plot_trace-333"><span class="linenos">333</span></a><span class="sd">    - `include_warmup:</span>
</span><span id="plot_trace-334"><a href="#plot_trace-334"><span class="linenos">334</span></a><span class="sd">       Include the warmup samples in the trace plot.</span>
</span><span id="plot_trace-335"><a href="#plot_trace-335"><span class="linenos">335</span></a>
</span><span id="plot_trace-336"><a href="#plot_trace-336"><span class="linenos">336</span></a><span class="sd">    - `**kwargs`:</span>
</span><span id="plot_trace-337"><a href="#plot_trace-337"><span class="linenos">337</span></a><span class="sd">      Further keyword arguments passed to the seaborn `relplot()` function.</span>
</span><span id="plot_trace-338"><a href="#plot_trace-338"><span class="linenos">338</span></a>
</span><span id="plot_trace-339"><a href="#plot_trace-339"><span class="linenos">339</span></a><span class="sd">    ## Returns</span>
</span><span id="plot_trace-340"><a href="#plot_trace-340"><span class="linenos">340</span></a>
</span><span id="plot_trace-341"><a href="#plot_trace-341"><span class="linenos">341</span></a><span class="sd">    A seaborn `FacetGrid`.</span>
</span><span id="plot_trace-342"><a href="#plot_trace-342"><span class="linenos">342</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="plot_trace-343"><a href="#plot_trace-343"><span class="linenos">343</span></a>
</span><span id="plot_trace-344"><a href="#plot_trace-344"><span class="linenos">344</span></a>    <span class="c1"># NOTE: Docstring duplications</span>
</span><span id="plot_trace-345"><a href="#plot_trace-345"><span class="linenos">345</span></a>    <span class="c1"># The entries `results` to `max_chains` are shared with the `summary()`</span>
</span><span id="plot_trace-346"><a href="#plot_trace-346"><span class="linenos">346</span></a>    <span class="c1"># and all user plotting functions.</span>
</span><span id="plot_trace-347"><a href="#plot_trace-347"><span class="linenos">347</span></a>    <span class="c1"># The entries `title` to `save_path` are shared with `plot_density()`, `plot_cor()`</span>
</span><span id="plot_trace-348"><a href="#plot_trace-348"><span class="linenos">348</span></a>    <span class="c1"># and partially with `plot_param()`.</span>
</span><span id="plot_trace-349"><a href="#plot_trace-349"><span class="linenos">349</span></a>
</span><span id="plot_trace-350"><a href="#plot_trace-350"><span class="linenos">350</span></a>    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
</span><span id="plot_trace-351"><a href="#plot_trace-351"><span class="linenos">351</span></a>    <span class="n">plot_df</span> <span class="o">=</span> <span class="n">setup_plot_df</span><span class="p">(</span>
</span><span id="plot_trace-352"><a href="#plot_trace-352"><span class="linenos">352</span></a>        <span class="n">results</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_indices</span><span class="p">,</span> <span class="n">chain_indices</span><span class="p">,</span> <span class="n">max_chains</span><span class="p">,</span> <span class="n">include_warmup</span>
</span><span id="plot_trace-353"><a href="#plot_trace-353"><span class="linenos">353</span></a>    <span class="p">)</span>
</span><span id="plot_trace-354"><a href="#plot_trace-354"><span class="linenos">354</span></a>
</span><span id="plot_trace-355"><a href="#plot_trace-355"><span class="linenos">355</span></a>    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span>
</span><span id="plot_trace-356"><a href="#plot_trace-356"><span class="linenos">356</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">plot_df</span><span class="p">,</span>
</span><span id="plot_trace-357"><a href="#plot_trace-357"><span class="linenos">357</span></a>        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
</span><span id="plot_trace-358"><a href="#plot_trace-358"><span class="linenos">358</span></a>        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;iteration&quot;</span><span class="p">,</span>
</span><span id="plot_trace-359"><a href="#plot_trace-359"><span class="linenos">359</span></a>        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span id="plot_trace-360"><a href="#plot_trace-360"><span class="linenos">360</span></a>        <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;chain_index&quot;</span><span class="p">,</span>
</span><span id="plot_trace-361"><a href="#plot_trace-361"><span class="linenos">361</span></a>        <span class="n">col</span><span class="o">=</span><span class="s2">&quot;param&quot;</span><span class="p">,</span>
</span><span id="plot_trace-362"><a href="#plot_trace-362"><span class="linenos">362</span></a>        <span class="n">col_wrap</span><span class="o">=</span><span class="n">set_plot_cols</span><span class="p">(</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">ncol</span><span class="p">),</span>
</span><span id="plot_trace-363"><a href="#plot_trace-363"><span class="linenos">363</span></a>        <span class="n">facet_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span id="plot_trace-364"><a href="#plot_trace-364"><span class="linenos">364</span></a>        <span class="n">palette</span><span class="o">=</span><span class="n">color_palette</span><span class="p">,</span>
</span><span id="plot_trace-365"><a href="#plot_trace-365"><span class="linenos">365</span></a>        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
</span><span id="plot_trace-366"><a href="#plot_trace-366"><span class="linenos">366</span></a>        <span class="n">aspect</span><span class="o">=</span><span class="n">aspect_ratio</span><span class="p">,</span>
</span><span id="plot_trace-367"><a href="#plot_trace-367"><span class="linenos">367</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="plot_trace-368"><a href="#plot_trace-368"><span class="linenos">368</span></a>    <span class="p">)</span>
</span><span id="plot_trace-369"><a href="#plot_trace-369"><span class="linenos">369</span></a>
</span><span id="plot_trace-370"><a href="#plot_trace-370"><span class="linenos">370</span></a>    <span class="n">g</span> <span class="o">=</span> <span class="n">set_aesthetics</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">title_spacing</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="plot_trace-371"><a href="#plot_trace-371"><span class="linenos">371</span></a>
</span><span id="plot_trace-372"><a href="#plot_trace-372"><span class="linenos">372</span></a>    <span class="n">save_figure</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
</span><span id="plot_trace-373"><a href="#plot_trace-373"><span class="linenos">373</span></a>    <span class="k">return</span> <span class="n">g</span>
</span></pre></div>


            <div class="docstring"><p>Visualize posterior samples over time with a trace plot.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><p><code>results</code>:
Result object of the sampling process. Must have a method
<code>get_posterior_samples()</code> which extracts all samples from the posterior
distribution.</p></li>
<li><p><code>params</code>:
Names of the model parameters that are contained in the plot. Must coincide with
the dictionary keys of the <code><a href="#Position">Position</a></code> with the posterior samples. If <code>None</code>,
all parameters are included.</p></li>
<li><p><code>param_indices</code>:
Indices of each model parameter that are contained in the plot. Selects e.g.
<code>beta_0</code> out of a <code>beta</code> parameter vector.A single index can be specified as an
integer or a sequence containing one integer. If <code>None</code>, all subparameters are
included.</p></li>
<li><p><code>chain_indices</code>:
Indices of chains for each model subparameter that are contained in the plot.
Selects e.g. chain 0 and chain 2 out of multiple chains. A single index can be
specified as an integer or a sequence containing one integer. If <code>None</code>, all
chains are included.</p></li>
<li><p><code>max_chains</code>:
Upper bound how many chains are included within each subplot/facet. Avoids
overplotting. If <code>None</code>, all chains contained in the <code>results</code> input are plotted.
Always starts chain selection from the lowest chain index upwards. For selecting
specific chains use the argument <code>chain_indices</code>.</p></li>
<li><p><code>title</code>:
Plot title.</p></li>
<li><p><code>title_spacing</code>:
Determines the margin/whitespace between the plot title (set with
<code>fig.suptitle()</code>) and the first row of subplots/facets. Passed to the <code>top</code>
argument of <code>fig.subplots_adjust()</code>.</p></li>
<li><p><code>xlabel</code>:
Label of the x-axis.</p></li>
<li><p><code>style</code>:
Passed to the <code>style</code> argument of <code>sns.set_theme()</code>. Valid options are <code>darkgrid</code>,
<code>whitegrid</code>, <code>dark</code>, <code>white</code>, and <code>ticks</code>.</p></li>
<li><p><code>color_palette</code>:
Passed to the palette argument of <code>sns.relplot()</code>. String values must be valid
inputs of <code>sns.color_palette()</code> such as a seaborn color palette or a matplotlib
colormap. Custom colors can be set with a list of color strings or a dictionary
with the chain indices as keys and color strings as values. The number of color
strings must coincide with the number of plotted chains. If <code>None</code>, the default
<code>tab10</code> matplotlib colormap is chosen.</p></li>
<li><p><code>ncol</code>:
Number of subplots/facets within each row of the grid.</p></li>
<li><p><code>height</code>:
Height in inches of each subplot/facet within the grid.</p></li>
<li><p><code>aspect_ratio</code>:
Ratio of width / height of each subplot/facet within the grid,
i.e. <code>width = aspect_ratio * height</code>.</p></li>
<li><p><code>save_path</code>:
File path where the plot is saved.</p></li>
<li><p>`include_warmup:
Include the warmup samples in the trace plot.</p></li>
<li><p><code>**kwargs</code>:
Further keyword arguments passed to the seaborn <code>relplot()</code> function.</p></li>
</ul>

<h2 id="returns">Returns</h2>

<p>A seaborn <code>FacetGrid</code>.</p>
</div>


                </section>
                <section id="stan_epochs">
                            <input id="stan_epochs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stan_epochs</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">warmup_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>,</span><span class="param">	<span class="n">posterior_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>,</span><span class="param">	<span class="n">init_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">75</span>,</span><span class="param">	<span class="n">term_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>,</span><span class="param">	<span class="n">base_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span></span><span class="return-annotation">) -> <span class="nb">list</span><span class="p">[</span><span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">epoch</span><span class="o">.</span><span class="n">EpochConfig</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="stan_epochs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#stan_epochs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="stan_epochs-13"><a href="#stan_epochs-13"><span class="linenos">13</span></a><span class="k">def</span> <span class="nf">stan_epochs</span><span class="p">(</span>
</span><span id="stan_epochs-14"><a href="#stan_epochs-14"><span class="linenos">14</span></a>    <span class="n">warmup_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="stan_epochs-15"><a href="#stan_epochs-15"><span class="linenos">15</span></a>    <span class="n">posterior_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="stan_epochs-16"><a href="#stan_epochs-16"><span class="linenos">16</span></a>    <span class="n">init_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">75</span><span class="p">,</span>
</span><span id="stan_epochs-17"><a href="#stan_epochs-17"><span class="linenos">17</span></a>    <span class="n">term_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="stan_epochs-18"><a href="#stan_epochs-18"><span class="linenos">18</span></a>    <span class="n">base_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
</span><span id="stan_epochs-19"><a href="#stan_epochs-19"><span class="linenos">19</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">EpochConfig</span><span class="p">]:</span>
</span><span id="stan_epochs-20"><a href="#stan_epochs-20"><span class="linenos">20</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="stan_epochs-21"><a href="#stan_epochs-21"><span class="linenos">21</span></a><span class="sd">    Sets up a list of `liesel.goose.epoch.EpochConfig`&#39;s,</span>
</span><span id="stan_epochs-22"><a href="#stan_epochs-22"><span class="linenos">22</span></a><span class="sd">    following the Stan Development Team, [Stan Reference Manual (2021), Chapter 15.2](</span>
</span><span id="stan_epochs-23"><a href="#stan_epochs-23"><span class="linenos">23</span></a><span class="sd">    https://mc-stan.org/docs/2_28/reference-manual/hmc-algorithm-parameters.html).</span>
</span><span id="stan_epochs-24"><a href="#stan_epochs-24"><span class="linenos">24</span></a>
</span><span id="stan_epochs-25"><a href="#stan_epochs-25"><span class="linenos">25</span></a><span class="sd">    ## Parameters</span>
</span><span id="stan_epochs-26"><a href="#stan_epochs-26"><span class="linenos">26</span></a>
</span><span id="stan_epochs-27"><a href="#stan_epochs-27"><span class="linenos">27</span></a><span class="sd">    - `warmup_duration`: The number of warmup samples.</span>
</span><span id="stan_epochs-28"><a href="#stan_epochs-28"><span class="linenos">28</span></a><span class="sd">    - `posterior_duration`: The number of posterior samples.</span>
</span><span id="stan_epochs-29"><a href="#stan_epochs-29"><span class="linenos">29</span></a><span class="sd">    - `init_duration`: The number of samples in the *initial fast* adaptation epoch.</span>
</span><span id="stan_epochs-30"><a href="#stan_epochs-30"><span class="linenos">30</span></a><span class="sd">    - `term_duration`: The number of samples in the *final fast* adaptation epoch.</span>
</span><span id="stan_epochs-31"><a href="#stan_epochs-31"><span class="linenos">31</span></a><span class="sd">    - `base_duration`: The number of samples in the *first slow* adaptation epoch.</span>
</span><span id="stan_epochs-32"><a href="#stan_epochs-32"><span class="linenos">32</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="stan_epochs-33"><a href="#stan_epochs-33"><span class="linenos">33</span></a>
</span><span id="stan_epochs-34"><a href="#stan_epochs-34"><span class="linenos">34</span></a>    <span class="k">if</span> <span class="n">warmup_duration</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span id="stan_epochs-35"><a href="#stan_epochs-35"><span class="linenos">35</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;warmup_duration too short (&lt; 20)&quot;</span><span class="p">)</span>
</span><span id="stan_epochs-36"><a href="#stan_epochs-36"><span class="linenos">36</span></a>
</span><span id="stan_epochs-37"><a href="#stan_epochs-37"><span class="linenos">37</span></a>    <span class="k">if</span> <span class="n">warmup_duration</span> <span class="o">&lt;</span> <span class="n">init_duration</span> <span class="o">+</span> <span class="n">term_duration</span> <span class="o">+</span> <span class="n">base_duration</span><span class="p">:</span>
</span><span id="stan_epochs-38"><a href="#stan_epochs-38"><span class="linenos">38</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="stan_epochs-39"><a href="#stan_epochs-39"><span class="linenos">39</span></a>            <span class="s2">&quot;warmup_duration too short &quot;</span>
</span><span id="stan_epochs-40"><a href="#stan_epochs-40"><span class="linenos">40</span></a>            <span class="s2">&quot;(&lt; init_duration + term_duration + base_duration)&quot;</span>
</span><span id="stan_epochs-41"><a href="#stan_epochs-41"><span class="linenos">41</span></a>        <span class="p">)</span>
</span><span id="stan_epochs-42"><a href="#stan_epochs-42"><span class="linenos">42</span></a>
</span><span id="stan_epochs-43"><a href="#stan_epochs-43"><span class="linenos">43</span></a>    <span class="n">epochs</span> <span class="o">=</span> <span class="p">[</span><span class="n">_EpochConfig</span><span class="p">(</span><span class="n">EpochType</span><span class="o">.</span><span class="n">INITIAL_VALUES</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</span><span id="stan_epochs-44"><a href="#stan_epochs-44"><span class="linenos">44</span></a>    <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_EpochConfig</span><span class="p">(</span><span class="n">EpochType</span><span class="o">.</span><span class="n">FAST_ADAPTATION</span><span class="p">,</span> <span class="n">init_duration</span><span class="p">))</span>
</span><span id="stan_epochs-45"><a href="#stan_epochs-45"><span class="linenos">45</span></a>
</span><span id="stan_epochs-46"><a href="#stan_epochs-46"><span class="linenos">46</span></a>    <span class="n">time_left</span> <span class="o">=</span> <span class="n">warmup_duration</span> <span class="o">-</span> <span class="n">init_duration</span> <span class="o">-</span> <span class="n">term_duration</span>
</span><span id="stan_epochs-47"><a href="#stan_epochs-47"><span class="linenos">47</span></a>    <span class="n">this_time</span> <span class="o">=</span> <span class="n">base_duration</span>
</span><span id="stan_epochs-48"><a href="#stan_epochs-48"><span class="linenos">48</span></a>
</span><span id="stan_epochs-49"><a href="#stan_epochs-49"><span class="linenos">49</span></a>    <span class="k">while</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">this_time</span> <span class="o">&lt;=</span> <span class="n">time_left</span><span class="p">:</span>
</span><span id="stan_epochs-50"><a href="#stan_epochs-50"><span class="linenos">50</span></a>        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_EpochConfig</span><span class="p">(</span><span class="n">EpochType</span><span class="o">.</span><span class="n">SLOW_ADAPTATION</span><span class="p">,</span> <span class="n">this_time</span><span class="p">))</span>
</span><span id="stan_epochs-51"><a href="#stan_epochs-51"><span class="linenos">51</span></a>        <span class="n">time_left</span> <span class="o">-=</span> <span class="n">this_time</span>
</span><span id="stan_epochs-52"><a href="#stan_epochs-52"><span class="linenos">52</span></a>        <span class="n">this_time</span> <span class="o">*=</span> <span class="mi">2</span>
</span><span id="stan_epochs-53"><a href="#stan_epochs-53"><span class="linenos">53</span></a>
</span><span id="stan_epochs-54"><a href="#stan_epochs-54"><span class="linenos">54</span></a>    <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_EpochConfig</span><span class="p">(</span><span class="n">EpochType</span><span class="o">.</span><span class="n">SLOW_ADAPTATION</span><span class="p">,</span> <span class="n">time_left</span><span class="p">))</span>
</span><span id="stan_epochs-55"><a href="#stan_epochs-55"><span class="linenos">55</span></a>    <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_EpochConfig</span><span class="p">(</span><span class="n">EpochType</span><span class="o">.</span><span class="n">FAST_ADAPTATION</span><span class="p">,</span> <span class="n">term_duration</span><span class="p">))</span>
</span><span id="stan_epochs-56"><a href="#stan_epochs-56"><span class="linenos">56</span></a>    <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_EpochConfig</span><span class="p">(</span><span class="n">EpochType</span><span class="o">.</span><span class="n">POSTERIOR</span><span class="p">,</span> <span class="n">posterior_duration</span><span class="p">))</span>
</span><span id="stan_epochs-57"><a href="#stan_epochs-57"><span class="linenos">57</span></a>
</span><span id="stan_epochs-58"><a href="#stan_epochs-58"><span class="linenos">58</span></a>    <span class="k">return</span> <span class="n">epochs</span>
</span></pre></div>


            <div class="docstring"><p>Sets up a list of <code><a href="#EpochConfig">liesel.goose.EpochConfig</a></code>'s,
following the Stan Development Team, <a href="https://mc-stan.org/docs/2_28/reference-manual/hmc-algorithm-parameters.html">Stan Reference Manual (2021), Chapter 15.2</a>.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><code>warmup_duration</code>: The number of warmup samples.</li>
<li><code>posterior_duration</code>: The number of posterior samples.</li>
<li><code>init_duration</code>: The number of samples in the <em>initial fast</em> adaptation epoch.</li>
<li><code>term_duration</code>: The number of samples in the <em>final fast</em> adaptation epoch.</li>
<li><code>base_duration</code>: The number of samples in the <em>first slow</em> adaptation epoch.</li>
</ul>
</div>


                </section>
                <section id="summary">
                            <input id="summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">summary</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">results</span><span class="p">:</span> <span class="n">liesel</span><span class="o">.</span><span class="n">goose</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">SamplingResult</span>,</span><span class="param">	<span class="n">per_chain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">param_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">quantiles</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)</span>,</span><span class="param">	<span class="n">hdi_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>,</span><span class="param">	<span class="n">round_digits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">as_dataframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">|</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="summary-471"><a href="#summary-471"><span class="linenos">471</span></a><span class="k">def</span> <span class="nf">summary</span><span class="p">(</span>
</span><span id="summary-472"><a href="#summary-472"><span class="linenos">472</span></a>    <span class="n">results</span><span class="p">:</span> <span class="n">SamplingResult</span><span class="p">,</span>
</span><span id="summary-473"><a href="#summary-473"><span class="linenos">473</span></a>    <span class="n">per_chain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="summary-474"><a href="#summary-474"><span class="linenos">474</span></a>    <span class="n">params</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="summary-475"><a href="#summary-475"><span class="linenos">475</span></a>    <span class="n">param_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="summary-476"><a href="#summary-476"><span class="linenos">476</span></a>    <span class="n">chain_indices</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="summary-477"><a href="#summary-477"><span class="linenos">477</span></a>    <span class="n">quantiles</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span>
</span><span id="summary-478"><a href="#summary-478"><span class="linenos">478</span></a>    <span class="n">hdi_prob</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="summary-479"><a href="#summary-479"><span class="linenos">479</span></a>    <span class="n">round_digits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="summary-480"><a href="#summary-480"><span class="linenos">480</span></a>    <span class="n">as_dataframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="summary-481"><a href="#summary-481"><span class="linenos">481</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="summary-482"><a href="#summary-482"><span class="linenos">482</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="summary-483"><a href="#summary-483"><span class="linenos">483</span></a><span class="sd">    Compute summary statistics and diagnostic measures of posterior samples.</span>
</span><span id="summary-484"><a href="#summary-484"><span class="linenos">484</span></a>
</span><span id="summary-485"><a href="#summary-485"><span class="linenos">485</span></a><span class="sd">    ## Parameters</span>
</span><span id="summary-486"><a href="#summary-486"><span class="linenos">486</span></a>
</span><span id="summary-487"><a href="#summary-487"><span class="linenos">487</span></a><span class="sd">    - `results`:</span>
</span><span id="summary-488"><a href="#summary-488"><span class="linenos">488</span></a><span class="sd">      Result object of the sampling process. Must have a method</span>
</span><span id="summary-489"><a href="#summary-489"><span class="linenos">489</span></a><span class="sd">      `get_posterior_samples()` which extracts all samples from the posterior</span>
</span><span id="summary-490"><a href="#summary-490"><span class="linenos">490</span></a><span class="sd">      distribution.</span>
</span><span id="summary-491"><a href="#summary-491"><span class="linenos">491</span></a>
</span><span id="summary-492"><a href="#summary-492"><span class="linenos">492</span></a><span class="sd">    - `per_chain`:</span>
</span><span id="summary-493"><a href="#summary-493"><span class="linenos">493</span></a><span class="sd">      If `True`, all statistics and diagnostics (except the Rhat value) are computed for</span>
</span><span id="summary-494"><a href="#summary-494"><span class="linenos">494</span></a><span class="sd">      each chain separately. If `False`, one metric is computed for each subparameter</span>
</span><span id="summary-495"><a href="#summary-495"><span class="linenos">495</span></a><span class="sd">      after concatenating all chains.</span>
</span><span id="summary-496"><a href="#summary-496"><span class="linenos">496</span></a>
</span><span id="summary-497"><a href="#summary-497"><span class="linenos">497</span></a><span class="sd">    - `params`:</span>
</span><span id="summary-498"><a href="#summary-498"><span class="linenos">498</span></a><span class="sd">      Names of the model parameters that are contained in the summary output. Must</span>
</span><span id="summary-499"><a href="#summary-499"><span class="linenos">499</span></a><span class="sd">      coincide with the dictionary keys of the `Position` with the posterior samples.</span>
</span><span id="summary-500"><a href="#summary-500"><span class="linenos">500</span></a><span class="sd">      If `None`, all parameters are included.</span>
</span><span id="summary-501"><a href="#summary-501"><span class="linenos">501</span></a>
</span><span id="summary-502"><a href="#summary-502"><span class="linenos">502</span></a><span class="sd">    - `param_indices`:</span>
</span><span id="summary-503"><a href="#summary-503"><span class="linenos">503</span></a><span class="sd">      Indices of each model parameter that are contained in the summary output. Selects</span>
</span><span id="summary-504"><a href="#summary-504"><span class="linenos">504</span></a><span class="sd">      e.g. `beta_0` out of a `beta` parameter vector.A single index can be specified as</span>
</span><span id="summary-505"><a href="#summary-505"><span class="linenos">505</span></a><span class="sd">      an integer or a sequence containing one integer. If `None`, all subparameters are</span>
</span><span id="summary-506"><a href="#summary-506"><span class="linenos">506</span></a><span class="sd">      included.</span>
</span><span id="summary-507"><a href="#summary-507"><span class="linenos">507</span></a>
</span><span id="summary-508"><a href="#summary-508"><span class="linenos">508</span></a><span class="sd">    - `chain_indices`:</span>
</span><span id="summary-509"><a href="#summary-509"><span class="linenos">509</span></a><span class="sd">      Indices of chains for each model subparameter that are contained in the summary</span>
</span><span id="summary-510"><a href="#summary-510"><span class="linenos">510</span></a><span class="sd">      output. Selects e.g. chain 0 and chain 2 out of multiple chains. A single index</span>
</span><span id="summary-511"><a href="#summary-511"><span class="linenos">511</span></a><span class="sd">      can be specified as an integer or a sequence containing one integer. If `None`,</span>
</span><span id="summary-512"><a href="#summary-512"><span class="linenos">512</span></a><span class="sd">      all chains are included.</span>
</span><span id="summary-513"><a href="#summary-513"><span class="linenos">513</span></a>
</span><span id="summary-514"><a href="#summary-514"><span class="linenos">514</span></a><span class="sd">    - `quantiles`:</span>
</span><span id="summary-515"><a href="#summary-515"><span class="linenos">515</span></a><span class="sd">      Quantiles of the posterior distribution that are contained in the summary output.</span>
</span><span id="summary-516"><a href="#summary-516"><span class="linenos">516</span></a>
</span><span id="summary-517"><a href="#summary-517"><span class="linenos">517</span></a><span class="sd">    - `hdi_prob`:</span>
</span><span id="summary-518"><a href="#summary-518"><span class="linenos">518</span></a><span class="sd">      Coverage level of the Highest Density Interval of the posterior distribution.</span>
</span><span id="summary-519"><a href="#summary-519"><span class="linenos">519</span></a><span class="sd">      Summary output contains lower and upper bound of this interval.</span>
</span><span id="summary-520"><a href="#summary-520"><span class="linenos">520</span></a>
</span><span id="summary-521"><a href="#summary-521"><span class="linenos">521</span></a><span class="sd">    - `round_digits`:</span>
</span><span id="summary-522"><a href="#summary-522"><span class="linenos">522</span></a><span class="sd">      Number of decimals for each float value within the summary output.</span>
</span><span id="summary-523"><a href="#summary-523"><span class="linenos">523</span></a>
</span><span id="summary-524"><a href="#summary-524"><span class="linenos">524</span></a><span class="sd">    - `as_dataframe`:</span>
</span><span id="summary-525"><a href="#summary-525"><span class="linenos">525</span></a><span class="sd">      If `True`, all statistics and diagnostics are embedded into a `pandas` data frame.</span>
</span><span id="summary-526"><a href="#summary-526"><span class="linenos">526</span></a><span class="sd">      If `False`, a dictionary with the same keys as `Position` with the posterior</span>
</span><span id="summary-527"><a href="#summary-527"><span class="linenos">527</span></a><span class="sd">      samples is returned.</span>
</span><span id="summary-528"><a href="#summary-528"><span class="linenos">528</span></a>
</span><span id="summary-529"><a href="#summary-529"><span class="linenos">529</span></a><span class="sd">    ## Returns</span>
</span><span id="summary-530"><a href="#summary-530"><span class="linenos">530</span></a>
</span><span id="summary-531"><a href="#summary-531"><span class="linenos">531</span></a><span class="sd">    Dictionary if `as_dataframe` is False, `pandas.DataFrame` if `as_dataframe` is</span>
</span><span id="summary-532"><a href="#summary-532"><span class="linenos">532</span></a><span class="sd">    True.</span>
</span><span id="summary-533"><a href="#summary-533"><span class="linenos">533</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="summary-534"><a href="#summary-534"><span class="linenos">534</span></a>    <span class="c1"># NOTE: Docstring Duplications</span>
</span><span id="summary-535"><a href="#summary-535"><span class="linenos">535</span></a>    <span class="c1"># The entries `results`, `params`, `param_indices` and `chain_indices` are shared</span>
</span><span id="summary-536"><a href="#summary-536"><span class="linenos">536</span></a>    <span class="c1"># with all user plotting functions.</span>
</span><span id="summary-537"><a href="#summary-537"><span class="linenos">537</span></a>    <span class="n">posterior_samples</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_posterior_samples</span><span class="p">()</span>
</span><span id="summary-538"><a href="#summary-538"><span class="linenos">538</span></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">validate_params</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span><span id="summary-539"><a href="#summary-539"><span class="linenos">539</span></a>
</span><span id="summary-540"><a href="#summary-540"><span class="linenos">540</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">as_dataframe</span><span class="p">:</span>
</span><span id="summary-541"><a href="#summary-541"><span class="linenos">541</span></a>        <span class="k">return</span> <span class="n">collect_param_dicts</span><span class="p">(</span>
</span><span id="summary-542"><a href="#summary-542"><span class="linenos">542</span></a>            <span class="n">posterior_samples</span><span class="p">,</span>
</span><span id="summary-543"><a href="#summary-543"><span class="linenos">543</span></a>            <span class="n">per_chain</span><span class="p">,</span>
</span><span id="summary-544"><a href="#summary-544"><span class="linenos">544</span></a>            <span class="n">params</span><span class="p">,</span>
</span><span id="summary-545"><a href="#summary-545"><span class="linenos">545</span></a>            <span class="n">param_indices</span><span class="p">,</span>
</span><span id="summary-546"><a href="#summary-546"><span class="linenos">546</span></a>            <span class="n">chain_indices</span><span class="p">,</span>
</span><span id="summary-547"><a href="#summary-547"><span class="linenos">547</span></a>            <span class="n">quantiles</span><span class="p">,</span>
</span><span id="summary-548"><a href="#summary-548"><span class="linenos">548</span></a>            <span class="n">hdi_prob</span><span class="p">,</span>
</span><span id="summary-549"><a href="#summary-549"><span class="linenos">549</span></a>            <span class="n">round_digits</span><span class="p">,</span>
</span><span id="summary-550"><a href="#summary-550"><span class="linenos">550</span></a>        <span class="p">)</span>
</span><span id="summary-551"><a href="#summary-551"><span class="linenos">551</span></a>
</span><span id="summary-552"><a href="#summary-552"><span class="linenos">552</span></a>    <span class="k">return</span> <span class="n">collect_param_dfs</span><span class="p">(</span>
</span><span id="summary-553"><a href="#summary-553"><span class="linenos">553</span></a>        <span class="n">posterior_samples</span><span class="p">,</span>
</span><span id="summary-554"><a href="#summary-554"><span class="linenos">554</span></a>        <span class="n">per_chain</span><span class="p">,</span>
</span><span id="summary-555"><a href="#summary-555"><span class="linenos">555</span></a>        <span class="n">params</span><span class="p">,</span>
</span><span id="summary-556"><a href="#summary-556"><span class="linenos">556</span></a>        <span class="n">param_indices</span><span class="p">,</span>
</span><span id="summary-557"><a href="#summary-557"><span class="linenos">557</span></a>        <span class="n">chain_indices</span><span class="p">,</span>
</span><span id="summary-558"><a href="#summary-558"><span class="linenos">558</span></a>        <span class="n">quantiles</span><span class="p">,</span>
</span><span id="summary-559"><a href="#summary-559"><span class="linenos">559</span></a>        <span class="n">hdi_prob</span><span class="p">,</span>
</span><span id="summary-560"><a href="#summary-560"><span class="linenos">560</span></a>        <span class="n">round_digits</span><span class="p">,</span>
</span><span id="summary-561"><a href="#summary-561"><span class="linenos">561</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute summary statistics and diagnostic measures of posterior samples.</p>

<h2 id="parameters">Parameters</h2>

<ul>
<li><p><code>results</code>:
Result object of the sampling process. Must have a method
<code>get_posterior_samples()</code> which extracts all samples from the posterior
distribution.</p></li>
<li><p><code>per_chain</code>:
If <code>True</code>, all statistics and diagnostics (except the Rhat value) are computed for
each chain separately. If <code>False</code>, one metric is computed for each subparameter
after concatenating all chains.</p></li>
<li><p><code>params</code>:
Names of the model parameters that are contained in the summary output. Must
coincide with the dictionary keys of the <code><a href="#Position">Position</a></code> with the posterior samples.
If <code>None</code>, all parameters are included.</p></li>
<li><p><code>param_indices</code>:
Indices of each model parameter that are contained in the summary output. Selects
e.g. <code>beta_0</code> out of a <code>beta</code> parameter vector.A single index can be specified as
an integer or a sequence containing one integer. If <code>None</code>, all subparameters are
included.</p></li>
<li><p><code>chain_indices</code>:
Indices of chains for each model subparameter that are contained in the summary
output. Selects e.g. chain 0 and chain 2 out of multiple chains. A single index
can be specified as an integer or a sequence containing one integer. If <code>None</code>,
all chains are included.</p></li>
<li><p><code>quantiles</code>:
Quantiles of the posterior distribution that are contained in the summary output.</p></li>
<li><p><code>hdi_prob</code>:
Coverage level of the Highest Density Interval of the posterior distribution.
Summary output contains lower and upper bound of this interval.</p></li>
<li><p><code>round_digits</code>:
Number of decimals for each float value within the summary output.</p></li>
<li><p><code>as_dataframe</code>:
If <code>True</code>, all statistics and diagnostics are embedded into a <code>pandas</code> data frame.
If <code>False</code>, a dictionary with the same keys as <code><a href="#Position">Position</a></code> with the posterior
samples is returned.</p></li>
</ul>

<h2 id="returns">Returns</h2>

<p>Dictionary if <code>as_dataframe</code> is False, <code>pandas.DataFrame</code> if <code>as_dataframe</code> is
True.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>